Class EMRservice.CAHandsign.HBCA.GenEventCert Extends %CSP.Page [ ProcedureBlock ]
{

ClassMethod OnPage() As %Status
{
	s application = $Get(%request.Data("application",1),"")
	d ..applyCert(application)
	Quit $$$OK
}

/// Return: json  {"retCode":"0","retMsg":"消息提示"}
/// Debug:	w ##Class(CA.Handsign.HBCA.GenEventCert).applyCert("{""applySubject"":""test"",""userIdCardNum"":""420702200001011111"",""authUserId"":""BFF708B38E154A5F867B61ACF194D3A7"",""applyPlatform"":""LCA"",""dn"":""C\u003dCN,ST\u003d湖北,L\u003d武汉,OU\u003d4202@1@4444,CN\u003d湖北CA"",""userName"":""kebiao"",""projectId"":""15402F1340BE4B988AA166327C08E920""}")
/// 		w ##class(CA.Handsign.HBCA.GenEventCert).applyCert(^DHCCERTAUTH("Debugger","Handsign"))
ClassMethod applyCert(application As %String) As %String
{
	//s ^DHCCERTAUTH("Debugger","Handsign") = application
	//w "{""notBefore"":1604559943957,""certB64"":""MIIDnDCCAoSgAwIBAgIRAJZOIhf/SUqAl07zbb4cpRgwDQYJKoZIhvcNAQEFBQAwYDEgMB4GA1UEAwwX5rmW5YyXQ0HmtYvor5VMQ0HmoLlSU0ExDTALBgNVBAoMBEhCQ0ExDzANBgNVBAcMBuatpuaxiTEPMA0GA1UECAwG5rmW5YyXMQswCQYDVQQGEwJDTjAeFw0yMDExMDUwNzA1NDNaFw0yMTAyMTMwNzA1NDNaMEsxCzAJBgNVBAYTAkNOMQowCAYDVQQIDAFWMQswCQYDVQQHDAJmSTEUMBIGA1UECwwLNDIwMkAxQDQ0NDQxDTALBgNVBAMMBFYXQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCQOrp82eRhpsnmgRUde91BRmSbxEzUGbMSR6r2iNVyD90nJ+L+JMOivn4ViQtYWkJC3Q98R+6Db8K7NsegR3ZtPXMsv+czpzqCzaLW1rxRr4Bk1SMTEbrb1frraNvr50qFMgw2RcPMTzhwJuXikMlY6mE74dWQ6CHPHc5ehq09bxwKUC4BaRKUYQI+4ib39PhPJIrwrx4qHqigyftTskaAESwZxMKO+P3vtdGompi5yTfQ347z63ds108ay/3J9PsDYOANEqlded3YT76UJXqPtfiXwltotor8SeQbejvZHPacXlJbos94ZEslf3Nyl4IIFyryd9XHnuvTUAhx5C0JAgMBAAGjZjBkMB8GA1UdIwQYMBaAFGm1evveELFPWgU3hmiZCLO2PzgDMB0GA1UdDgQWBBS1cZzBPXInUUaEcxJnOHV7Z/zCJTALBgNVHQ8EBAMCBsAwCQYDVR0TBAIwADAKBgVUEAsHAwQBMTANBgkqhkiG9w0BAQUFAAOCAQEAok6I1RG6SVEc4qJL7DZgF+b/+R/Tl/EshgnWTrsRBvpeJlO0Nld3yjwGQ3Js0kYWbArNqpzY1Y4Y+EvaaIlVJQSNrTRVKu+4DrCf4Fu15r5RjW04M6fu+kfc3ypSz+pm7nbiqDzxC5J3bNNd+6dWvV4r+mGrv+p2FPJCpiH2r7PHnS6nmT6BQW/LFXAkQ2MGR5EXM1vcHoXbI3b410PjsD6lsnBz/mgkoE80AgxhY821jOlY/O+gIlV+wPMhmNPWZEKjbGiJHe3MC+55FI5dnUN+JpzbhLsAgPkxbYbZsjfIK1Lfr9o4pF23juPbpRQeWx9Vqcf8TWFfxfXqFiKi+g=="",""pubKeyHex"":""30820122300d06092a864886f70d01010105000382010f003082010a0282010100903aba7cd9e461a6c9e681151d7bdd4146649bc44cd419b31247aaf688d5720fdd2727e2fe24c3a2be7e15890b585a4242dd0f7c47ee836fc2bb36c7a047766d3d732cbfe733a73a82cda2d6d6bc51af8064d5231311badbd5faeb68dbebe74a85320c3645c3cc4f387026e5e290c958ea613be1d590e821cf1dce5e86ad3d6f1c0a502e0169129461023ee226f7f4f84f248af0af1e2a1ea8a0c9fb53b24680112c19c4c28ef8fdefb5d1a89a98b9c937d0df8ef3eb776cd74f1acbfdc9f4fb0360e00d12a95d79ddd84fbe94257a8fb5f897c25b68b68afc49e41b7a3bd91cf69c5e525ba2cf78644b257f7372978208172af277d5c79eebd3500871e42d090203010001"",""errorCode"":""0"",""priKeyHex"":""308204be020100300d06092a864886f70d0101010500048204a8308204a40201000282010100903aba7cd9e461a6c9e681151d7bdd4146649bc44cd419b31247aaf688d5720fdd2727e2fe24c3a2be7e15890b585a4242dd0f7c47ee836fc2bb36c7a047766d3d732cbfe733a73a82cda2d6d6bc51af8064d5231311badbd5faeb68dbebe74a85320c3645c3cc4f387026e5e290c958ea613be1d590e821cf1dce5e86ad3d6f1c0a502e0169129461023ee226f7f4f84f248af0af1e2a1ea8a0c9fb53b24680112c19c4c28ef8fdefb5d1a89a98b9c937d0df8ef3eb776cd74f1acbfdc9f4fb0360e00d12a95d79ddd84fbe94257a8fb5f897c25b68b68afc49e41b7a3bd91cf69c5e525ba2cf78644b257f7372978208172af277d5c79eebd3500871e42d090203010001028201000595ce9fb3d8e31ab03e1dc0cd72dcdd309e88052ca3f8884d948aa7702252dfd024ba67d10767af8b50aae11318456b84371708cd28cc7c7516269f89a286d0a164eec6522bd7059e27dc2ed56336c714f1e2aa906c1af83523b9bec6686edd1d061480bc082266ed74b35eeadc883d8a1b009484de8f0cb31e707dcad995d3c326385825cabdff3894a52be1fb1f9885941c510574e67b9bb62e61a157a1bb17f5c3173b30c72adea7a13f0e1c431db9632621128b2736daea56504af8dc473254c186a828d703fd753a6da03b73194b89e5d3cd4237e3083e79ab9335fcb4d947c74e9c464223b9f45d17946b705b4a74e36f18346b33c726f1b96f92dac102818100c6ea0cd73857d3cf187816f8455a3e8999c792623c31a0c85dfc0c40dd5e58a08138c93979ed4b3f325e4f10063dfd47bda1a2333244204c8ee56bdebac6cc63864e8017e8a5ed01f227458836654b07d4dfddeb254c55f6eb86534bd1cb74de9f5c58ba03a981329d1746067d3f65cef366d52bc9c708fab3b86a1750d4e34102818100b99f0f3d4d31ffd7cc51234efa30b9bbe546ca2ad5f002924da3f66cbb053438a35851eb4c4313452e8b9523447844d91586fbdecbf5298189109a5fa8cd3e18cecb9a3b87586b33d28084f9b6a623d487299c3a2ee245e5d24c5e7bd1fdef86b47e4377465268d0e5645cc2cfb0b6bd2625925d2aa87b912e832fd7b460ffc9028180300ca3936d99d1a16a20c033b2d50cdc42587224e6b37a4a4c61b1380e015759563db865f8ecf84b48c87d42baaf48ba86b53fb02c4946a017b895a914e726c237d4489efde4eeee94672625b4361dbcc3905c540c0b778c90f23eb6c6f3e5c44d2c8a864c922a92665e13dd476e0412ccbb1f6d576d8bdebb8125a782301ac1028181009bbb5f45c72653c7f19b814c198c17c814ac37a188ac3cfc1237a5dfc368b24f727bfefeb294f3edef071cb0e219256a1c2d8bd378bacf7fe6470fbd8219f027501871e5cfbfd6f13b82a80df9b79a080cfe541c5c896aab4eacd3f87e4dd64fe5cea93bc0bc13446fb0ac42a58d55438c65a94e912399c84c85b3f5fd580441028181009e952ea619a4c05f742106dc12ef71985a450c8e72cf58f0e56cb01ec455a6d7e340be501c7c769cd47561ed13bb4e1820f7a751eb6db4a885f6ecabb0accd5a1417b38b00f55f4450712e4a22f8276123034a7903271ca817d55b94e9b8be85a6e3e3ac611eb03b0899ac7251745f26899f2f4c888c9c1a1694bec2d57921c2"",""errorMsg"":""成功"",""notAfter"":1613199943957,""certSn"":""964E2217FF494A80974EF36DBE1CA518"",""pfxPassword"":""11111111"",""pfxB64"":""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""}"
	
	// 创建对象http://221.232.224.75:58140/hbcaLCA/lcaCert/genCertNew.do
    s service= ##class(%Net.HttpRequest).%New()
	s service.OpenTimeout = 5
	s service.Timeout = 5
	s service.Server = "10.220.8.153"
	s service.Port = "8080"
	
	s service.ContentType="text/html;"
	s service.ContentCharset = "ASCII"
	d service.EntityBody.Write(application)	
	d service.Post("/hbcaLCA/lcaCert/genCertNew.do")
	
	s response=service.HttpResponse
	s (ret,errinfo,content) = ""
	if $isobject(response.Data) {
		s ret = response.Data
		if (0=ret.Size) {}
		else {
			while (ret.AtEnd = 0) { s content=content_ret.Read(32000) }			
		}
	}
	w content
}

}
