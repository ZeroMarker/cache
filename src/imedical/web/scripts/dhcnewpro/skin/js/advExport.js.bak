///不良事件导出
function ExportWordData(ID,RepTypeCode,RepType,filePath)
{ 
	var RepDate="",OccDateTime="",RepProcess=""
	runClassMethod("web.DHCADVCOMMONPRINT","GetExportbyWord",
	{AdvMasterDr:ID,RepTypeCode:RepTypeCode},function(ret){
		var tmp=ret.replace(/(^\s*)|(\s*$)/g,"").split("^");
		RepDate=tmp[0];
		OccDateTime=tmp[1];
		RepProcess=tmp[2];
						
	},"",false);
	var WordApp=new ActiveXObject("Word.Application"); 
	var wdCharacter=1 
	var wdOrientLandscape = 1 
	WordApp.Application.Visible=true; //执行完成之后是否弹出已经生成的word 
	var myDoc=WordApp.Documents.Add();//创建新的空文档
	
	//WordApp.ActiveDocument.PageSetup.Orientation = wdOrientLandscape//页面方向设置为横向 
	WordApp. Selection.ParagraphFormat.Alignment=1 //1居中对齐,0为居右
	WordApp. Selection.ParagraphFormat.BaseLineAlignment=4 //1居中对齐,0为居右  
	WordApp. Selection.Font.Bold=true 
	WordApp. Selection.Font.Size=16 
	WordApp. Selection.TypeText("护理不良事件改进报表（典型案例分析）"); 
	/*
	WordApp. Selection.MoveRight(wdCharacter);　　　　// 光标右移字符 
	WordApp. Selection.TypeParagraph()　　　　　　　　// 插入段落 
	WordApp. Selection.Font.Size=12 
	WordApp. Selection.TypeText("-----作者");         // 分行插入日期 
	*/
	WordApp.Selection.TypeParagraph()     // 插入段落
	WordApp. Selection.Font.Bold=false 
	WordApp. Selection.Font.Size=9
	var myTable=myDoc.Tables.Add (WordApp.Selection.Range, 8,2) //8行7列的表格 
	myTable.Style="网格型"
	var title = "标题" 
	var TableRange; //以下为给表格中的单元格赋值 
	myTable.Rows.Height =30; //设置行高
	myTable.Rows(1).Cells.Merge();//合并整行
	myTable.Cell(1,1).width=420;
	myTable.Rows(2).Cells.Merge();//合并整行
	myTable.Cell(2,1).width=420;
	myTable.Cell(2,1).range.Font.Bold= false;
	myTable.Rows(3).Cells.Merge();//合并整行
	myTable.Cell(3,1).width=420;
	myTable.Cell(3,1).Height="50";
	/*
	for (i= 0;i<4;i++) 
	{ 
		with (myTable.Cell(1,i+1).Range) 
		{ 
			font.Size = 12; 
			InsertAfter("这是第" +i+ "列"+title); 
			ColumnWidth =4
		}
	} 
	*/
	/*for (n =0;n<8;n++) 
	{ 
		
		for (i =0;i<2;i++) 
		{ 
			with (myTable.Cell(n+2,i+1).Range) 
			{
				font.Size = 12; 
				InsertAfter("行内容"); 
			}
		}
		
		myTable.Cell(n+4,1).width=140;
		myTable.Cell(n+4,1).range.Text="奥术大师多";
		myTable.Cell(n+4,2).width=280;
		myTable.Cell(n+4,1).Height="50";
	}*/
	myTable.Cell(1,1).range.Text="上报日期：   "+RepDate+"                   发生时间："+OccDateTime;
	myTable.Cell(2,1).range.Text="医疗机构名称： "+LgHospDesc+"                  不良事件类别： "+RepType;
	//myTable.Cell(n+2,2).Height="25";
	myTable.Cell(3,1).range.Text="事件过程（详细描述）："+RepProcess;
	myTable.Cell(3,1).Height="200";
	myTable.Rows(4).Cells.Merge();//合并整行
	myTable.Cell(4,1).range.Text="原因分析"
	myTable.Cell(4,1).width=420;
	myTable.Cell(5,1).width=140;
	myTable.Cell(5,1).range.Text="人（任何相关人员）";
	myTable.Cell(5,2).width=280;
	myTable.Cell(5,1).Height="50";
	
	myTable.Cell(6,1).width=140;
	myTable.Cell(6,1).range.Text="方法（环节、政策、指南规范）";
	myTable.Cell(6,2).width=280;
	myTable.Cell(6,1).Height="50";
	
	myTable.Cell(7,1).width=140;
	myTable.Cell(7,1).range.Text="材料（材料用品、耗材、形式、培训手册）";
	myTable.Cell(7,2).width=280;
	myTable.Cell(7,1).Height="50";
	
	myTable.Cell(8,1).width=140;
	myTable.Cell(8,1).range.Text="机器（技术、设备、系统）";
	myTable.Cell(8,2).width=280;
	myTable.Cell(8,1).Height="50";
	
	myTable.Cell(9,1).width=140;
	myTable.Cell(9,1).range.Text="环境（温度，湿度，噪声干扰，照明，净化污染）";
	myTable.Cell(9,2).width=280;
	myTable.Cell(9,1).Height="50";
	
	myTable.Cell(10,1).width=140;
	myTable.Cell(10,1).range.Text="其他";
	myTable.Cell(10,2).width=280;
	myTable.Cell(10,1).Height="50";
	

	
	
	
	myTable.range.ParagraphFormat.Alignment = 0; //向左对其
	row_count = 0; 
	col_count = 0 
	myDoc.Protect(1) 
}
			
		
///不良事件朝阳导出excel统计
function ExportExcelStatic(StDate,EndDate,filePath)
{ 
	var  retvalArr="",succflag="false"

	runClassMethod("web.DHCADVCOMMONPRINT","GetExportbyExcel",
	{StDate:StDate,EndDate:EndDate},function(ret){
				
		retvalArr=ret.replace(/(^\s*)|(\s*$)/g,"").split("^");
	},"",false);
	if(retvalArr==""){
		$.messager.alert("提示:","取数据错误！");
		return;
	}	
	//1、获取XLS导出路径
	var path=tkMakeServerCall("web.DHCDocConfig","GetPath");
	var Template = path+"DHCADV_ExportStatic.xlsx";

	var xlApp = new ActiveXObject("Excel.Application");
	var xlBook = xlApp.Workbooks.Add(Template);
	var objSheet = xlBook.ActiveSheet;
	alert(retvalArr);
	objSheet.Cells(2,5).value=LgHospDesc; //医院名称
	objSheet.Cells(8,1).value=retvalArr[0]; //总数
	objSheet.Cells(8,2).value=retvalArr[1]; //痊愈
	objSheet.Cells(8,3).value=retvalArr[2]; //好转
	objSheet.Cells(8,4).value=retvalArr[3]; //未发展
	objSheet.Cells(8,5).value=retvalArr[4]; //发展
	objSheet.Cells(8,6).value=retvalArr[5]; //Ⅰ
	objSheet.Cells(8,7).value=retvalArr[6]; //Ⅱ
	objSheet.Cells(8,8).value=retvalArr[7]; //Ⅲ
	objSheet.Cells(8,9).value=retvalArr[8]; //Ⅳ
	objSheet.Cells(8,10).value=retvalArr[9]; //Ⅴ
	objSheet.Cells(8,11).value=retvalArr[10]; //Ⅵ
	objSheet.Cells(8,12).value=retvalArr[11]; //院外带入
	objSheet.Cells(8,13).value=retvalArr[12]; //胃管
	objSheet.Cells(8,14).value=retvalArr[13]; //尿管
	objSheet.Cells(8,15).value=retvalArr[14]; //深静脉
	objSheet.Cells(8,16).value=retvalArr[15]; //其他
	objSheet.Cells(8,17).value=retvalArr[16]; //跌倒
	objSheet.Cells(8,18).value=retvalArr[17]; //坠床
	objSheet.Cells(8,19).value=retvalArr[18]; //给错患者
	objSheet.Cells(8,20).value=retvalArr[19]; //时间
	objSheet.Cells(8,21).value=retvalArr[20]; //剂量
	objSheet.Cells(8,22).value=retvalArr[21]; //其他
	objSheet.Cells(8,23).value=retvalArr[22]; //走失
	objSheet.Cells(8,24).value=retvalArr[23]; //自杀
	objSheet.Cells(8,25).value=retvalArr[24]; //烫伤
	objSheet.Cells(8,26).value=retvalArr[25]; //其他
	objSheet.Cells(8,27).value=retvalArr[26]; //医疗相关
	objSheet.Cells(8,28).value=retvalArr[27]; //药事相关
	objSheet.Cells(8,29).value=retvalArr[28]; //护理相关
	objSheet.Cells(8,30).value=retvalArr[29]; //其他

	objSheet.Cells(13,5).value=LgUserName; //上报人
	objSheet.Cells(13,16).value="64456715"; //联系电话
	objSheet.Cells(13,24).value=formatDate(0); //上报时间
	succflag=xlBook.SaveAs(filePath+"北京市朝阳区医疗机构护理安全（不良）事件报表"+".xlsx");
	xlApp=null;
	xlBook.Close(savechanges=false);
	objSheet=null;
	return succflag;
}

///不良事件医管局导出excel统计
function ExportExcelAllData(StDate,EndDate,RepType,filePath)
{ 
	var  retvalArr="",succflag="false"

	runClassMethod("web.DHCADVCOMMONPRINT","GetExpbyExcel",
	{StDate:StDate,EndDate:EndDate,reporttype:RepType},function(ret){
				
		retvalArr=ret;
	},"json",false);
	if(retvalArr==""){
		$.messager.alert("提示:","取数据错误！");
		return false;
	}		
		//意外事件报告单
		if(RepType=="意外事件报告单"){  
			succflag=exportAccidentData(retvalArr); //
		}
		//用药错误报告单
		if(RepType=="用药错误报告单"){ 
			succflag=exportDrugErrData(retvalArr);
		}
		//跌倒(坠床)事件报告单	
		if(RepType=="跌倒(坠床)事件报告单"){  
			succflag=exportFallDownData(retvalArr);
		}
		//管路脱落报告单
		if(RepType=="管路脱落报告单"){  
			succflag=exportPipeOffData(retvalArr);
		}
		//压疮报告单
		if(RepType=="压疮报告单"){  
			succflag=exportSkinUlcerData(retvalArr);
		}	
	return succflag;
}
function exportAccidentData(data){
	var succflag="false";
	//var data=DataList.split("$$")
	var strjLen=data.length;
	//1、获取XLS导出路径
	var path=tkMakeServerCall("web.DHCDocConfig","GetPath");
	var Template = path+"DHCADV_AccidentFillexcel.xls";
	var xlApp = new ActiveXObject("Excel.Application");
	var xlBook = xlApp.Workbooks.Add(Template);
	var objSheet = xlBook.ActiveSheet;	
	for (i=1;i<strjLen;i++)
  {
		data[i].RepHospType
		objSheet.Cells(1+i,1).value=$g(data["RepHospType"]); //填报单位
		objSheet.Cells(1+i,2).value="'"+"003903110105210111"; //机构登记号
		objSheet.Cells(1+i,3).value=""; //填报科室1		
		objSheet.Cells(1+i,4).value=""; //填报科室2
		objSheet.Cells(1+i,5).value=$g(data["ReportDate"]); //报告日期	
		objSheet.Cells(1+i,6).value=""; //$g(data["DisMedThingPatName"]); //患者姓名
		objSheet.Cells(1+i,7).value=""; //$g(data["PatMedicalNo"]); //病案号	
		objSheet.Cells(1+i,8).value=""; //$g(data["OccuLoc"]); //发生科室		
		objSheet.Cells(1+i,9).value=""; //radioValue("PatOrigin-label-94335,PatOrigin-label-94336,PatOrigin-label-94337,PatOrigin-label-94338,PatOrigin-label-94339",data); //患者来源
		objSheet.Cells(1+i,10).value=""; //$g(data["PatSexinput"]); //性别
		objSheet.Cells(1+i,11).value=""; //$g(data["PatAge"]); //年龄
		objSheet.Cells(1+i,12).value=radioValue("DegreeEducate-94370,DegreeEducate-94371,DegreeEducate-94372,DegreeEducate-94373,DegreeEducate-94374,DegreeEducate-94375",data); //文化程度
		objSheet.Cells(1+i,13).value=$g(data["PatDiag"]); //第一诊断		
		objSheet.Cells(1+i,14).value=$g(data["PatAdmDate"]); //入院日期  
		objSheet.Cells(1+i,15).value="入院时ADL得分："+$g(data["PatAdmADLScore"]); //入院时ADL得分
		objSheet.Cells(1+i,16).value=radioValue("NursingLev-94352,NursingLev-94353,NursingLev-94354,NursingLev-94355,NursingLev-94367",data); //护理级别
		objSheet.Cells(1+i,17).value=radioValue("PatSelfCareAbility-94345,PatSelfCareAbility-94346,PatSelfCareAbility-94347",data); //患者自我照顾能力
		objSheet.Cells(1+i,18).value=radioValue("AFType-94495,AFType-94498,AFType-94499",data); //意外事件发生类型
		objSheet.Cells(1+i,19).value=""; //意外事件类型其他
		var oth=radioValue("AFType-94500,AFType-94927,AFType-94978,AFType-94979,AFType-94980,AFType-94981,AFType-94165",data);
		if(oth!=""){
			objSheet.Cells(1+i,18).value="其他"
			objSheet.Cells(1+i,19).value=oth;
		}
		objSheet.Cells(1+i,20).value=$g(data["HappenTime"])+" "+$g(data["OccurTime"]).split(":")[0]+"时"; //给药发生日期
		objSheet.Cells(1+i,21).value=radioValue("HappenPlace-label-94575,HappenPlace-label-94576,HappenPlace-label-94577,HappenPlace-label-94579,HappenPlace-label-94580,HappenPlace-label-94581,HappenPlace-label-94582,HappenPlace-label-94583,HappenPlace-label-94584,HappenPlace-label-94585",data); //发生地点
		objSheet.Cells(1+i,22).value=radioValue("PatEscort-94349,PatEscort-94350",data); //陪护人员		
		objSheet.Cells(1+i,23).value=radioValue("DiscoverMan-94528,DiscoverMan-94530,DiscoverMan-94531,DiscoverMan-94532",data); //发现人
		objSheet.Cells(1+i,24).value=radioValue("PipeDutyNurTitle-94468,PipeDutyNurTitle-94469,PipeDutyNurTitle-94470,PipeDutyNurTitle-94471",data); //事件发生当班护士职称
		objSheet.Cells(1+i,25).value=""; //工作年限
		if($g(data["WLManWorkLife"])!=""){
			objSheet.Cells(1+i,25).value=$g(data["WLManWorkLife"])+"年"; //工作年限
		}	
		objSheet.Cells(1+i,26).value=radioValue("AFResult-94565",data); //事件造成的后果
		objSheet.Cells(1+i,27).value=$g(data["AFResult-94567"]); //事件造成的后果		
		if($g(data["AFResult-94567"])!=""){
			objSheet.Cells(1+i,26).value="其他"
		}
		objSheet.Cells(1+i,28).value=$g(data["WLEventProcess"]); //事件经过
	}
	succflag=xlBook.SaveAs(filePath+"YWSJ_"+".xlsx");
	xlApp=null;
	xlBook.Close(savechanges=false);
	objSheet=null;
	return succflag;
}



//处理未定义的变量
function $g(param){
	return param==undefined?"":	param;
}
//radio和checkbox数据获取
function radioValue(param,data){
	//alert(param);
	var ret=[]
	
	if(param==="") return "";
	paramArray = param.split(",");
	
	for(var i =0;i<paramArray.length;i++){
		if($g(data[paramArray[i]])!=""){
			ret.push($g(data[paramArray[i]]));
		}
	}
	
	return ret.join("； ");
}

//radio和checkbox数据获取  带有子元素拼串
function checksubValue(data,param,subdata){
	//alert(param);
	var ret=[]
	if(param==="") return "";
	paramArray = param.split(",");
	for(var i =0;i<paramArray.length;i++){
		if($g(subdata[paramArray[i]])!=""){
			ret.push($g(subdata[paramArray[i]]));
		}
	}
	if (ret.join("； ")!=""){
		data=data+"（"+ret.join("； ")+"）";
	}
	return data;
}
function myRadioValue(param,data){
	var ret = radioValue(param,data);
	if(ret===""){
		ret="无";
	}
	return ret;
}