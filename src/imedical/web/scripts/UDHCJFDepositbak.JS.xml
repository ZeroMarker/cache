var SelectedRow = 0;
var Adm,RcptFlag,Guser,CurNo,EndNo,Title,UserLoc
var returnval,path
var gusername,PrtFlag
var curyear,curmon,curday
var gusercode
var payamt
var Prtrowid,Arpbl,PrtStatus,CurNo,EndNo,Title,RcptRowid,JkFlag
var Objtbl,Rows,Sum,i,status,select
var gusername
var clickflag=0
var curyear,curmon,curday,path
var deptypeobj,pyobj,bankobj
var company,bank,cardno,authno,patadmdate //yyx 2006-11-08  
var zfflag="Y"
   // alert(eval(45).toFixed(2))

function BodyLoadHandler() {
	alert(eval(45).toFixed(2))
	gettoday()
	RcptFlag="Y"
	PrtFlag="N"
	Abortprt="N"

	var getpath=document.getElementById('getpath');
	if (getpath) {var encmeth=getpath.value} else {var encmeth=''};
	  path=cspRunServerMethod(encmeth,'','');
	        
	Guser=session['LOGON.USERID']
   	UserLoc=session['LOGON.CTLOCID']
   	gusercode=session['LOGON.USERCODE']
    CurNo=""
    var papobj=document.getElementById('papno')
    var papno=papobj.value;
    papobj.onkeydown=getpapno
   	
    Adm=document.getElementById('Adm').value;
  	if ((papno=="")&&(Adm!="")){
    var infro=document.getElementById('getinfro');
	if (infro) {var encmeth=infro.value}else {var encmeth=''};
	if (cspRunServerMethod(encmeth,'set_pat','',Adm)=='1'){
	}
    }
    deptypeobj=document.getElementById('deposittype');
    pyobj=document.getElementById('paymode');
    bankobj=document.getElementById('bank');
    authnoobj=document.getElementById('authno');
    deptypeobj.onkeydown=getdeptype;
    pyobj.onkeydown=getpy;
    bankobj.onkeydown=getbank;
    authnoobj.onkeydown=enterauthno
    var deposittype=deptypeobj.value
    if (deposittype=="")
    { 
      deposittype=t['09'];
      deptypeobj.value=deposittype
    }
	var typeid=document.getElementById('gettyperowid');
	if (typeid) {var encmeth=typeid.value} else {var encmeth=''};
	var tmp=cspRunServerMethod(encmeth,'','',deposittype)
	document.getElementById('deptype').value=tmp
	document.getElementById('paymode').value=t['10']
	
    var modeid=document.getElementById('getpaymodeid');
	if (modeid) {var encmeth=modeid.value} else {var encmeth=''};
	var tmp1=cspRunServerMethod(encmeth,'','')
	document.getElementById('moderowid').value=tmp1
	document.getElementById('deposittype').readOnly=true
	//document.getElementById('paymode').readOnly=true
	document.getElementById('currentno').readOnly=true
    if (RcptFlag=="Y")
	{
		var rcptno=document.getElementById('getrcptno');
	if (rcptno) {var encmeth=rcptno.value} else {var encmeth=''};
	if (cspRunServerMethod(encmeth,'GetRcptNo','',Guser)=='0') {
			} 
	}
	var obj=document.getElementById("BtnPrint");
	if (obj) obj.onclick=Add_click;	
	obj=document.getElementById("Return");
	if (obj) obj.onclick=Return_click;	
	//payamt=document.getElementById('payamt').value
	payamt=document.getElementById('payamt');	
	payamt.onkeydown=getamt;
    if (Adm!=""){
	var insu=document.getElementById("GetInsu")
	if (insu) {var encmeth=insu.value} else {var encmeth=''};
	if (cspRunServerMethod(encmeth,Adm)=='') 
	{
		alert(t['11'])
		//return;
			} 
    }
	obj=document.getElementById("RefundDeposit");
	if (obj) obj.onclick=Refund_click;
	obj=document.getElementById("AbortDeposit");
	if (obj) obj.onclick=Abort_click; 
	GetSum()  
	var payamtobj=document.getElementById("payamt")
	payamtobj.onkeydown=enterpayamt;
	var compobj=document.getElementById("company")
	compobj.onkeydown=entercomp;
	var bksubobj=document.getElementById("banksub")
	bksubobj.onkeydown=enterbksub;
	var cardnoobj=document.getElementById("cardno")
	cardnoobj.onkeydown=entercardno;
	//var bankobj=document.getElementById("bank")
	//bankobj.onkeydown=enterbank;
	elementformat() 
	websys_setfocus('payamt')
}
function gettoday()
{
	var getdateobj=document.getElementById('gettoday');	
	if (getdateobj) {var encmeth=getdateobj.value} else {var encmeth=''};
	if (cspRunServerMethod(encmeth,'setdate_val','','')=='1'){
		};
}
function setdate_val(value)	{
 date=value.split("/")
 curday=date[0]
 curmon=date[1]
 curyear=date[2]

}
function getpapno(){
	var key=websys_getKey(e);
	if (key==13) {
	 var nameobj=document.getElementById('name')
     var papobj=document.getElementById('papno')
     var pattypeobj=document.getElementById('pattype')
     var pataddressobj=document.getElementById('pataddress')
     var patzynoobj=document.getElementById('patzyno')
     papno=papobj.value	 
	 var adm=document.getElementById('getadm');	 
	 if (adm) {var encmeth=adm.value}else {var encmeth=''};
	 var str=cspRunServerMethod(encmeth,"","",papno)
	 
     var str1=str.split("#")
     var str2=str1[0].split("^")
     var obj=document.getElementById('Adm')
     Adm=str2[3] 
     
     nameobj.value=str2[0]
     papobj.value=str1[1]      
     if (Adm=="") {
	    alert(t['32']) 
	    websys_setfocus('papno') }

     window.location.href="websys.default.csp?WEBSYS.TCOMPONENT=UDHCJFDeposit&Adm="+Adm

   }
}
function Add_click()	
{   if (Adm=="")
    {   alert(t['32'])
	    websys_setfocus('papno')
	    return;}
	selectrow=SelectedRow;
	var insu=document.getElementById("GetInsu")
	if (insu) {var encmeth=insu.value} else {var encmeth=''};
	if (cspRunServerMethod(encmeth,Adm)=='') 
	{
		alert(t['11'])
		//return;
			} 
	if (PrtFlag=="Y")
    { alert(t['01']);
      return;}
	var deptype=document.getElementById('deptype').value;
	if (deptype=="") {
		alert(t['02']);
		return;}
    var payamt=document.getElementById('payamt').value;
    if ((payamt=="")||(!payamt)) {
		alert(t['03']);
		websys_setfocus('payamt')
		return;}
	var moderowid=document.getElementById('moderowid').value;
    if (moderowid=="") {
		websys_setfocus('paymode')
		alert(t['04']);
		return;}
	
	if (CurNo=="")
	{
	   alert(t['05']);
	   return ;
    }
    company=document.getElementById('company').value;
    bank=document.getElementById('bankrowid').value;
    cardno=document.getElementById('cardno').value;
    authno=document.getElementById('authno').value; 
    var banksubobj=document.getElementById('banksub');
    var banksub=banksubobj.value;
    var comment=document.getElementById('comment').value
    var pass=document.getElementById('password').checked
    if (pass==true)
    {   pass="Y" }
    else
    {   pass=""   }
    var Add=document.getElementById('Add');
	if (Add) {var encmeth=Add.value} else {var encmeth=''};
	dep=deptype+"^"+payamt+"^"+moderowid+"^"+company+"^"+bank+"^"+cardno+"^"+authno+"^"+Adm+"^"+CurNo+"^"+UserLoc+"^"+Guser+"^"+EndNo+"^"+Title+"^"+banksub+"^"+comment+"^"+pass
	if (cspRunServerMethod(encmeth,'SetPidAdd','',dep)=='0') {
			}

}

function set_pat(value)
{  
    var sub = value.split("^")
    var papnoobj=document.getElementById('papno')
    papnoobj.value=sub[0]
    var nameobj=document.getElementById('name')
    nameobj.value=sub[1]
    document.getElementById('pattype').value=sub[2]
    document.getElementById('pataddress').value=sub[3]
    document.getElementById('patzyno').value=sub[4]
    document.getElementById('admdate').value=sub[5]
    document.getElementById('foreignid').value=sub[6]
    document.getElementById('foreignphone').value=sub[7]
    document.getElementById('workaddress').value=sub[8]
}
function GetRcptNo(value)
{   var sub = value.split("^")
	var rcptrowid=sub[0]
	if (rcptrowid=="")
	{
	   alert(t['05']);
	   return ;
    }
	EndNo=sub[1]
	CurNo=sub[2]
	Title=sub[3]
	var obj=document.getElementById('currentno');
	obj.value=CurNo
}

function SetPidAdd(value) 
 { 
    var sub
    var amt    
    var str=value.split("^")
    var retcode=str[0]
    var yjrowid=str[1]
    var rcptrowid=str[2]
	if ((retcode!="0")&(retcode!="100"))
	{alert(t['06']);
	return;}
	
	if (retcode=="100"){
     alert(t['07']);
     window.location.reload();	    
	   // window.opener.Find.click()
	
     }
	if (retcode=="0") 
	{
    	window.location.href="websys.default.csp?WEBSYS.TCOMPONENT=UDHCJFDeposit&Adm="+Adm; 
        PrtFlag="Y"
	    var yjdetail=document.getElementById('getyjdetail');
		if (yjdetail) {var encmeth=yjdetail.value} else {var encmeth=''};
		returnval=cspRunServerMethod(encmeth,'','',yjrowid);
		printYJ()
        if (Abortprt=="Y"){
		   var truthBeTold = window.confirm(t['anh01']);
           if (!truthBeTold) {alert(t['103'])
	          if (RcptFlag=="Y")
	             {var rcptno=document.getElementById('getrcptno');
	             if (rcptno) {var encmeth=rcptno.value} else {var encmeth=''};
	             if (cspRunServerMethod(encmeth,'GetRcptNo','',Guser)=='0') {
			     } 
	          }
	          PrtFlag="N"
	          abort(yjrowid,rcptrowid)     
	       }
	       if (truthBeTold){
		     window.location.reload();
	      
		   }    
	   }
	   if (Abortprt=="N"){
		   var truthBeTold = window.confirm(t['anh01']);
           if (!truthBeTold) {alert(t['31'])
		      printYJ()
	          window.location.reload();
           }
           window.location.reload();
	   }
	}	
}
function Return_click()
{   
	parent.close()
}
function LookUpType(str)
{
	var obj=document.getElementById('deptype');
	var tem=str.split("^");
	obj.value=tem[1];
}
function LookUpPayMode(str)
{
	var obj=document.getElementById('moderowid');
	var tem=str.split("^");
	obj.value=tem[1];
	elementformat()
	
}
function LookUpBank(str)
{
	var obj=document.getElementById('bankrowid');
	var tem=str.split("^");
	obj.value=tem[1];
	
}
function getamt() {
	var key=websys_getKey(e);
	if (key==13) {
		var payamt=document.getElementById('payamt').value
		if (payamt!=""){	
			var ss=payamt
			ss=eval(ss)			
			payamt.value=ss.toFixed(2)
			if (pyobj.value==t['10']){
			websys_setfocus('BtnPrint');}						
			else{		
			DHCWeb_Nextfocus()	
				}
		
			}			
		}
	}
function Refund_click()
{
	var obj
	selectrow=SelectedRow;
	clickflag=1
    var truthBeTold = window.confirm(t['12']);
    if (!truthBeTold) { return ;}
	if (!Prtrowid)
	{alert(t['13'])
	 return }
    if (Arpbl)
    {alert(t['14'])
     return;}
    if (PrtStatus==t['15'])
    {alert(t['16'])
     return;}
    if (PrtStatus==t['17'])
	{alert(t['18'])
	 return false ;}
  	if (PrtStatus==t['19'])
   	{alert(t['20'])
	 return false ;}
	var getstatus=document.getElementById('getprtstatus');
	if (getstatus) {var encmeth=getstatus.value} else {var encmeth=''};
	if (cspRunServerMethod(encmeth,Prtrowid)=='4') 
	{   alert(t['27'])
	    return;
			}    	
	if (RcptFlag=="Y")
	{var rcptno=document.getElementById('getrcptno');
	if (rcptno) {var encmeth=rcptno.value} else {var encmeth=''};
	if (cspRunServerMethod(encmeth,'GetRcptNo','',Guser)=='0') {
			} 
	}
	if (RcptFlag=="N")
	{ rcptno="" 
	  CurNo=""
	  EndNo=""}
    if (RcptFlag=="Y")
	{  if (CurNo=="")
	   {  alert(t['05'])
	      return }
	   var nextno
	   nextno=document.getElementById('getnextno');
	   if (nextno) {var encmeth=nextno.value} else {var encmeth=''};
	   if (cspRunServerMethod(encmeth,'GetNextNo','',CurNo)=='0') {
			} 
	}
	
	var Refund=document.getElementById('Refund');
	if (Refund) {var encmeth=Refund.value} else {var encmeth=''};
	if (cspRunServerMethod(encmeth,'SetPid','',CurNo,EndNo,Prtrowid,Guser,RcptRowid,RcptFlag)=='0') {
			}	
}
function SetPid(value) 
{   
    if (value=="1")
	{alert(t['30']);
	return;}
	if (value!="0")
	{alert(t['21']);
	return;}
	try{	
	    alert(t['07']);	   
	    if ((RcptFlag=="Y")&&(clickflag==1)) {
		    var getyjdetail=document.getElementById('getyjdetail');
	        if (getyjdetail) {var encmeth=getyjdetail.value} else {var encmeth=''};
	        var patinfo=cspRunServerMethod(encmeth,'','',Prtrowid);
	        gusername=session['LOGON.USERNAME']
	        gusercode=session['LOGON.USERCODE']
	        returnval=patinfo
	        printYJ()
		    }	
		
	    window.location.reload();
	   // parent.frames['UDHCJFFindDeposit'].location.href="websys.default.csp?WEBSYS.TCOMPONENT=UDHCJFFindDeposit&Adm="+Adm; 
   		//parent.frames['UDHCJFAddDeposit'].location.href="websys.default.csp?WEBSYS.TCOMPONENT=UDHCJFAddDeposit&Adm="+Adm; 
		} catch(e) {};
}
function SelectRowHandler()	
{  	
	var eSrc=window.event.srcElement;
	Objtbl=document.getElementById('tUDHCJFDeposit');
	Rows=Objtbl.rows.length;
	
	var lastrowindex=Rows - 1;
	var rowObj=getRow(eSrc);
	var selectrow=rowObj.rowIndex;
	if (!selectrow) return;
	
	obj=document.getElementById('prtrowid');
	SelRowObj=document.getElementById('Tprtrowidz'+selectrow);
    Prtrowid=SelRowObj.innerText;
	
	obj.value=Prtrowid
	SelRowObj=document.getElementById('Tarpblz'+selectrow);
	Arpbl=SelRowObj.innerText;
	
	Arpbl=Arpbl.charCodeAt(0)
	SelRowObj=document.getElementById('Tprtstatusz'+selectrow);
	PrtStatus=SelRowObj.innerText;
	SelRowObj=document.getElementById('Trcptrowidz'+selectrow);
	RcptRowid=SelRowObj.innerText;
	SelRowObj=document.getElementById('Tjkflagdz'+selectrow);
	JkFlag=SelRowObj.innerText;
	//var obj=document.getElementById('Adm');
	//var TrakMenuDoc=parent.frames['eprmenu'].document;
	//var TrakMenuADM=TrakMenuDoc.getElementById('EpisodeID');
	//var TrakMenuBill=TrakMenuDoc.getElementById('BillRowIds');
	//obj.value=TrakMenuADM.value
	SelectedRow = selectrow;
}
function GetNextNo(value)
{   
   if (parseInt(value,10)>parseInt(EndNo,10))
  {
       alert(t['07'])
       return false ;
  }
}

function abort(yjrowid,rcptrowid){
   var abortobj
   var p1=yjrowid
   var p2=rcptrowid
   var p3=Guser
   abortobj=document.getElementById('Abort');  
   if (abortobj) {var encmeth=abortobj.value} else {var encmeth=''};
   if (cspRunServerMethod(encmeth,'SetPid1','',p1,p2,p3)=='0') {
			} 
}
function SetPid1(value){
   if (value!="0")
	{(t['12']);
	return;}
	else{
	Add_click()
		}
}

function Abort_click()
{  
    clickflag=2
    var truthBeTold = window.confirm(t['22']);
    if (!truthBeTold) { return ;}
	if (!Prtrowid)
	   {alert(t['23'])
		 return false}
	if (Arpbl)
	   {alert(t['14'])
	    return false}
	if (JkFlag=="Y")
		{alert(t['24'])
		 return false}
	if (PrtStatus==t['17'])
	   {alert(t['25'])
		return false}
	if (PrtStatus==t['19'])
	   {alert(t['29'])
		return false}
	if (PrtStatus==t['26'])
	   	{alert(t['27']+rcptno+t['28'])
		 return false}

	var Abort=document.getElementById('Abort');
	if (Abort) {var encmeth=Abort.value} else {var encmeth=''};
	if (cspRunServerMethod(encmeth,'SetPid','',Prtrowid,RcptRowid,Guser)=='0') {
		}	 
}
function GetSum()
{   Sum=0;
    Objtbl=document.getElementById('tUDHCJFDeposit');
	Rows=Objtbl.rows.length;
	Sum=0
	for (i=1;i<=Rows-1;i++)
	{
	   SelRowObj=document.getElementById('Tprtstatusz'+i);
	   prtstatus=SelRowObj.innerText;
	   SelRowObj=document.getElementById('selectz'+i);
	   select=SelRowObj.checked;
	   SelRowObj=document.getElementById('Tpayamtz'+i);
	   payamt=SelRowObj.innerText;
	    SelRowObj=document.getElementById('Tpaystatusz'+i);
	   var paystatus=SelRowObj.innerText;
	   if ((prtstatus!=t['26'])&&(select==true))
	   {  Sum=eval(Sum)+eval(payamt) ;
	   }
	}
	 obj=document.getElementById('yjnum');
	 obj.value=Rows-1
	 obj=document.getElementById('sum');
	 alert(parseFloat(33).toFixed(2))
	 obj.value=parseFloat(Sum).toFixed(2)
}
function getdeptype()
{if (window.event.keyCode==13) 
	{  window.event.keyCode=117;
	  deposittype_lookuphandler();
		}
	}
function getpy()
{if (window.event.keyCode==13) 
	{  window.event.keyCode=117;
	  paymode_lookuphandler();
       		}
	}
	
function elementformat(){
	var compobj=document.getElementById("company")
	var cardnoobj=document.getElementById("cardno")
	var banksubobj=document.getElementById("banksub")
	var authnoobj=document.getElementById("authno")
	var Myobj=document.getElementById('Myid');
    
    if (Myobj){
	    var imgname="ld"+Myobj.value+"i"+"bank"
	    var bankobj1=document.getElementById(imgname);  }
	
	if (pyobj.value==t['10']){
	   bankobj.readOnly=true;	   
	   compobj.readOnly=true;	   
	   cardnoobj.readOnly=true;
	   authnoobj.readOnly=true;
	   banksubobj.readOnly=true;
	   bankobj1.style.display="none"
	   websys_setfocus('BtnPrint')
	}else{
	   bankobj.readOnly=false;	   
	   compobj.readOnly=false;	   
       banksubobj.readOnly=false;
	   bankobj1.style.display=""
	   cardnoobj.readOnly=false;
	   authnoobj.readOnly=false;
	   websys_setfocus('bank')
	   //websys_setfocus('bank')
	   //var pymode=pyobj.value
	   //if (pymode==t['paymode01']){
	    //	  cardnoobj.readOnly=false;  
		//  authnoobj.readOnly=true
		// }
	   //if (pymode.indexOf(t['paymode02'])>-1){
		//  authnoobj.readOnly=false; 
		//  cardnoobj.readOnly=true
		//    }	
	   //    websys_setfocus('bank')
	       }
}
function getbank()
{if (window.event.keyCode==13) 
	{  window.event.keyCode=117;
	  bank_lookuphandler();
	 // websys_setfocus('banksub')
	  DHCWeb_Nextfocus()
		}
	}
function entercomp(){
 	var key=websys_getKey(e);	
	if (key==13) {
		//if (pyobj.value==t['paymode01']){
		DHCWeb_Nextfocus()	}
		//else{
		//	websys_setfocus('authno')}
	//}
}
function enterbksub(){
 	 var key=websys_getKey(e);
	if (key==13) {
	  DHCWeb_Nextfocus();	   
	}
}
function entercardno(){
 	var key=websys_getKey(e);	
	if (key==13) {
		DHCWeb_Nextfocus()	}
}
function enterpayamt(){
 	var key=websys_getKey(e);	
	if (key==13) {
		DHCWeb_Nextfocus()	
		var payamt=document.getElementById('payamt').value
	  	document.getElementById('payamt').value=eval(payamt).toFixed(2).toString(10) //yyx
	    var getamtdx=document.getElementById('getamtdx');
	    if (getamtdx) {var encmeth=getamtdx.value} else {var encmeth=''};
	    var amtdx=cspRunServerMethod(encmeth,"","",payamt)
	    document.getElementById('amtdx').value=amtdx
	}
}
function enterbank(){
 	var key=websys_getKey(e);	
	if (key==13) {
		DHCWeb_Nextfocus()	}
}
function enterauthno(){
 	var key=websys_getKey(e);	
	if (key==13) {
		DHCWeb_Nextfocus()	}
}

document.body.onload = BodyLoadHandler;