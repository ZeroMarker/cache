var ret="";var checkret="";var comboret=""; var grid;var arrgrid=new Array();function eachItem1(item,index,length) {       if (item.xtype=="datefield") {               //修改下拉框的请求地址    			ret=ret+item.id+"|"+formatDate(item.getValue())+"^";   	    }     if (item.xtype=="timefield") {               //修改下拉框的请求地址    			//debugger;			ret=  ret+item.id+"|"+item.getValue()+"^";         } 	 if (item.xtype=="combo") {               //修改下拉框的请求地址    			//debugger;			comboret=  comboret+item.id+"|"+item.getValue()+"!"+item.lastSelectionText+"^";         } 	 if (item.xtype=="textfield") {               //修改下拉框的请求地址    			//debugger;						ret=  ret+item.id+"|"+item.getValue()+"^";         } 	 if (item.xtype=="textarea") {               //修改下拉框的请求地址    			ret=  ret+item.id+"|"+item.getRawValue()+"^";       } 	 if (item.xtype=="checkbox") {               //修改下拉框的请求地址    			//debugger;			if (item.checked==true) checkret=checkret+item.id+"|"+item.boxLabel+"^";			else {checkret=checkret+item.id+"|"+""+"^";}        } 	      if (item.items && item.items.getCount() > 0) {          item.items.each(eachItem1, this);       }   } var ITypItm="Item15"; //后取数据字典型var ITypItm1="Item26"; var ITypItm2="Item35";var ITypItm3="Item12";  var ILISTTypItm="FOURLIST"; //后取数据字典型function ifLISTflag(itm){	var tm=ILISTTypItm.split('|');	var flag=false;	for (var i=0;i<tm.length;i++)	{		if (itm==tm[i])		{			flag=true;		}	}	return flag ;}  function BodyLoadHandler(){	setsize("mygridpl","gform","mygrid"); 	var but1=Ext.getCmp("mygridbut1");  but1.on('click',additm);   var but=Ext.getCmp("mygridbut2");	but.setText("选行保存");  but.on('click',gridsave);       grid=Ext.getCmp('mygrid');  var tobar=grid.getTopToolbar();  tobar.addItem(            "-");       	tobar.addButton(	  {		className: 'new-topic-button',		text: "全部保存",		handler:AllSave,		id:'mygridbutAllSave'	  }  	);	  tobar.addItem("-");    tobar.addButton(	  {		className: 'new-topic-button',		text: "查询",		handler:find,		id:'findbtn'	  });  tobar.addItem ("-",{		xtype:'checkbox',		id:'IfCancelRec',		checked:false,		boxLabel:'显示作废记录' 			}); tobar.addItem("-");	 tobar.addButton(	  {		className: 'new-topic-button',		text: "打印",		handler:function(){printNurCareRec("DHCNurPrnMouldANHUI100")},		id:'mygridbutprintNurRec'	  });                           var but=Ext.getCmp("butGetScore");  but.on('click',butGetScore);   grid=Ext.getCmp('mygrid');  var bbar = grid.getBottomToolbar ();	bbar.hide();  grid.setTitle(gethead());   grid.on('afteredit',scoreSum,this);	//var but=Ext.getCmp("butClose");   // but.on('click',btclose);	var but=Ext.getCmp("butSave");      but.on('click',Save);	var but=Ext.getCmp("butPrint");  but.on('click',function(){butPGDPrintFn("DHCNurPrnMouldANHUI10")} );  var but=Ext.getCmp("butPrint2");  but.on('click',function(){butPGDPrintFn("DHCNurPrnMouldANHUI1022")} );	//var GetQueryData=document.getElementById('GetQueryData');  if ((session['LOGON.GROUPDESC']!="护理部")&&(session['LOGON.GROUPDESC']!="护理部主任"))			{			  	var Item31 = Ext.getCmp("Item31");			  	Item31.disable()		  } 	var Item2 = Ext.getCmp("Item15"); 	var Item3=Ext.getCmp("Item26");	var Item4=Ext.getCmp("Item35");		Item2.on('specialkey',cmbkey); 	Item3.on('specialkey',cmbkey);	Item4.on('specialkey',cmbkey); 	var Item12=Ext.getCmp("Item12");		Item12.on('specialkey',cmbkey);	var Item23 = Ext.getCmp("Item23"); 	Item23.disable();	  var SFDD = Ext.getCmp("Item27");	SFDD.on('change',SFDDFun,this);  var FOURLIST = Ext.getCmp("FOURLIST");	FOURLIST.on('specialkey',FOURLISTcmbkey); 	getFourlistdata("",FOURLIST)  //ITypItm="Item2";	//setVal2(ExamId);	//var Item29 = Ext.getCmp("Item29");   //editor: new Ext.grid.GridEditor(new Ext.form.TextField({readOnly:"true"}))}  	//CaseMeasure.readonly="false";      Ext.override(Ext.grid.RowSelectionModel, {			onEditorKey : function(F, E) {				var C = E.getKey(), G, D = this.grid, B = D.activeEditor;				var A = E.shiftKey; 				//debugger;        if (C == E.RIGHT) {        // alert();        E.stopEvent();        B.completeEdit();        G = D.walkCells(B.row,B.col+1, 1, this.acceptsNav,this);        }               if (C == E.LEFT) {        // alert();        E.stopEvent();        B.completeEdit();        G = D.walkCells(B.row,B.col-1, 1, this.acceptsNav,this);        }       if (C == E.DOWN) {       // alert();       E.stopEvent();       B.completeEdit();       G = D.walkCells(B.row+1,4, 1, this.acceptsNav,this);       }             if (C == E.UP) {       // alert();       E.stopEvent();       B.completeEdit();       G = D.walkCells(B.row-1,4, 1, this.acceptsNav,this);       }        				if (C == E.TAB) {					E.stopEvent();					B.completeEdit();					if (A) {						G = D.walkCells(B.row, B.col - 1, -1, this.acceptsNav,								this);					} else {						G = D.walkCells(B.row, B.col + 1, 1, this.acceptsNav,								this);					}				} else {					if (C == E.ENTER) {						E.stopEvent();						// alert(B);						B.completeEdit();						if (this.moveEditorOnEnter !== false) {							if (A) {								// G = D.walkCells(B.row - 1, B.col, -1,								// this.acceptsNav,this)								G = D.walkCells(B.row, B.col - 1, -1,										this.acceptsNav, this);							} else {								// G = D.walkCells(B.row + 1, B.col, 1,								// this.acceptsNav,this)								G = D.walkCells(B.row, B.col + 1, 1,										this.acceptsNav, this);							}						}					} else {						if (C == E.ESC) {							B.cancelEdit();						}					}				}				if (G) {					D.startEditing(G[0], G[1]);				}			}		});    var sm2 = new Ext.grid.RowSelectionModel({           moveEditorOnEnter: true,           singleSelect: true,           listeners: {               //rowselect : function(sm, row, rec) {                   //centerForm.getForm().loadRecord(rec);              // }           }         }); 	 setsize("mygrid", "gform", "mygrid"); 	 grid = Ext.getCmp('mygrid');        grid.addListener('rowcontextmenu', rightClickFn);           var score1 = Ext.getCmp("Item16"); 	score1.on('change',scoreAdd,this);   var score1 = Ext.getCmp("Item17"); 	score1.on('change',scoreAdd,this); 	var score1 = Ext.getCmp("Item18"); 	score1.on('change',scoreAdd,this); 	var score1 = Ext.getCmp("Item19"); 	score1.on('change',scoreAdd,this); 	var score1 = Ext.getCmp("Item20"); 	score1.on('change',scoreAdd,this); 	var score1 = Ext.getCmp("Item21"); 	score1.on('change',scoreAdd,this);	var obj = Ext.getCmp("Item1");     obj.disable();	var obj = Ext.getCmp("Item2");     obj.disable();	var obj = Ext.getCmp("Item4");     obj.disable();	var obj = Ext.getCmp("Item5");     obj.disable();	var obj = Ext.getCmp("Item6");     obj.disable();	var obj = Ext.getCmp("Item7");     obj.disable();	var obj = Ext.getCmp("Item8");     obj.disable();    grid.colModel.setHidden(11,true);	grid.colModel.setHidden(12,true);  setvalue()	//alert(SpId);}   function FOURLISTcmbkey(field, e){	if (e.getKey() ==Ext.EventObject.ENTER)	{		var pp=field.lastQuery;		//alert(pp);				getFourlistdata(pp,field);	}}var FOURLISTArray=new Array();function getFourlistdata(p,cmb){	var GetFourList =document.getElementById('GetFourList');	//debugger; 	//alert(EpisodeID);    var ret=cspRunServerMethod(GetFourList.value,EpisodeID);	//alert("ret="+ret);		if (ret!="")	{		var aa=ret.split('^');		for (i=0;i<aa.length;i++)		{			if (aa[i]=="" ) continue;			var it=aa[i].split('|');			addFourList(it[1],it[0]);		}		//debugger;		cmb.store.loadData(FOURLISTArray);	}}function addFourList(a,b){	FOURLISTArray.push(	{		desc:a,		id:b	}	);}function SFDDFun (obj){  var Item27value=Ext.getCmp("Item27").getValue();   if (Item27value=="否")  {    var FSRQ = Ext.getCmp("Item10");	 	FSRQ.setValue("");     var FSSJ = Ext.getCmp("Item11");	 	FSSJ.setValue("");   } }function butGetScore(){	var GetScore=document.getElementById('GetScore');  	var FOURLIST = Ext.getCmp("FOURLIST"); 	if (GetScore) {		var ret=cspRunServerMethod(GetScore.value,"DHCNURANHUI21",EpisodeID+"^"+FOURLIST.value);		//alert(ret)	 	if (ret!="")    {  	 	var tt=ret.split('^');	 	var DDSScore = Ext.getCmp("Item16");	 	DDSScore.setValue(getValueByCode(tt[0]));	 	var CGYGYXZDScore = Ext.getCmp("Item17");	 	CGYGYXZDScore.setValue(getValueByCode(tt[1]));    var XZFZScore = Ext.getCmp("Item18");    XZFZScore.setValue(getValueByCode(tt[2]));    var JMSYScore = Ext.getCmp("Item19");    JMSYScore.setValue(getValueByCode(tt[3]));     var BTScore = Ext.getCmp("Item20");    BTScore.setValue(getValueByCode(tt[4]));    var RZZTScore = Ext.getCmp("Item21");    RZZTScore.setValue(getValueByCode(tt[5]));    var SYJYYScore = Ext.getCmp("Item22");    SYJYYScore.setValue(getValueByCode(tt[6]));    var MouseScore = Ext.getCmp("Item23");    MouseScore.setValue(getValueByCode(tt[7]));    }    else    {    	alert("该病人尚未填写4评单,请先填写再提取!");    }    	}}function scoreAdd(obj){	 //var scorearry1=new Array(); 	 var scorehj=0; 	 var tmp=obj.getValue();	 tmp=scoreFormat(tmp);	 var sumval=0;	 for (var k=16;k<22;k++)	 {         var itm="Item"+k;         var val= scoreFormat(Ext.getCmp(itm).getValue())         if (val=="")         {         	val=0         }else{         	val=parseInt(val);         }         sumval=sumval+val;	 }	 //alert(sumval)	 /*	 switch (obj.getName()) 	 {	 	case 'Item16':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item17").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item18").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item19").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item20").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item21").getValue()));           break;     case 'Item17':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item16").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item18").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item19").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item20").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item21").getValue()));           break;    case 'Item18':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item16").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item17").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item19").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item20").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item21").getValue()));           break;    case 'Item19':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item16").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item17").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item18").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item20").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item21").getValue()));           break;    case 'Item20':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item16").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item17").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item18").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item19").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item21").getValue()));           break;    case 'Item21':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item16").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item17").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item18").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item19").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item20").getValue()));           break; 	 } 	 */	 var amtsum = Ext.getCmp("Item23"); 	 //tmp=parseInt(tmp)+parseInt(amtsum.getValue())	 	 amtsum.setValue(sumval); }  function scoreFormat(value){ var scorearry1=new Array();  scorearry1=value.split("分"); value=scorearry1[0];  return value;}function scoreSum(obj){   var scorearry=new Array();    var sum=0;   var r=obj.record;    var temp=r.get("Item39");     if((temp!=undefined)&&(temp!=""))   {       sum=sum+parseInt(temp);      //scorearry=temp.split("(");      //scorearry=scorearry[1].split("分)");       //sum=sum+parseInt(scorearry[0]);    }    //alert(sum)   temp=null;   temp=r.get("Item40");   if((temp!=undefined)&&(temp!=""))   {     sum=sum+parseInt(temp);   //scorearry=temp.split("(");     //scorearry=scorearry[1].split("分)");   //sum=sum+parseInt(scorearry[0]);    }    //alert(sum)   temp=null;   temp=r.get("Item41");   if((temp!=undefined)&&(temp!=""))   {     sum=sum+parseInt(temp);   //scorearry=temp.split("(");     //scorearry=scorearry[1].split("分)");   //sum=sum+parseInt(scorearry[0]);    }      //alert(sum)   temp=null;   temp=r.get("Item42");   if((temp!=undefined)&&(temp!=""))   {    sum=sum+parseInt(temp);   //scorearry=temp.split("(");   //scorearry=scorearry[1].split("分)");   //sum=sum+parseInt(scorearry[0]);    }    temp=null;   temp=r.get("Item43");    if((temp!=undefined)&&(temp!=""))   {    sum=sum+parseInt(temp);   //scorearry=temp.split("(");   //scorearry=scorearry[1].split("分)");   //sum=sum+parseInt(scorearry[0]);    }    temp=null;   temp=r.get("Item44");   if((temp!=undefined)&&(temp!=""))   {     sum=sum+parseInt(temp);   //scorearry=temp.split("(");   //scorearry=scorearry[1].split("分)");   //sum=sum+parseInt(scorearry[0]);    }    var mygrid = Ext.getCmp('mygrid');    var selModel = mygrid.getSelectionModel();    var rowIndex = mygrid.store.indexOf(mygrid.getSelectionModel().getSelected());   mygrid.store.getAt(rowIndex).set(mygrid.getColumnModel().getDataIndex(8),sum);} function printNurRec(){		//alert("odj");				var GetPrnSet=document.getElementById('GetPrnSet');		var GetHead=document.getElementById('GetPatInfo');		var ret=cspRunServerMethod(GetHead.value,EpisodeID);		var hh=ret.split("^");		//alert("ddd");		//debugger;		var a=cspRunServerMethod(GetPrnSet.value,"DHCNURANHUI10",EpisodeID); //page, caredattim, prnpos, adm,Typ,user		if (a=="") return;		var GetLableRec=document.getElementById('GetLableRec');		var LabHead=cspRunServerMethod(GetLableRec.value,"DHCNURANHUI10^"+session['LOGON.CTLOCID']);		var tm=a.split("^");		var stdate="" //tm[2];		var stim="" //tm[3];		var edate="" //tm[4];		var etim="" //tm[5];		//PrintComm.RHeadCaption=hh[1];		//PrintComm.LHeadCaption=hh[0];		//PrintComm.RFootCaption="第";		//PrintComm.LFootCaption="页";		//PrintComm.LFootCaption=hh[2];		PrintComm.TitleStr=ret;		PrintComm.SetPreView("1");		PrintComm.PrnLoc=session['LOGON.CTLOCID'];		var aa=tm[1].split("&");		//PrintComm.stPage=aa[0];		//if (aa.length>1) PrintComm.stRow=aa[1];		PrintComm.stPage=0;		PrintComm.stRow=0;		PrintComm.previewPrint="1"; //是否弹出设置界面		//PrintComm.stprintpos=tm[0];		PrintComm.stprintpos=0;		//alert(PrintComm.Pages);		PrintComm.SetConnectStr(CacheDB); 		PrintComm.WebUrl=webIP+"/dthealth/web/DWR.DoctorRound.cls";		PrintComm.ItmName = "DHCNurPrnMouldANHUI100"; //338155!2010-07-13!0:00!!		//debugger;		var parr=EpisodeID+"!"+stdate+"!"+stim+"!"+edate+"!"+etim+"!DHCNURANHUI10";   	//alert(parr);		PrintComm.ID = "";		PrintComm.MultID = "";		//PrintComm.MthArr="web.DHCConsult:getConsultInfo&id:"+myid;		if(LabHead!="")PrintComm.LabHead=LabHead;		PrintComm.SetParrm(parr); // ="EpisodeId" ; //"p1:0^p2:"		PrintComm.PrintOut();		var SavePrnSet=document.getElementById('SavePrnSet');		//debugger;		var CareDateTim=PrintComm.CareDateTim;		if (CareDateTim=="") return ;		var pages=PrintComm.pages;		var stRow=PrintComm.stRow;		//debugger;		var stprintpos=PrintComm.stPrintPos;		//alert(pages+","+CareDateTim+","+stprintpos+","+EpisodeID+","+"DHCNURANHUI5"+","+session['LOGON.USERID']+","+PrintComm.PrnFlag);		//PrnFlag==1说明是打印预览		if (PrintComm.PrnFlag==1) return;		//如果原记录保存打印到第8页则当打印第8页之前页时不保存打印记录		if (pages<aa[0]) return;		var a=cspRunServerMethod(SavePrnSet.value,pages,CareDateTim,stprintpos,EpisodeID,"DHCNURANHUI10",session['LOGON.USERID']); //page, caredattim, prnpos, adm,Typ,user		//find();}function printNurRec1(){			var GetPrnSet=document.getElementById('GetPrnSet');			var GetHead=document.getElementById('GetPatInfo');			var ret=cspRunServerMethod(GetHead.value,EpisodeID);			var hh=ret.split("^");				var getid=document.getElementById('GetId');        	var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID);			//debugger;			var a=cspRunServerMethod(GetPrnSet.value,"DHCNURANHUI10",EpisodeID); 	//page, caredattim, prnpos, adm,Typ,user			if (a=="") return;			var GetLableRec=document.getElementById('GetLableRec');			var LabHead=cspRunServerMethod(GetLableRec.value,"DHCNURANHUI10^"+session['LOGON.CTLOCID']);			var tm=a.split("^");			var stdate="" 	//tm[2];			var stim="" 	//tm[3];			var edate="" 	//tm[4];			var etim="" 	//tm[5];			//PrintComm.RHeadCaption=hh[1];			//PrintComm.LHeadCaption=hh[0];			//PrintComm.RFootCaption="第";			//PrintComm.LFootCaption="页";			//PrintComm.LFootCaption=hh[2];			PrintComm.TitleStr=ret;			PrintComm.SetPreView("1");			PrintComm.PrnLoc=session['LOGON.CTLOCID'];			var aa=tm[1].split("&");			//PrintComm.stPage=aa[0];			//if (aa.length>1) 	PrintComm.stRow=aa[1];			PrintComm.stPage=0;			PrintComm.stRow=0;			PrintComm.previewPrint="1"; 	//是否弹出设置界面			//PrintComm.stprintpos=tm[0];			PrintComm.stprintpos=0;			//alert(PrintComm.Pages);			PrintComm.SetConnectStr(CacheDB);	PrintComm.WebUrl=webIP+"/trakcare/web/DWR.DoctorRound.cls";	//PrintComm.WebUrl=WebIp+"/trakcarelive/trak/web/DWR.DoctorRound.cls";			PrintComm.ItmName = "DHCNurPrnMouldANHUI10"; 	//338155!2010-07-13!0:00!!			//debugger;			var parr=EpisodeID;			PrintComm.ID = "";			PrintComm.MultID = "";			var mth1="Nur.DHCMoudData:getVal&parr:"+id+"!";			PrintComm.MthArr=mth1;			//PrintComm.MthArr="web.DHCConsult:getConsultInfo&id:"+myid;			if(LabHead!="")PrintComm.LabHead=LabHead;			PrintComm.SetParrm(parr); 	// ="EpisodeId" ; 	//"p1:0^p2:"			PrintComm.PrintOut();			var SavePrnSet=document.getElementById('SavePrnSet');			//debugger;			var CareDateTim=PrintComm.CareDateTim;			if (CareDateTim=="") return ;			var pages=PrintComm.pages;   			var stRow=PrintComm.stRow;			//debugger;			var stprintpos=PrintComm.stPrintPos;			//alert(pages+","+CareDateTim+","+stprintpos+","+EpisodeID+","+"DHCNURANHUI15"+","+session['LOGON.USERID']+","+PrintComm.PrnFlag);			//PrnFlag==1说明是打印预览			if (PrintComm.PrnFlag==1) return;			//如果原记录保存打印到第8页则当打印第8页之前页时不保存打印记录			if (pages<aa[0]) return;			//var a=cspRunServerMethod(SavePrnSet.value,pages,CareDateTim,stprintpos,EpisodeID,"DHCNURANHUI15",session['LOGON.USERID']);	//page, caredattim, prnpos, adm,Typ,user			//find();}function butPrintFn(){		  //alert("odj");		  		  PrintComm.RHeadCaption='dddd';			PrintComm.LHeadCaption="3333333";			//PrintComm.RFootCaption="第";			//PrintComm.LFootCaption="页";			//PrintComm.LFootCaption="88";			//alert(PrintComm.Pages);			PrintComm.SetConnectStr(CacheDB); 			PrintComm.WebUrl=webIP+"/dthealth/web/DWR.DoctorRound.cls";			PrintComm.ItmName = "DHCNurPrnMouldANHUI10";			//debugger;			//var parr="@"+EpisodeID+"@DHCNURHYD_Assessment@DHCNURHYD_DisSummary";			var parr="@"+EpisodeID+"@DHCNURANHUI10";			PrintComm.MthArr="web.DHCNurMouldDataComm:GetPrnValComm&parr:"+parr;			//PrintComm.LabHead=LabHead;						//PrintComm.SetParrm(parr);			PrintComm.PrintOut();		//printNurRec();	        	//return;		}function butPrintFn2(){		  //alert("odj");		  		  PrintComm.RHeadCaption='dddd';			PrintComm.LHeadCaption="3333333";			//PrintComm.RFootCaption="第";			//PrintComm.LFootCaption="页";			//PrintComm.LFootCaption="88";			//alert(PrintComm.Pages);			PrintComm.SetConnectStr(CacheDB); 			PrintComm.WebUrl=webIP+"/dthealth/web/DWR.DoctorRound.cls";			PrintComm.ItmName = "DHCNurPrnMouldANHUI1022";			//debugger;			//var parr="@"+EpisodeID+"@DHCNURHYD_Assessment@DHCNURHYD_DisSummary";			var parr="@"+EpisodeID+"@DHCNURANHUI10";			PrintComm.MthArr="web.DHCNurMouldDataComm:GetPrnValComm&parr:"+parr;			//PrintComm.LabHead=LabHead;						//PrintComm.SetParrm(parr);			PrintComm.PrintOut();		//printNurRec();	        	//return;		} function butPrintFn1(){			PrintComm.RHeadCaption='dddd';			PrintComm.LHeadCaption="3333333";			//PrintComm.RFootCaption="第";			//PrintComm.LFootCaption="页";			//PrintComm.LFootCaption="88";			//alert(PrintComm.Pages);			PrintComm.SetConnectStr(CacheDB); 			PrintComm.WebUrl=webIP+"/trakcare/web/DWR.DoctorRound.cls";			PrintComm.ItmName = "DHCNurPrnMouldANHUI10";			//debugger;			//var parr="@"+EpisodeID+"@DHCNURHYD_Assessment@DHCNURHYD_DisSummary";			var parr="@"+EpisodeID+"@DHCNURANHUI10";			parr=parr+"|web.DHCMGtestpge:DHCNurComplexPrn1&parr$"+EpisodeID;       		PrintComm.MthArr="web.DHCNurMouldDataComm:GetPrnValComm&parr:"+parr;			//alert(PrintComm.MthArr);				//PrintComm.LabHead=LabHead;						//PrintComm.SetParrm(parr);			PrintComm.PrintOut();}   function gethead(){	var GetHead=document.getElementById('GetHead');	var ret=cspRunServerMethod(GetHead.value,EpisodeID);	var hh=ret.split("^");	return hh[0]+"  "+hh[1];	//debugger;}function additm(){   var Plant = Ext.data.Record.create([	{name:'CareDate'},	{name:'CareTime'},	{name:'Item39'},	{name:'Item40'},	{name:'Item41'},	{name:'Item42'},	{name:'Item43'},	{name:'Item44'},	{name:'Item45'},	{name:'CaseMeasure'},	{name:'User'},	{name:'rw'},	{name:'par'}      ]);  var count = grid.store.getCount();   var r = new Plant({CareDate:new Date(),CareTime:new Date().dateFormat('H:i')});   grid.store.commitChanges();   grid.store.insert(0,r); 	return;}  var rightClick = new Ext.menu.Menu(  { 	   id : 'rightClickCont',     items : [             {                id:'rMenu1',                text : '作废',                handler:CancelRecord            }       ]    });function rightClickFn(client, rowIndex, e)  {          e.preventDefault();          grid=client;		  CurrRowIndex=rowIndex;          rightClick.showAt(e.getXY());            }function CancelRecord(){	var objCancelRecord=document.getElementById('CancelRecord');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) 	{  		alert("请先选择一条跌倒坠床记录!"); 		return; 	}	else	{		var flag = confirm("你确定要作废此条记录吗!")		if (flag) 		{                    var par=objRow[0].get("par");					var rw=objRow[0].get("rw");					if (objCancelRecord) {						var a = cspRunServerMethod(objCancelRecord.value, par, rw, session['LOGON.USERID'], session['LOGON.GROUPDESC']);						if (a!=0){							alert(a);							return;						}else{							find();						}					}		}			}}function DBC2SBC(str)   {	var result = '';	if ((str)&&(str.length)) {		for (i = 0; i < str.length; i++) {			code = str.charCodeAt(i);			if (code >= 65281 && code <= 65373) {				result += String.fromCharCode(str.charCodeAt(i) - 65248);			}			else {				if (code == 12288) {					result += String.fromCharCode(str.charCodeAt(i) - 12288 + 32);				}				else {					result += str.charAt(i);				}			}		}	}	else{		result=str;	}  	return result;   } function AllSave() {	var store = grid.store;	var rowCount = store.getCount(); //记录数	var cm = grid.getColumnModel();	var colCount = cm.getColumnCount(); 	var list = [];	var rowObj = grid.getSelectionModel().getSelections();	var len = rowObj.length;	//for (var r = 0;r < len; r++) 	//{	//	list.push(rowObj[r].data);	//}		var grid1=Ext.getCmp('mygrid');  var rwIndex=grid1.getSelectionModel().last;   var RecSave=document.getElementById('RecSave');    	for (var i = 0; i < store.getCount(); i++) {		list.push(store.getAt(i).data);	//	//	debugger;	}     for (var i = 0; i < list.length; i++)    {   	var obj=list[i];   	var str="";    var CareDate="";     var CareTime="";     for (var p in obj)     {     	 var aa = formatDate(obj[p]);     	 if (p=="CareDate") CareDate=aa;     	 if (p=='CareTime') CareTime=obj[p];       if (p=="") continue;        if (aa == "") 			{					str = str + p + "|" + DBC2SBC(obj[p]) + '^';			}else			{			  	str = str + p + "|" + aa + '^';				}       }       //alert(str);   var a=cspRunServerMethod(RecSave.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURANHUI10",session['LOGON.GROUPDESC']);	 if (a!="0")	 {				alert(a);				return;	 }      }    //	alert("保存成功");	      find();  } function gridsave() {	var store = grid.store;	var rowCount = store.getCount(); //记录数	var cm = grid.getColumnModel();	var colCount = cm.getColumnCount(); 	var list = [];	var rowObj = grid.getSelectionModel().getSelections();	var len = rowObj.length;	if(len<1)	{		alert("请选择某行")		return;	}	for (var r = 0;r < len; r++) 	{		list.push(rowObj[r].data);	}		var grid1=Ext.getCmp('mygrid');  var rwIndex=grid1.getSelectionModel().last;   var RecSave=document.getElementById('RecSave');    for (var i = 0; i < list.length; i++)    {   	var obj=list[i];   	var str="";    var CareDate="";     var CareTime="";     for (var p in obj)     {     	 var aa = formatDate(obj[p]);     	 if (p=="CareDate") CareDate=aa;     	 if (p=='CareTime') CareTime=obj[p];       if (p=="") continue;        if (aa == "") 			{					str = str + p + "|" + DBC2SBC(obj[p]) + '^';			}else			{			  	str = str + p + "|" + aa + '^';				}       }      }     //alert(str);   var a=cspRunServerMethod(RecSave.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURANHUI10",session['LOGON.GROUPDESC']);   //alert("保存成功");		if (a!="0")	{				alert(a);				return;	}   find();   }   function find(){	//var link="dhcnurtempature.csp?EpisodeID="+EpisodeID;   /// window.open (link,'体温单','height=1,width=1,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no')    // window.close();  // alert(parent.frames.length);    MeasureRel = new Hashtable();    REC = new Array();	var adm = EpisodeID;	var GetQueryData = document.getElementById('GetQueryData');	var mygrid = Ext.getCmp("mygrid");	var StDate = Ext.getCmp("Item1").value;  //取上报日期     var now=new Date();	var nowMonth=now.getMonth()+1;	var nowMDate=now.getDate();	if ((((now.getDate()).toString()).length)==1)  //修改日期日头格式	{	 		var nowMDate="0"+(now.getDate()).toString();	}	if ((((now.getMonth()+1).toString()).length)==1)  //修改日期月份格式	{	 		var nowMonth="0"+(now.getMonth()+1).toString();	}	var Enddate=now.getFullYear()+"-"+nowMonth+"-"+nowMDate;    if (StDate=="")    {            StDate=now.getFullYear()+"-"+nowMonth+"-"+nowMDate;    }	var IfCancelRec=Ext.getCmp("IfCancelRec").getValue();   var parr = adm + "^" +StDate + "^" + "00&00"+ "^" + Enddate + "^" + "23&59" + "^"+"DHCNURANHUI10" + "^" + IfCancelRec;   if (StDate=="")   {   	  alert("上报日期不能为空")   	  return;   }	//alert(parr);	//var parr = adm + "^" + StDate.value + "^" + StTime.value + "^" + Enddate.value + "^" + EndTime.value + "^"+"DHCNURANHUI9" + "^" + IfCancelRec;	// debugger;	var a = cspRunServerMethod(GetQueryData.value, "web.DHCNurRecComm:GetCareRecComm", "parr$" + parr, "AddRec");	//alert(REC)	mygrid.store.loadData(REC);}function AddRec(str){	//var a=new Object(eval(str));	var obj = eval('(' + str + ')');	obj.CareDate=getDate(obj.CareDate);	//obj.PregHPregDate=getDate(obj.PregHPregDate);	REC.push(obj);	//debugger;}  function setVal2(itm,val){	  if (val=="") return ;	  var tt=val.split('!');		//alert(tt);	 	var cm=Ext.getCmp(itm);		person=new Array();		addperson(tt[1],tt[0]);		cm.store.loadData(person);		cm.setValue(tt[0]); 		 }  function cmbkey(field, e){	if (e.getKey() ==Ext.EventObject.ENTER)	{		var pp=field.lastQuery;		getlistdata(pp,field);	//	alert(ret);	}}var person=new Array();function getlistdata(p,cmb){	var GetPerson =document.getElementById('GetPerson');	//debugger;    var ret=cspRunServerMethod(GetPerson.value,p);	if (ret!="")	{		var aa=ret.split('^');		for (i=0;i<aa.length;i++)		{			if (aa[i]=="" ) continue;			var it=aa[i].split('|');			addperson(it[1],it[0]);		}		//debugger;		cmb.store.loadData(person);	}}function addperson(a,b){	person.push(	{		desc:a,		id:b	}	);}function Save(){	var StDate = Ext.getCmp("Item1");  //取上报日期 	if(StDate.value=="")	{		StDate.setValue(new Date());	}  ret="";  checkret="";  comboret="";  var SaveRec=document.getElementById('Save');  var gform=Ext.getCmp("gform");  gform.items.each(eachItem1, this);   var getid=document.getElementById("GetId");  var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID);   ret+"&"+checkret+"&"+comboret;  var FOURLIST="";  var FOURLISTobj=Ext.getCmp("FOURLIST");  if(FOURLISTobj)  {	  FOURLIST=FOURLISTobj.getValue();  }  ret=ret+"^Item100|"+FOURLIST+"!"+FOURLISTobj.getRawValue(); 	//var Item29 = Ext.getCmp("Item29");  	//alert(Item29.value);  	if (id==""){  var Id=cspRunServerMethod(SaveRec.value,"^EmrUser|"+session['LOGON.USERID']+"^EmrCode|"+EmrCode+"^"+ret+"^DetLocDr|"+session['LOGON.CTLOCID']+"^EpisodeId|"+EpisodeID+"&"+checkret+"&"+comboret,"");  alert("已保存!");  return;  }  else  {     var Id=cspRunServerMethod(SaveRec.value,"^EmrUser|"+session['LOGON.USERID']+"^EmrCode|"+EmrCode+"^"+ret+"^DetLocDr|"+session['LOGON.CTLOCID']+"^EpisodeId|"+EpisodeID+"&"+checkret+"&"+comboret,id);     if (Id!=="")		 {        alert("已保存!");        return;      }         else      	{     		alert("保存失败!");        return;	   }      }    window.parent.reloadtree2(EmrCode,"评估");    }    function setvalue(){	var ha = new Hashtable();  var getid=document.getElementById('GetId');  var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID); // alert(id)  if (id != "")   {   	//alert("1");   	var getVal = document.getElementById('getVal');   	var ret = cspRunServerMethod(getVal.value, id);    var tm = ret.split('^');		sethashvalue(ha, tm);  } 	else 	{				getPatInfo();				return;	}  	// debugger;         	 var gform=Ext.getCmp("gform");   gform.items.each(eachItem, this);  	 //  alert(a);	for (var i=0 ; i<ht.keys().length;i++)//for...in statement get all of Array's index	{		var key = ht.keys()[i]; 		//restr += ht.items(key) + " " + ht.parent[key] + "<br/>";		if (key.indexOf("_") == -1) 		{			//alert(key);			var flag=ifflag(key );			//alert(flag);			if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items(key));				//debugger;				continue;			} 						var flag=ifflag1(key );			if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items(key));				//debugger;				continue;			} 						var flag=ifflag2(key );			if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items(key));				//debugger;				continue;			} 			var flag=ifflag3(key );						if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items(key));				//debugger;				continue;			} 			var flag=ifLISTflag(key );			if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items("Item100"));				//debugger;				continue;			} 									var itm = Ext.getCmp(key);			if (ha.contains(key)) 			itm.setValue(getval(ha.items(key)));				    }else{			var aa=key.split('_'); 			if(ha.contains(aa[0]))			{			  setcheckvalue(key,ha.items(aa[0]));			}		}    }    find(); }function getval(itm){	var tm=itm.split('!');	return tm[0];}function ifflag(itm){	var tm=ITypItm.split('|');	var flag=false;	for (var i=0;i<tm.length;i++)	{		if (itm==tm[i])		{			flag=true;		}	}	return flag ;} function ifflag1(itm){	var tm=ITypItm1.split('|');	var flag=false;	for (var i=0;i<tm.length;i++)	{		if (itm==tm[i])		{			flag=true;		}	}	return flag ;}function ifflag2(itm){	var tm=ITypItm2.split('|');	var flag=false;	for (var i=0;i<tm.length;i++)	{		if (itm==tm[i])		{			flag=true;		}	}	return flag ;}function ifflag3(itm){	var tm=ITypItm3.split('|');	var flag=false;	for (var i=0;i<tm.length;i++)	{		if (itm==tm[i])		{			flag=true;		}	}	return flag ;}function getPatInfo(){	var PatInfo=document.getElementById('PatInfo');	if (PatInfo) {		var ret=cspRunServerMethod(PatInfo.value,EpisodeID);	 	//alert(ret)	 	var tt=ret.split('^');	 	var patName = Ext.getCmp("Item5");	 	patName.setValue(getValueByCode(tt[4]));	 	var sex = Ext.getCmp("Item7");	 	sex.setValue(getValueByCode(tt[3]));	 	var  regno= Ext.getCmp("Item8");	 	regno.setValue(getValueByCode(tt[9]));	 	var age = Ext.getCmp("Item6");	 	age.setValue(getValueByCode(tt[6]));	 	var patWard = Ext.getCmp("Item2");	 	patWard.setValue(getValueByCode(tt[7]));	 	var bedCode = Ext.getCmp("Item4");	 	bedCode.setValue(getValueByCode(tt[5]));	 	var diag = Ext.getCmp("Item9");	 	diag.setValue(getValueByCode(tt[8]));	 	var myDate=new Date();	 	var Month=myDate.getMonth()+1;	 	var MDate=myDate.getDate();	 	if ((((myDate.getDate()).toString()).length)==1)  //修改日期日头格式	 	{	 		var MDate="0"+(myDate.getDate()).toString();	 	}	 	if ((((myDate.getMonth()+1).toString()).length)==1)  //修改日期月份格式	 	{	 		var Month="0"+(myDate.getMonth()+1).toString();	 	}	 	var nowDate=myDate.getFullYear()+"-"+Month+"-"+MDate;	 	var ReportDate = Ext.getCmp("Item1");  //报告日期	 	ReportDate.setValue(nowDate);  	  var EvaluateDate = Ext.getCmp("Item36");  //评价日期	 	EvaluateDate.setValue(nowDate); 	  //var OccurDate = Ext.getCmp("Item10");  //发生日期	 	//OccurDate.setValue(nowDate);	 		 	var hh=myDate.getHours();	 	var mm=myDate.getMinutes();	 	var Time=hh+":"+mm	 	//alert(Time);	 		 	//var OccurTime = Ext.getCmp("Item11");  //发生时间	  //OccurTime.setValue(Time);  	 		 	} }function getValueByCode(tempStr){	var retStr=tempStr;	var strArr = tempStr.split("|");	if (strArr.length>1) 	{		retStr=strArr[1];	}	return retStr;}