var ret="";var checkret="";var comboret="";var arrgrid=new Array();var SumInName="";var SumInAmount="";var SumOutName="";var SumOutAmount="";var PartInName="";var PartInAmount="";var PartOutName="";var PartOutAmount="";var DisplaySumInName="";var DisplaySumInAmount="";var DisplaySumOutName="";var DisplaySumOutAmount="";var OrdInName="";var OrdInAmount="";var ICountCls="";var OCountCls="";var prnmode = tkMakeServerCall("User.DHCNURMoudelLink", "getPrintCode", EmrCode); //根据界面模板获取打印模板var prnmcodes = "";if (prnmode != "") {	var prnarr = prnmode.split('|')		prnmcodes = prnarr[0];	IfMakePic = prnarr[3]; //是否生成图片	WillUpload = prnarr[4]; //是否上传ftp	//alert(WillUpload)	if (prnarr[2] == "Y") //启用续打	{		StartLock = "1";	} else {		StartLock = "0";	}}var prncode = prnmcodes; //打印模板名称//alert(prncode);var DHCPatOrdListT103=new Ext.data.JsonStore({data:[],fields:['OrdDate','OrdTime','ARCIMDesc','PriorDes','Meth','PHFreq','Dose','DoseUnit','OrdStat','Doctor','Oew','OrdSub','SeqNo','ExeCtp']});var DHCNurLabRecT103=new Ext.data.JsonStore({data:[],fields:['StDateTime','ARCIMDes','LabEpisodeNo','testcode','LabDate','LabTime','LabCpt','RowId']});var DHCNurCheckRecT102=new Ext.data.JsonStore({data:[],fields:['OrdDate','OrdTime','ARCIMDesc','DateEx','TimeEx','CPTEx','ArcimDR','ORW']});//var GetNurseRecSet=document.getElementById('GetNurseRecSet');var GetNurseRecSet=document.getElementById('GetNurseRecSet');if (GetNurseRecSet){	var ret=cspRunServerMethod(GetNurseRecSet.value,"DHCNURBG_JZQJD1");	var hh=ret.split("^");	SumInName=hh[0].split("&")[0];	SumInAmount=hh[0].split("&")[1];	SumOutName=hh[1].split("&")[0];	SumOutAmount=hh[1].split("&")[1];	PartInName=hh[2].split("&")[0].split("!")[0];	PartInAmount=hh[2].split("&")[1];	PartOutName=hh[3].split("&")[0].split("!")[0];	PartOutAmount=hh[3].split("&")[1];	DisplaySumInName=hh[7].split("&")[0].split("!")[0];	DisplaySumInAmount=hh[7].split("&")[1];	DisplaySumOutName=hh[8].split("&")[0].split("!")[0];	DisplaySumOutAmount=hh[8].split("&")[1];    ICountCls=hh[9];    OCountCls=hh[10];    OrdInName=hh[11].split("&")[0];;    OrdInAmount=hh[11].split("&")[1];;	//debugger;	//alert(OrdInName);}var UserType="";var GetUserType=document.getElementById('GetUserType');if (GetUserType){	UserType=cspRunServerMethod(GetUserType.value,session['LOGON.USERID']);}var grid;var DiagnosDr="";var CurrHeadDr="";function gethead(){	var GetHead=document.getElementById('GetHead');	var ret=cspRunServerMethod(GetHead.value,EpisodeID);	var hh=ret.split("^");	return hh[0]+"  "+hh[1];	//debugger;}var printcolor='#C9C9C9';     //已打印颜色  var havechangecolor='#FF8247' //有修改颜色  var noprintcolor='#FFFFF0';   //未打印颜色  var Startcolor='#1E90FF';     //从该条开始打印的颜色function formatDate(value){  	try	{	   return value ? value.dateFormat('Y-m-d') : '';	}	catch(err)	{	   return '';	} };function eachItem1(item,index,length) {       if (item.xtype=="datefield") {               //修改下拉框的请求地址    			ret=ret+item.id+"|"+formatDate(item.getValue())+"^";   			          }     if (item.xtype=="timefield") {               //修改下拉框的请求地址    			//debugger;			ret=  ret+item.id+"|"+item.getValue()+"^";             } 	 if (item.xtype=="combo") {               //修改下拉框的请求地址    			//debugger;			comboret=  comboret+item.id+"|"+item.getValue()+"!"+item.lastSelectionText+"^";             } 	 if (item.xtype=="textfield") {               //修改下拉框的请求地址    			//debugger;			ret=  ret+item.id+"|"+item.getValue()+"^";             } 	 if (item.xtype=="textarea") {               //修改下拉框的请求地址    			ret=  ret+item.id+"|"+item.getRawValue()+"^";             } 	 if (item.xtype=="checkbox") {               //修改下拉框的请求地址    			//debugger;		if ((item.checked==true)||(item.xtype=="radio"))	    	{   			//checkret=checkret+item.id+"|"+item.boxLabel+"|"+item.boxLabel+"^";    			checkret=checkret+item.id+"|"+item.boxLabel+"^";   		}		else    		{    			//checkret=checkret+item.id+"|"+"|"+item.boxLabel+""+"^";    			checkret=checkret+item.id+"|"+""+"^";      	}                /*if (item.checked==true) 		{			checkret=checkret+item.id+"|"+item.boxLabel+"^";		}         else         	{       		checkret=checkret+item.id+"|"+""+"^";         	}*/    }     /*if (item.xtype=="radio"){    	if (item.checked==true) 		{			//alert(022)			checkret=checkret+item.id+"|"+item.boxLabel+"^";		}          else         	{       		checkret=checkret+item.id+"|"+""+"^";         	}   	    }*/	      if (item.items && item.items.getCount() > 0) {          item.items.each(eachItem1, this);       }   }   var ITypItm="Item54"; //后取数据字典型 var locdata = new Array();var ITypItm1="Item55"; function reloaddep(depobj){	var depval=depobj.getRawValue();	tkMakeServerCall("web.DHCNurSyComm","getlocByName","addloc",depval);	alert(depval)	depobj.store.loadData(locdata);} function BodyLoadHandler(){		var dep = Ext.getCmp("Item47");    if(dep)		{		dep.store.on("beforeLoad",function(){		var wardstore=dep.store;		var str=dep.lastQuery		wardstore.baseParams.ward=str; 		});		dep.store.load({params:{start:0,limit:2000}});	}    	var dep = Ext.getCmp("Item48");  	if(dep)	{		dep.store.on("beforeLoad",function(){		var wardstore=dep.store;		var str=dep.lastQuery		wardstore.baseParams.ward=str; 		});		dep.store.load({params:{start:0,limit:2000}});	}    		var but=Ext.getCmp("butSave");    but.on('click',function(){Save(false)});								// 评估单 保存	var but=Ext.getCmp("butPrint");    but.on('click',butPrintFn);	setvalue();	setsize("mygridpl","gform","mygrid");	var but1=Ext.getCmp("mygridbut1");	but1.on('click',additm);	var but=Ext.getCmp("mygridbut2");	but.setText("保存");	but.on('click',function(){saveGrid(false)});							  // 表格保存	setzkinit() 	var DIAG = Ext.getCmp("Item58");	var Item66 = Ext.getCmp("Item66");	var B234 = Ext.getCmp("B234");	var Item111= Ext.getCmp("Item65_1");	var Item211= Ext.getCmp("Item65_2");	var Item311= Ext.getCmp("Item65_3");	var Item411= Ext.getCmp("Item65_4");        	var Item221= Ext.getCmp("Item56_1");    var Item222= Ext.getCmp("Item56_2");    var Item223= Ext.getCmp("Item56_3");    var Item224= Ext.getCmp("Item56_4");    var Item225= Ext.getCmp("Item56_5");    var Item226= Ext.getCmp("Item56_6");    var Item227= Ext.getCmp("Item56_7");    var Item228= Ext.getCmp("Item56_8");	var Item3=Ext.getCmp("Item54");	var Item4=Ext.getCmp("Item55");		Item4.on('specialkey',cmbkey); 	Item3.on('specialkey',cmbkey);	//Item66.setVisible(false);	//B234.setVisible(false);		if(Item66.value!="")	{		 Item66.setVisible(true);		 B234.setVisible(true); 	}	else	{		 Item66.setVisible(false);		 B234.setVisible(false);		}   Item111.on("check",function()	{  		var dd11=Item111.getValue()	 	if (dd11==true)	    {		    	Item211.setValue(false) 	    	Item311.setValue(false)	    	Item411.setValue(false)	    }		   	})   	Item211.on("check",function()	{  		var dd11=Item211.getValue()	 	if (dd11==true)	    {		    	Item111.setValue(false) 	    	Item311.setValue(false)	    	Item411.setValue(false)	    }		   	})	   	Item311.on("check",function()	{  		var dd11=Item311.getValue()	 	if (dd11==true)	    {		    	Item111.setValue(false) 	    	Item211.setValue(false)	    	Item411.setValue(false)	    }		   	})	   	Item411.on("check",function()	{  		var dd11=Item411.getValue()	 	if (dd11==true)	    {		    	Item111.setValue(false) 	    	Item211.setValue(false)	    	Item311.setValue(false)	    }		   	})   	Item221.on("check",function()	{  		var dd22=Item221.getValue()	 	if (dd22==true)	    {		    	Item222.setValue(false) 	    	Item223.setValue(false)	    	Item224.setValue(false)	    	Item225.setValue(false) 	    	Item226.setValue(false) 	    	Item227.setValue(false) 	    	Item228.setValue(false) 	    	Item66.setVisible(false)	    	B234.setVisible(false)    		Item66.setValue("")    	  		    }		   	})   	Item222.on("check",function()	{  		var dd22=Item222.getValue()	 	if (dd22==true)	    {		    	Item221.setValue(false) 	    	Item223.setValue(false)	    	Item224.setValue(false)	    	Item225.setValue(false) 	    	Item226.setValue(false) 	    	Item227.setValue(false) 	    	Item228.setValue(false) 	    	Item66.setVisible(false)	    	B234.setVisible(false)    		Item66.setValue("")    	  		    }		   	})	   	Item223.on("check",function()	{  		var dd22=Item223.getValue()	 	if (dd22==true)	    {		    	Item221.setValue(false)	    	Item222.setValue(false) 	    	Item224.setValue(false)	    	Item225.setValue(false) 	    	Item226.setValue(false) 	    	Item227.setValue(false) 	    	Item228.setValue(false) 	    	Item66.setVisible(false)	    	B234.setVisible(false)    		Item66.setValue("")    	  		    }		   	})	   	Item224.on("check",function()	{  		var dd22=Item224.getValue()	 	if (dd22==true)	    {		    	Item221.setValue(false) 	    	Item222.setValue(false)	    	Item223.setValue(false)	    	Item225.setValue(false) 	    	Item226.setValue(false) 	    	Item227.setValue(false) 	    	Item228.setValue(false) 	    	Item66.setVisible(false)	    	B234.setVisible(false)    		Item66.setValue("")    	  		    }		   	})	   	Item225.on("check",function()	{  		var dd22=Item225.getValue()	 	if (dd22==true)	    {		    	Item221.setValue(false) 	    	Item222.setValue(false)	    	Item223.setValue(false)	    	Item224.setValue(false) 	    	Item226.setValue(false) 	    	Item227.setValue(false) 	    	Item228.setValue(false) 	    	Item66.setVisible(false)	    	B234.setVisible(false)    		Item66.setValue("")    	  		    }		   	})	   	Item226.on("check",function()	{  		var dd22=Item226.getValue()	 	if (dd22==true)	    {		    	Item221.setValue(false) 	    	Item222.setValue(false)	    	Item223.setValue(false)	    	Item224.setValue(false) 	    	Item225.setValue(false) 	    	Item227.setValue(false) 	    	Item228.setValue(false) 	    	Item66.setVisible(false)	    	B234.setVisible(false)    		Item66.setValue("")    	  		    }		   	})	   	Item227.on("check",function()	{  		var dd22=Item227.getValue()	 	if (dd22==true)	    {		    	Item221.setValue(false) 	    	Item222.setValue(false)	    	Item223.setValue(false)	    	Item224.setValue(false) 	    	Item225.setValue(false) 	    	Item226.setValue(false) 	    	Item228.setValue(false) 	    	Item66.setVisible(false)	    	B234.setVisible(false)    		Item66.setValue("")    	  		    }		   	})	   	Item228.on("check",function()	{  		var dd22=Item228.getValue()	 	if (dd22==true)	    {		    	Item221.setValue(false) 	    	Item222.setValue(false) 	    	Item223.setValue(false)	    	Item224.setValue(false)	    	Item225.setValue(false) 	    	Item226.setValue(false) 	    	Item227.setValue(false)	    	B234.setVisible(true) 	    	Item66.setVisible(true) 	    	Item66.focus();	    }		   	})		Ext.override(Ext.Editor, {			onSpecialKey : function(field, e) {				var key = e.getKey();				this.fireEvent('specialkey', field, e);			}		});Ext.override(Ext.grid.RowSelectionModel, {			onEditorKey : function(F, E) {				var C = E.getKey(), G, D = this.grid, B = D.activeEditor;				var A = E.shiftKey; 				//debugger;        if (C == E.RIGHT) {        // alert();        E.stopEvent();        B.completeEdit();        G = D.walkCells(B.row,B.col+1, 1, this.acceptsNav,this);        }               if (C == E.LEFT) {        // alert();        E.stopEvent();        B.completeEdit();        G = D.walkCells(B.row,B.col-1, 1, this.acceptsNav,this);        }       if (C == E.DOWN) {       // alert();       E.stopEvent();       B.completeEdit();       G = D.walkCells(B.row+1,4, 1, this.acceptsNav,this);       }             if (C == E.UP) {       // alert();       E.stopEvent();       B.completeEdit();       G = D.walkCells(B.row-1,4, 1, this.acceptsNav,this);       }        				if (C == E.TAB) {					E.stopEvent();					B.completeEdit();					if (A) {						G = D.walkCells(B.row, B.col - 1, -1, this.acceptsNav,								this);					} else {						G = D.walkCells(B.row, B.col + 1, 1, this.acceptsNav,								this);					}				} else {					if (C == E.ENTER) {						E.stopEvent();						// alert(B);						B.completeEdit();						if (this.moveEditorOnEnter !== false) {							if (A) {								// G = D.walkCells(B.row - 1, B.col, -1,								// this.acceptsNav,this)								G = D.walkCells(B.row, B.col - 1, -1,										this.acceptsNav, this);							} else {								// G = D.walkCells(B.row + 1, B.col, 1,								// this.acceptsNav,this)								G = D.walkCells(B.row, B.col + 1, 1,										this.acceptsNav, this);							}						}					} else {						if (C == E.ESC) {							B.cancelEdit();						}					}				}				if (G) {					D.startEditing(G[0], G[1]);				}			}		});    var sm2 = new Ext.grid.RowSelectionModel({           moveEditorOnEnter: true,           singleSelect: false,           listeners: {               //rowselect : function(sm, row, rec) {                   //centerForm.getForm().loadRecord(rec);              // }           }         });  	grid=Ext.getCmp('mygrid');  	grid.setTitle(gethead());  	var mydate=new Date();  	var tobar=grid.getTopToolbar();	tobar.addItem(	    {			xtype:'datefield',			//format: 'Y-m-d',			id:'mygridstdate',			value:(diffDate(new Date(),-1))		},	    {			xtype:'timefield',			width:100,			format: 'H:i',			value:'0:00',			id:'mygridsttime'		},	    {			xtype:'datefield',			//format: 'Y-m-d',			id:'mygridenddate',			value:diffDate(new Date(),1)		},	    {			xtype:'timefield',			width:100,			id:'mygridendtime',			format: 'H:i',			value:'0:00'		}	);	tobar.addButton(	  {		className: 'new-topic-button',		text: "查询",		handler:find,		id:'mygridSch'	  }	);    tobar.addButton(		  {			//className: 'new-topic-button',			text: "统计",			handler:findStat,			id:'mygridStat'		  }	  );	/*tobar.addButton(		  {			//className: 'new-topic-button',			text: "统计尿量",			handler:findStatNL,			id:'mygridStatNL'		  }	  );*/   	/*tobar.addButton(		  {			className: 'new-topic-button',			text: "打印",			handler:printNurRec,			id:'PrintBut'		  }	  ); */ 	//tobar.addButton(	//	  {	//		//className: 'new-topic-button',	//		text: "续打印设置",	//		handler:PrintSet,	//		id:'XPrintSet'	//	  }	//  );   	tobar.addItem ("-",{			xtype:'checkbox',			id:'IfCancelRec',			checked:false,			boxLabel:'显示作废记录' 			});	//tobar.render(grid.tbar);	tobar.doLayout();  	if (UserType=="DOCTOR1") 	{ 		if (but1) but1.hide(); 		if (but) but.hide(); 		//var obj=Ext.getCmp("PrintBut"); 		//if (obj) obj.hide();  		var obj=Ext.getCmp("XPrintSet"); 		if (obj) obj.hide();		 	} 	else 	{		grid.addListener('rowcontextmenu', rightClickFn);		grid.addListener('rowclick', rowClickFn); 	}grid.on('mouseover',function(e){//添加mouseover事件	var index = grid.getView().findRowIndex(e.getTarget());//根据mouse所在的target可以取到列的位置	if(index!==false){//当取到了正确的列时，（因为如果传入的target列没有取到的时候会返回false）		var store = grid.getStore();		var totalRow="";		if (store.getCount()>0) totalRow=store.getAt(index).get(DisplaySumInName);		//alert(totalRow)		if ((totalRow)&&(totalRow.indexOf("入液量")>-1))		{			//var record = store.getAt(index);//把这列的record取出来			//var str = Ext.encode(record.data);//组装一个字符串，这个需要你自己来完成，这儿我把他序列化			var par=store.getAt(index).get("par");			var rw=store.getAt(index).get("rw");			var totalRow1,totalRow2,totalRow3,totalRow4;			if ((par)&&(rw))			{				var GetSubInOut=document.getElementById('GetSubInOut');				if (GetSubInOut)				{					var ret=cspRunServerMethod(GetSubInOut.value,par+"^"+rw);					var retArr=ret.split("@");					totalRow1=retArr[0];					totalRow2=retArr[1];					totalRow3=retArr[2];					totalRow4=retArr[3];				}	 				}			else			{				totalRow1=store.getAt(index).get(PartInName);				totalRow2=store.getAt(index).get(PartInAmount);				totalRow3=store.getAt(index).get(PartOutName);				totalRow4=store.getAt(index).get(PartOutAmount);			}			//var str="<p>"+totalRow1+"</p><p>"+totalRow2+"</p><p>"+totalRow3+"</p><p>"+totalRow4+"</p>";			var str="<TABLE borderColor=#000000 width='100%' bgColor=#ffffff border=1 cellSpacing=0 cellPadding=0><TBODY>";			str=str+"<TR bgColor=#D2E9FF><TD></TD><TD>名称</TD><TD>量</TD></TR>";			var totalRow2Arr=totalRow2.split(";");			str=str+"<TR><TD bgColor=#D2E9FF rowSpan="+(totalRow2Arr.length-1)+">入液量分项</TD><TD>"+totalRow2Arr[0].replace(":","</TD><TD>")+"</TD></TR>";			for (var i=1;i<(totalRow2Arr.length-1);i++)			{				str=str+"<TR><TD>"+totalRow2Arr[i].replace(":","</TD><TD>")+"</TD></TR>";			}			var totalRow4Arr=totalRow4.split(";");			str=str+"<TR><TD bgColor=#D2E9FF rowSpan="+(totalRow4Arr.length-1)+">出液量分项</TD><TD>"+totalRow4Arr[0].replace(":","</TD><TD>")+"</TD></TR>";			for (var i=1;i<(totalRow4Arr.length-1);i++)			{				str=str+"<TR><TD>"+totalRow4Arr[i].replace(":","</TD><TD>")+"</TD></TR>";			}			str=str+"</TBODY></TABLE>";			var rowEl = Ext.get(e.getTarget());//把target转换成Ext.Element对象			rowEl.set({				'ext:qtip':str  //设置它的tip属性			},false);	  }	}});Ext.QuickTips.init();//注意，提示初始化必须要有grid.getStore().on('load',function(s,records){          var girdcount=0;          s.each(function(r){          //alert(r.get(DisplaySumInName))              if(r.get(DisplaySumInName)=='总入液量='){                    grid.getView().getRow(girdcount).style.backgroundColor='#F7FE2E';              }              if(r.get(DisplaySumInName)=='入液量='){                    grid.getView().getRow(girdcount).style.backgroundColor='#A7FE2E';              }               if(r.get(DisplaySumOutName)=='总尿量='){                    grid.getView().getRow(girdcount).style.backgroundColor='#F7FE2E';              }              if(r.get(DisplaySumOutName)=='尿量='){                    grid.getView().getRow(girdcount).style.backgroundColor='#A7FE2E';              }              girdcount=girdcount+1;          });       //scope:this       });			find();}function addloc(a, b) {	locdata.push({				id : a,				desc : b			});} function findperson(combo, record, index) {	//alert(combo.value+"^"+record+"^"+index);	person = new Array();	var cmb = Ext.getCmp("RequestConDoc");	cmb.store.loadData(person);	if(combo.value!="") getlistdata(combo.value,cmb);}function additm(){   	//saveGrid(true);	var Plant = Ext.data.Record.create([	{name:'CareDate'}, 	{name:'CareTime'},	{name:'Item1'},	{name:'Item2'},	{name:'Item3'},	{name:'Item4'},	{name:'Item5'},	{name:'Item6'},	{name:'Item7'},	{name:'Item8'},	{name:'Item9'}, 	{name:'Item10'},	{name:'Item11'},	{name:'Item12'},	{name:'Item13'},	{name:'Item14'},	{name:'Item15'},	{name:'Item16'},	{name:'Item17'}, 	{name:'Item18'},	{name:'Item19'}, 	{name:'Item20'},	{name:'Item21'},	{name:'Item22'},	{name:'Item23'},	{name:'Item24'},	{name:'Item25'},	{name:'Item26'},	{name:'Item27'},	{name:'Item28'},	{name:'Item29'},	{name:'Item30'},	{name:'Item31'},	{name:'Item32'},	{name:'Item33'},	{name:'Item34'},	{name:'Item35'},	{name:'Item36'},	{name:'Item37'},	{name:'Item38'},	{name:'Item39'},	{name:'Item40'},	{name:'Item41'},	{name:'Item42'},	{name:'Item43'},	{name:'Item44'},	{name:'Item45'},	{name:'Item46'},	{name:'Item47'}, 	{name:'Item48'},	{name:'Item49'},	{name:'Item50'},	{name:'CaseMeasure'},	{name:'User'},	{name:'rw'},	{name:'par'}      ]);    var count = grid.store.getCount();     var r = new Plant({CareDate:new Date(),CareTime:new Date().dateFormat('H:i')}); 	var sameDate="";sameTime="";	var formatid=tkMakeServerCall("websys.Conversions","DateFormat");	var format="d/MM/yyyy";	if(formatid==3) format="yyyy-MM-d";	if(formatid==1) format="MM/d/yyyy";	var sameTimeRecord=false;	for(var j=0;j<count;j++){		//var careDate=formatDate(grid.store.getAt(j).data.CareDate);		var careDate=formatDate1(grid.store.getAt(j).data.CareDate,format);		var careTime=grid.store.getAt(j).data.CareTime;		//if((careDate==formatDate(new Date()))&&(careTime==new Date().dateFormat('H:i'))){		if((careDate==formatDate1(new Date(),format))&&(careTime==new Date().dateFormat('H:i'))){				sameDate=careDate,sameTime=careTime;			sameTimeRecord=true;			break;		}	}	if(sameTimeRecord){				if(!window.confirm(sameDate+"  "+sameTime+" 有相同时间点的记录，确定要新建吗?"))		{			return;		}	}    grid.store.commitChanges();     grid.store.insert(0,r); 	grid.getSelectionModel().selectFirstRow();	return;} var rightClick = new Ext.menu.Menu(  {            id : 'rightClickCont',            items : [  {                id:'rMenu1',                text : '医嘱',                handler:OrdSch            },  {                id:'rMenu2',                text : '病情措施及处理',                handler:RecMeasureNew            }, /* {                id:'rMenu8',                text : '插入尿量小结',                handler:InOutNodNL            },  {                id:'rMenu9',                text : '插入24小时尿量',                handler:InOutSumNL            }, */{                id:'rMenu4',                text : '插入出入液量小结',                handler:InOutNod            },  {                id:'rMenu5',                text : '插入24小时出入液量',                handler:InOutSum            },  /*{                id:'rMenu6',                text : '修改关联诊断',                handler:UpdateRelDiagnos            }, */ {                id:'rMenu7',                text : '作废',                handler:CancelRecord            }]        });function rightClickFn(client, rowIndex, e)  {          e.preventDefault();          grid=client;		  CurrRowIndex=rowIndex;          rightClick.showAt(e.getXY());            }function rowClickFn(grid, rowIndex, e)  {                //alert('你单击了' + rowIndex);            }              function MeasureNew(){   	MeasureRel = new Hashtable();	var grid1=Ext.getCmp('mygrid');	var objRow=grid1.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条护理记录!"); return; }	var par=grid1.getSelectionModel().getSelections()[0].get("par"); 	var rw=grid1.getSelectionModel().getSelections()[0].get("rw"); 	var rowid=par+"||"+rw;	if (par==undefined)	{		rowid="";	}	var parr="DHCNURXH2^"+EpisodeID+"^CaseMeasureXml^"+rowid;  var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCNURMeasure", EpisodeID, "");	arr = eval(a);  var emrknowurl="dhcnuremrknow.csp?EmrCode=DHCNurKnowldge&Parr="+parr+"&EpisodeID="+EpisodeID;                    var south_item = new Ext.Panel({                   region: 'south',                                split: false,                  	border: false,                  	// collapsible: true,            		    autoScroll: false,                layout: 'absolute',                   minSize: 100,  				        height:570, //内层高度（600-30）预留30的高度给确定按钮  				      frame:true,                //items: arr 				        buttons: [ {						      text: '确定',						     						      handler: function(){														    sureMeasure();						      }					        }, {						      text: '取消',						      handler: function(){							    window.close();						      }					       }],				        html: '<iframe id ="southTab" name="ddd" style="width:100%; height:100%" src='+emrknowurl+' ></iframe>'                                 });   	var window = new Ext.Window({ 		title: '病情措施及处理',		x:100,		y:50,		width: 900,  //宽度		modal:true,		height: 600,  //高度		id:'CaseForm',		autoScroll: false,		layout: 'absolute',		plain: true,		frame:true,		items: south_item   	});	var mygrid=Ext.getCmp("mygrid");	var rowObj = mygrid.getSelectionModel().getSelections();	var len = rowObj.length;	if (len < 1)	{		Ext.Msg.show({title:'注意',msg:'请选择一条数据!',buttons: Ext.Msg.OK,icon:Ext.MessageBox.WARNING});		return;	}  window.show();}              function MultiFun(){	var GetMulti=document.getElementById('GetMulti');	var getcheckform=document.getElementById('getcheckform');		var ret= cspRunServerMethod(GetMulti.value, "DHCNURBG_JZQJD1");    var grid=Ext.getCmp('mygrid');    var tt=ret.split('^');	var ab="";	for (i=0;i<tt.length;i++)	{		if (tt[i]=="") continue;		//debugger;		var dd=grid.getSelectionModel().getSelections()[0].get(tt[i]); 		if (dd==undefined)dd=""		if (dd!="") ab=ab+dd+"^"+tt[i]+"!";		else ab=ab+"^"+tt[i]+"!";	}	var tabstr=cspRunServerMethod(getcheckform.value, "DHCNURBG_JZQJD1",ab);	var tabarr=tabstr.split('!');		var tbitm=new Array();		for (i = 0; i < tabarr.length; i++) 		{			if (tabarr[i] == "") 				continue;			var itmm = tabarr[i].split('^');			tbitm.push({				xtype: 'panel',				id: itmm[0],				title: itmm[1],				//height: 1000,				layout: 'absolute',				//frame:false,				//palin:false,				closable: false,				items: eval(itmm[2])						})				//alert(itmm[2]);		}	var subttab=new Ext.TabPanel({	    activeTab : 0,//        autoTabs: true,        resizeTabs:true,         //height:200,      //  width:300,        enableTabScroll:true, 	   items:tbitm     });	 	var window = new Ext.Window({		title: '多选',		width: 450,		height: 480,		id:'mulForm',		autoScroll: true,		layout: 'fit',		plain: true,		frame:true,		items: subttab ,  		buttons:[{id:'mulselbut',text:'保存',handler:SaveMulCheck}]	});	   window.show(); }var checkret="";function SaveMulCheck(){  checkret="";  var gform=Ext.getCmp("mulForm");  gform.items.each(eachItem, this);  	var aa=checkret.split('^');	//alert(aa);	var ht = new Hashtable();	//debugger;	for (i = 0; i < aa.length; i++) {		if (aa[i] == "") 			continue;		var itm = aa[i].split('|');		var aitm = itm[0].split('_');		if (ht.contains(aitm[0])) {		  var val=ht.items(aitm[0])		  ht.remove(aitm[0]);		  var dd=val+";"+itm[1];		  ht.add(aitm[0],dd);		}		else {		ht.add(aitm[0], itm[1])	    }			}	var mygrid=Ext.getCmp('mygrid');	 for(var i in ht.keys())	 {	  var key =ht.keys()[i];      var restr = ht.items(key);	   mygrid.getSelectionModel().getSelections()[0].set(key,restr); 	 }	//alert(checkret);}/*function add(a1, a2){	attenitm.push({		xtype:'panel',		id: a1,		title: a2,		region:'center',		height:1000,		layout:'fit',		closable:true,		items:[]	})} */function multiSel(ret){		var grid1=Ext.getCmp('multigrid');		var code=grid1.getSelectionModel().getSelections()[0].get("itm3");     var itname=grid1.getSelectionModel().getSelections()[0].get("itm4"); 	  var getcheckform=document.getElementById('getcheckform');		//alert(itname+"!!"+code)		var ret=cspRunServerMethod(getcheckform.value, "DHCNURBG_JZQJD1",itname,code,"");			var CareDate=grid.getSelectionModel().getSelections()[0].get("CareDate"); 		var aa=new Array();		aa=eval(aa);    /*		debugger;		for(var i=0;i<items.length;i++){             panl.remove(items[i]);           }            panl.doLayout();		panl.add(new Ext.form.Checkbox({                        id:"addboxModule",                                    name:"userModule",                    boxLabel : 'moduleName'                    }));*/		panl.doLayout();		debugger;		 }function addMulitm(ret){	var grid1=Ext.getCmp('multigrid');  	var Plant = Ext.data.Record.create([	{name:'itm1'},	{name:'itm2'},	{name:'itm3'},	{name:'itm4'}      ]);	var itm=ret.split('^');	for (i = 0; i < itm.length; i++) {		if (itm[i]=="") continue;		var aa=itm[i].split('!');		var count = grid1.store.getCount();		var r = new Plant({			itm1: aa[0],			itm2: "",			itm3:aa[1],			itm4:aa[2]		});		grid1.store.commitChanges();		grid1.store.insert(count, r);	}   return;   }              function OrdSch1(){	// var CurrAdm=selections[rowIndex].get("Adm");	selections = grid.getSelectionModel().getSelections();	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCPatOrdList", EpisodeID, "");	arr = eval(a);	var window = new Ext.Window({		title: '医嘱',		width: 550,		height: 550,		autoScroll: true,		layout: 'absolute',		plain: true,		frame: true,		//modal: true,		//bodyStyle: 'padding:5px;',		///buttonAlign: 'center',		items: arr	});	var butin=Ext.getCmp('ordgridbut1');  butin.text="确定"; 	//debugger;  butin.on('click',SureIn);  window.show();}function OrdSch(){         	// var CurrAdm=selections[rowIndex].get("Adm");	selections = grid.getSelectionModel().getSelections();	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCPatOrdList", EpisodeID, "");	arr = eval(a);	var window = new Ext.Window({		title: '',		x:100,		y:50,		width: 600,		height: 550,		autoScroll: true,		layout: 'absolute',		plain: true,		frame:true,		//modal: true,		//bodyStyle: 'padding:5px;',		///buttonAlign: 'center',		items: arr	});	var mydate=new Date();  	var	grid1=Ext.getCmp("ordgrid");	grid1.getBottomToolbar().hide()	tobar=grid1.getTopToolbar();	tobar.addItem(	    {			xtype:'datefield',			//format: 'Y-m-d',			id:'ordgridstdate',			value:(diffDate(new Date(),-1))		},	    {			xtype:'datefield',			//format: 'Y-m-d',			id:'ordgridenddate',			value:new Date()		}	);	tobar.addButton(	  {		className: 'new-topic-button',		text: "查询",		//handler:find,		id:'ordgridSch'	  }	);	var butin=Ext.getCmp('ordgridbut2');	butin.hide();	var butin=Ext.getCmp('ordgridbut1');	butin.text="确定";	//debugger;	butin.on('click',SureIn);	var butschord=Ext.getCmp('ordgridSch');	butschord.on('click',SchOrd);	window.show();} var condata=new Array();function add(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){ //OrdDate,OrdTime,ARCIMDesc,PriorDes,Meth,PHFreq,Dose,PhQtyOrd,OrdStat,Doctor,Oew,OrdSub,Sel,SeqNo 	condata.push({		OrdDate: a,		OrdTime: b,		ARCIMDesc: c,		PriorDes: d,		Meth: e,		PHFreq: f,		Dose: g,		DoseUnit: h,		PhQtyOrd: i,		OrdStat: j,		Doctor: k,		Oew: l,		OrdSub: m,		SeqNo: o	});}function SchOrd(){	condata=new Array();	var adm=EpisodeID;	var StDate= Ext.getCmp("ordgridstdate");	var Enddate= Ext.getCmp("ordgridenddate");	var GetQueryData=document.getElementById('GetQueryData1');	var ordgrid=Ext.getCmp("ordgrid");	var parr=adm+"^"+StDate.value+"^"+Enddate.value; 	var a=cspRunServerMethod(GetQueryData.value,"web.DHCNUREMR:GetPatOrd","parr$"+parr,"add");	// grid.width=document.body.offsetWidth;	ordgrid.store.loadData(condata);}function Schlab(){	condata=new Array();	var adm=EpisodeID;	var StDate= Ext.getCmp("LabGridstdate");	var Enddate= Ext.getCmp("LabGridenddate");	var GetQueryData=document.getElementById('GetQueryData1');	var ordgrid=Ext.getCmp("LabGrid");  //var parr=adm+"^"+StDate.value+"^"+Enddate.value;	//alert(adm); 	var a=cspRunServerMethod(GetQueryData.value,"web.DHCNurJYRESULT:GetLabNo","Adm$"+adm,"AddLab");  // grid.width=document.body.offsetWidth;  ordgrid.store.loadData(condata);   }function AddLab(a,b,c,d,e,f,g,h){	//OrdDate,OrdTime,ARCIMDesc,ORW,DateEx,TimeEx ,CPTEx,ArcimDR		condata.push({			ARCIMDes:a,			LabEpisodeNo:b,			StDateTime:c,			RowId:d,			testcode:e,			LabCpt:f,			LabDate:g,			LabTime:h		});}function AddCheck(a,b,c,d,e,f,g,h){	//OrdDate,OrdTime,ARCIMDesc,ORW,DateEx,TimeEx ,CPTEx,ArcimDR		condata.push({			OrdDate:a,			OrdTime:b,			ARCIMDesc:c,			ORW:d,			DateEx:e,			TimeEx:f ,			CPTEx:g,			ArcimDR:h		});}function SchCheck(){	condata=new Array();	var adm=EpisodeID;	var StDate= Ext.getCmp("CheckGridstdate");	var Enddate= Ext.getCmp("CheckGridenddate");	var GetQueryData=document.getElementById('GetQueryData1');	var ordgrid=Ext.getCmp("CheckGrid");    var parr=adm+"^"+StDate.value+"^"+Enddate.value; 	var a=cspRunServerMethod(GetQueryData.value,"web.DHCNurJYRESULT:GetOrdRadia","parr$"+parr,"AddCheck");   // grid.width=document.body.offsetWidth;        ordgrid.store.loadData(condata);   }function Measure(){   /* selections = grid.getSelectionModel().getSelections(); 	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCNURMeasure", EpisodeID, "");	arr = eval(a);*/	//EmrCode,EpisodeId,fieldCode		MeasureRel = new Hashtable();     var grid1=Ext.getCmp('mygrid');	var par=grid1.getSelectionModel().getSelections()[0].get("par"); 	var rw=grid1.getSelectionModel().getSelections()[0].get("rw");    // debugger;	var rowid=par+"||"+rw;	if (par==undefined)	{		rowid="";	}	var parr="DHCNURBG_JZQJD1^"+EpisodeID+"^CaseMeasureXml^"+rowid;	//alert(parr);	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCPatOrdList", EpisodeID, "");	arr = eval(a);	var arrlab = new Array();	a = cspRunServerMethod(pdata1, "", "DHCNurLabRec", EpisodeID, "");	arrlab = eval(a);	var arrcheck = new Array();	a = cspRunServerMethod(pdata1, "", "DHCNurCheckRec", EpisodeID, "");	arrcheck = eval(a);	var arrResult = new Array();	a = cspRunServerMethod(pdata1, "", "DHCNurLCResult", EpisodeID, "");	arrResult = eval(a);	//DHCNurLCResult	var north_item = new Ext.Panel({   			title: '',   			region: 'north',   			//contentEl: 'north-div',   			split: true,   							frame:true,			border: true,   			//collapsible: true,   			height: 250,   			items:[{				xtype:"tabpanel",				activeTab:0,				frame:true,				items:[	  				{title:"医嘱",			  			width: 550,			  			height: 250,			  			autoScroll: true,		      			layout:'absolute',			  			items:arr},			         		{title:"检查",			  			width: 550,			  			height: 250,			  			autoScroll: true,		      			layout:'absolute',			  			items:arrcheck			 			},			         		{title:"检验",			  			width: 550,			  			height: 250,			  			autoScroll: true,		      			layout:'absolute',			  			items:arrlab			 			}]						 }]		});                var arr = new Array();	        var a = cspRunServerMethod(pdata1, "", "DHCNURMeasure", EpisodeID, "");	        arr = eval(a);            var emrknowurl="dhcnuremrknow.csp?EmrCode=DHCNurKnowldge&Parr="+parr+"&EpisodeID="+EpisodeID;			//alert(emrknowurl);            //中间               var center_item = new Ext.Panel({                   region: 'center',             		autoScroll: true,                split: true,                   layout: 'fit',                   collapsible: false,  				height:50,                 minSize: 50,     				frame:true,                items: arrResult            });                //南边，状态栏               var south_item = new Ext.Panel({                   region: 'south',                 	// contentEl: 'south-div',                   split: true,                  	// border: true,                  	// collapsible: true,            		autoScroll: true,                layout: 'absolute',                   minSize: 250,  				height:250,  				frame:true,                //items: arr 				buttons: [{						text: '确定',						handler: function(){							//	Save();							//	window.close();							sureMeasure();						}					}, {						text: '取消',						handler: function(){							window.close();						}					}],				html: '<iframe id ="southTab" name="ddd" style="width:100%; height:100%" src='+emrknowurl+' ></iframe>'                            });                   //中间的中间，功能菜单    	//alert(parr);	var window = new Ext.Window({ 		title: '医嘱',		x:100,		y:50,		width: 550,		modal:true,		height: 580,		id:'CaseForm',		autoScroll: true,		layout: 'border',		plain: true,		frame:true,		items: [north_item, center_item,south_item]   	});	var grid=Ext.getCmp("LabGrid");	var tobar=grid.getTopToolbar();	addtitCon(tobar,grid.id);	grid=Ext.getCmp("CheckGrid");	tobar=grid.getTopToolbar();	addtitCon(tobar,grid.id);	grid=Ext.getCmp("ordgrid");	tobar=grid.getTopToolbar();	addtitCon(tobar,grid.id);		var butschlab=Ext.getCmp('LabGridSch');	butschlab.on('click',Schlab);		var butschord=Ext.getCmp('ordgridSch');	butschord.on('click',SchOrd);		var butschcheck=Ext.getCmp('CheckGridSch');	butschcheck.on('click',SchCheck);		var gridc=Ext.getCmp('CheckGrid');	gridc.on('click',gridcheckclick);		var gridl=Ext.getCmp('LabGrid');	gridl.on('click',gridLabclick);	var mygrid=Ext.getCmp("mygrid");      ////var butsure=Ext.getCmp('_Button6');   //butsure.on('click',sureMeasure);	var rowObj = mygrid.getSelectionModel().getSelections();	var len = rowObj.length;	if (len < 1) {		//Ext.Msg.show({title:'注意',msg:'请选择需要修改的数据!',buttons: Ext.Msg.OK,icon:Ext.MessageBox.WARNING});		return;	}	else {		//var content = rowObj[0].get("CaseMeasure");		//var TxtCaseMeasure=Ext.getCmp('TxtCaseMeasure');		//TxtCaseMeasure.setValue(content);	} //var mydate=new Date(); //var butord=Ext.getCmp('_Button5'); //butord.on=('click',OrdSch1); window.show(); //alert();}function Measure1(){  selections = grid.getSelectionModel().getSelections(); 	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCNURMeasure", EpisodeID, "");	arr = eval(a);	var window = new Ext.Window({		title: '医嘱',		width: 550,		height: 450,		autoScroll: true,		layout: 'absolute',		plain: true,		frame:true,		//modal: true,		//bodyStyle: 'padding:5px;',		///buttonAlign: 'center',		items: arr	}); var mydate=new Date(); var butord=Ext.getCmp('_Button5'); butord.on=('click',OrdSch1); window.show();}function sureMeasure(){	 var gform=Ext.getCmp("gform");   //gform.items.each(eachItem, this);  	var TxtCaseMeasure=Ext.getCmp('TxtCaseMeasure');	var frm=Ext.getCmp('CaseForm');	var aa=document.getElementById("southTab");	var CareCon=Ext.get("southTab").dom.contentWindow.document.getElementById("DesignForm");	//alert(CareCon.QichTextCon.GetCellText());	var win=Ext.get("southTab").dom.contentWindow;   // var parr="DHCNURBG_JZQJD1^"+EpisodeID+"^CaseMeasureXml";	var ret=southTab.Save();		var grid1=Ext.getCmp('mygrid');	CaseMeasureID=ret; 	var rwIndex=grid1.getSelectionModel().last;	MeasureRel.add(rwIndex,CaseMeasureID);	//debugger;	grid.getSelectionModel().getSelections()[0].set("CaseMeasure",CareCon.QichTextCon.GetCellText());	frm.close();}function gridcheckclick(){	 var grid=Ext.getCmp("CheckGrid");  	var rowObj = grid.getSelectionModel().getSelections();	var len = rowObj.length;	var GetRadiaNote=document.getElementById('GetRadiaNote');	if(len < 1)	{		//Ext.Msg.show({title:'注意',msg:'请选择需要修改的数据!',buttons: Ext.Msg.OK,icon:Ext.MessageBox.WARNING});		return;	}	else	{		var rowid = rowObj[0].get("ORW");		var a=cspRunServerMethod(GetRadiaNote.value,rowid);        var LCResult=Ext.getCmp('LCResult');		a=a.replace("_$c(13,10)_",String.fromCharCode(13)+String.fromCharCode(10));		var aa=a.split("_$c_");		var txt="";		for (i=0;i<aa.length;i++)		{			if (aa[i]=="")  continue;			txt=txt+aa[i];//+String.fromCharCode(13)+String.fromCharCode(10);		}		LCResult.setValue(txt);		//EpisodeID=rowObj[0].get("EpisodeId");		/*for (i = 0; i < top.frames.length; i++) {			alert(top.frames[i].name);		}		var frm = top.frames[0].document.forms["fEPRMENU"];	    frm.EpisodeID.value=EpisodeID;        ModConsult();*/	}}function gridLabclick(){	 var grid=Ext.getCmp("LabGrid");  	var rowObj = grid.getSelectionModel().getSelections();	var len = rowObj.length;	var GetLabItemdata=document.getElementById('GetLabItemdata');	if(len < 1)	{		//Ext.Msg.show({title:'注意',msg:'请选择需要修改的数据!',buttons: Ext.Msg.OK,icon:Ext.MessageBox.WARNING});		return;	}	else	{		var labno = rowObj[0].get("LabEpisodeNo");		var tesc=rowObj[0].get("testcode");		var ARCIMDes=rowObj[0].get("ARCIMDes");		var a=cspRunServerMethod(GetLabItemdata.value,labno,tesc);		if (a=="-1") return;		var LCResult=Ext.getCmp('LCResult');		//a=a.replace("&",String.fromCharCode(13)+String.fromCharCode(10));		var aa=a.split("$");		var aresult=aa[1].split('&');		var txt="";		for (i=0;i<aresult.length;i++)		{			if (aresult[i]=="")  continue;			var labar=aresult[i].split("^");			txt=txt+labar+String.fromCharCode(13)+String.fromCharCode(10);		}		LCResult.setValue("        "+ARCIMDes+String.fromCharCode(13)+String.fromCharCode(10)+txt);		//EpisodeID=rowObj[0].get("EpisodeId");		/*for (i = 0; i < top.frames.length; i++) {			//alert(top.frames[i].name);		}		var frm = top.frames[0].document.forms["fEPRMENU"];	    frm.EpisodeID.value=EpisodeID;        ModConsult();*/	}}function InOutNod(){ //小结    	var SaveOutIn=document.getElementById('SaveOutIn');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先点'统计'按钮!"); return; }	else	{	  var countstr=""; //合计项	  var countcls=ICountCls+"&"+OCountCls;	  var tt=countcls.split('&');	  for (i=0;i<tt.length;i++)	  {	  	if (tt[i]=="") continue;		countstr=countstr+tt[i]+"|"+objRow[0].get(tt[i])+"^";	  }	  var CareDate=objRow[0].get("CareDate");	  var CareTime=objRow[0].get("CareTime");	  var inamount=objRow[0].get(DisplaySumInAmount);	  var OutQtAmount=objRow[0].get(DisplaySumOutAmount);	  var InPart=objRow[0].get(PartInAmount);	  var OutPart=objRow[0].get(PartOutAmount);	  //var StatTime=objRow[0].get("Item1");	  //var StatHours=objRow[0].get("Item2");	  var CaseMeasure=objRow[0].get("CaseMeasure");	  var CaseMeasureArr=CaseMeasure.split(" ");	  if (CaseMeasureArr.length>1)	  {	  	var StatTime=CaseMeasureArr[0];	  	var StatHours=CaseMeasureArr[1];	  }	  else	  {	  	var StatTime="";	  	var StatHours="";	  }		var str=countstr+"^SumInAmount|"+inamount+"^SumOutAmount|"+OutQtAmount+"^CareDate|"+CareDate+"^CareTime|"+CareTime+"^Typ|Nod^"+"InPart|"+InPart+"^OutPart|"+OutPart+"^StatTime|"+StatTime+"^StatHours|"+StatHours;		var diaggrid = Ext.getCmp('diaggrid');		if (diaggrid) {  		var selModel=diaggrid.getSelectionModel();  		if (selModel.hasSelection()) {     			var objDiagRow = selModel.getSelections();		  							DiagnosDr=objDiagRow[0].get("rw");			}			else {				DiagnosDr="";				}		}		else {			DiagnosDr="";		}		str=str+"^DiagnosDr|"+DiagnosDr;		//alert(str);		var a=cspRunServerMethod(SaveOutIn.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURBG_JZQJD1");		find();	}}function InOutSum(){	var SaveOutIn=document.getElementById('SaveOutIn');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先点'统计'按钮!"); return; }	else	{	  var countstr=""; //合计项	  var countcls=ICountCls+"&"+OCountCls;	  var tt=countcls.split('&');	  for (i=0;i<tt.length;i++)	  {	  	if (tt[i]=="") continue;		countstr=countstr+tt[i]+"|"+objRow[0].get(tt[i])+"^";	  }      var CareDate=objRow[0].get("CareDate"); 	  var CareTime=objRow[0].get("CareTime");	  var inamount=objRow[0].get(DisplaySumInAmount);	  var OutQtAmount=objRow[0].get(DisplaySumOutAmount);	  var InPart=objRow[0].get(PartInAmount);	  var OutPart=objRow[0].get(PartOutAmount);		//var StatTime=objRow[0].get("Item1");	  //var StatHours=objRow[0].get("Item2");	  var CaseMeasure=objRow[0].get("CaseMeasure");	  var CaseMeasureArr=CaseMeasure.split(" ");	  if (CaseMeasureArr.length>1)	  {	  	var StatTime=CaseMeasureArr[0];	  	var StatHours=CaseMeasureArr[1];	  }	  else	  {	  	var StatTime="";	  	var StatHours="";	  }		var str=countstr+"^SumInAmount|"+inamount+"^SumOutAmount|"+OutQtAmount+"^CareDate|"+CareDate+"^CareTime|"+CareTime+"^Typ|Sum^"+"InPart|"+InPart+"^OutPart|"+OutPart+"^StatTime|"+StatTime+"^StatHours|"+StatHours;		//alert(str);		var diaggrid = Ext.getCmp('diaggrid');		if (diaggrid) {  		var selModel=diaggrid.getSelectionModel();  		if (selModel.hasSelection()) {     			var objDiagRow = selModel.getSelections();		  							DiagnosDr=objDiagRow[0].get("rw");			}			else {				DiagnosDr="";				}		}		else {			DiagnosDr="";		}		str=str+"^DiagnosDr|"+DiagnosDr;		//alert(str);		var a=cspRunServerMethod(SaveOutIn.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURBG_JZQJD1");		find(); }}function UpdateRelDiagnos(){	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCNurRelDiagnos", EpisodeID, "");	arr = eval(a);	var window = new Ext.Window({		title: '关联诊断记录',		width: 615,		height: 235,		autoScroll: true,		layout: 'absolute',		plain: true,		frame:true,		//modal: true,		//bodyStyle: 'padding:5px;',		///buttonAlign: 'center',		items: arr	});	var butin=Ext.getCmp('diaggridbut1');	butin.text="确定";	butin.on('click',UpdateDiagnos);	var but2=Ext.getCmp('diaggridbut2');	but2.text="插入小结";	but2.on('click',UpdateDiagnos1);	var diaggrid = Ext.getCmp('diaggrid');	var diagtobar=diaggrid.getTopToolbar();	diagtobar.addButton({		className: 'new-topic-button',		text: "插入24小时",		handler:UpdateDiagnos2,		id:'diaggridbut3'  	});	//debugger;	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length > 0) {		var inname = objRow[0].get(DisplaySumInName);		var outname = objRow[0].get(DisplaySumOutName);		if ((inname)&&(outname)&&((inname.indexOf("入液量") != -1) || (outname.indexOf("出液量") != -1))) {			butin.hide();		}		else {			but2.hide();			var but3 = Ext.getCmp('diaggridbut3');			but3.hide();		}	}	SchDiag();	window.show();}function UpdateDiagnos(){	var diaggrid=Ext.getCmp("diaggrid");	var objDiagnosRow=diaggrid.getSelectionModel().getSelections();	if (objDiagnosRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条诊断记录!"); return; }	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条护理记录!"); return; }	else	{		saveGrid(true);	}}function UpdateDiagnos1(){	var diaggrid=Ext.getCmp("diaggrid");	var objDiagnosRow=diaggrid.getSelectionModel().getSelections();	if (objDiagnosRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条诊断记录!"); return; }	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条统计记录!"); return; }	else	{		InOutNod();	}}function UpdateDiagnos2(){	var diaggrid=Ext.getCmp("diaggrid");	var objDiagnosRow=diaggrid.getSelectionModel().getSelections();	if (objDiagnosRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条诊断记录!"); return; }	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条统计记录!"); return; }	else	{		InOutSum();	}}function SchDiag(){	condata=new Array();	var adm=EpisodeID;	var GetQueryData=document.getElementById('GetQueryData1');	var diaggrid=Ext.getCmp("diaggrid");	//alert(adm); 	var a=cspRunServerMethod(GetQueryData.value,"web.DHCNurseRecordComm:GetCopyDiagnos","parr$"+adm,"AddDiag");  	diaggrid.store.loadData(condata);   }function AddDiag(a1,a2,a3,a4,a5){	condata.push({		DiagNos:a1,		RecUser:a2,		RecDate:a3,		RecTime:a4,		rw:a5	});} function DBC2SBC(str)   {	var result = '';	if ((str)&&(str.length)) {		for (i = 0; i < str.length; i++) {			code = str.charCodeAt(i);			if (code >= 65281 && code <= 65373) {				result += String.fromCharCode(str.charCodeAt(i) - 65248);			}			else {				if (code == 12288) {					result += String.fromCharCode(str.charCodeAt(i) - 12288 + 32);				}				else {					result += str.charAt(i);				}			}		}	}	else{		result=str;	}  	return result;   }function SureIn() {	var grid = Ext.getCmp('ordgrid');	var mygrid=Ext.getCmp('mygrid');	var store = grid.store;	var rowCount = store.getCount(); //记录数	/*var cm = grid.getColumnModel();	var colCount = cm.getColumnCount(); //列数	var view = grid.getView();*/	var num=0;    var selModel = grid.getSelectionModel();       if (selModel.hasSelection()) {          	// Ext.Msg.confirm("警告", "确定要删除吗？", function(button) {   				var selections = selModel.getSelections();				//var rowIndex = grid.store.indexOf(grid.getSelectionModel().getSelected());				//grid.getSelectionModel().selectRow(rowIndex);				//debugger;				var caredate,caretime;				Ext.each(selections, function(item) {					var des=item.data.ARCIMDesc;					des=des.replace("_____","");					var ml=item.data.Dose;					var unit=item.data.DoseUnit;					if ((unit!="ml")&&(unit!="ML")) ml=0;					var seqno=item.data.SeqNo;					var rowIndex = grid.store.indexOf(item);					for (var i = rowIndex-1; i >=0; i--) {						var subdes=store.getAt(i).data.ARCIMDesc;						subdes=subdes.replace("_____","");						var subml=store.getAt(i).data.Dose;						var subunit=store.getAt(i).data.DoseUnit;						if (subunit!="ml") subml=0;						var subseqno=store.getAt(i).data.SeqNo;						if (subseqno==seqno)						{							des=subdes+","+des;							ml=eval(ml)+eval(subml);						}						else						{							break;							}					}					for (var i = rowIndex+1; i < store.getCount(); i++) {												var subdes=store.getAt(i).data.ARCIMDesc;						//alert(subdes);						subdes=subdes.replace("_____","");						var subml=store.getAt(i).data.Dose;						var subunit=store.getAt(i).data.DoseUnit;						if ((subunit!="ml")&&(subunit!="ML")) subml=0;						var subseqno=store.getAt(i).data.SeqNo;						if (subseqno==seqno)						{							des=des+","+subdes;							ml=eval(ml)+eval(subml);						}						else						{							break;							}					}					if (num == 0) {						caredate=mygrid.getStore().getAt(0).get("CareDate");						caretime=mygrid.getStore().getAt(0).get("CareTime");						var objRow=mygrid.getSelectionModel().getSelections();						if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择某行!"); return; }						else						{								objRow[0].set(OrdInName, des);								objRow[0].set(OrdInAmount, ml);						}					}else{						additm();						mygrid.getSelectionModel().selectRow(mygrid.store.getCount()-1);   						mygrid.getSelectionModel().getSelections()[0].set("CareDate", caredate);						mygrid.getSelectionModel().getSelections()[0].set("CareTime", caretime);						mygrid.getSelectionModel().getSelections()[0].set(OrdInName, des);						mygrid.getSelectionModel().getSelections()[0].set(OrdInAmount, ml);					}					num++;				});        } }function saveGrid(autoFlag){	var store = grid.store;    var rowCount = store.getCount(); //记录数    if(grid.activeEditor != null){	 		       grid.activeEditor.completeEdit();  	}	var cm = grid.getColumnModel();	var colCount = cm.getColumnCount();	var list = [];	var rowObj = grid.getSelectionModel().getSelections();	var len = rowObj.length;	// for (var r = 0;r < len; r++) {		// list.push(rowObj[r].data);	// }	for (var i = 0; i < store.getCount(); i++) {		    list.push(store.getAt(i).data);	    }		var grid1=Ext.getCmp('mygrid');	var rwIndex=grid1.getSelectionModel().last;	var CaseMeasureID="CaseMeasureID|";		var RecSave=document.getElementById('RecSave');	for (var i = 0; i < list.length; i++) {	  var obj=list[i];	  var str="";	  var CareDate="";	  var CareTime="";	  var flag="0";		for (var p in obj) {			var aa = formatDate(obj[p]);							if (p=="CareDate") CareDate=aa;			if (p=='CareTime') CareTime=obj[p];			if (p=="") continue;			if ((p == DisplaySumInName) && (obj[p].indexOf("入液量") != -1)) {				flag = "1";			}			if ((p==DisplaySumOutName)&&(obj[p].indexOf("出液量")!= -1))			{				flag="1";			} 			if (aa == "") 			{					str = str + p + "|" + DBC2SBC(obj[p]) + '^';			}else			{			  	str = str + p + "|" + aa + '^';				}		}		if ((str!="")&&(flag=="0"))		{			if (str.indexOf("CareDate")==-1)			{				str=str+"CareDate|"+CareDate+"^CareTime|"+CareTime;				//debugger;			}			var diaggrid = Ext.getCmp('diaggrid');			if (diaggrid) {	  		var selModel=diaggrid.getSelectionModel();	  		if (selModel.hasSelection()) {   	  			var objDiagRow = selModel.getSelections();		  								DiagnosDr=objDiagRow[0].get("rw");				}				else {					DiagnosDr="";					}			}			else {				DiagnosDr="";			}			str=str+"^"+"DiagnosDr|"+DiagnosDr;			str=str+"^"+CaseMeasureID;			var a=cspRunServerMethod(RecSave.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURBG_JZQJD1",session['LOGON.GROUPDESC']);			if (a!="0")			{				//alert(a);				return;			}		}	}	find();	Save(autoFlag);  }  function addtitCon(tobar,lab){	var but1=Ext.getCmp(lab+"but1");	but1.hide();	var but2=Ext.getCmp(lab+"but2");	but2.hide();		tobar.addItem(	    {			xtype:'datefield',			format: 'Y-m-d',			id:lab+'stdate',			value:(diffDate(new Date(),-1))		},	    {			xtype:'datefield',			format: 'Y-m-d',			id:lab+'enddate',			value:new Date()		}	);	tobar.addButton(	  {		className: 'new-topic-button',		text: "查询",		//handler:find,		id:lab+'Sch'	  }	);}function find(){	//var link="dhcnurtempature.csp?EpisodeID="+EpisodeID;   /// window.open (link,'体温单','height=1,width=1,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no')    // window.close();  // alert(parent.frames.length);    MeasureRel = new Hashtable();    REC = new Array();	var adm = EpisodeID;	var StDate = Ext.getCmp("mygridstdate");	var StTime = Ext.getCmp("mygridsttime");	var Enddate = Ext.getCmp("mygridenddate");	var EndTime = Ext.getCmp("mygridendtime");	var GetQueryData = document.getElementById('GetQueryData');	var mygrid = Ext.getCmp("mygrid");	var IfCancelRec=Ext.getCmp("IfCancelRec").getValue();	var parr = adm + "^" + StDate.value + "^" + StTime.value + "^" + Enddate.value + "^" + EndTime.value + "^"+"DHCNURBG_JZQJD1" + "^" + IfCancelRec;	// debugger;	//alert(parr)	//var a = cspRunServerMethod(GetQueryData.value, "web.DHCNurRecComm:GetCareRecComm", "parr$" + parr, "AddRec");	//mygrid.store.loadData(REC);	var mygrid = Ext.getCmp("mygrid");    mygrid.store.on("beforeLoad",function(){          mygrid.store.baseParams.parr=parr;    //传参数，根据原来的方式修改    });        mygrid.getStore().addListener('load',handleGridLoadEvent); //护理记录表格需要：日期转换及出入量统计行加颜色    mygrid.store.load({    	params:{    		start:0,    		limit:30    	}	   })}function handleGridLoadEvent(store,records)  {	var grid=Ext.getCmp('mygrid');	var gridcount=0;      var StDate = Ext.getCmp("mygridstdate");	var StTime = Ext.getCmp("mygridsttime");	var Enddate = Ext.getCmp("mygridenddate");	var EndTime = Ext.getCmp("mygridendtime");	var mygrid = Ext.getCmp("mygrid");	var params=EpisodeID+"&"+prncode+"&"+ StDate.value + "&" + StTime.value.replace(":","*") + "&" + Enddate.value + "&" + EndTime.value.replace(":","*")	printinfo=tkMakeServerCall("Nur.DHCNurRecPrint","getprintinfo",params)    printarr=printinfo.split('&')    //alert(printarr)    printinfoST=tkMakeServerCall("Nur.DHCNurRecPrintStPos","getval",EpisodeID+"&"+prncode+"&")    printarrST=printinfoST.split('^')    // alert(printarrST)	  store.each(function(r){	                             var rowid=r.get("par")+"||"+r.get("rw")               if(r.get('CareDate')!="") //日期格式转换			 {			   var date=getDate(r.get('CareDate'));			   grid.store.getAt(gridcount).set("CareDate",date);					    }					store.commitChanges()	                 if (printinfoST!="")                 {                        //alert(printinfoST[0])                     //alert(rowid)                     if (rowid!=printarrST[0])                       {                                                  if (printarr[0].indexOf(rowid)>-1) //该条记录已打印                      {                                             grid.getView().getRow(gridcount).style.backgroundColor=printcolor;                                            }                      if (printarr[1].indexOf(rowid)>-1) //该条记录未打印                      {                         grid.getView().getRow(gridcount).style.backgroundColor=noprintcolor;                      }                      if (printarr[2].indexOf(rowid)>-1) //该条记录有修改                      {                         grid.getView().getRow(gridcount).style.backgroundColor=havechangecolor;                      }                       }                    else  //打印记录索引行                    {                                //alert(printarrST[3])                                                var pinfo=tkMakeServerCall("Nur.DHCNurRecPrint","getval",r.get("par")+"&"+r.get("rw")  )                         var pprr=pinfo.split('^')                        // alert(pprr)                                       if (printarrST[3]=="0")                      {                                                 grid.getView().getRow(gridcount).style.backgroundColor=Startcolor;                      }                        else if (pprr[4]=="2") //该条有修改                      {                                               grid.getView().getRow(gridcount).style.backgroundColor=havechangecolor;                       }                      else                      {                        grid.getView().getRow(gridcount).style.backgroundColor=printcolor;                       }                    }                                 }                                       gridcount=gridcount+1;                            }); 	}function findStat(){  //查询出入液量合计    var adm=EpisodeID;	var StDate= Ext.getCmp("mygridstdate");	var StTime= Ext.getCmp("mygridsttime");	var Enddate= Ext.getCmp("mygridenddate");	var EndTime= Ext.getCmp("mygridendtime");	var GeInOutAmount=document.getElementById('GeInOutAmount');	var mygrid=Ext.getCmp("mygrid");	 	var a=cspRunServerMethod(GeInOutAmount.value,adm,StDate.value,StTime.value,Enddate.value,EndTime.value,"DHCNURBG_JZQJD1");	if (a=="") { Ext.Msg.alert('提示', "无护理记录数据!"); return; }	//additm();	additmstat(Enddate.value,EndTime.value);	var tt=a.split('^');		mygrid.getSelectionModel().selectRow(mygrid.store.getCount()-1);   	for (i=0;i<tt.length;i++)	{		itm=tt[i].split('|');		mygrid.getSelectionModel().getSelections()[0].set(itm[0],itm[1]); 	}	//alert(tt);}function findStatNL(){  //查询出入液量合计    var adm=EpisodeID;	var StDate= Ext.getCmp("mygridstdate");	var StTime= Ext.getCmp("mygridsttime");	var Enddate= Ext.getCmp("mygridenddate");	var EndTime= Ext.getCmp("mygridendtime");	//var GeInOutAmount=document.getElementById('GeInOutAmount');	var mygrid=Ext.getCmp("mygrid");  //alert(adm+"|"+StDate.value+"|"+StTime.value+"|"+Enddate.value+"|"+EndTime.value+"|"+"DHCNURBG_JZQJD1") 	var a=cspRunServerMethod(GeInOutAmountNL.value,adm,StDate.value,StTime.value,Enddate.value,EndTime.value,"DHCNURBG_JZQJD1"); 	//alert(a)	if (a=="") { Ext.Msg.alert('提示', "无护理记录数据!"); return; }	//additm();	additmstat(Enddate.value,EndTime.value);	var tt=a.split('^');	//alert(tt);	mygrid.getSelectionModel().selectRow(mygrid.store.getCount()-1); 	//mygrid.getSelectionModel().selectRow(0);   	for (i=0;i<tt.length;i++)	{		itm=tt[i].split('|');		mygrid.getSelectionModel().getSelections()[0].set(itm[0],itm[1]); 	}	//alert(tt);}function additmstat(statenddate,statendtime){  	var Plant = Ext.data.Record.create([	{name:'CareDate'}, 	{name:'CareTime'},	{name:'Item1'},	{name:'Item2'},	{name:'Item3'},	{name:'Item4'},	{name:'Item5'},	{name:'Item6'},	{name:'Item7'},	{name:'Item8'},	{name:'Item9'}, 	{name:'Item10'},	{name:'Item11'},	{name:'Item12'},	{name:'Item13'},	{name:'Item14'},	{name:'Item15'},	{name:'Item16'},	{name:'Item17'}, 	{name:'Item18'},	{name:'Item19'}, 	{name:'Item20'},	{name:'Item21'},	{name:'Item22'},	{name:'Item23'},	{name:'Item24'},	{name:'Item25'},	{name:'Item26'},	{name:'Item27'},	{name:'Item28'},	{name:'Item29'},	{name:'Item30'},	{name:'Item31'},	{name:'Item32'},	{name:'Item33'},	{name:'Item34'},	{name:'Item35'},	{name:'Item36'},	{name:'Item37'},	{name:'Item38'},	{name:'Item39'},	{name:'Item40'},	{name:'Item41'},	{name:'Item42'},	{name:'Item43'},	{name:'Item44'},	{name:'Item45'},	{name:'Item46'},	{name:'Item47'}, 	{name:'Item48'},	{name:'Item49'},	{name:'Item50'},	{name:'CaseMeasure'},	{name:'User'},	{name:'rw'},	{name:'par'}      ]);    var count = grid.store.getCount();     var r = new Plant({CareDate:statenddate,CareTime:statendtime});     grid.store.commitChanges();     grid.store.insert(count,r);    return;}function setVal2(itm,val){	    if (val=="") return ;	   	var tt=val.split('!');		//alert(tt);	 	var cm=Ext.getCmp(itm);		person=new Array();		addperson(tt[1],tt[0]);		cm.store.loadData(person);		cm.setValue(tt[0]);		 } function setVal3(itm,val){	    if (val=="") return ;	   	var tt=val.split('!');		//alert(tt);	 	var cm=Ext.getCmp(itm);		opertion=new Array();		addopertion(tt[1],tt[0]);		cm.store.loadData(opertion);		cm.setValue(tt[0]);		 } function cmbkey(field, e){	if (e.getKey() ==Ext.EventObject.ENTER)	{		var pp=field.lastQuery;		getlistdata(pp,field);	//	alert(ret);			}}var person=new Array();function getlistdata(p,cmb){	var GetPerson =document.getElementById('GetPerson');	//debugger;    var ret=cspRunServerMethod(GetPerson.value,p);	if (ret!="")	{		var aa=ret.split('^');		for (i=0;i<aa.length;i++)		{			if (aa[i]=="" ) continue;			var it=aa[i].split('|');			addperson(it[1],it[0]);		}		//debugger;		cmb.store.loadData(person);	}}function addperson(a,b){	person.push(	{		desc:a,		id:b	}	);}function cmbkey1(field, e){	if (e.getKey() ==Ext.EventObject.ENTER)	{		var pp=field.lastQuery;		getoperlistdata(pp,field);	//	alert(ret);			}}var opertion=new Array();function getoperlistdata(p,cmb){	var GetPerson =document.getElementById('GetOper');	//debugger;    var ret=cspRunServerMethod(GetOper.value,p);	if (ret!="")	{		var aa=ret.split('^');		for (i=0;i<aa.length;i++)		{			if (aa[i]=="" ) continue;			var it=aa[i].split('|');			addopertion(it[1],it[0]);		}		//debugger;		cmb.store.loadData(opertion);	}}function addopertion(a,b){	opertion.push(	{		desc:a,		id:b	}	);}function btclose(){	window.close();}function cmbkey(field, e){	if (e.getKey() ==Ext.EventObject.ENTER)	{		var pp=field.lastQuery;		getlistdata(pp,field);	//	alert(ret);			}}var person=new Array();function getlistdata(p,cmb){	var GetPerson =document.getElementById('GetPerson');	//debugger;    var ret=cspRunServerMethod(GetPerson.value,p);	if (ret!="")	{		var aa=ret.split('^');		for (i=0;i<aa.length;i++)		{			if (aa[i]=="" ) continue;			var it=aa[i].split('|');			addperson(it[1],it[0]);		}		//debugger;		cmb.store.loadData(person);	}}function addperson(a,b){	person.push(	{		desc:a,		id:b	}	);}var REC=new Array();function AddRec(str){	//var a=new Object(eval(str));	//var obj = eval('(' + str + ')');	//arrgrid.push(obj);	//debugger; 	//alert(str);		//var a=new Object(eval(str));	var obj = eval('(' + str + ')');	obj.CareDate=getDate(obj.CareDate);	//obj.PregHPregDate=getDate(obj.PregHPregDate);	REC.push(obj);	//debugger;	}function setvalue(){	//alert(ExamId);   var ha = new Hashtable();   var getid=document.getElementById('GetId');   //alert(getid)   var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID);   //alert(id);   //alert(EmrCode)   //alert(EpisodeID)   //alert(11)   if (id != "") {   	var getVal = document.getElementById('getVal');   	var ret = cspRunServerMethod(getVal.value, id);   	//alert(ret)   	var tm = ret.split('^')    //alert(tm);		sethashvalue(ha, tm);			}			else {				getPatInfo();				return;				//var PatInfo = document.getElementById('PatInfo');				//if (PatInfo) {				//alert(12);					//var ret = cspRunServerMethod(PatInfo.value, EpisodeID, EmrCode);					//var tm = ret.split('^')					//sethashvalue(ha, tm)				}				// debugger;    	      	 var gform=Ext.getCmp("gform");     gform.items.each(eachItem, this);  	 //  alert(a);	for (var i=0 ; i<ht.keys().length;i++)//for...in statement get all of Array's index	{		var key = ht.keys()[i];		//restr += ht.items(key) + " " + ht.parent[key] + "<br/>";		if (key.indexOf("_") == -1) 		{			//alert(key);			var flag=ifflag(key );			if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items(key));				//debugger;				continue;			}   		var flag1=ifflag1(key );		 if (flag1==true)			{				if (ha.contains(key)) setVal3(key ,ha.items(key));				//debugger;				continue;			} 			var itm = Ext.getCmp(key);			if (ha.contains(key)) 			itm.setValue(getval(ha.items(key)));					Ext.getCmp("Item47").store.load({params:{start:0,limit:2000},callback:function(){		 		if(ha.items("Item47")!=""){		 			if(Ext.getCmp("Item47")){		 				Ext.getCmp("Item47").typeAhead=false;		 				Ext.getCmp("Item47").setValue(ha.items("Item47"));		 			}		 		}		 	}})			Ext.getCmp("Item48").store.load({params:{start:0,limit:2000},callback:function(){		 		if(ha.items("Item48")!=""){		 			if(Ext.getCmp("Item48")){		 				Ext.getCmp("Item48").typeAhead=false;		 				Ext.getCmp("Item48").setValue(ha.items("Item48"));		 			}		 		}		 	}})	    }else{			var aa=key.split('_');			if(ha.contains(aa[0]))			{			  setcheckvalue(key,ha.items(aa[0]));			} 		}    } }function getval(itm){	var tm=itm.split('!');	//alert(tm)	return tm[0];}function ifflag(itm){	var tm=ITypItm.split('|');	var flag=false;	for (var i=0;i<tm.length;i++)	{		if (itm==tm[i])		{			flag=true;		}	}	return flag ;} function ifflag1(itm){	var tm=ITypItm1.split('|');	var flag=false;	for (var i=0;i<tm.length;i++)	{		if (itm==tm[i])		{			flag=true;		}	}	return flag ;}function Save(autoFlag){    ret="";    checkret="";    comboret="";	var gform=Ext.getCmp("gform");	gform.items.each(eachItem1, this);  	var getid=document.getElementById("GetId");	var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID);	var SaveRec=document.getElementById('Save');	if (id==""){		var Id=cspRunServerMethod(SaveRec.value,"^EmrUser|"+session['LOGON.USERID']+"^EmrCode|"+EmrCode+"^"+ret+"^DetLocDr|"+session['LOGON.CTLOCID']+"^EpisodeId|"+EpisodeID+"&"+checkret+"&"+comboret,"");    }	else	{		var Id=cspRunServerMethod(SaveRec.value,"^EmrUser|"+session['LOGON.USERID']+"^EmrCode|"+EmrCode+"^"+ret+"^DetLocDr|"+session['LOGON.CTLOCID']+"^EpisodeId|"+EpisodeID+"&"+checkret+"&"+comboret,id);	}	if(!autoFlag) alert("已保存"); }function getPatInfo(){	var PatInfo=document.getElementById('PatInfo');	if (PatInfo) 	{		//alert(EpisodeID)		var ret=cspRunServerMethod(PatInfo.value,EpisodeID);		//alert(ret)	 	var tt=ret.split('^');	 	var DIAG = Ext.getCmp("Item58");	    DIAG.setValue(getValueByCode(tt[8]));	 	//var patallergy =Ext.getCmp("Item43")	 	//patallergy.setValue(getValueByCode(tt[47]));    	 	/*var patName = Ext.getCmp("Item20");	 	patName.setValue(getValueByCode(tt[4]));	 //	var sex = Ext.getCmp("Item127");	 	//sex.setValue(getValueByCode(tt[10]));	 	//var age = Ext.getCmp("Item127");	 	//age.setValue(getValueByCode(tt[13]));	 	var patLoc = Ext.getCmp("Item21");	 	patLoc.setValue(getValueByCode(tt[2]));    var bedcode = Ext.getCmp("Item22");	 	bedcode.setValue(getValueByCode(tt[5]));	  var MedCareNo = Ext.getCmp("Item23");		MedCareNo.setValue(getValueByCode(tt[9]));*/		SelectTodayTime();	}}function SelectTodayTime(){ 	var d = new Date(); 	var today = d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate(); 	var year = Ext.getCmp("Item62"); 	//year =d.getYear(); 	year.setValue(d.getFullYear());	 	var month = Ext.getCmp("Item63"); 	//month =d.getMonth()+1;	 	month.setValue(d.getMonth()+1); 	var date = Ext.getCmp("Item64"); 	//date =d.getDate(); 	date.setValue(d.getDate()); 	//alert(today);}function getValueByCode(tempStr){	var retStr=tempStr;	var strArr = tempStr.split("|");	if (strArr.length>1) 	{		retStr=strArr[1];	}	return retStr;}function printNurRecold(){   	var GetPrnSet = document.getElementById('GetPrnSet');	var GetHead = document.getElementById('GetPatInfo');	var ret = cspRunServerMethod(GetHead.value, EpisodeID);	var hh = ret.split("^");	var getid = document.getElementById('GetId');	var id = cspRunServerMethod(getid.value, EmrCode, EpisodeID);  //139	var a = cspRunServerMethod(GetPrnSet.value, "DHCNURBG_JZQJD1", EpisodeID); //page, caredattim, prnpos, adm,Typ,user	if (a == "") return;	var GetLableRec = document.getElementById('GetLableRec');	var LabHead = cspRunServerMethod(GetLableRec.value, "DHCNURBG_JZQJD1^" + session['LOGON.CTLOCID']);	var tm = a.split("^");	var stdate = "" //tm[2];	var stim = "" //tm[3];	var edate = "" //tm[4];	var etim = "" //tm[5];		//PrintComm.RHeadCaption=hh[1];		//PrintComm.LHeadCaption=hh[0];		//PrintComm.RFootCaption="第";		//PrintComm.LFootCaption="页";		//PrintComm.LFootCaption=hh[2];	PrintCommPic.dxflag = 1;  //1：一条记录打印一条横线；0：一条记录的每一行文字下面都打印一条横线	PrintCommPic.TitleStr = ret;	PrintCommPic.SetPreView("1");	//PrintCommPic.PrnLoc = session['LOGON.CTLOCID'];	var aa = tm[1].split("&");	//PrintCommPic.stPage=aa[0];	//if (aa.length>1) PrintCommPic.stRow=aa[1];	PrintCommPic.stPage = 0;	PrintCommPic.stRow = 0;	PrintCommPic.previewPrint = "1"; //是否弹出设置界面	//PrintCommPic.stprintpos=tm[0];	PrintCommPic.stprintpos = 0;	//alert(PrintCommPic.Pages);	PrintCommPic.SetConnectStr(CacheDB);	PrintCommPic.WebUrl = WebIp + "/imedical/web/DWR.DoctorRound.cls";		PrintCommPic.ItmName = "DHCNURMouldPrn_ZYYJZQJD"; //338155!2010-07-13!0:00!!	//debugger;	//var parr="DHCNURBG_CCSJMDZGCJLD^"+EpisodeID;	var parr = EpisodeID + "!" + "" + "!" + "" + "!" + "" + "!" + "" + "!DHCNURBG_JZQJD1!";	//alert(parr)	PrintCommPic.ID = "";	PrintCommPic.MultID = "";	//alert(id)	var mth1 = "Nur.DHCMoudData:getPGDVal&parr:" + id + "!";	//var mth1 = "Nur.DHCMoudData:getVal&id:" + id + "!";	PrintCommPic.MthArr = mth1;	//PrintCommPic.MthArr="web.DHCConsult:getConsultInfo&id:"+myid;	if (LabHead != "") PrintCommPic.LabHead = LabHead;	PrintCommPic.SetParrm(parr); // ="EpisodeId" ; //"p1:0^p2:"	PrintCommPic.PrintOut();	var SavePrnSet = document.getElementById('SavePrnSet');	//debugger;	var CareDateTim = PrintCommPic.CareDateTim;	if (CareDateTim == "") return;	var pages = PrintCommPic.pages;	var stRow = PrintCommPic.stRow;	//debugger;	var stprintpos = PrintCommPic.stPrintPos;	//PrnFlag==1说明是打印预览	if (PrintCommPic.PrnFlag == 1) return;	//如果原记录保存打印到第8页则当打印第8页之前页时不保存打印记录	if (pages < aa[0]) return;}function printNurRec(){	    		var zkflag=0; 			if (zkflag=="1") //转科		{		   var PrnLoc=patloc ;  //转科打印时设置床号 如果没更新转科这句屏蔽		}		else		{		  var PrnLoc=session['LOGON.CTLOCID']; 		}		var GetLableRec=document.getElementById('GetLableRec');		var LabHead=cspRunServerMethod(GetLableRec.value,EmrCode+"^"+session['LOGON.CTLOCID']+"^"+EpisodeID+"^"+session['LOGON.USERID']);		LabHead=LabHead.replace(/&/g,"$");		//alert(LabHead)		var stdate=""		var stim="" 		var edate="" 		var etim=""				var GetPGDId=tkMakeServerCall("Nur.DHCMoudData","GetId",EmrCode,EpisodeID);		if(NurRecId!=="") GetPGDId=NurRecId;		var mth1="Nur.DHCMoudData:getPGDVal$parr:"+GetPGDId+"!";						var prncode="DHCNURMouldPrn_ZYYJZQJD";		var WebUrl=WebIp+"/imedical/web/DWR.DoctorRound.cls";		//是否启用转科开关，默认不启用：1 启用；0 不启用				tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","tranflag",EmrCode,zkflag);		//续打开关，默认不许打-- 0：不续打；1:启用续打功能		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","xuflag",EmrCode,"0");		//打印起始页的页码		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","curPages",EmrCode,0);		//转科打印时是否换页立即换页，默认换页 ---1 换页  0 不换页		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","SplitPage",EmrCode,"0");		//打印内容线条类型，默认是一条记录打印一直线：1 一条记录一条线；0 一行文字打印一条线 		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","dxflag",EmrCode,"1");		//预览打印 设置起始页和打印机 0 不弹出 1 弹出		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","previewPrint",EmrCode,"1");		//外框打印，Y--打印所有，其他--按内容行高打印		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","AllLine",EmrCode,"Y");		//是否生成打印记录		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","Makeprintinfo",EmrCode,"N");		//是否生成奇偶打印记录		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","MakeInfo",EmrCode,"N");		//是否预览		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","PreView",EmrCode,"1");				//是否生成图片 Y 生成，N 不生成		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","MakeTemp",EmrCode,"N");		//是否生成图片 Y 生成，N 不生成		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","MakePic",EmrCode,"N");		//是否开始生成图片		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","StartMakePic",EmrCode,"N");		//生成的图片是否上传ftp		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","IfUpload",EmrCode,"N");		//是否生成所有页 ，默认是否(从原来最后一页开始生成)；"Y"--从第一页开始生成		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","MakeAllPages",EmrCode,"N");				//默认不启用CA打印 1：启用；0：不启用				tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","CAStart",EmrCode,"0");		//科室是否启用CA--0 不启用；1 启用		tkMakeServerCall("NurEmr.DHCNurEmrPrintComm","SetEmrTempGlobal","IsVerifyCALoc",EmrCode,"0");		var EmrType=1;  //1:混合单 2：记录单 3：评估单		var parr=EpisodeID+"!"+stdate+"!"+stim+"!"+edate+"!"+etim+"!"+EmrCode+"!";		//alert(parr)			var link=WebIp+"/dhcmg/PrintComm/PrintCommPic.application?method=PrintOut&EpisodeID="+EpisodeID+"&EmrCode="+EmrCode+"&EmrType="+EmrType+"&ItmName="+prncode+"&Parrm="+parr+"&PrnLoc="+PrnLoc+"&PrnBed="+bedCode+"&LabHead="+LabHead+"&curhead="+"&MthArr="+mth1+"&WebUrl="+WebUrl;		//alert(link)		window.location.href=link;			}function printNurRec3(){		var GetPrnSet=document.getElementById('GetPrnSet');		var GetHead=document.getElementById('GetPatInfo');		var ret=cspRunServerMethod(GetHead.value,EpisodeID);		var hh=ret.split("^");		//debugger;		var a=cspRunServerMethod(GetPrnSet.value,"DHCNURBG_JZQJD1",EpisodeID); //page, caredattim, prnpos, adm,Typ,user		if (a=="") return;		var GetLableRec=document.getElementById('GetLableRec');		var LabHead=cspRunServerMethod(GetLableRec.value,"DHCNURBG_JZQJD1^"+session['LOGON.CTLOCID']);		var tm=a.split("^");		var stdate="" //tm[2];		var stim="" //tm[3];		var edate="" //tm[4];		var etim="" //tm[5];		//PrintCommPic.RHeadCaption=hh[1];		//PrintCommPic.LHeadCaption=hh[0];		//PrintCommPic.RFootCaption="第";		//PrintCommPic.LFootCaption="页";		//PrintCommPic.LFootCaption=hh[2];			PrintCommPic.TitleStr=ret;		PrintCommPic.SetPreView("1");		PrintCommPic.PrnLoc=session['LOGON.CTLOCID'];		var aa=tm[1].split("&");		//PrintCommPic.stPage=aa[0];		//if (aa.length>1) PrintCommPic.stRow=aa[1];		PrintCommPic.stPage=0;		PrintCommPic.stRow=0;		PrintCommPic.previewPrint="1"; //是否弹出设置界面		//PrintCommPic.stprintpos=tm[0];		PrintCommPic.stprintpos=0;		//alert(PrintCommPic.Pages);		PrintCommPic.SetConnectStr(CacheDB);     PrintCommPic.WebUrl=WebIp+"/imedical/web/DWR.DoctorRound.cls";		PrintCommPic.ItmName = "DHCNURMouldPrn_ZYYJZQJD"; //338155!2010-07-13!0:00!!		//debugger;		var parr=EpisodeID+"!"+stdate+"!"+stim+"!"+edate+"!"+etim+"!DHCNURBG_JZQJD1";		PrintCommPic.ID = "";		PrintCommPic.MultID = "";		//PrintCommPic.MthArr="web.DHCConsult:getConsultInfo&id:"+myid;		if(LabHead!="")PrintCommPic.LabHead=LabHead;		PrintCommPic.SetParrm(parr); // ="EpisodeId" ; //"p1:0^p2:"		PrintCommPic.PrintOut();		var SavePrnSet=document.getElementById('SavePrnSet');		//debugger;		var CareDateTim=PrintCommPic.CareDateTim;		if (CareDateTim=="") return ;		var pages=PrintCommPic.pages;		var stRow=PrintCommPic.stRow;		//debugger;		var stprintpos=PrintCommPic.stPrintPos;		//alert(pages+","+CareDateTim+","+stprintpos+","+EpisodeID+","+"DHCNURANHUI30"+","+session['LOGON.USERID']+","+PrintCommPic.PrnFlag);		//PrnFlag==1说明是打印预览		if (PrintCommPic.PrnFlag==1) return;		//如果原记录保存打印到第8页则当打印第8页之前页时不保存打印记录		if (pages<aa[0]) return;		var a=cspRunServerMethod(SavePrnSet.value,pages,CareDateTim,stprintpos,EpisodeID,"DHCNURBG_JZQJD1",session['LOGON.USERID']); //page, caredattim, prnpos, adm,Typ,user		//find();}function butPrintFn(){   	    printNurRec();	    return;			PrintCommPic.RHeadCaption='dddd';			PrintCommPic.LHeadCaption="3333333";			var getid=document.getElementById('GetId');            var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID);			//PrintCommPic.RFootCaption="第";			//PrintCommPic.LFootCaption="页";			//PrintCommPic.LFootCaption="88";			//alert(PrintCommPic.Pages);			PrintCommPic.SetConnectStr(CacheDB);			PrintCommPic.WebUrl=WebIp+"/imedical/web/DWR.DoctorRound.cls";			PrintCommPic.ItmName = "DHCNURMouldPrn_ZYYJZQJD";			//debugger;			//var parr="@"+EpisodeID+"@DHCNURHYD_Assessment@DHCNURHYD_DisSummary";						//var parr="@"+EpisodeID+"@DHCNURBG_JZQJD1";			//PrintCommPic.MthArr="web.DHCNurMouldDataComm:GetPrnValComm&parr:"+parr;				        var mth1="Nur.DHCMoudData:getVal&parr:"+id+"!";	        var mth2="web.DHCMGtestpge:DHCNurOperComplexPrn&parr$"+EpisodeID+"!";			//var parr="@"+EpisodeID+"@DHCNURHYD_Assessment@DHCNURHYD_DisSummary";			//var parr="a@"+EpisodeID+"^b@DHCNURXHPGD";			PrintCommPic.MthArr=mth1+"|"+mth2;			//alert(PrintCommPic.MthArr);			//PrintCommPic.LabHead=LabHead;						//PrintCommPic.SetParrm(parr);			PrintCommPic.PrintOut();} function scoreFormat(value){if (value.indexOf("分")!="-1"){  var scorearry1=new Array();  scorearry1=value.split("(分"); value=scorearry1[0];   if (value.indexOf("  ")!="-1")  {    scorearry1=value.split("  ");   value=scorearry1[1];   }   if (value==null) {  value="0"; }}else{	if (value=="") value="0";}   return value;}function scoreAdd(obj){	 //var scorearry1=new Array(); 	 var scorehj=0; 	 var tmp=obj.getValue();	 tmp=scoreFormat(tmp); 	 if (tmp==null)	 {  	    tmp="0";		 	   }	 	 switch (obj.getName()) 	 {	 	case 'Item8':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;     case 'Item9':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;    case 'Item10':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;    case 'Item11':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;    case 'Item12':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;    case 'Item13':           scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;     case 'Item14':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));            break;     case 'Item15':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));            break;     case 'Item34':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()));            break; 	 } 	 var amtsum = Ext.getCmp("Item33"); 	 //tmp=parseInt(tmp)+parseInt(amtsum.getValue())	 	 amtsum.setValue(scorehj);  } function CancelRecordold(){	var objCancelRecord=document.getElementById('CancelRecord');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条护理记录!"); return; }	else	{		Ext.Msg.show({    	       title:'再确认一下',    	       msg: '你确定要作废此条护理记录吗?',    	       buttons:{"ok":"确定","cancel":"取消"},	       fn:  function(btn, text){    	            if (btn == 'ok'){    					var par=objRow[0].get("par");					var rw=objRow[0].get("rw");					//alert(par+","+rw+","+session['LOGON.USERID']+","+session['LOGON.GROUPDESC']);					if (objCancelRecord) {						var a = cspRunServerMethod(objCancelRecord.value, par, rw, session['LOGON.USERID'], session['LOGON.GROUPDESC']);						if (a!=0){							return;						}else{							find();						}					}	            }    	        },    	       animEl: 'newbutton'   	    });	}}function CancelRecord(){	var objCancelRecord=document.getElementById('CancelRecord');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) 	{		alert("请先选择一条护理记录!");		return;	} else 	{		var flag = confirm("你确定要作废此条记录吗!")		if (flag) 		{			var par=objRow[0].get("par");					var rw=objRow[0].get("rw");					//alert(par+","+rw+","+session['LOGON.USERID']+","+session['LOGON.GROUPDESC']);					if (objCancelRecord) {						var a = cspRunServerMethod(objCancelRecord.value, par, rw, session['LOGON.USERID'], session['LOGON.GROUPDESC']);						if (a!=0){							alert(a);							return;						}else{							find();						}					}		}	}}function InOutNodNL(){ //小结    //alert(1);	var SaveOutInNL=document.getElementById('SaveOutInNL');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先点'统计'按钮!"); return; }	else	{	  var countstr=""; //合计项	  var countcls=ICountCls+"&"+OCountCls;	  var tt=countcls.split('&');	  for (i=0;i<tt.length;i++)	  {	  	if (tt[i]=="") continue;		countstr=countstr+tt[i]+"|"+objRow[0].get(tt[i])+"^";	  }	  var CareDate=objRow[0].get("CareDate");	  var CareTime=objRow[0].get("CareTime");	  var inamount=objRow[0].get(DisplaySumInAmount);	  var OutQtAmount=objRow[0].get(DisplaySumOutAmount);	  var InPart=objRow[0].get(PartInAmount);	  var OutPart=objRow[0].get(PartOutAmount);	  //var StatTime=objRow[0].get("Item1");	  //var StatHours=objRow[0].get("Item2");	  var CaseMeasure=objRow[0].get("CaseMeasure");	  var CaseMeasureArr=CaseMeasure.split(" ");	  if (CaseMeasureArr.length>1)	  {	  	var StatTime=CaseMeasureArr[0];	  	var StatHours=CaseMeasureArr[1];	  }	  else	  {	  	var StatTime="";	  	var StatHours="";	  }		var str=countstr+"^SumInAmount|"+inamount+"^SumOutAmount|"+OutQtAmount+"^CareDate|"+formatDate(CareDate)+"^CareTime|"+CareTime+"^Typ|Nod^"+"InPart|"+InPart+"^OutPart|"+OutPart+"^StatTime|"+StatTime+"^StatHours|"+StatHours;		var diaggrid = Ext.getCmp('diaggrid');		if (diaggrid) {  		var selModel=diaggrid.getSelectionModel();  		if (selModel.hasSelection()) {     			var objDiagRow = selModel.getSelections();		  							DiagnosDr=objDiagRow[0].get("rw");			}			else {				DiagnosDr="";				}		}		else {			DiagnosDr="";		}		str=str+"^DiagnosDr|"+DiagnosDr+"^HeadDR|"+CurrHeadDr;		//alert(str);		var a=cspRunServerMethod(SaveOutInNL.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURBG_JZQJD1");		find();	}}function InOutSumNL(){	var SaveOutInNL=document.getElementById('SaveOutInNL');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先点'统计'按钮!"); return; }	else	{	  var countstr=""; //合计项	  var countcls=ICountCls+"&"+OCountCls;	  var tt=countcls.split('&');	  for (i=0;i<tt.length;i++)	  {	  	if (tt[i]=="") continue;		  countstr=countstr+tt[i]+"|"+objRow[0].get(tt[i])+"^";	  }      var CareDate=objRow[0].get("CareDate"); 	  var CareTime=objRow[0].get("CareTime");	  var inamount=objRow[0].get(DisplaySumInAmount);	  var OutQtAmount=objRow[0].get(DisplaySumOutAmount);	  var InPart=objRow[0].get(PartInAmount);	  var OutPart=objRow[0].get(PartOutAmount);		//var StatTime=objRow[0].get("Item1");	  //var StatHours=objRow[0].get("Item2");	  var CaseMeasure=objRow[0].get("CaseMeasure");	  var CaseMeasureArr=CaseMeasure.split(" ");	  if (CaseMeasureArr.length>1)	  {	  	var StatTime=CaseMeasureArr[0];	  	var StatHours=CaseMeasureArr[1];	  }	  else	  {	  	var StatTime="";	  	var StatHours="";	  }		var str="^SumInAmount|"+"^SumOutAmount|"+OutQtAmount+"^CareDate|"+formatDate(CareDate)+"^CareTime|"+CareTime+"^Typ|Sum^"+"InPart|"+"^OutPart|"+"^StatTime|"+StatTime+"^StatHours|"+StatHours;		//alert(str);		var diaggrid = Ext.getCmp('diaggrid');		if (diaggrid) {  		var selModel=diaggrid.getSelectionModel();  		if (selModel.hasSelection()) {     			var objDiagRow = selModel.getSelections();		  							DiagnosDr=objDiagRow[0].get("rw");			}			else {				DiagnosDr="";				}		}		else {			DiagnosDr="";		}		str=str+"^DiagnosDr|"+DiagnosDr+"^HeadDR|"+CurrHeadDr;		//alert(str);		var a=cspRunServerMethod(SaveOutInNL.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURBG_JZQJD1");		find(); }}function InOutNod(){ //小结    	var SaveOutIn=document.getElementById('SaveOutIn');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先点'统计'按钮!"); return; }	else	{	  var countstr=""; //合计项	  var countcls=ICountCls+"&"+OCountCls;	  var tt=countcls.split('&');	  for (i=0;i<tt.length;i++)	  {	  	if (tt[i]=="") continue;		countstr=countstr+tt[i]+"|"+objRow[0].get(tt[i])+"^";	  }	  var CareDate=objRow[0].get("CareDate");	  var CareTime=objRow[0].get("CareTime");	  var inamount=objRow[0].get(DisplaySumInAmount);	  var OutQtAmount=objRow[0].get(DisplaySumOutAmount);	  var InPart=objRow[0].get(PartInAmount);	  var OutPart=objRow[0].get(PartOutAmount);	  //var StatTime=objRow[0].get("Item1");	  //var StatHours=objRow[0].get("Item2");	  var CaseMeasure=objRow[0].get("CaseMeasure");	  var CaseMeasureArr=CaseMeasure.split(" ");	  if (CaseMeasureArr.length>1)	  {	  	var StatTime=CaseMeasureArr[0];	  	var StatHours=CaseMeasureArr[1];	  }	  else	  {	  	var StatTime="";	  	var StatHours="";	  }		var str=countstr+"^SumInAmount|"+inamount+"^SumOutAmount|"+OutQtAmount+"^CareDate|"+CareDate+"^CareTime|"+CareTime+"^Typ|Nod^"+"InPart|"+InPart+"^OutPart|"+OutPart+"^StatTime|"+StatTime+"^StatHours|"+StatHours;		var diaggrid = Ext.getCmp('diaggrid');		if (diaggrid) {  		var selModel=diaggrid.getSelectionModel();  		if (selModel.hasSelection()) {     			var objDiagRow = selModel.getSelections();		  							DiagnosDr=objDiagRow[0].get("rw");			}			else {				DiagnosDr="";				}		}		else {			DiagnosDr="";		}		str=str+"^DiagnosDr|"+DiagnosDr+"^HeadDR|"+CurrHeadDr;		//alert(str);		var a=cspRunServerMethod(SaveOutIn.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURBG_JZQJD1");		find();	}}function InOutSum(){	var SaveOutIn=document.getElementById('SaveOutIn');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先点'统计'按钮!"); return; }	else	{	  var countstr=""; //合计项	  var countcls=ICountCls+"&"+OCountCls;	  var tt=countcls.split('&');	  for (i=0;i<tt.length;i++)	  {	  	if (tt[i]=="") continue;		countstr=countstr+tt[i]+"|"+objRow[0].get(tt[i])+"^";	  }      var CareDate=objRow[0].get("CareDate"); 	  var CareTime=objRow[0].get("CareTime");	  var inamount=objRow[0].get(DisplaySumInAmount);	  var OutQtAmount=objRow[0].get(DisplaySumOutAmount);	  var InPart=objRow[0].get(PartInAmount);	  var OutPart=objRow[0].get(PartOutAmount);		//var StatTime=objRow[0].get("Item1");	  //var StatHours=objRow[0].get("Item2");	  var CaseMeasure=objRow[0].get("CaseMeasure");	  var CaseMeasureArr=CaseMeasure.split(" ");	  if (CaseMeasureArr.length>1)	  {	  	var StatTime=CaseMeasureArr[0];	  	var StatHours=CaseMeasureArr[1];	  }	  else	  {	  	var StatTime="";	  	var StatHours="";	  }		var str=countstr+"^SumInAmount|"+inamount+"^SumOutAmount|"+OutQtAmount+"^CareDate|"+CareDate+"^CareTime|"+CareTime+"^Typ|Sum^"+"InPart|"+InPart+"^OutPart|"+OutPart+"^StatTime|"+StatTime+"^StatHours|"+StatHours;		//alert(str);		var diaggrid = Ext.getCmp('diaggrid');		if (diaggrid) {  		var selModel=diaggrid.getSelectionModel();  		if (selModel.hasSelection()) {     			var objDiagRow = selModel.getSelections();		  							DiagnosDr=objDiagRow[0].get("rw");			}			else {				DiagnosDr="";				}		}		else {			DiagnosDr="";		}		str=str+"^DiagnosDr|"+DiagnosDr+"^HeadDR|"+CurrHeadDr;		//alert(str);		var a=cspRunServerMethod(SaveOutIn.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURBG_JZQJD1");		find(); }}function UpdateRelDiagnos(){	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCNurRelDiagnos", EpisodeID, "");	arr = eval(a);	var window = new Ext.Window({		title: '关联诊断记录',		width: 615,		height: 235,		autoScroll: true,		layout: 'absolute',		plain: true,		frame:true,		//modal: true,		//bodyStyle: 'padding:5px;',		///buttonAlign: 'center',		items: arr	});	var butin=Ext.getCmp('diaggridbut1');	butin.text="确定";	butin.on('click',UpdateDiagnos);	var but2=Ext.getCmp('diaggridbut2');	but2.text="插入小结";	but2.on('click',UpdateDiagnos1);	var diaggrid = Ext.getCmp('diaggrid');	var diagtobar=diaggrid.getTopToolbar();	diagtobar.addButton({		className: 'new-topic-button',		text: "插入24小时",		handler:UpdateDiagnos2,		id:'diaggridbut3'  	});	//debugger;	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length > 0) {		var inname = objRow[0].get(DisplaySumInName);		var outname = objRow[0].get(DisplaySumOutName);		if ((inname)&&(outname)&&((inname.indexOf("入液量") != -1) || (outname.indexOf("出液量") != -1))) {			butin.hide();		}		else {			but2.hide();			var but3 = Ext.getCmp('diaggridbut3');			but3.hide();		}	}	SchDiag();	window.show();}