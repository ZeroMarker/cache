var locdata = new Array(); var Turmbledata = new Array();cspRunServerMethod(GetWardLoc, 'addloc');  addTurmble("是","是") addTurmble("否","否")addTurmble("全部","全部") function AddRec(str){	var obj = eval('(' + str + ')');	REC.push(obj);}var storeloc = new Ext.data.JsonStore({			data : locdata,			fields : ['loc', 'locdes']		}); 		var Turmbleloc = new Ext.data.JsonStore({			data : Turmbledata,			fields : ['Turmble', 'Turmbledes']		});function addTurmble(a, b) {	Turmbledata.push({				Turmble : a,				Turmbledes : b			});}function addloc(a, b) {	locdata.push({				loc : a,				locdes : b			});}//护理单元var comboboxDep = new Ext.form.ComboBox({	name : 'comboboxDep',	id : 'comboboxDep',	store : new Ext.data.Store({		proxy : new Ext.data.HttpProxy({			url : "../csp/dhc.nurse.ext.common.getdata.csp"		}),		reader : new Ext.data.JsonReader({			root : 'rows',			totalProperty : 'results',			fields : [{				'name' : 'ctlocDesc',				'mapping' : 'ctlocDesc'			}, {				'name' : 'CtLocDr',				'mapping' : 'CtLocDr'			}]		}),		baseParams : {			className : 'web.DHCNurHCRecComm',			methodName : 'Wardgetloc',			type : 'Query'		}	}),	//tabIndex : '0',	listWidth : 270,//	height : 18,	width : 270,	xtype : 'combo',	displayField : 'ctlocDesc',	valueField : 'CtLocDr',	hideTrigger : false,	queryParam : 'ward1',	forceSelection : true,	triggerAction : 'all',	minChars : 1,	pageSize : 10,	typeAhead : false,	typeAheadDelay : 1000,	loadingText : 'Searching...'});var locField = new Ext.form.ComboBox({			id : 'locsys',			hiddenName : 'loc1',			store : storeloc,			width : 150,			fieldLabel : '病区',			valueField : 'loc',			displayField : 'locdes',			allowBlank : true,			mode : 'local',			anchor : '100%'		}); 		var TurmbleField = new Ext.form.ComboBox({			id : 'Turmblesys',			hiddenName : 'Turmble1',			store : Turmbleloc,			width : 50,			fieldLabel : '是否跌倒坠床',			valueField : 'Turmble',			displayField : 'Turmbledes',			allowBlank : true,			mode : 'local',			anchor : '100%'		});function BodyLoadHandler() { 	  	 var but1 = Ext.getCmp("DHCNURANHUI12gridbut1");	 but1.hide();	 var but2 = Ext.getCmp("DHCNURANHUI12gridbut2");	 but2.hide();               Ext.override(Ext.grid.RowSelectionModel, {			onEditorKey : function(F, E) {				var C = E.getKey(), G, D = this.grid, B = D.activeEditor;				var A = E.shiftKey; 				//debugger;        if (C == E.RIGHT) {        // alert();        E.stopEvent();        B.completeEdit();        G = D.walkCells(B.row,B.col+1, 1, this.acceptsNav,this);        }               if (C == E.LEFT) {        // alert();        E.stopEvent();        B.completeEdit();        G = D.walkCells(B.row,B.col-1, 1, this.acceptsNav,this);        }       if (C == E.DOWN) {       // alert();       E.stopEvent();       B.completeEdit();       G = D.walkCells(B.row+1,4, 1, this.acceptsNav,this);       }             if (C == E.UP) {       // alert();       E.stopEvent();       B.completeEdit();       G = D.walkCells(B.row-1,4, 1, this.acceptsNav,this);       }        				if (C == E.TAB) {					E.stopEvent();					B.completeEdit();					if (A) {						G = D.walkCells(B.row, B.col - 1, -1, this.acceptsNav,								this);					} else {						G = D.walkCells(B.row, B.col + 1, 1, this.acceptsNav,								this);					}				} else {					if (C == E.ENTER) {						E.stopEvent();						// alert(B);						B.completeEdit();						if (this.moveEditorOnEnter !== false) {							if (A) {								// G = D.walkCells(B.row - 1, B.col, -1,								// this.acceptsNav,this)								G = D.walkCells(B.row, B.col - 1, -1,										this.acceptsNav, this);							} else {								// G = D.walkCells(B.row + 1, B.col, 1,								// this.acceptsNav,this)								G = D.walkCells(B.row, B.col + 1, 1,										this.acceptsNav, this);							}						}					} else {						if (C == E.ESC) {							B.cancelEdit();						}					}				}				if (G) {					D.startEditing(G[0], G[1]);				}			}		});    var sm2 = new Ext.grid.RowSelectionModel({           moveEditorOnEnter: true,           singleSelect: true,           listeners: {               //rowselect : function(sm, row, rec) {                   //centerForm.getForm().loadRecord(rec);              // }           }         });                 	 setsize("DHCNURANHUI12gridpl", "gform", "DHCNURANHUI12grid"); 	 grid = Ext.getCmp('DHCNURANHUI12grid');         grid.addListener('rowdblclick', rowdblclickFn);                                  var mydate = new Date();	 var tobar = grid.getTopToolbar();	  tobar.addItem({		xtype:'datefield',		//format: 'Y-m-d',		id:'DHCNURANHUI12gridstartdate',		value:(diffDate(new Date(),-1))		}, {		xtype:'datefield',		//format: 'Y-m-d',		id:'DHCNURANHUI12gridenddate',		value:(diffDate(new Date(),0))	}); 		tobar.addItem('病区', comboboxDep); 		tobar.addItem('是否发生跌倒', TurmbleField);	var dep=Ext.getCmp('comboboxDep'); 	dep.store.on("beforeLoad",function(){		var wardstore=dep.store;		var str=dep.lastQuery		wardstore.baseParams.ward=str; 		}); 	var comboboxDepStore=Ext.getCmp('comboboxDep').getStore();	comboboxDepStore.load({params:{start:0,limit:2000}});	  	tobar.addButton(		  {			className: 'new-topic-button',			text: "查询",			handler:find,			id:'DHCNURANHUI12gridSch'		  }     //grid.on('rowclick',rowClickFn);); }function setvalue(id,EpisodeID,e){	var ha = new Hashtable();  if (id != "")   {   	//alert("1");   	var getVal = document.getElementById('getVal');   	var ret = cspRunServerMethod(getVal.value, id);    var tm = ret.split('^');		sethashvalue(ha, tm);  } 	else 	{				//getPatInfo();				return;	}  	// debugger;         	 var gform=Ext.getCmp("gform");   gform.items.each(eachItem, this);  	 //  alert(a);	for (var i=0 ; i<ht.keys().length;i++)//for...in statement get all of Array's index	{		var key = ht.keys()[i]; 		//restr += ht.items(key) + " " + ht.parent[key] + "<br/>";		if (key.indexOf("_") == -1) 		{			//alert(key);			var flag=ifflag(key );			//alert(flag);			if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items(key));				//debugger;				continue;			} 						var flag=ifflag1(key );			if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items(key));				//debugger;				continue;			} 						var flag=ifflag2(key );			if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items(key));				//debugger;				continue;			} 						var itm = Ext.getCmp(key);			if (ha.contains(key)) 			itm.setValue(getval(ha.items(key)));				    }else{			var aa=key.split('_'); 			if(ha.contains(aa[0]))			{			  setcheckvalue(key,ha.items(aa[0]));			}		}    }    //find(); }   function rowdblclickFn(grid, rowIndex, e)  {          //alert(EpisodeID);   	        //alert(id);	        	        //var a = cspRunServerMethod(pdata1, "", "DHCNURANHUI10", EpisodeID, ""); 	        //var a=cspRunServerMethod(getid.value,"DHCNURANHUI10",EpisodeID);	        //arr = eval(a);  	        //if (id != "")           //{            //var getVal = document.getElementById('getVal');   	        //var ret = cspRunServerMethod(getVal.value, id);            //var tm = ret.split('^');             //alert(tm);                        //sethashvalue(ha, tm);          //}	           //var window = new Ext.Window({		      //title: '跌倒坠床上报',		      //width: 850,		      //height: 650,		      //autoScroll: true,		      //layout: 'absolute',		      //plain: true,		      //frame:true,		  		//items:arr	       //});	      //setvalue(id,EpisodeID)        //window.show();                    //alert('你单击了' + rowIndex);          selections = grid.getSelectionModel().getSelections(); 	        var arr = new Array();   	        EpisodeID=grid.store.getAt(rowIndex).get(grid.getColumnModel().getDataIndex(7));  	        var id=grid.store.getAt(rowIndex).get(grid.getColumnModel().getDataIndex(8));  	        var lnk= "dhcnuremrcomm.csp?"+"&EmrCode=DHCNURANHUI10&EpisodeID="+EpisodeID+"&NurRecId="+id;  	         	        window.open(lnk,"htm",'toolbar=no,location=no,directories=no,resizable=yes,width=860,height=700'); }     function find(){ 	REC = new Array();	var StartDate = formatDate(Ext.getCmp("DHCNURANHUI12gridstartdate").getValue());	var EndDate = formatDate(Ext.getCmp("DHCNURANHUI12gridenddate").getValue()); 	var locsys = Ext.getCmp("comboboxDep").getValue(); 	var Turmblesys = Ext.getCmp("Turmblesys").getValue(); 	var EmrCode="DHCNURANHUI10" 	var parr =StartDate+"^"+EndDate+"^"+locsys+"^"+session['LOGON.CTLOCID']+"^"+EmrCode+"^"+Turmblesys;	//alert(parr);	if ((StartDate=="")||(EndDate=="")) return;  var GetQueryData = document.getElementById('GetQueryData');  var DHCNURANHUI12grid = Ext.getCmp("DHCNURANHUI12grid");  var a = cspRunServerMethod(GetQueryData.value, "web.DHCBlurQuery:DHCNURKPQuery", "Parr$" + parr, "AddRec");  //var a = cspRunServerMethod(GetQueryData.value, "web.DHCBlurQuery:DHCNURANHUI12grid", "Parr$" + parr, "AddRec");  DHCNURANHUI12grid.store.loadData(REC); }