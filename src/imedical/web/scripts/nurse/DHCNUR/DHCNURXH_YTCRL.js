var ret="";var checkret="";var comboret="";var arrgrid=new Array();var SumInName="";var SumInAmount="";var SumOutName="";var SumOutAmount="";var PartInName="";var PartInAmount="";var PartOutName="";var PartOutAmount="";var DisplaySumInName="";var DisplaySumInAmount="";var DisplaySumOutName="";var DisplaySumOutAmount="";var OrdInName="";var OrdInAmount="";var ICountCls="";var OCountCls="";var GetNurseRecSet=document.getElementById('GetNurseRecSet');if (GetNurseRecSet){	var ret=cspRunServerMethod(GetNurseRecSet.value,"DHCNURXH_YTCRL");	var hh=ret.split("^");	//alert(ret)	SumInName=hh[0].split("&")[0];	SumInAmount=hh[0].split("&")[1];	SumOutName=hh[1].split("&")[0];	SumOutAmount=hh[1].split("&")[1];	PartInName=hh[2].split("&")[0].split("!")[0];	PartInAmount=hh[2].split("&")[1];	PartOutName=hh[3].split("&")[0].split("!")[0];	PartOutAmount=hh[3].split("&")[1];	DisplaySumInName=hh[7].split("&")[0].split("!")[0];	DisplaySumInAmount=hh[7].split("&")[1];	DisplaySumOutName=hh[8].split("&")[0].split("!")[0];	DisplaySumOutAmount=hh[8].split("&")[1];    ICountCls=hh[9];    OCountCls=hh[10];    OrdInName=hh[11].split("&")[0];;    OrdInAmount=hh[11].split("&")[1];;	//debugger;	//alert(OrdInName);}var GetNurseRecSet=document.getElementById('GetNurseRecSet');var UserType="";var GetUserType=document.getElementById('GetUserType');if (GetUserType){	UserType=cspRunServerMethod(GetUserType.value,session['LOGON.USERID']);}var grid;var DiagnosDr="";function gethead(){	var GetHead=document.getElementById('GetHead');	var ret=cspRunServerMethod(GetHead.value,EpisodeID);	var hh=ret.split("^");	return hh[0]+"  "+hh[1];	//debugger;}function formatDate(value){  	try	{	   return value ? value.dateFormat('Y-m-d') : '';	}	catch(err)	{	   return '';	} };function eachItem1(item,index,length) {       if (item.xtype=="datefield") {               //修改下拉框的请求地址    			ret=ret+item.id+"|"+formatDate(item.getValue())+"^";   			          }     if (item.xtype=="timefield") {               //修改下拉框的请求地址    			//debugger;			ret=  ret+item.id+"|"+item.getValue()+"^";             } 	 if (item.xtype=="combo") {               //修改下拉框的请求地址    			//debugger;			comboret=  comboret+item.id+"|"+item.getValue()+"!"+item.lastSelectionText+"^";             } 	 if (item.xtype=="textfield") {               //修改下拉框的请求地址    			//debugger;			ret=  ret+item.id+"|"+item.getValue()+"^";             } 	 if (item.xtype=="textarea") {               //修改下拉框的请求地址    			ret=  ret+item.id+"|"+item.getRawValue()+"^";             } 	 if (item.xtype=="checkbox") {               //修改下拉框的请求地址    			//debugger;			if (item.checked==true) checkret=checkret+item.id+"|"+item.boxLabel+"^";             } 	      if (item.items && item.items.getCount() > 0) {          item.items.each(eachItem1, this);       }   }   var ITypItm="Item344"; //后取数据字典型 var ITypItm1="Item1111";  function BodyLoadHandler(){	//var but=Ext.getCmp("butClose");   // but.on('click',btclose);	var but=Ext.getCmp("butSave");    but.on('click',Save);	var but=Ext.getCmp("butPrint");    but.on('click',butPrintFn);	//var GetQueryData=document.getElementById('GetQueryData');	setvalue()	//alert(SpId); 	//外科护理单	setsize("mygridpl","gform","mygrid");	//fm.doLayout(); 	var but1=Ext.getCmp("mygridbut1");	but1.on('click',additm);	var but=Ext.getCmp("mygridbut2");	but.setText("保存");	but.on('click',save);	Ext.override(Ext.Editor, {			onSpecialKey : function(field, e) {				var key = e.getKey();				this.fireEvent('specialkey', field, e);			}		});Ext.override(Ext.grid.RowSelectionModel, {			onEditorKey : function(F, E) {				var C = E.getKey(), G, D = this.grid, B = D.activeEditor;				var A = E.shiftKey; 				//debugger;        if (C == E.RIGHT) {        // alert();        E.stopEvent();        B.completeEdit();        G = D.walkCells(B.row,B.col+1, 1, this.acceptsNav,this);        }               if (C == E.LEFT) {        // alert();        E.stopEvent();        B.completeEdit();        G = D.walkCells(B.row,B.col-1, 1, this.acceptsNav,this);        }       if (C == E.DOWN) {       // alert();       E.stopEvent();       B.completeEdit();       G = D.walkCells(B.row+1,4, 1, this.acceptsNav,this);       }             if (C == E.UP) {       // alert();       E.stopEvent();       B.completeEdit();       G = D.walkCells(B.row-1,4, 1, this.acceptsNav,this);       }        				if (C == E.TAB) {					E.stopEvent();					B.completeEdit();					if (A) {						G = D.walkCells(B.row, B.col - 1, -1, this.acceptsNav,								this);					} else {						G = D.walkCells(B.row, B.col + 1, 1, this.acceptsNav,								this);					}				} else {					if (C == E.ENTER) {						E.stopEvent();						// alert(B);						B.completeEdit();						if (this.moveEditorOnEnter !== false) {							if (A) {								// G = D.walkCells(B.row - 1, B.col, -1,								// this.acceptsNav,this)								G = D.walkCells(B.row, B.col - 1, -1,										this.acceptsNav, this);							} else {								// G = D.walkCells(B.row + 1, B.col, 1,								// this.acceptsNav,this)								G = D.walkCells(B.row, B.col + 1, 1,										this.acceptsNav, this);							}						}					} else {						if (C == E.ESC) {							B.cancelEdit();						}					}				}				if (G) {					D.startEditing(G[0], G[1]);				}			}		});    var sm2 = new Ext.grid.RowSelectionModel({           moveEditorOnEnter: true,           singleSelect: false,           listeners: {               //rowselect : function(sm, row, rec) {                   //centerForm.getForm().loadRecord(rec);              // }           }         });  	grid=Ext.getCmp('mygrid');  	grid.setTitle(gethead());  	var mydate=new Date();  	var tobar=grid.getTopToolbar();	tobar.addItem(	    {			xtype:'datefield',			format: 'Y-m-d',			id:'mygridstdate',			value:(diffDate(new Date(),-1))		},	    {			xtype:'timefield',			width:100,			format: 'H:i',			value:'07:00',			id:'mygridsttime'		},	    {			xtype:'datefield',			format: 'Y-m-d',			id:'mygridenddate',			value:diffDate(new Date(),0)		},	    {			xtype:'timefield',			width:100,			id:'mygridendtime',			format: 'H:i',			value:'07:00'		}	);	tobar.addButton(	  {		className: 'new-topic-button',		text: "查询",		handler:find,		id:'mygridSch'	  }	);    tobar.addButton(		  {			//className: 'new-topic-button',			text: "统计",			handler:findStat,			id:'mygridStat'		  }	  );   	/*tobar.addButton(		  {			//className: 'new-topic-button',			text: "打印",			handler:printNurRec,			id:'PrintBut'		  }	  );*/  	//tobar.addButton(	//	  {	//		//className: 'new-topic-button',	//		text: "续打印设置",	//		handler:PrintSet,	//		id:'XPrintSet'	//	  }	//  );   	tobar.addItem ("-",{			xtype:'checkbox',			id:'IfCancelRec',			checked:false,			boxLabel:'显示作废记录' 			});		tobar.addItem ("-",{		  text: "预览体温单",			handler:tempeture,			id:'tempeture'					});	//tobar.render(grid.tbar);	tobar.doLayout();  	if (UserType=="DOCTOR") 	{ 		if (but1) but1.hide(); 		if (but) but.hide(); 		//var obj=Ext.getCmp("PrintBut"); 		//if (obj) obj.hide();  		var obj=Ext.getCmp("XPrintSet"); 		if (obj) obj.hide();		 	} 	else 	{		grid.addListener('rowcontextmenu', rightClickFn);		grid.addListener('rowclick', rowClickFn); 	}grid.on('mouseover',function(e){//添加mouseover事件    return;	var index = grid.getView().findRowIndex(e.getTarget());//根据mouse所在的target可以取到列的位置	if(index!==false){//当取到了正确的列时，（因为如果传入的target列没有取到的时候会返回false）		var store = grid.getStore();		var totalRow="";		if (store.getCount()>0) totalRow=store.getAt(index).get(DisplaySumInName);		if ((totalRow)&&(totalRow.indexOf("入液量")>-1))		{			//var record = store.getAt(index);//把这列的record取出来			//var str = Ext.encode(record.data);//组装一个字符串，这个需要你自己来完成，这儿我把他序列化			var par=store.getAt(index).get("par");			var rw=store.getAt(index).get("rw");			var totalRow1,totalRow2,totalRow3,totalRow4;			if ((par)&&(rw))			{				var GetSubInOut=document.getElementById('GetSubInOut');				if (GetSubInOut)				{					var ret=cspRunServerMethod(GetSubInOut.value,par+"^"+rw);					var retArr=ret.split("@");					totalRow1=retArr[0];					totalRow2=retArr[1];					totalRow3=retArr[2];					totalRow4=retArr[3];				}	 				}			else			{				totalRow1=store.getAt(index).get(PartInName);				totalRow2=store.getAt(index).get(PartInAmount);				totalRow3=store.getAt(index).get(PartOutName);				totalRow4=store.getAt(index).get(PartOutAmount);			}			//var str="<p>"+totalRow1+"</p><p>"+totalRow2+"</p><p>"+totalRow3+"</p><p>"+totalRow4+"</p>";			var str="<TABLE borderColor=#000000 width='100%' bgColor=#ffffff border=1 cellSpacing=0 cellPadding=0><TBODY>";			str=str+"<TR bgColor=#D2E9FF><TD></TD><TD>名称</TD><TD>量</TD></TR>";			var totalRow2Arr=totalRow2.split(";");			str=str+"<TR><TD bgColor=#D2E9FF rowSpan="+(totalRow2Arr.length-1)+">入液量分项</TD><TD>"+totalRow2Arr[0].replace(":","</TD><TD>")+"</TD></TR>";			for (var i=1;i<(totalRow2Arr.length-1);i++)			{				str=str+"<TR><TD>"+totalRow2Arr[i].replace(":","</TD><TD>")+"</TD></TR>";			}			var totalRow4Arr=totalRow4.split(";");			str=str+"<TR><TD bgColor=#D2E9FF rowSpan="+(totalRow4Arr.length-1)+">出液量分项</TD><TD>"+totalRow4Arr[0].replace(":","</TD><TD>")+"</TD></TR>";			for (var i=1;i<(totalRow4Arr.length-1);i++)			{				str=str+"<TR><TD>"+totalRow4Arr[i].replace(":","</TD><TD>")+"</TD></TR>";			}			str=str+"</TBODY></TABLE>";			var rowEl = Ext.get(e.getTarget());//把target转换成Ext.Element对象			rowEl.set({				'ext:qtip':str  //设置它的tip属性			},false);	  }	}});Ext.QuickTips.init();//注意，提示初始化必须要有grid.getStore().on('load',function(s,records){          var girdcount=0;          s.each(function(r){              if(r.get("CaseMeasure").indexOf('小结')>-1){                                        grid.getView().getRow(girdcount).style.backgroundColor='#A7FE2E';              }              if((r.get("CaseMeasure").indexOf('小结')=="-1")&&((r.get("CaseMeasure").indexOf('出入液量')>-1))){                    grid.getView().getRow(girdcount).style.backgroundColor='#F7FE2E';              }              girdcount=girdcount+1;          });       //scope:this       });	} function additm(){  //alert(diffDate(new Date(),0)) var curdate=diffDate(new Date(),0) //var curdate="2013-02-25" //alert(curdate)  var curtime=new Date().dateFormat('H:i') //var curtime="07:00" //alert(curtime) var flag="1" //增加 var BlankDesc=tkMakeServerCall("Nur.DHCNurseRecSub","GetBlankDesc2",EpisodeID,curdate,curtime,flag) //alert(11) //alert(BlankDesc) if (BlankDesc=="")  {   var BlankDesc="^^^^^^^" } var tt=BlankDesc.split("^") //alert(tt) var Item34=tt[0] var Item26=tt[1] var Item28=tt[2] var Item30=tt[3] var Item32=tt[4] var Item17=tt[5] var Item15=tt[6]   	var Plant = Ext.data.Record.create([	{name:'CareDate'}, 	{name:'CareTime'},	{name:'Item1'},	{name:'Item2'},	{name:'Item3'},	{name:'Item4'},	{name:'Item5'},	{name:'Item6'},	{name:'Item7'},	{name:'Item8'},	{name:'Item9'}, 	{name:'Item10'},	{name:'Item11'},	{name:'Item12'},	{name:'Item13'},	{name:'Item14'},	{name:'Item15'},	{name:'Item16'},	{name:'Item17'}, 	{name:'Item18'},	{name:'Item19'}, 	{name:'Item20'},	{name:'Item21'},	{name:'Item22'},	{name:'Item23'},	{name:'Item24'},	{name:'Item25'},	{name:'Item26'},	{name:'Item27'},	{name:'Item28'},	{name:'Item29'},	{name:'Item30'},	{name:'Item31'},	{name:'Item32'},	{name:'Item33'},	{name:'Item34'},	{name:'Item35'},	{name:'Item36'},	{name:'Item37'},	{name:'Item38'},	{name:'Item39'},	{name:'Item40'},	{name:'Item41'},	{name:'Item42'},	{name:'Item43'},	{name:'Item44'},	{name:'Item45'},	{name:'Item46'},	{name:'Item47'}, 	{name:'Item48'},	{name:'Item49'},	{name:'Item50'},	{name:'CaseMeasure'},	{name:'User'},	{name:'rw'},	{name:'par'}      ]);    var count = grid.store.getCount();     var r = new Plant({CareDate:new Date(),CareTime:new Date().dateFormat('H:i'),Item34:Item34,Item26:Item26,Item28:Item28,Item30:Item30,Item32:Item32,Item17:Item17,Item15:Item15});     grid.store.commitChanges();     grid.store.insert(count,r); 	return;} var rightClick = new Ext.menu.Menu(  {            id : 'rightClickCont',            items : [  {                id:'rMenu1',                text : '医嘱',                handler:OrdSch            },  {                id:'rMenu2',                text : '备注',                handler:Measure            },  {                id:'rMenu4',                text : '插入出入液量小结',                handler:InOutNod            },  {                id:'rMenu5',                text : '插入24小时出入液量',                handler:InOutSum            },{                id:'rMenu7',                text : '作废',                handler:CancelRecord            }]        });function rightClickFn(client, rowIndex, e)  {          e.preventDefault();          grid=client;		  CurrRowIndex=rowIndex;          rightClick.showAt(e.getXY());            }function rowClickFn(grid, rowIndex, e)  {                //alert('你单击了' + rowIndex);            }              function MultiFun(){	var GetMulti=document.getElementById('GetMulti');	var getcheckform=document.getElementById('getcheckform');		var ret= cspRunServerMethod(GetMulti.value, "DHCNURXH_YTCRL");    var grid=Ext.getCmp('mygrid');    var tt=ret.split('^');	var ab="";	for (i=0;i<tt.length;i++)	{		if (tt[i]=="") continue;		//debugger;		var dd=grid.getSelectionModel().getSelections()[0].get(tt[i]); 		if (dd==undefined)dd=""		if (dd!="") ab=ab+dd+"^"+tt[i]+"!";		else ab=ab+"^"+tt[i]+"!";	}	var tabstr=cspRunServerMethod(getcheckform.value, "DHCNURXH_YTCRL",ab);	var tabarr=tabstr.split('!');		var tbitm=new Array();		for (i = 0; i < tabarr.length; i++) 		{			if (tabarr[i] == "") 				continue;			var itmm = tabarr[i].split('^');			tbitm.push({				xtype: 'panel',				id: itmm[0],				title: itmm[1],				//height: 1000,				layout: 'absolute',				//frame:false,				//palin:false,				closable: false,				items: eval(itmm[2])						})				//alert(itmm[2]);		}	var subttab=new Ext.TabPanel({	    activeTab : 0,//        autoTabs: true,        resizeTabs:true,         //height:200,      //  width:300,        enableTabScroll:true, 	   items:tbitm     });	 	var window = new Ext.Window({		title: '多选',		width: 450,		height: 480,		id:'mulForm',		autoScroll: true,		layout: 'fit',		plain: true,		frame:true,		items: subttab ,  		buttons:[{id:'mulselbut',text:'保存',handler:SaveMulCheck}]	});	   window.show(); }var checkret="";function SaveMulCheck(){  checkret="";  var gform=Ext.getCmp("mulForm");  gform.items.each(eachItem, this);  	var aa=checkret.split('^');	var ht = new Hashtable();	//debugger;	for (i = 0; i < aa.length; i++) {		if (aa[i] == "") 			continue;		var itm = aa[i].split('|');		var aitm = itm[0].split('_');		if (ht.contains(aitm[0])) {		  var val=ht.items(aitm[0])		  ht.remove(aitm[0]);		  var dd=val+";"+itm[1];		  ht.add(aitm[0],dd);		}		else {		ht.add(aitm[0], itm[1])	    }			}	var mygrid=Ext.getCmp('mygrid');	 for(var i in ht.keys())	 {	  var key =ht.keys()[i];      var restr = ht.items(key);	   mygrid.getSelectionModel().getSelections()[0].set(key,restr); 	 }	//alert(checkret);}/*function add(a1, a2){	attenitm.push({		xtype:'panel',		id: a1,		title: a2,		region:'center',		height:1000,		layout:'fit',		closable:true,		items:[]	})} */function multiSel(ret){		var grid1=Ext.getCmp('multigrid');		var code=grid1.getSelectionModel().getSelections()[0].get("itm3");     var itname=grid1.getSelectionModel().getSelections()[0].get("itm4"); 	  var getcheckform=document.getElementById('getcheckform');		//alert(itname+"!!"+code)		var ret=cspRunServerMethod(getcheckform.value, "DHCNURXH_YTCRL",itname,code,"");			var CareDate=grid.getSelectionModel().getSelections()[0].get("CareDate"); 		var aa=new Array();		aa=eval(aa);    /*		debugger;		for(var i=0;i<items.length;i++){             panl.remove(items[i]);           }            panl.doLayout();		panl.add(new Ext.form.Checkbox({                        id:"addboxModule",                                    name:"userModule",                    boxLabel : 'moduleName'                    }));*/		panl.doLayout();		debugger;		 }function addMulitm(ret){	var grid1=Ext.getCmp('multigrid');  	var Plant = Ext.data.Record.create([	{name:'itm1'},	{name:'itm2'},	{name:'itm3'},	{name:'itm4'}      ]);	var itm=ret.split('^');	for (i = 0; i < itm.length; i++) {		if (itm[i]=="") continue;		var aa=itm[i].split('!');		var count = grid1.store.getCount();		var r = new Plant({			itm1: aa[0],			itm2: "",			itm3:aa[1],			itm4:aa[2]		});		grid1.store.commitChanges();		grid1.store.insert(count, r);	}   return;   }              function OrdSch1(){	// var CurrAdm=selections[rowIndex].get("Adm");	selections = grid.getSelectionModel().getSelections();	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCPatOrdList", EpisodeID, "");	arr = eval(a);	var window = new Ext.Window({		title: '医嘱',		width: 550,		height: 550,		autoScroll: true,		layout: 'absolute',		plain: true,		frame: true,		//modal: true,		//bodyStyle: 'padding:5px;',		///buttonAlign: 'center',		items: arr	});	var butin=Ext.getCmp('ordgridbut1');  butin.text="确定"; 	//debugger;  butin.on('click',SureIn);  window.show();}function OrdSch(){         	// var CurrAdm=selections[rowIndex].get("Adm");	selections = grid.getSelectionModel().getSelections();	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCPatOrdList", EpisodeID, "");	arr = eval(a);	var window = new Ext.Window({		title: '医嘱',		width: 450,		height: 550,		autoScroll: true,		layout: 'absolute',		plain: true,		frame:true,		//modal: true,		//bodyStyle: 'padding:5px;',		///buttonAlign: 'center',		items: arr	});	var mydate=new Date();	var	grid1=Ext.getCmp("ordgrid");	tobar=grid1.getTopToolbar();	tobar.addItem(	    {			xtype:'datefield',			format: 'Y-m-d',			id:'ordgridstdate',			value:(diffDate(new Date(),-1))		},	    {			xtype:'datefield',			format: 'Y-m-d',			id:'ordgridenddate',			value:new Date()		}	);	tobar.addButton(	  {		className: 'new-topic-button',		text: "查询",		//handler:find,		id:'ordgridSch'	  }	);	var butin=Ext.getCmp('ordgridbut2');	butin.hide();	var butin=Ext.getCmp('ordgridbut1');	butin.text="确定";	//debugger;	butin.on('click',SureIn);	var butschord=Ext.getCmp('ordgridSch');	butschord.on('click',SchOrd);	window.show();} var condata=new Array();function add(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){ //OrdDate,OrdTime,ARCIMDesc,PriorDes,Meth,PHFreq,Dose,PhQtyOrd,OrdStat,Doctor,Oew,OrdSub,Sel,SeqNo 	condata.push({		OrdDate: a,		OrdTime: b,		ARCIMDesc: c,		PriorDes: d,		Meth: e,		PHFreq: f,		Dose: g,		DoseUnit: h,		PhQtyOrd: i,		OrdStat: j,		Doctor: k,		Oew: l,		OrdSub: m,		SeqNo: o	});}function SchOrd(){	condata=new Array();	var adm=EpisodeID;	var StDate= Ext.getCmp("ordgridstdate");	var Enddate= Ext.getCmp("ordgridenddate");	var GetQueryData=document.getElementById('GetQueryData1');	var ordgrid=Ext.getCmp("ordgrid");	var parr=adm+"^"+StDate.value+"^"+Enddate.value; 	var a=cspRunServerMethod(GetQueryData.value,"web.DHCNUREMR:GetPatOrd","parr$"+parr,"add");	// grid.width=document.body.offsetWidth;	ordgrid.store.loadData(condata);}function Schlab(){	condata=new Array();	var adm=EpisodeID;	var StDate= Ext.getCmp("LabGridstdate");	var Enddate= Ext.getCmp("LabGridenddate");	var GetQueryData=document.getElementById('GetQueryData1');	var ordgrid=Ext.getCmp("LabGrid");  //var parr=adm+"^"+StDate.value+"^"+Enddate.value;	//alert(adm); 	var a=cspRunServerMethod(GetQueryData.value,"web.DHCNurJYRESULT:GetLabNo","Adm$"+adm,"AddLab");  // grid.width=document.body.offsetWidth;  ordgrid.store.loadData(condata);   }function AddLab(a,b,c,d,e,f,g,h){	//OrdDate,OrdTime,ARCIMDesc,ORW,DateEx,TimeEx ,CPTEx,ArcimDR		condata.push({			ARCIMDes:a,			LabEpisodeNo:b,			StDateTime:c,			RowId:d,			testcode:e,			LabCpt:f,			LabDate:g,			LabTime:h		});}function AddCheck(a,b,c,d,e,f,g,h){	//OrdDate,OrdTime,ARCIMDesc,ORW,DateEx,TimeEx ,CPTEx,ArcimDR		condata.push({			OrdDate:a,			OrdTime:b,			ARCIMDesc:c,			ORW:d,			DateEx:e,			TimeEx:f ,			CPTEx:g,			ArcimDR:h		});}function SchCheck(){	condata=new Array();	var adm=EpisodeID;	var StDate= Ext.getCmp("CheckGridstdate");	var Enddate= Ext.getCmp("CheckGridenddate");	var GetQueryData=document.getElementById('GetQueryData1');	var ordgrid=Ext.getCmp("CheckGrid");    var parr=adm+"^"+StDate.value+"^"+Enddate.value; 	var a=cspRunServerMethod(GetQueryData.value,"web.DHCNurJYRESULT:GetOrdRadia","parr$"+parr,"AddCheck");   // grid.width=document.body.offsetWidth;        ordgrid.store.loadData(condata);   }function Measure(){   /* selections = grid.getSelectionModel().getSelections(); 	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCNURMeasure", EpisodeID, "");	arr = eval(a);*/	//EmrCode,EpisodeId,fieldCode		MeasureRel = new Hashtable();     var grid1=Ext.getCmp('mygrid');	var par=grid1.getSelectionModel().getSelections()[0].get("par"); 	var rw=grid1.getSelectionModel().getSelections()[0].get("rw");    // debugger;	var rowid=par+"||"+rw;	if (par==undefined)	{		rowid="";	}	var parr="DHCNURXH_YTCRL^"+EpisodeID+"^CaseMeasureXml^"+rowid;	//alert(parr);	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCPatOrdList", EpisodeID, "");	arr = eval(a);	var arrlab = new Array();	a = cspRunServerMethod(pdata1, "", "DHCNurLabRec", EpisodeID, "");	arrlab = eval(a);	var arrcheck = new Array();	a = cspRunServerMethod(pdata1, "", "DHCNurCheckRec", EpisodeID, "");	arrcheck = eval(a);	var arrResult = new Array();	a = cspRunServerMethod(pdata1, "", "DHCNurLCResult", EpisodeID, "");	arrResult = eval(a);	//DHCNurLCResult	var north_item = new Ext.Panel({   			title: '',   			region: 'north',   			//contentEl: 'north-div',   			split: true,   							frame:true,			border: true,   			//collapsible: true,   			height: 200,   			items:[{				xtype:"tabpanel",				activeTab:0,				frame:true,				items:[	  				{title:"医嘱",			  			width: 550,			  			height: 200,			  			autoScroll: true,		      			layout:'absolute',			  			items:arr},			         		{title:"检查",			  			width: 550,			  			height: 200,			  			autoScroll: true,		      			layout:'absolute',			  			items:arrcheck			 			},			         		{title:"检验",			  			width: 550,			  			height: 200,			  			autoScroll: true,		      			layout:'absolute',			  			items:arrlab			 			}]						 }]		});                var arr = new Array();	        var a = cspRunServerMethod(pdata1, "", "DHCNURMeasure", EpisodeID, "");	        arr = eval(a);            var emrknowurl="dhcnuremrknow.csp?EmrCode=DHCNurKnowldge&Parr="+parr+"&EpisodeID="+EpisodeID;			//alert(emrknowurl);            //中间               var center_item = new Ext.Panel({                   region: 'center',             		autoScroll: true,                split: true,                   layout: 'fit',                   collapsible: false,  				height:50,                 minSize: 50,     				frame:true,                items: arrResult            });                //南边，状态栏               var south_item = new Ext.Panel({                   region: 'south',                 	// contentEl: 'south-div',                   split: true,                  	// border: true,                  	// collapsible: true,            		autoScroll: true,                layout: 'absolute',                   minSize: 200,  				height:200,  				frame:true,                //items: arr 				buttons: [{						text: '确定',						handler: function(){							//	Save();							//	window.close();							sureMeasure();						}					}, {						text: '取消',						handler: function(){							window.close();						}					}],				html: '<iframe id ="southTab" name="ddd" style="width:100%; height:100%" src='+emrknowurl+' ></iframe>'                            });                   //中间的中间，功能菜单    	//alert(parr);	var window = new Ext.Window({ 		title: '医嘱',		width: 550,		modal:true,		height: 580,		id:'CaseForm',		autoScroll: true,		layout: 'border',		plain: true,		frame:true,		items: [north_item, center_item,south_item]   	});	var grid=Ext.getCmp("LabGrid");	var tobar=grid.getTopToolbar();	addtitCon(tobar,grid.id);	grid=Ext.getCmp("CheckGrid");	tobar=grid.getTopToolbar();	addtitCon(tobar,grid.id);	grid=Ext.getCmp("ordgrid");	tobar=grid.getTopToolbar();	addtitCon(tobar,grid.id);		var butschlab=Ext.getCmp('LabGridSch');	butschlab.on('click',Schlab);		var butschord=Ext.getCmp('ordgridSch');	butschord.on('click',SchOrd);		var butschcheck=Ext.getCmp('CheckGridSch');	butschcheck.on('click',SchCheck);		var gridc=Ext.getCmp('CheckGrid');	gridc.on('click',gridcheckclick);		var gridl=Ext.getCmp('LabGrid');	gridl.on('click',gridLabclick);	var mygrid=Ext.getCmp("mygrid");      ////var butsure=Ext.getCmp('_Button6');   //butsure.on('click',sureMeasure);	var rowObj = mygrid.getSelectionModel().getSelections();	var len = rowObj.length;	if (len < 1) {		//Ext.Msg.show({title:'注意',msg:'请选择需要修改的数据!',buttons: Ext.Msg.OK,icon:Ext.MessageBox.WARNING});		return;	}	else {		//var content = rowObj[0].get("CaseMeasure");		//var TxtCaseMeasure=Ext.getCmp('TxtCaseMeasure');		//TxtCaseMeasure.setValue(content);	} //var mydate=new Date(); //var butord=Ext.getCmp('_Button5'); //butord.on=('click',OrdSch1); window.show(); //alert();}function Measure1(){  selections = grid.getSelectionModel().getSelections(); 	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCNURMeasure", EpisodeID, "");	arr = eval(a);	var window = new Ext.Window({		title: '医嘱',		width: 550,		height: 450,		autoScroll: true,		layout: 'absolute',		plain: true,		frame:true,		//modal: true,		//bodyStyle: 'padding:5px;',		///buttonAlign: 'center',		items: arr	}); var mydate=new Date(); var butord=Ext.getCmp('_Button5'); butord.on=('click',OrdSch1); window.show();}function sureMeasure(){	 var gform=Ext.getCmp("gform");   //gform.items.each(eachItem, this);  	var TxtCaseMeasure=Ext.getCmp('TxtCaseMeasure');	var frm=Ext.getCmp('CaseForm');	var aa=document.getElementById("southTab");	var CareCon=Ext.get("southTab").dom.contentWindow.document.getElementById("DesignForm");	//alert(CareCon.QichTextCon.GetCellText());	var win=Ext.get("southTab").dom.contentWindow;   // var parr="DHCNURXH_YTCRL^"+EpisodeID+"^CaseMeasureXml";	var ret=southTab.Save();		var grid1=Ext.getCmp('mygrid');	CaseMeasureID=ret; 	var rwIndex=grid1.getSelectionModel().last;	MeasureRel.add(rwIndex,CaseMeasureID);	//debugger;	grid.getSelectionModel().getSelections()[0].set("CaseMeasure",CareCon.QichTextCon.GetCellText());	frm.close();}function gridcheckclick(){	 var grid=Ext.getCmp("CheckGrid");  	var rowObj = grid.getSelectionModel().getSelections();	var len = rowObj.length;	var GetRadiaNote=document.getElementById('GetRadiaNote');	if(len < 1)	{		//Ext.Msg.show({title:'注意',msg:'请选择需要修改的数据!',buttons: Ext.Msg.OK,icon:Ext.MessageBox.WARNING});		return;	}	else	{		var rowid = rowObj[0].get("ORW");		var a=cspRunServerMethod(GetRadiaNote.value,rowid);        var LCResult=Ext.getCmp('LCResult');		a=a.replace("_$c(13,10)_",String.fromCharCode(13)+String.fromCharCode(10));		var aa=a.split("_$c_");		var txt="";		for (i=0;i<aa.length;i++)		{			if (aa[i]=="")  continue;			txt=txt+aa[i];//+String.fromCharCode(13)+String.fromCharCode(10);		}		LCResult.setValue(txt);		//EpisodeID=rowObj[0].get("EpisodeId");		/*for (i = 0; i < top.frames.length; i++) {			alert(top.frames[i].name);		}		var frm = top.frames[0].document.forms["fEPRMENU"];	    frm.EpisodeID.value=EpisodeID;        ModConsult();*/	}}function gridLabclick(){	 var grid=Ext.getCmp("LabGrid");  	var rowObj = grid.getSelectionModel().getSelections();	var len = rowObj.length;	var GetLabItemdata=document.getElementById('GetLabItemdata');	if(len < 1)	{		//Ext.Msg.show({title:'注意',msg:'请选择需要修改的数据!',buttons: Ext.Msg.OK,icon:Ext.MessageBox.WARNING});		return;	}	else	{		var labno = rowObj[0].get("LabEpisodeNo");		var tesc=rowObj[0].get("testcode");		var ARCIMDes=rowObj[0].get("ARCIMDes");		var a=cspRunServerMethod(GetLabItemdata.value,labno,tesc);		if (a=="-1") return;		var LCResult=Ext.getCmp('LCResult');		//a=a.replace("&",String.fromCharCode(13)+String.fromCharCode(10));		var aa=a.split("$");		var aresult=aa[1].split('&');		var txt="";		for (i=0;i<aresult.length;i++)		{			if (aresult[i]=="")  continue;			var labar=aresult[i].split("^");			txt=txt+labar+String.fromCharCode(13)+String.fromCharCode(10);		}		LCResult.setValue("        "+ARCIMDes+String.fromCharCode(13)+String.fromCharCode(10)+txt);		//EpisodeID=rowObj[0].get("EpisodeId");		/*for (i = 0; i < top.frames.length; i++) {			//alert(top.frames[i].name);		}		var frm = top.frames[0].document.forms["fEPRMENU"];	    frm.EpisodeID.value=EpisodeID;        ModConsult();*/	}}function InOutNod(){ //小结    	var SaveOutIn=document.getElementById('SaveOutIn');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先点'统计'按钮!"); return; }	else	{	  var countstr=""; //合计项	  var countcls=ICountCls+"&"+OCountCls;	  var tt=countcls.split('&');	  for (i=0;i<tt.length;i++)	  {	  	if (tt[i]=="") continue;		countstr=countstr+tt[i]+"|"+objRow[0].get(tt[i])+"^";	  }	  var CareDate=objRow[0].get("CareDate");	  var CareTime=objRow[0].get("CareTime");	   var inamount=objRow[0].get("Item3");	 var OutQtAmount=objRow[0].get("DisplaySumOutAmount");	  var InPart=objRow[0].get(PartInAmount);	  var OutPart=objRow[0].get(PartOutAmount);	  //var StatTime=objRow[0].get("Item1");	  //var StatHours=objRow[0].get("Item2");	  var CaseMeasure=objRow[0].get("CaseMeasure");	  var CaseMeasureArr=CaseMeasure.split(" ");	  if (CaseMeasureArr.length>1)	  {	  	var StatTime=CaseMeasureArr[0];	  	var StatHours=CaseMeasureArr[1];	  }	  else	  {	  	var StatTime="";	  	var StatHours="";	  }		var str=countstr+"^SumInAmount|"+inamount+"^SumOutAmount|"+"^CareDate|"+formatDate(CareDate)+"^CareTime|"+CareTime+"^Typ|Nod^"+"InPart|"+InPart+"^OutPart|"+OutPart+"^StatTime|"+StatTime+"^StatHours|"+StatHours;		var diaggrid = Ext.getCmp('diaggrid');		if (diaggrid) {  		var selModel=diaggrid.getSelectionModel();  		if (selModel.hasSelection()) {     			var objDiagRow = selModel.getSelections();		  							DiagnosDr=objDiagRow[0].get("rw");			}			else {				DiagnosDr="";				}		}		else {			DiagnosDr="";		}		str=str+"^DiagnosDr|"+DiagnosDr;		alert(str);		var a=cspRunServerMethod(SaveOutIn.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURXH_YTCRL");		find();	}}function InOutSum(){	var SaveOutIn=document.getElementById('SaveOutIn');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先点'统计'按钮!"); return; }	else	{	  var countstr=""; //合计项	  var countcls=ICountCls+"&"+OCountCls;	  var tt=countcls.split('&');	  for (i=0;i<tt.length;i++)	  {	  	if (tt[i]=="") continue;		  countstr=countstr+tt[i]+"|"+objRow[0].get(tt[i])+"^";	  }    var CareDate=objRow[0].get("CareDate"); 	  var CareTime=objRow[0].get("CareTime");	  var inamount=objRow[0].get("Item3");	  var OutQtAmount=objRow[0].get("DisplaySumOutAmount");	  var InPart=objRow[0].get(PartInAmount);	  var OutPart=objRow[0].get(PartOutAmount);	  var CaseMeasure=objRow[0].get("CaseMeasure");	  var CaseMeasureArr=CaseMeasure.split(" ");	  if (CaseMeasureArr.length>1)	  {	  	var StatTime=CaseMeasureArr[0];	  	var StatHours=CaseMeasureArr[1];	  }	  else	  {	  	var StatTime="";	  	var StatHours="";	  }		var str=countstr+"^SumInAmount|"+inamount+"^SumOutAmount|"+"^CareDate|"+formatDate(CareDate)+"^CareTime|"+CareTime+"^Typ|Sum^"+"InPart|"+InPart+"^OutPart|"+OutPart+"^StatTime|"+StatTime+"^StatHours|"+StatHours;		//alert(str)		var diaggrid = Ext.getCmp('diaggrid');		if (diaggrid) {  		var selModel=diaggrid.getSelectionModel();  		if (selModel.hasSelection()) {     			var objDiagRow = selModel.getSelections();		  							DiagnosDr=objDiagRow[0].get("rw");			}			else {				DiagnosDr="";				}		}		else {			DiagnosDr="";		}		str=str+"^DiagnosDr|"+DiagnosDr;		//alert(str);		var a=cspRunServerMethod(SaveOutIn.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURXH_YTCRL");	var Item21=objRow[0].get("Item21");	var Item27=objRow[0].get("Item27");	var Item29=objRow[0].get("Item29");	var Item31=objRow[0].get("Item31");	var Item33=objRow[0].get("Item33");	var Item24=objRow[0].get("Item24");	var Item16=objRow[0].get("Item16");	  var CareDate=formatDate(objRow[0].get("CareDate")); 	if (Item21=="0") {Item21=""} 	else (Item21="Item21|"+Item21+"^")	if (Item27=="0") {Item27=""} 	else (Item27="Item27|"+Item27+"^")	if (Item29=="0") {Item29=""} 	else (Item29="Item29|"+Item29+"^")	if (Item31=="0") {Item31=""} 	else (Item31="Item31|"+Item31+"^")	if (Item33=="0") {Item33=""} 	else (Item33="Item33|"+Item33+"^")	if (Item24=="0") {Item24=""} 	else (Item24="Item24|"+Item24+"^")	if (Item16=="0") {Item16=""} 	else (Item16="Item16|"+Item16+"^")	var parr=Item21+Item27+Item29+Item31+Item33+Item24+Item16	//var parr="Item21|"+Item21+"^"+"Item27|"+Item27+"^"+"Item29|"+Item29+"^"+"Item31|"+Item31+"^"+"Item33|"+Item33+"^"+"Item24|"+Item24+"^"+"Item16|"+Item16;  //alert(parr)  //alert(CareDate) // var id=tkMakeServerCall("web.DHCThreeNew","Save",EpisodeID,parr,session['LOGON.USERID'],"DHCNUR6",session['LOGON.GROUPDESC'],CareDate,"06:00");  //alert(id)		find(); }}function UpdateRelDiagnos(){	var arr = new Array();	var a = cspRunServerMethod(pdata1, "", "DHCNurRelDiagnos", EpisodeID, "");	arr = eval(a);	var window = new Ext.Window({		title: '关联诊断记录',		width: 615,		height: 235,		autoScroll: true,		layout: 'absolute',		plain: true,		frame:true,		//modal: true,		//bodyStyle: 'padding:5px;',		///buttonAlign: 'center',		items: arr	});	var butin=Ext.getCmp('diaggridbut1');	butin.text="确定";	butin.on('click',UpdateDiagnos);	var but2=Ext.getCmp('diaggridbut2');	but2.text="插入小结";	but2.on('click',UpdateDiagnos1);	var diaggrid = Ext.getCmp('diaggrid');	var diagtobar=diaggrid.getTopToolbar();	diagtobar.addButton({		className: 'new-topic-button',		text: "插入24小时",		handler:UpdateDiagnos2,		id:'diaggridbut3'  	});	//debugger;	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length > 0) {		var inname = objRow[0].get(DisplaySumInName);		var outname = objRow[0].get(DisplaySumOutName);		if ((inname)&&(outname)&&((inname.indexOf("入液量") != -1) || (outname.indexOf("出液量") != -1))) {			butin.hide();		}		else {			but2.hide();			var but3 = Ext.getCmp('diaggridbut3');			but3.hide();		}	}	SchDiag();	window.show();}function UpdateDiagnos(){	var diaggrid=Ext.getCmp("diaggrid");	var objDiagnosRow=diaggrid.getSelectionModel().getSelections();	if (objDiagnosRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条诊断记录!"); return; }	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条护理记录!"); return; }	else	{		save();	}}function UpdateDiagnos1(){	var diaggrid=Ext.getCmp("diaggrid");	var objDiagnosRow=diaggrid.getSelectionModel().getSelections();	if (objDiagnosRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条诊断记录!"); return; }	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条统计记录!"); return; }	else	{		InOutNod();	}}function UpdateDiagnos2(){	var diaggrid=Ext.getCmp("diaggrid");	var objDiagnosRow=diaggrid.getSelectionModel().getSelections();	if (objDiagnosRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条诊断记录!"); return; }	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条统计记录!"); return; }	else	{		InOutSum();	}}function SchDiag(){	condata=new Array();	var adm=EpisodeID;	var GetQueryData=document.getElementById('GetQueryData1');	var diaggrid=Ext.getCmp("diaggrid");	//alert(adm); 	var a=cspRunServerMethod(GetQueryData.value,"web.DHCNurseRecordComm:GetCopyDiagnos","parr$"+adm,"AddDiag");  	diaggrid.store.loadData(condata);   }function AddDiag(a1,a2,a3,a4,a5){	condata.push({		DiagNos:a1,		RecUser:a2,		RecDate:a3,		RecTime:a4,		rw:a5	});} function DBC2SBC(str)   {	var result = '';	if ((str)&&(str.length)) {		for (i = 0; i < str.length; i++) {			code = str.charCodeAt(i);			if (code >= 65281 && code <= 65373) {				result += String.fromCharCode(str.charCodeAt(i) - 65248);			}			else {				if (code == 12288) {					result += String.fromCharCode(str.charCodeAt(i) - 12288 + 32);				}				else {					result += str.charAt(i);				}			}		}	}	else{		result=str;	}  	return result;   }function SureIn() {	var grid = Ext.getCmp('ordgrid');	var mygrid=Ext.getCmp('mygrid');	var store = grid.store;	var rowCount = store.getCount(); //记录数	/*var cm = grid.getColumnModel();	var colCount = cm.getColumnCount(); //列数	var view = grid.getView();*/	var num=0;	var des2=""	var ml2=0;	var selModel = grid.getSelectionModel();     if (selModel.hasSelection())   {   				var selections = selModel.getSelections();					 	var caredate,caretime;			 	var Meth=""				Ext.each(selections, function(item) 				{					var des=item.data.ARCIMDesc;					des=des.replace("_____","");					var ml=item.data.Dose;					var Dose=item.data.Dose;					//alert(ml)					var unit=item.data.DoseUnit;					if ((unit!="ml")&&(unit!="ML")) ml=0;					var seqno=item.data.SeqNo;					var rowIndex = grid.store.indexOf(item);					//alert(rowIndex)						if (Meth=="")					{Meth=store.getAt(rowIndex).data.Meth;}					var subdes=store.getAt(rowIndex).data.ARCIMDesc;					subdes=subdes.replace("_____","");					var subml=store.getAt(rowIndex).data.Dose;					var subunit=store.getAt(rowIndex).data.DoseUnit;					if (subunit!="ml") subml=0;					var subseqno=store.getAt(rowIndex).data.SeqNo;					//alert(subml)					if (unit!="")					{					subdes=subdes+" "+Dose+"("+unit+")"					}					else					{					subdes=subdes					}					if (des2=="") 					{des2=subdes}					else					{					des2=des2+"&"+subdes					}										ml2=eval(ml2)+eval(ml);						//alert(ml2)							num++;		        }  )  }             	if (Meth!="")					{					  Meth=Meth.split("-")					  //alert(Meth)					  Meth=Meth[1]										}     	      ml2=ml2+"";     	     // alert(ml2)     	      var objRow=mygrid.getSelectionModel().getSelections();     	      //alert(objRow.length )						if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择某行!"); return; }						else						{								objRow[0].set("Item1", des2);								objRow[0].set("Item2", ml2);								objRow[0].set("Item5", Meth);						}				    }function SureIn1111() {	var grid = Ext.getCmp('ordgrid');	var mygrid=Ext.getCmp('mygrid');	var store = grid.store;	var rowCount = store.getCount(); //记录数	/*var cm = grid.getColumnModel();	var colCount = cm.getColumnCount(); //列数	var view = grid.getView();*/	var num=0;	    var selModel = grid.getSelectionModel();       if (selModel.hasSelection()) {          	// Ext.Msg.confirm("警告", "确定要删除吗？", function(button) {   				var selections = selModel.getSelections();				//var rowIndex = grid.store.indexOf(grid.getSelectionModel().getSelected());				//grid.getSelectionModel().selectRow(rowIndex);				//debugger;				var caredate,caretime;				Ext.each(selections, function(item) {					var des=item.data.ARCIMDesc;					des=des.replace("_____","");					var ml=item.data.Dose;					var unit=item.data.DoseUnit;					if ((unit!="ml")&&(unit!="ML")) ml=0;					var seqno=item.data.SeqNo;					var rowIndex = grid.store.indexOf(item);					for (var i = rowIndex-1; i >=0; i--) {						var subdes=store.getAt(i).data.ARCIMDesc;						subdes=subdes.replace("_____","");						var subml=store.getAt(i).data.Dose;						var subunit=store.getAt(i).data.DoseUnit;						if (subunit!="ml") subml=0;						var subseqno=store.getAt(i).data.SeqNo;						if (subseqno==seqno)						{							des=subdes+","+des;							ml=eval(ml)+eval(subml);						}						else						{							break;							}					}					for (var i = rowIndex+1; i < store.getCount(); i++) {						var subdes=store.getAt(i).data.ARCIMDesc;						subdes=subdes.replace("_____","");						var subml=store.getAt(i).data.Dose;						var subunit=store.getAt(i).data.DoseUnit;						if ((subunit!="ml")&&(subunit!="ML")) subml=0;						var subseqno=store.getAt(i).data.SeqNo;						if (subseqno==seqno)						{							des=des+","+subdes;							ml=eval(ml)+eval(subml);						}						else						{							break;							}					}					//alert(num)					ml=ml+"";					if (num == 0) {						caredate=mygrid.getStore().getAt(0).get("CareDate");						caretime=mygrid.getStore().getAt(0).get("CareTime");						var objRow=mygrid.getSelectionModel().getSelections();						if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择某行!"); return; }						else						{								objRow[0].set(OrdInName, des);								objRow[0].set(OrdInAmount, ml);						}					}else{					  if (num>"0") return;						additm();						alert(des)						mygrid.getSelectionModel().selectRow(mygrid.store.getCount()-1);   						mygrid.getSelectionModel().getSelections()[0].set("CareDate", caredate);						mygrid.getSelectionModel().getSelections()[0].set("CareTime", caretime);						mygrid.getSelectionModel().getSelections()[0].set(OrdInName, des);						mygrid.getSelectionModel().getSelections()[0].set(OrdInAmount, ml);					}					num++;				});        } }function save(){	var store = grid.store;	var rowCount = store.getCount(); //记录数	var cm = grid.getColumnModel();	var colCount = cm.getColumnCount();	var list = [];	var rowObj = grid.getSelectionModel().getSelections();		var len = rowObj.length;		for (var r = 0;r < len; r++) {		list.push(rowObj[r].data);	}			var grid1=Ext.getCmp('mygrid');	var rwIndex=grid1.getSelectionModel().last;	var CaseMeasureID="CaseMeasureID|";	//debugger;	//if (MeasureRel.contains(rwIndex))	//{	//	var rid=MeasureRel.items(rwIndex);			//	CaseMeasureID=CaseMeasureID+rid;	//}	//for (var i = 0; i < store.getCount(); i++) {	//	list.push(store.getAt(i).data);	//	//	debugger;	//}	var RecSave=document.getElementById('RecSave');	for (var i = 0; i < list.length; i++) {	  var obj=list[i];	  var str="";	  var CareDate="";	  var CareTime="";	  var flag="0";		for (var p in obj) {			var aa = formatDate(obj[p]);							if (p=="CareDate") CareDate=aa;			if (p=='CareTime') CareTime=obj[p];			if (p=="") continue;			if ((p == DisplaySumInName) && (obj[p].indexOf("入液量") != -1)) {				flag = "1";			}			if ((p==DisplaySumOutName)&&(obj[p].indexOf("出液量")!= -1))			{				flag="1";			} 			if (aa == "") 			{					str = str + p + "|" + DBC2SBC(obj[p]) + '^';			}else			{			  	str = str + p + "|" + aa + '^';				}		}		if ((str!="")&&(flag=="0"))		{			if (str.indexOf("CareDate")==-1)			{				str=str+"CareDate|"+CareDate+"^CareTime|"+CareTime;				//debugger;			}			var diaggrid = Ext.getCmp('diaggrid');			if (diaggrid) {	  		var selModel=diaggrid.getSelectionModel();	  		if (selModel.hasSelection()) {   	  			var objDiagRow = selModel.getSelections();		  								DiagnosDr=objDiagRow[0].get("rw");				}				else {					DiagnosDr="";					}			}			else {				DiagnosDr="";			}			str=str+"DiagnosDr|"+DiagnosDr;			str=str+"^"+CaseMeasureID;			//alert(str);			var a=cspRunServerMethod(RecSave.value,EpisodeID,str,session['LOGON.USERID'],"DHCNURXH_YTCRL",session['LOGON.GROUPDESC']);			//alert(a)			if (a!="0")			{				alert(a);				return;			}		}	}	find();}  function addtitCon(tobar,lab){	var but1=Ext.getCmp(lab+"but1");	but1.hide();	var but2=Ext.getCmp(lab+"but2");	but2.hide();		tobar.addItem(	    {			xtype:'datefield',			format: 'Y-m-d',			id:lab+'stdate',			value:(diffDate(new Date(),-1))		},	    {			xtype:'datefield',			format: 'Y-m-d',			id:lab+'enddate',			value:new Date()		}	);	tobar.addButton(	  {		className: 'new-topic-button',		text: "查询",		//handler:find,		id:lab+'Sch'	  }	);}function find(){	//var link="dhcnurtempature.csp?EpisodeID="+EpisodeID;   /// window.open (link,'体温单','height=1,width=1,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no')    // window.close();  // alert(parent.frames.length);    MeasureRel = new Hashtable();    REC = new Array();	var adm = EpisodeID;	var StDate = Ext.getCmp("mygridstdate");	var StTime = Ext.getCmp("mygridsttime");	var Enddate = Ext.getCmp("mygridenddate");	var EndTime = Ext.getCmp("mygridendtime");	var GetQueryData = document.getElementById('GetQueryData');	var mygrid = Ext.getCmp("mygrid");	var IfCancelRec=Ext.getCmp("IfCancelRec").getValue();	var parr = adm + "^" + StDate.value + "^" + StTime.value + "^" + Enddate.value + "^" + EndTime.value + "^"+"DHCNURXH_YTCRL" + "^" + IfCancelRec;	// debugger;	//alert(parr)	var a = cspRunServerMethod(GetQueryData.value, "web.DHCNurRecComm:GetCareRecComm", "parr$" + parr, "AddRec");	mygrid.store.loadData(REC);}function findStat(){  //查询出入液量合计    var adm=EpisodeID;	var StDate= Ext.getCmp("mygridstdate");	var StTime= Ext.getCmp("mygridsttime");	var Enddate= Ext.getCmp("mygridenddate");	var EndTime= Ext.getCmp("mygridendtime");	var GeInOutAmount=document.getElementById('GeInOutAmount');	var mygrid=Ext.getCmp("mygrid");	 	var a=cspRunServerMethod(GeInOutAmount.value,adm,StDate.value,StTime.value,Enddate.value,EndTime.value,"DHCNURXH_YTCRL");	if (a=="") { Ext.Msg.alert('提示', "无护理记录数据!"); return; }	//additm();	additmstat(Enddate.value,EndTime.value);	var tt=a.split('^');	//alert(tt)	mygrid.getSelectionModel().selectRow(mygrid.store.getCount()-1);   	var flag=0;	for (i=0;i<tt.length;i++)	{		itm=tt[i].split('|');				if ((itm[0]=="Item6")&&(flag=="1")) 		{}		else{		mygrid.getSelectionModel().getSelections()[0].set(itm[0],itm[1]); 		if (itm[0]=="Item6")		{flag=1}	  }	} //var curdate=diffDate(new Date(),0) var curdate=Enddate.value var curtime=EndTime.value //alert(curtime) //alert(curdate) var flag=0  //统计 var BlankDesc=tkMakeServerCall("Nur.DHCNurseRecSub","GetBlankDesc2",EpisodeID,curdate,curtime,flag) var tt=BlankDesc.split("^") var Item34=tt[0] var Item26=tt[1] var Item28=tt[2] var Item30=tt[3] var Item32=tt[4] var Item17=tt[5] var Item15=tt[6] mygrid.getSelectionModel().getSelections()[0].set("Item34",tt[0]);  mygrid.getSelectionModel().getSelections()[0].set("Item26",tt[1]);  mygrid.getSelectionModel().getSelections()[0].set("Item28",tt[2]);  mygrid.getSelectionModel().getSelections()[0].set("Item30",tt[3]);  mygrid.getSelectionModel().getSelections()[0].set("Item32",tt[4]);  mygrid.getSelectionModel().getSelections()[0].set("Item17",tt[5]);  mygrid.getSelectionModel().getSelections()[0].set("Item15",tt[6]); 	//alert(tt);}function additmstat(statenddate,statendtime){  	var Plant = Ext.data.Record.create([	{name:'CareDate'}, 	{name:'CareTime'},	{name:'Item1'},	{name:'Item2'},	{name:'Item3'},	{name:'Item4'},	{name:'Item5'},	{name:'Item6'},	{name:'Item7'},	{name:'Item8'},	{name:'Item9'}, 	{name:'Item10'},	{name:'Item11'},	{name:'Item12'},	{name:'Item13'},	{name:'Item14'},	{name:'Item15'},	{name:'Item16'},	{name:'Item17'}, 	{name:'Item18'},	{name:'Item19'}, 	{name:'Item20'},	{name:'Item21'},	{name:'Item22'},	{name:'Item23'},	{name:'Item24'},	{name:'Item25'},	{name:'Item26'},	{name:'Item27'},	{name:'Item28'},	{name:'Item29'},	{name:'Item30'},	{name:'Item31'},	{name:'Item32'},	{name:'Item33'},	{name:'Item34'},	{name:'Item35'},	{name:'Item36'},	{name:'Item37'},	{name:'Item38'},	{name:'Item39'},	{name:'Item40'},	{name:'Item41'},	{name:'Item42'},	{name:'Item43'},	{name:'Item44'},	{name:'Item45'},	{name:'Item46'},	{name:'Item47'}, 	{name:'Item48'},	{name:'Item49'},	{name:'Item50'},	{name:'CaseMeasure'},	{name:'User'},	{name:'rw'},	{name:'par'}      ]);    var count = grid.store.getCount();     var r = new Plant({CareDate:getDate(statenddate),CareTime:statendtime});     grid.store.commitChanges();     grid.store.insert(count,r);    return;}function setVal2(itm,val){	    if (val=="") return ;	   	var tt=val.split('!');		//alert(tt);	 	var cm=Ext.getCmp(itm);		person=new Array();		addperson(tt[1],tt[0]);		cm.store.loadData(person);		cm.setValue(tt[0]);		 } function setVal3(itm,val){	    if (val=="") return ;	   	var tt=val.split('!');		//alert(tt);	 	var cm=Ext.getCmp(itm);		opertion=new Array();		addopertion(tt[1],tt[0]);		cm.store.loadData(opertion);		cm.setValue(tt[0]);		 } function cmbkey(field, e){	if (e.getKey() ==Ext.EventObject.ENTER)	{		var pp=field.lastQuery;		getlistdata(pp,field);	//	alert(ret);			}}var person=new Array();function getlistdata(p,cmb){	var GetPerson =document.getElementById('GetPerson');	//debugger;    var ret=cspRunServerMethod(GetPerson.value,p);	if (ret!="")	{		var aa=ret.split('^');		for (i=0;i<aa.length;i++)		{			if (aa[i]=="" ) continue;			var it=aa[i].split('|');			addperson(it[1],it[0]);		}		//debugger;		cmb.store.loadData(person);	}}function addperson(a,b){	person.push(	{		desc:a,		id:b	}	);}function cmbkey1(field, e){	if (e.getKey() ==Ext.EventObject.ENTER)	{		var pp=field.lastQuery;		getoperlistdata(pp,field);	//	alert(ret);			}}var opertion=new Array();function getoperlistdata(p,cmb){	var GetPerson =document.getElementById('GetOper');	//debugger;    var ret=cspRunServerMethod(GetOper.value,p);	if (ret!="")	{		var aa=ret.split('^');		for (i=0;i<aa.length;i++)		{			if (aa[i]=="" ) continue;			var it=aa[i].split('|');			addopertion(it[1],it[0]);		}		//debugger;		cmb.store.loadData(opertion);	}}function addopertion(a,b){	opertion.push(	{		desc:a,		id:b	}	);}function btclose(){	window.close();}function cmbkey(field, e){	if (e.getKey() ==Ext.EventObject.ENTER)	{		var pp=field.lastQuery;		getlistdata(pp,field);	//	alert(ret);			}}var person=new Array();function getlistdata(p,cmb){	var GetPerson =document.getElementById('GetPerson');	//debugger;    var ret=cspRunServerMethod(GetPerson.value,p);	if (ret!="")	{		var aa=ret.split('^');		for (i=0;i<aa.length;i++)		{			if (aa[i]=="" ) continue;			var it=aa[i].split('|');			addperson(it[1],it[0]);		}		//debugger;		cmb.store.loadData(person);	}}function addperson(a,b){	person.push(	{		desc:a,		id:b	}	);}var REC=new Array();function AddRec(str){	//var a=new Object(eval(str));	//var obj = eval('(' + str + ')');	//arrgrid.push(obj);	//debugger; 	//alert(str);		//var a=new Object(eval(str));	var obj = eval('(' + str + ')');	obj.CareDate=getDate(obj.CareDate);	//obj.PregHPregDate=getDate(obj.PregHPregDate);	REC.push(obj);	//debugger;	}function setvalue(){	//alert(ExamId);	//alert(1);   var ha = new Hashtable();   var getid=document.getElementById('GetId');   var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID);   //alert(id);   if (id != "") {   	var getVal = document.getElementById('getVal');   	var ret = cspRunServerMethod(getVal.value, id);   	var tm = ret.split('^')    //alert(tm);		sethashvalue(ha, tm);							}			else {				getPatInfo();				return;				//var PatInfo = document.getElementById('PatInfo');				//if (PatInfo) {				//alert(12);					//var ret = cspRunServerMethod(PatInfo.value, EpisodeID, EmrCode);					//var tm = ret.split('^')					//sethashvalue(ha, tm)				}				// debugger;    	      	 var gform=Ext.getCmp("gform");     gform.items.each(eachItem, this);  	 //  alert(a);	for (var i=0 ; i<ht.keys().length;i++)//for...in statement get all of Array's index	{		var key = ht.keys()[i];		//restr += ht.items(key) + " " + ht.parent[key] + "<br/>";		if (key.indexOf("_") == -1) 		{			//alert(key);			var flag=ifflag(key );			if (flag==true)			{				if (ha.contains(key)) setVal2(key ,ha.items(key));				//debugger;				continue;			}   		var flag1=ifflag1(key );		 if (flag1==true)			{				if (ha.contains(key)) setVal3(key ,ha.items(key));				//debugger;				continue;			} 			var itm = Ext.getCmp(key);			if (ha.contains(key)) 			itm.setValue(getval(ha.items(key)));				    }else{			var aa=key.split('_');			if(ha.contains(aa[0]))			{			  setcheckvalue(key,ha.items(aa[0]));			} 		}    } }function getval(itm){	var tm=itm.split('!');//	alert(tm)	return tm[0];}function ifflag(itm){	var tm=ITypItm.split('|');	var flag=false;	for (var i=0;i<tm.length;i++)	{		if (itm==tm[i])		{			flag=true;		}	}	return flag ;} function ifflag1(itm){	var tm=ITypItm1.split('|');	var flag=false;	for (var i=0;i<tm.length;i++)	{		if (itm==tm[i])		{			flag=true;		}	}	return flag ;}function Save(){  ret="";  checkret="";  comboret="";  var SaveRec=document.getElementById('Save');  var gform=Ext.getCmp("gform");  gform.items.each(eachItem1, this);    //alert(EmrCode) //alert(ret+"&"+checkret+"&"+comboret);  //alert(checkret);   var getid=document.getElementById("GetId");   //alert(getid);  var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID); // alert(id) if (id==""){ var Id=cspRunServerMethod(SaveRec.value,"^EmrUser|"+session['LOGON.USERID']+"^EmrCode|"+EmrCode+"^"+ret+"^DetLocDr|"+session['LOGON.CTLOCID']+"^EpisodeId|"+EpisodeID+"&"+checkret+"&"+comboret,""); //alert("已保存");     } else	{	var Id=cspRunServerMethod(SaveRec.value,"^EmrUser|"+session['LOGON.USERID']+"^EmrCode|"+EmrCode+"^"+ret+"^DetLocDr|"+session['LOGON.CTLOCID']+"^EpisodeId|"+EpisodeID+"&"+checkret+"&"+comboret,id);	}// alert("已保存"); //alert(NurRecId);}function getPatInfo(){	//return ;	var PatInfo=document.getElementById('PatInfo');	//alert(PatInfo);	if (PatInfo) 	{		var ret=cspRunServerMethod(PatInfo.value,EpisodeID);		//alert(ret);	 	var tt=ret.split('^');	 	var patName = Ext.getCmp("Item6");	 	patName.setValue(getValueByCode(tt[4]));	 	//var sex = Ext.getCmp("Item4");	 //	sex.setValue(getValueByCode(tt[9]));	 //	var  regno= Ext.getCmp("Item6");	 	//regno.setValue(getValueByCode(tt[15]));	 //	var age = Ext.getCmp("Item5");	 	//age.setValue(getValueByCode(tt[6]));	 	var patLoc = Ext.getCmp("Item7");	 	patLoc.setValue(getValueByCode(tt[7]));	 	var bedCode = Ext.getCmp("Item8");	 	bedCode.setValue(getValueByCode(tt[5]));	 	 //	var diag = Ext.getCmp("Item9");	 //	diag.setValue(getValueByCode(tt[8]));	 //	var admdate = Ext.getCmp("Item7");	 //	admdate.setValue(getValueByCode(tt[10]));	 //	var admtime = Ext.getCmp("Item8");	 //	admtime.setValue(getValueByCode(tt[11]));		//alert("dd");	 	var MedCareNo = Ext.getCmp("Item11");	 	MedCareNo.setValue(getValueByCode(tt[9]));	}}function getValueByCode(tempStr){	var retStr=tempStr;	var strArr = tempStr.split("|");	if (strArr.length>1) 	{		retStr=strArr[1];	}	return retStr;}function tempeture(){    //var rowObj = grid1.getSelectionModel().getSelections();		//if (rowObj.length == 0) { Ext.Msg.alert('提示', "请先选择一条记录!"); return; }		//var Adm=rowObj[0].get("Adm"); 		TempShow(EpisodeID);}function printNurRec(){    //alert(23)		var GetPrnSet=document.getElementById('GetPrnSet');		var GetHead=document.getElementById('GetPatInfo');		var ret=cspRunServerMethod(GetHead.value,EpisodeID);		var hh=ret.split("^");		var getid=document.getElementById('GetId');    var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID);		//debugger;		var a=cspRunServerMethod(GetPrnSet.value,"DHCNURXH_YTCRL",EpisodeID); //page, caredattim, prnpos, adm,Typ,user		if (a=="") return;		var GetLableRec=document.getElementById('GetLableRec');		var LabHead=cspRunServerMethod(GetLableRec.value,"DHCNURXH_YTCRL^"+session['LOGON.CTLOCID']);		var tm=a.split("^");		var stdate="" //tm[2];		var stim="" //tm[3];		var edate="" //tm[4];		var etim="" //tm[5];		var StDate = Ext.getCmp("mygridstdate").value;	  var StTime = Ext.getCmp("mygridsttime").value;	  var tt2=StTime.split(":")	  var StTime2=tt2[0]+"&"+tt2[1]	   var Enddate = Ext.getCmp("mygridenddate").value;	   var EndTime = Ext.getCmp("mygridendtime").value;	   var tt3=EndTime.split(":")	   var EndTime2=tt3[0]+"&"+tt3[1]		//PrintComm.RHeadCaption=hh[1];		PrintComm.LHeadCaption=StDate+" "+StTime;		//PrintComm.RFootCaption="第";		PrintComm.LFootCaption=Enddate+" "+EndTime;		//PrintComm.LFootCaption=hh[2];		PrintComm.TitleStr=ret;		PrintComm.SetPreView("1");		PrintComm.PrnLoc=session['LOGON.CTLOCID'];		var aa=tm[1].split("&");		//PrintComm.stPage=aa[0];		//if (aa.length>1) PrintComm.stRow=aa[1];		PrintComm.stPage=0;		PrintComm.stRow=0;		PrintComm.previewPrint="1"; //是否弹出设置界面		//PrintComm.stprintpos=tm[0];		PrintComm.stprintpos=0;		//alert(PrintComm.Pages);		PrintComm.SetConnectStr(CacheDB);		PrintComm.WebUrl=WebIp+"/dthealth/web/DWR.DoctorRound.cls";		PrintComm.ItmName = "DHCNURMoudPRN_YTCRL"; //338155!2010-07-13!0:00!!		//debugger;		//var parr="DHCNURXH_YTCRL^"+EpisodeID;		//var parr=EpisodeID+"!"+""+"!"+""+"!"+""+"!"+""+"!DHCNURXH_YTCRL!";		var parr=EpisodeID+"!"+StDate+"!"+StTime2+"!"+Enddate+"!"+EndTime2+"!DHCNURXH_YTCRL!";		//alert(parr)		PrintComm.ID = "";		PrintComm.MultID = "";		var mth1="Nur.DHCMoudData:getVal&parr:"+id+"!";		PrintComm.MthArr=mth1;		//PrintComm.MthArr="web.DHCConsult:getConsultInfo&id:"+myid;		if(LabHead!="")PrintComm.LabHead=LabHead;		PrintComm.SetParrm(parr); // ="EpisodeId" ; //"p1:0^p2:"		PrintComm.PrintOut();		var SavePrnSet=document.getElementById('SavePrnSet');		//debugger;		var CareDateTim=PrintComm.CareDateTim;		if (CareDateTim=="") return ;		var pages=PrintComm.pages;   		var stRow=PrintComm.stRow;		//debugger;		var stprintpos=PrintComm.stPrintPos;		//alert(pages+","+CareDateTim+","+stprintpos+","+EpisodeID+","+"DHCNURXH_YTCRL"+","+session['LOGON.USERID']+","+PrintComm.PrnFlag);		//PrnFlag==1说明是打印预览		if (PrintComm.PrnFlag==1) return;		//如果原记录保存打印到第8页则当打印第8页之前页时不保存打印记录		if (pages<aa[0]) return;		//var a=cspRunServerMethod(SavePrnSet.value,pages,CareDateTim,stprintpos,EpisodeID,"DHCNURXH_YTCRL",session['LOGON.USERID']); //page, caredattim, prnpos, adm,Typ,user		//find();}function butPrintFn(){         Save()	        printNurRec();	        return;			PrintComm.RHeadCaption='dddd';			PrintComm.LHeadCaption="3333333";			var getid=document.getElementById('GetId');            var id=cspRunServerMethod(getid.value,EmrCode,EpisodeID);			//PrintComm.RFootCaption="第";			//PrintComm.LFootCaption="页";			//PrintComm.LFootCaption="88";			//alert(PrintComm.Pages);			PrintComm.SetConnectStr(CacheDB);			PrintComm.WebUrl=WebIp+"/dthealth/web/DWR.DoctorRound.cls";			PrintComm.ItmName = "DHCNurPrnMouldANHUI16";			//debugger;			//var parr="@"+EpisodeID+"@DHCNURHYD_Assessment@DHCNURHYD_DisSummary";						//var parr="@"+EpisodeID+"@DHCNURXH_YTCRL";			//PrintComm.MthArr="web.DHCNurMouldDataComm:GetPrnValComm&parr:"+parr;				        var mth1="Nur.DHCMoudData:getVal&parr:"+id+"!";	        var mth2="web.DHCMGtestpge:DHCNurOperComplexPrn&parr$"+EpisodeID+"!";			//var parr="@"+EpisodeID+"@DHCNURHYD_Assessment@DHCNURHYD_DisSummary";			//var parr="a@"+EpisodeID+"^b@DHCNURXHPGD";			PrintComm.MthArr=mth1+"|"+mth2;			//alert(PrintComm.MthArr);			//PrintComm.LabHead=LabHead;						//PrintComm.SetParrm(parr);			PrintComm.PrintOut();} function scoreFormat(value){if (value.indexOf("分")!="-1"){  var scorearry1=new Array();  scorearry1=value.split("(分"); value=scorearry1[0];   if (value.indexOf("  ")!="-1")  {    scorearry1=value.split("  ");   value=scorearry1[1];   }   if (value==null) {  value="0"; }}else{	if (value=="") value="0";}   return value;}function scoreAdd(obj){	 //var scorearry1=new Array(); 	 var scorehj=0; 	 var tmp=obj.getValue();	 tmp=scoreFormat(tmp); 	 if (tmp==null)	 {  	    tmp="0";		 	   }	 	 switch (obj.getName()) 	 {	 	case 'Item8':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;     case 'Item9':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;    case 'Item10':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;    case 'Item11':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;    case 'Item12':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;    case 'Item13':           scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));           break;     case 'Item14':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));            break;     case 'Item15':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item34").getValue()));            break;     case 'Item34':            scorehj=parseInt(tmp)+parseInt(scoreFormat(Ext.getCmp("Item9").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item10").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item11").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item12").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item13").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item14").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item8").getValue()))+parseInt(scoreFormat(Ext.getCmp("Item15").getValue()));            break; 	 } 	 var amtsum = Ext.getCmp("Item33"); 	 //tmp=parseInt(tmp)+parseInt(amtsum.getValue())	 	 amtsum.setValue(scorehj);  } function CancelRecord(){	var objCancelRecord=document.getElementById('CancelRecord');	var objRow=grid.getSelectionModel().getSelections();	if (objRow.length == 0) { Ext.Msg.alert('提示', "请先选择一条护理记录!"); return; }	else	{		Ext.Msg.show({    	       title:'再确认一下',    	       msg: '你确定要作废此条护理记录吗?',    	       buttons:{"ok":"确定","cancel":"取消"},	       fn:  function(btn, text){    	            if (btn == 'ok'){    					var par=objRow[0].get("par");					var rw=objRow[0].get("rw");					//alert(par+","+rw+","+session['LOGON.USERID']+","+session['LOGON.GROUPDESC']);					if (objCancelRecord) {						var a = cspRunServerMethod(objCancelRecord.value, par, rw, session['LOGON.USERID'], session['LOGON.GROUPDESC']);						if (a!=0){							alert(a);							return;						}else{							find();						}					}	            }    	        },    	       animEl: 'newbutton'   	    });	}}