document.body.onload = BodyLoadHandler;var LoopCount=1;var TemplatePath;var MRDiagnos;var InMedicare;var DiagnoseArray=new Array();var HospitalCode; var HospitalCode="ZGYDYY";//document.body.onunload = BodyUnLoadHandler;function PrintLineKeydownHandler(e) {	try {keycode=websys_getKey(e);} catch(e) {keycode=websys_getKey();}	if (keycode==13) return false;}/*var obj=document.getElementById('Find');if (obj) obj.onclick=Findclickhandler;function Findclickhandler() {	//alert(PatientID)	var obj=document.getElementById('PatRegNo');	var RegNo=""	if (obj) RegNo=obj.value 	var Str="http://173.116.11.32/hh_lis_new/Query/zl_query_record.aspx?t=2&p="+RegNo	newWindow=window.open(Str,"LabReports","top=100,right=100,height=600,width=1000")}*/function BodyLoadHandler() {	var obj=document.getElementById("PatientID");    if (obj) var PateintID=obj.value;    var obj=document.getElementById("EpisodeID");    if (obj) var EpisodeID=obj.value;    	if (PateintID==""){  	encmeth=document.getElementById("GetPateintIDMethod").value  	document.getElementById("PatientID").value=cspRunServerMethod(encmeth,EpisodeID).split('^')[0];  	var obj=document.getElementById("PatientID");	  if (obj) var PateintID=obj.value;	  document.getElementById("MRADMID").value=cspRunServerMethod(encmeth,EpisodeID).split('^')[1];  	}  	var MRADMID=document.getElementById("MRADMID").value  	if(MRADMID==""){	  	encmeth=document.getElementById("GetPateintIDMethod").value	  	document.getElementById("MRADMID").value=cspRunServerMethod(encmeth,EpisodeID).split('^')[1];	}	var obj=document.getElementById("EpisodeID");	if (obj) var EpisodeID=obj.value;	var obj=document.getElementById("Print");	if (obj) obj.onclick=PrintClickHandler;	var obj=document.getElementById("Printjc");	if (obj) obj.onclick=PrintjcClickHandler;	var obj=document.getElementById("Printzl");	if (obj) obj.onclick=PrintzlClickHandler;	var obj=document.getElementById("MRADMID");	if (obj) var MRADMID=obj.value;	//var obj=document.getElementById("LabEpisodeNo");	//if (obj) obj.onclick=LabEpisodeNoClick;	var GetPrescPath=document.getElementById("GetPrescPath");	if (GetPrescPath) {var encmeth=GetPrescPath.value} else {var encmeth=''};	if (encmeth!="") {		TemplatePath=cspRunServerMethod(encmeth);	}    var obj=document.getElementById("AllSelect");	if (obj){obj.onclick=SelectAllClickHandler;}	/*var GetHospital=document.getElementById("GetHospital");	if (GetHospital) {var encmeth=GetHospital.value} else {var encmeth=''};	if (encmeth!="") {		var HospitalStr=cspRunServerMethod(encmeth,"CurrentHospital");		HospitalCode=mPiece(HospitalStr,"^",0);	}*/	var GetMRDiagnosDesc=document.getElementById("GetMRDiagnos"); 	if (GetMRDiagnosDesc) {var encmeth=GetMRDiagnosDesc.value} else {var encmeth=''};	if (encmeth!="") {		MRDiagnos=cspRunServerMethod(encmeth,MRADMID,",");		//alert(cspRunServerMethod(encmeth,MRADMID,","))		/*var len=MRDiagnos.length;		var len1=0;		var startpos=0;		var endpos=0;		for (var j=0;j<len;j++) {			var char1=MRDiagnos.substring(j,j+1);			endpos=j+1;			if (CheckChinese(char1)) {len1=len1+2}else{len1=len1+1	}			if (len1>26) {				DiagnoseArray[DiagnoseArray.length]=MRDiagnos.substring(startpos,endpos);				startpos=endpos;				len1=0;			}		}		if (len1!=0) {DiagnoseArray[DiagnoseArray.length]=MRDiagnos.substring(startpos,endpos);}*/		}			var obj=document.getElementById("PatientID");	if (obj) var PatientID=obj.value;	var GetPatient=document.getElementById("GetPatient");	if (GetPatient) {var encmeth=GetPatient.value} else {var encmeth=''};	if (encmeth!="") {		var Patient=cspRunServerMethod(encmeth,PatientID);		var PatientName=mPiece(Patient,"^",2)		var PatientSex=mPiece(Patient,"^",3)		var PatientNo=mPiece(Patient,"^",1)		var obj=document.getElementById("PatientName");		if (obj) obj.value=PatientName;		var obj=document.getElementById("PatientSex");		if (obj) obj.value=PatientSex;		var obj=document.getElementById("PatientNo");		if (obj) obj.value=PatientNo;	}	    if (HospitalCode=="YKYZLYY"){		DHCP_GetXMLConfig("XMLObject","YKYZLYYOrderItemLabPrint");	} else if (HospitalCode=="HF"){		DHCP_GetXMLConfig("XMLObject","AHHFOrderItemLabPrint");	}else if (HospitalCode=="ZGYDYY"){		DHCP_GetXMLConfig("XMLObject","ZGYDYYOrderItemLabPrint");	}	else{		if (HospitalCode=="JST") InitalJST();		DHCP_GetXMLConfig("XMLObject","OrderItemLabPrint");	} 	document.onclick=OrderDetails;	}function SelectAllClickHandler(e){  var obj=document.getElementById("AllSelect");  var Objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');  var Rows=Objtbl.rows.length;  for (var i=1;i<Rows;i++){	var selobj=document.getElementById('Selectz'+i); 	if (!selobj.disabled)	{selobj.checked=obj.checked;}  	}}function OrderDetails(e){   	var src=websys_getSrcElement(e);	if (src.tagName == "A") return;	if (src.id.substring(0,7)=="Selectz")	{		var arry=src.id.split("z");		rowsel=arry[arry.length-1];		var obj=document.getElementById("Selectz"+rowsel);			if (obj) {			var LabEpisodeNo=GetColumnData("LabEpisodeNo",rowsel)			//alert(LabEpisodeNo);			ChangelLinkItemSelect(LabEpisodeNo,obj.checked);		}	}}function ChangelLinkItemSelect(SelectLabEpisodeNo,checked){    try{		var eTABLE=document.getElementById("tUDHCOrderItem_Lab_Print");		for (var i=1; i<eTABLE.rows.length; i++) {			var AddItemObj=document.getElementById("Selectz"+i);			var LabNo=GetColumnData("LabEpisodeNo",i)			//remove space char			var LabEpisodeNo= LabNo.replace(/[\t\n\r ]/g, "");			if (LabEpisodeNo=="") continue;			if (LabEpisodeNo!=SelectLabEpisodeNo) continue;			SetColumnData("Select",i,checked);					}    }catch(e){alert(e.message)}}function SetColumnData(ColName,Row,Val){	var CellObj=document.getElementById(ColName+"z"+Row);	if (CellObj){	  //alert(CellObj.id+"^"+CellObj.tagName);	  if (CellObj.tagName=='LABEL'){	  	CellObj.innerText=Val;	  }else{			if (CellObj.type=="checkbox"){				CellObj.checked=Val;			}else{				CellObj.value=Val;			}		}	}}function GetColumnData(ColName,Row){	var CellObj=document.getElementById(ColName+"z"+Row);	//alert(CellObj.id+"^"+CellObj.tagName+"^"+CellObj.value);	if (CellObj.tagName=='LABEL'){		return CellObj.innerText;	}else{		if (CellObj.type=="checkbox"){			return CellObj.checked;		}else{			return CellObj.value;}		}	return "";}function GetStrLength(str){	var len=str.length;	var len1=0;	for (var j=0;j<len;j++) {		var char1=str.substring(j,j+1);		if (CheckChinese(char1)) {len1=len1+2}else{len1=len1+1	}	}	//alert(len1);	return len1;}function CheckChinese(char1){	if(escape(char1).indexOf("%u")!=-1) return true;	return false;}	function PrintFun(PObj,inpara,inlist){	////DHCPrtComm.js	try{		var mystr="";		for (var i= 0; i<PrtAryData.length;i++){			mystr=mystr + PrtAryData[i];		}		inpara=DHCP_TextEncoder(inpara)		inlist=DHCP_TextEncoder(inlist)		var docobj=new ActiveXObject("MSXML2.DOMDocument.4.0");		docobj.async = false;    //close		var rtn=docobj.loadXML(mystr);		if ((rtn)){			////ToPrintDoc(ByVal inputdata As String, ByVal ListData As String, InDoc As MSXML2.DOMDocument40)						var rtn=PObj.ToPrintDocNew(inpara,inlist,docobj);			////var rtn=PObj.ToPrintDoc(myinstr,myList,docobj);		}	}catch(e){		alert(e.message);		return;	}}function ISPhamacyChangeHandler(){	var obj=document.getElementById("IsPhamacy");	if (obj) {		var IsPhamacy=obj.checked;		var objtbl=document.getElementById('tUDHCOrderItem_Print');		var rows=objtbl.rows.length;		var Row="1";		for (var j=1;j<rows;j++) {			//because come for query,rowid is show as "1,2,3.."			//if (j!=1) Row=Row+1;			Row=j			//Rowid:OrderName:StartDate:SeqNo:DoseQty:DoseUOM:Priority:Status:			//Frequence:Instruction:Duration:PackQty:RecDep:Billed"	        var Tbl_Select=document.getElementById("Selectz"+Row);	        var Tbl_OrderType=document.getElementById("OrderTypez"+Row);	        if ((Tbl_Select)&&(Tbl_OrderType)){		        if (IsPhamacy) {			        if (Tbl_OrderType.value=="R") {		        		Tbl_Select.checked=true;			        }else{				        Tbl_Select.checked=false;		        	}		        }else{		           Tbl_Select.checked=true;		        }	        }		}	}}function CleartTbl(){	var objtbl=document.getElementById('tUDHCOrderItem_Print');	var rows=objtbl.rows.length;	var lastrowindex=rows-1;	for (var j=1;j<lastrowindex;j++) {		objtbl.deleteRow(1);		//alert(j)	}}function FindOrderItems(EpisodeID,IsPhamacy) {	CleartTbl()	//alert(EpisodeID+"^"+PrescNo);	var GetOrderItems=document.getElementById('GetOrderItems');	if (GetOrderItems) {var encmeth=GetOrderItems.value;} else {var encmeth=''};	//alert(IsPhamacy);	if (encmeth!="") {		if (cspRunServerMethod(encmeth,'QueryDetail',EpisodeID,IsPhamacy)=='0') {			obj.className='';		}		LoopCount=1;	}}function QueryDetail(value) {	try {		if (value!=""){			var objtbl=document.getElementById('tUDHCOrderItem_Print');		var rows=objtbl.rows.length;		var LastRow=rows - 1;		        if (LoopCount!=1) AddRowToList(objtbl);        LoopCount=LoopCount+1;        		var eSrc=objtbl.rows[LastRow];		var RowObj=getRow(eSrc);		var rowitems=RowObj.all;		if (!rowitems) rowitems=RowObj.getElementsByTagName("label");		//alert(rowitems.length);		for (var j=0;j<rowitems.length;j++) {			if (rowitems[j].id) {				var Id=rowitems[j].id;				var arrId=Id.split("z");				var Row=arrId[arrId.length-1];			}		}		//DHCWebD_AddTabRow(objtbl);		//alert(Row);		var Split_Value=value.split("^")		//Rowid:OrderName:StartDate:SeqNo:DoseQty:DoseUOM:Priority:Status:		//Frequence:Instruction:Duration:PackQty:RecDep:Billed"		var Tbl_Rowid=document.getElementById("Rowidz"+Row);		var Tbl_OrderName=document.getElementById("OrderNamez"+Row);		var Tbl_StartDat=document.getElementById("StartDatez"+Row);		var Tbl_SeqNo=document.getElementById("SeqNoz"+Row);		var Tbl_DoseQty=document.getElementById("DoseQtyz"+Row);		var Tbl_DoseUOM=document.getElementById("DoseUOMz"+Row);		var Tbl_Priority=document.getElementById("Priorityz"+Row);		var Tbl_Status=document.getElementById("Statusz"+Row);		var Tbl_Frequence=document.getElementById("Frequencez"+Row);		var Tbl_Instruction=document.getElementById("Instructionz"+Row);		var Tbl_Duration=document.getElementById("Durationz"+Row);		var Tbl_PackQty=document.getElementById("PackQtyz"+Row);		var Tbl_PackUOM=document.getElementById("PackUOMz"+Row);		var Tbl_RecDep=document.getElementById("RecDepz"+Row);		var Tbl_Price=document.getElementById("Pricez"+Row);		var Tbl_Sum=document.getElementById("Sumz"+Row);		var Tbl_Billed=document.getElementById("Billedz"+Row);        var Tbl_Select=document.getElementById("Selectz"+Row);        var Tbl_BillType=document.getElementById("BillTypez"+Row);        var Tbl_OrderType=document.getElementById("OrderTypez"+Row);   	 	Tbl_Rowid.innerText=unescape(Split_Value[0]);    	Tbl_OrderName.innerText=unescape(Split_Value[1]);    	Tbl_StartDat.innerText=unescape(Split_Value[2]);    	Tbl_SeqNo.innerText=unescape(Split_Value[3]);    	Tbl_DoseQty.innerText=unescape(Split_Value[4]);    	Tbl_DoseUOM.innerText=unescape(Split_Value[5]);    	Tbl_Priority.innerText=unescape(Split_Value[6]);    	Tbl_Status.innerText=unescape(Split_Value[7]);   		Tbl_Frequence.innerText=unescape(Split_Value[8]);   		Tbl_Instruction.innerText=unescape(Split_Value[9]);   		Tbl_Duration.innerText=unescape(Split_Value[10]);   		Tbl_PackQty.innerText=unescape(Split_Value[11]);   		Tbl_PackUOM.innerText=unescape(Split_Value[12]);   		Tbl_Price.innerText=unescape(Split_Value[13]);   		Tbl_Sum.innerText=unescape(Split_Value[14]);   		Tbl_RecDep.innerText=unescape(Split_Value[15]);   		Tbl_Billed.innerText=unescape(Split_Value[16]);   		Tbl_BillType.innerText=unescape(Split_Value[17]);   		Tbl_OrderType.innerText=unescape(Split_Value[17]);        Tbl_Select.checked=true;		//AddRowToList(objtbl);		}	} catch(e) {};}function AddRowToList(objtbl) {	var row=objtbl.rows.length;	var objlastrow=objtbl.rows[row-1];	//make sure objtbl is the tbody element	objtbl=tk_getTBody(objlastrow);	//objtbl=websys_getParentElement(objlastrow);	var objnewrow=objlastrow.cloneNode(true);	var rowitems=objnewrow.all; //IE only	if (!rowitems) rowitems=objnewrow.getElementsByTagName("*"); //N6	for (var j=0;j<rowitems.length;j++) {		if (rowitems[j].id) {			var Id=rowitems[j].id;			var arrId=Id.split("z");			arrId[arrId.length-1]=arrId[arrId.length-1]+1;			rowitems[j].id=arrId.join("z");			rowitems[j].name=arrId.join("z");			rowitems[j].value="";			//rowitems[j].innerText="";		}	}	objnewrow=objtbl.appendChild(objnewrow);	{if ((objnewrow.rowIndex)%2==0) {objnewrow.className="RowEven";} else {objnewrow.className="RowOdd";}}}function DHCWebD_AddTabRow(objtbl){	DHCWebD_ResetRowItems(objtbl);	var row=objtbl.rows.length;	var objlastrow=objtbl.rows[row-1];	//make sure objtbl is the tbody element	objtbl=websys_getParentElement(objlastrow);	var objnewrow=objlastrow.cloneNode(true);	var rowitems=objnewrow.all; //IE only	if (!rowitems) rowitems=objnewrow.getElementsByTagName("*"); //N6	for (var j=0;j<rowitems.length;j++) {		if (rowitems[j].id) {			var Id=rowitems[j].id;			var arrId=Id.split("z");			arrId[arrId.length-1]=row;			rowitems[j].id=arrId.join("z");			rowitems[j].name=arrId.join("z");			rowitems[j].value="";		}	}	objnewrow=objtbl.appendChild(objnewrow);	{if ((objnewrow.rowIndex)%2==0) {objnewrow.className="RowEven";} else {objnewrow.className="RowOdd";}}		//DHCWebD_ResetRowItems(objtbl);}function DHCWebD_ResetRowItems(objtbl) {	//alert(objtbl.rows.length);	//check the header by z; zhaocz;	var firstrow=objtbl.rows[0];	var firstitems=firstrow.all;	if (!firstitems) firstitems=objrow.getElementsByTagName("*"); //N6	var myaryid=firstitems[1].id.split("z");	if (myaryid.length==2){		//no header			fIdx=0		}else{			fIdx=1		}	for (var i=fIdx;i<objtbl.rows.length; i++) {		var objrow=objtbl.rows[i];		{if ((i+1)%2==0) {objrow.className="RowEven";} else {objrow.className="RowOdd";}}		var rowitems=objrow.all; //IE only		if (!rowitems) rowitems=objrow.getElementsByTagName("*"); //N6		for (var j=0;j<rowitems.length;j++) {			//alert(i+":"+j+":"+rowitems[j].type);			if (rowitems[j].id) {				var arrId=rowitems[j].id.split("z");				arrId[arrId.length-1]=i;				rowitems[j].id=arrId.join("z");				rowitems[j].name=arrId.join("z");			}		}	}}function PrintClickHandler(){	try {	    if (HospitalCode=="HF"){	      PrintAHHFOld();	    }	    if (HospitalCode=="JST"){	      PrintJST();	    }	    if (HospitalCode=="BJZYY"){	      PrintBJZYY();	    }	    if (HospitalCode=="YKYZLYY"){	      PrintYKYZLYY();	    }	    if (HospitalCode=="ZGYDYY"){	      PrintZGYDYY();	    }	} catch(e) {};}function PrintjcClickHandler(){	try {        if (HospitalCode=="HF"){	        PrintAHHFjc();	        //PrintAHHF();	        return;         }	} catch(e) {};}function PrintzlClickHandler(){	try {        if (HospitalCode=="HF"){	        PrintAHHFzl();	        //PrintAHHF();	        return;         }	} catch(e) {};}function PrintAHHFjc(){	try {	    var obj=document.getElementById("PatientNo");	    if (obj) var PatientNo=obj.value;	    var obj=document.getElementById("EpisodeID");	    if (obj) var EpisodeID=obj.value;	    var obj=document.getElementById("PatientName");	    if (obj) var PatientName=obj.value;	    var obj=document.getElementById("PatientAge");	    if (obj) var PatientAge=obj.value;	    var obj=document.getElementById("PatientSex");	    if (obj) var PatientSex=obj.value;	    var obj=document.getElementById("PatientCompany");	    if (obj) var PatientCompany=obj.value;	    var obj=document.getElementById("AdmDep");	    if (obj) var AdmDep=obj.value;	    var AdmDepDesc=mPiece(AdmDep,"-",1);	    if (!AdmDepDesc) AdmDepDesc=AdmDep;	    var obj=document.getElementById("AdmDate");	    if (obj) var AdmDate=obj.value;	    var mystr="00000000";	    mystr=mystr.substring(0,8-PatientNo.length);    	PatientNo=mystr+PatientNo;		var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;		var Rowid,OrderName,StartDate,Status,Spec,UserAddName;		var PackQty,RecDep,Billed,Price,Sum,BillType,Select,LabEpisodeNo;	    var MyList="";	    var Row="1";	    var RecDepArray=new Array()		for (var j=1;j<rows;j++) {			Row=j;			var Tbl_Select=document.getElementById("Selectz"+Row);			Select=Tbl_Select.checked;			var Tbl_OecCat=document.getElementById("OecCatz"+Row);			OecCat=Tbl_OecCat.innerText;			if ((Select==true)&(OecCat==29)){					var Tbl_RecDep=document.getElementById("RecDepz"+Row);		    	if (Tbl_RecDep) RecDep=Tbl_RecDep.innerText;				if (RecDep==""){RecDep=AdmDepDesc;}		    	var findRecDep=false;		    	for (var i=0;i<RecDepArray.length;i++) {			    	if (RecDepArray[i]==RecDep){				    	//alert("find");				    	findRecDep=true;				    	break;			    	}		    	}	    		if (findRecDep==false){			    	RecDepArray[RecDepArray.length]=RecDep;		    	}			}		}	    for (var i=0;i<RecDepArray.length;i++) {		    var MyList="";			//var MyPara="";		    //MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"";			for (var j=1;j<rows;j++) {				Row=j;			    var Tbl_OecCat=document.getElementById("OecCatz"+Row);			    OecCat=Tbl_OecCat.innerText;				  var Tbl_RecDep=document.getElementById("RecDepz"+Row);		   		  if (Tbl_RecDep){					RecDepDesc=Tbl_RecDep.innerText;			    	if (RecDepDesc==""){RecDepDesc=AdmDepDesc;}			      }			    if ((RecDepDesc==RecDepArray[i])&(OecCat==29)){			        var Tbl_Select=document.getElementById("Selectz"+Row);					var Tbl_Rowid=document.getElementById("Rowidz"+Row);					var Tbl_OrderName=document.getElementById("OrderNamez"+Row);					var Tbl_StartDat=document.getElementById("StartDatez"+Row);					var Tbl_Status=document.getElementById("Statusz"+Row);					var Tbl_PackQty=document.getElementById("PackQtyz"+Row);					var Tbl_PackUOM=document.getElementById("PackUOMz"+Row);					var Tbl_Price=document.getElementById("Pricez"+Row);					var Tbl_Sum=document.getElementById("Sumz"+Row);					var Tbl_Billed=document.getElementById("Billedz"+Row);					var Tbl_BillType=document.getElementById("BillTypez"+Row);			    var Tbl_Spec=document.getElementById("Specz"+Row);			    var Tbl_UserAddName=document.getElementById("UserAddNamez"+Row);			    var Tbl_LabEpisodeNo=document.getElementById("LabEpisodeNoz"+Row);			    var Tbl_Location=document.getElementById("Locationz"+Row);			    var Tbl_DocNotes=document.getElementById("OrderNotesz"+Row);			    //if (Tbl_ordercat) ordercat=Tbl_ordercat.innerText;			      if (Tbl_Location) Location=Tbl_Location.innerText;			      if (Tbl_DocNotes) DocNotes=Tbl_DocNotes.innerText;			    	if (Tbl_OrderName) OrderName=Tbl_OrderName.innerText;			    	if (Tbl_StartDat) StartDate=Tbl_StartDat.innerText;			    	if (Tbl_Status) Status=Tbl_Status.innerText;			   		if (Tbl_PackQty) PackQty=Tbl_PackQty.innerText;			   		if (Tbl_PackUOM) PackUOM=Tbl_PackUOM.innerText;			   		if (Tbl_Price) Price=Tbl_Price.innerText;			        			   		var Price1=parseFloat(Price);			   		Price=Price1.toFixed(2);			   		if (Tbl_Sum) Sum=Tbl_Sum.innerText;			   		var Sum1=parseFloat(Sum);			   		Sum=Sum1.toFixed(2);			   		if (Tbl_Billed) Billed=Tbl_Billed.innerText;			   		if (Tbl_BillType) BillType=Tbl_BillType.innerText;			   		if (Tbl_Spec) Spec=Tbl_Spec.innerText;			   		if (Tbl_UserAddName) UserAddName=Tbl_UserAddName.innerText;					//if (Tbl_LabEpisodeNo) LabEpisodeNo=Tbl_LabEpisodeNo.innerText;					LabEpisodeNo="";					var Other=Spec+""+DocNotes;   //lgl++"\n"+DocNotes								        Select=Tbl_Select.checked;					if (Select==true){					    if (MyList=="") {						    //MyList = OrderName+"^"+LabEpisodeNo+"^"+Spec+"^"+RecDepDesc+"^"+Price;						    MyList = OrderName+"^"+Other+"^"+PackQty+"^"+Price+"^"+Sum;					    }else{				    	    MyList = MyList + String.fromCharCode(2)+OrderName+"^"+Other+"^"+PackQty+"^"+Price+"^"+Sum;;						}					}			    }			}			var MyPara="";		   MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"安徽省立医院检查提示单";		   MyPara=MyPara+"^OrderNameCaption"+String.fromCharCode(2)+"医嘱";		   MyPara=MyPara+"^SampleCaption"+String.fromCharCode(2)+"备注";		   MyPara=MyPara+"^Remark1"+String.fromCharCode(2)+"科室位置:"+Location;		   MyPara=MyPara+"^AdmDocCaption"+String.fromCharCode(2)+"医嘱医师:";		   MyPara=MyPara+"^AdmDateCaption"+String.fromCharCode(2)+"医嘱日期:";		   //alert(MyPara);AdmDocCaption  AdmDateCaption		   MyPara=MyPara+"^Remark2"+String.fromCharCode(2)+" ";		   MyPara=MyPara+"^Remark3"+String.fromCharCode(2)+" ";		    MyPara=MyPara+"^PANo"+String.fromCharCode(2)+PatientNo;		    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;		    MyPara=MyPara+"^AdmDate"+String.fromCharCode(2)+AdmDate;		    MyPara=MyPara+"^Name"+String.fromCharCode(2)+PatientName;		    MyPara=MyPara+"^Sex"+String.fromCharCode(2)+PatientSex;		    MyPara=MyPara+"^Age"+String.fromCharCode(2)+PatientAge;		    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;		    MyPara=MyPara+"^AdmDoc"+String.fromCharCode(2)+UserAddName;		    MyPara=MyPara+"^Diagnose"+String.fromCharCode(2)+MRDiagnos;		    MyPara=MyPara+"^RecLoc1"+String.fromCharCode(2)+RecDepArray[i];  //RecDepDesc;  lgl xiugai取接受科室			var myobj=document.getElementById("ClsBillPrint");			PrintFun(myobj,MyPara,MyList);		}		} catch(e) {};}function PrintAHHFzl(){  //包括处置治疗25?护理24?因为很多的处置治疗被归到了护理大类	try {	    var obj=document.getElementById("PatientNo");	    if (obj) var PatientNo=obj.value;	    var obj=document.getElementById("EpisodeID");	    if (obj) var EpisodeID=obj.value;	    var obj=document.getElementById("PatientName");	    if (obj) var PatientName=obj.value;	    var obj=document.getElementById("PatientAge");	    if (obj) var PatientAge=obj.value;	    var obj=document.getElementById("PatientSex");	    if (obj) var PatientSex=obj.value;	    var obj=document.getElementById("PatientCompany");	    if (obj) var PatientCompany=obj.value;	    var obj=document.getElementById("AdmDep");	    if (obj) var AdmDep=obj.value;	    var AdmDepDesc=mPiece(AdmDep,"-",1);	    if (!AdmDepDesc) AdmDepDesc=AdmDep;	    var obj=document.getElementById("AdmDate");	    if (obj) var AdmDate=obj.value;	    var mystr="00000000";	    mystr=mystr.substring(0,8-PatientNo.length);    	PatientNo=mystr+PatientNo;		var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;		var Rowid,OrderName,StartDate,Status,Spec,UserAddName;		var PackQty,RecDep,Billed,Price,Sum,BillType,Select,LabEpisodeNo;	    var MyList="";	    var Row="1";	    var RecDepArray=new Array()		for (var j=1;j<rows;j++) {			Row=j;			var Tbl_Select=document.getElementById("Selectz"+Row);			Select=Tbl_Select.checked;			var Tbl_OecCat=document.getElementById("OecCatz"+Row);			OecCat=Tbl_OecCat.innerText;						if ((Select==true)&((OecCat==24)|(OecCat==25)|(OecCat==41)|(OecCat==26))){	         //alert(OecCat);				var Tbl_RecDep=document.getElementById("RecDepz"+Row);		    	if (Tbl_RecDep) RecDep=Tbl_RecDep.innerText;				if (RecDep==""){RecDep=AdmDepDesc;}		    	var findRecDep=false;		    	for (var i=0;i<RecDepArray.length;i++) {			    	if (RecDepArray[i]==RecDep){				    	//alert("find");				    	findRecDep=true;				    	break;			    	}		    	}	    		if (findRecDep==false){			    	RecDepArray[RecDepArray.length]=RecDep;		    	}			}		}		//alert(RecDepArray.length);	    for (var i=0;i<RecDepArray.length;i++) {		    var MyList="";			//var MyPara="";		    //MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"";			for (var j=1;j<rows;j++) {				Row=j;			    var Tbl_OecCat=document.getElementById("OecCatz"+Row);			    OecCat=Tbl_OecCat.innerText;			   // alert(OecCat);				  var Tbl_RecDep=document.getElementById("RecDepz"+Row);		   		  if (Tbl_RecDep){					RecDepDesc=Tbl_RecDep.innerText;			    	if (RecDepDesc==""){RecDepDesc=AdmDepDesc;}			      }			    if ((RecDepDesc==RecDepArray[i])&((OecCat==24)|(OecCat==25)|(OecCat==41)|(OecCat==26))){			        var Tbl_Select=document.getElementById("Selectz"+Row);					var Tbl_Rowid=document.getElementById("Rowidz"+Row);					var Tbl_OrderName=document.getElementById("OrderNamez"+Row);					var Tbl_StartDat=document.getElementById("StartDatez"+Row);					var Tbl_Status=document.getElementById("Statusz"+Row);					var Tbl_PackQty=document.getElementById("PackQtyz"+Row);					var Tbl_PackUOM=document.getElementById("PackUOMz"+Row);					var Tbl_Price=document.getElementById("Pricez"+Row);					var Tbl_Sum=document.getElementById("Sumz"+Row);					var Tbl_Billed=document.getElementById("Billedz"+Row);					var Tbl_BillType=document.getElementById("BillTypez"+Row);			        var Tbl_Spec=document.getElementById("Specz"+Row);			        var Tbl_UserAddName=document.getElementById("UserAddNamez"+Row);			        var Tbl_LabEpisodeNo=document.getElementById("LabEpisodeNoz"+Row);			        var Tbl_Location=document.getElementById("Locationz"+Row);			        var Tbl_DocNotes=document.getElementById("OrderNotesz"+Row);			        //if (Tbl_ordercat) ordercat=Tbl_ordercat.innerText;			        if (Tbl_Location) Location=Tbl_Location.innerText;			        if (Tbl_DocNotes) DocNotes=Tbl_DocNotes.innerText;			    	if (Tbl_OrderName) OrderName=Tbl_OrderName.innerText;			    	if (Tbl_StartDat) StartDate=Tbl_StartDat.innerText;			    	if (Tbl_Status) Status=Tbl_Status.innerText;			   		if (Tbl_PackQty) PackQty=Tbl_PackQty.innerText;			   		if (Tbl_PackUOM) PackUOM=Tbl_PackUOM.innerText;			   		if (Tbl_Price) Price=Tbl_Price.innerText;			        			   		var Price1=parseFloat(Price);			   		Price=Price1.toFixed(2);			   		if (Tbl_Sum) Sum=Tbl_Sum.innerText;			   		var Sum1=parseFloat(Sum);			   		Sum=Sum1.toFixed(2);			   		if (Tbl_Billed) Billed=Tbl_Billed.innerText;			   		if (Tbl_BillType) BillType=Tbl_BillType.innerText;			   		if (Tbl_Spec) Spec=Tbl_Spec.innerText;			   		if (Tbl_UserAddName) UserAddName=Tbl_UserAddName.innerText;					//因为合肥买来的试管上已经有个预制条码?所以原来的标本号不用了					//if (Tbl_LabEpisodeNo) LabEpisodeNo=Tbl_LabEpisodeNo.innerText;					LabEpisodeNo="";					var Other=Spec+""+DocNotes;   //lgl++"\n"+DocNotes								        Select=Tbl_Select.checked;			        			        Price="";			        Sum="";					if (Select==true){					    if (MyList=="") {						    //MyList = OrderName+"^"+LabEpisodeNo+"^"+Spec+"^"+RecDepDesc+"^"+Price;						    MyList = OrderName+"^"+Other+"^"+PackQty+"^"+Price+"^"+Sum;					    }else{				    	    MyList = MyList + String.fromCharCode(2)+OrderName+"^"+Other+"^"+PackQty+"^"+Price+"^"+Sum;;						}					}			    }			}			var MyPara="";		   MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"安徽省立医院治疗提示单";		   MyPara=MyPara+"^OrderNameCaption"+String.fromCharCode(2)+"医嘱";		   MyPara=MyPara+"^SampleCaption"+String.fromCharCode(2)+"备注";		   MyPara=MyPara+"^Remark1"+String.fromCharCode(2)+"科室位置:"+Location;		   MyPara=MyPara+"^AdmDocCaption"+String.fromCharCode(2)+"医嘱医师:";		   MyPara=MyPara+"^AdmDateCaption"+String.fromCharCode(2)+"医嘱日期:";		   //alert(MyPara);AdmDocCaption  AdmDateCaption		   //MyPara=MyPara+"^Remark2"+String.fromCharCode(2)+"注意事项2";		   //MyPara=MyPara+"^Remark3"+String.fromCharCode(2)+"注意事项3";		   //MyPara=MyPara+"^Remark4"+String.fromCharCode(2)+"注意事项4";		   MyPara=MyPara+"^Remark2"+String.fromCharCode(2)+" ";		   MyPara=MyPara+"^Remark3"+String.fromCharCode(2)+" ";		   MyPara=MyPara+"^Remark4"+String.fromCharCode(2)+" ";		    MyPara=MyPara+"^PANo"+String.fromCharCode(2)+PatientNo;		    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;		    MyPara=MyPara+"^AdmDate"+String.fromCharCode(2)+AdmDate;		    MyPara=MyPara+"^Name"+String.fromCharCode(2)+PatientName;		    MyPara=MyPara+"^Sex"+String.fromCharCode(2)+PatientSex;		    MyPara=MyPara+"^Age"+String.fromCharCode(2)+PatientAge;		    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;		    MyPara=MyPara+"^AdmDoc"+String.fromCharCode(2)+UserAddName;		    MyPara=MyPara+"^Diagnose"+String.fromCharCode(2)+MRDiagnos;		    MyPara=MyPara+"^RecLoc1"+String.fromCharCode(2)+RecDepArray[i];  //RecDepDesc;  lgl xiugai取接受科室						var myobj=document.getElementById("ClsBillPrint");			PrintFun(myobj,MyPara,MyList);		}		} catch(e) {};}function PrintAHHFOld(){	try {	    var obj=document.getElementById("PatientNo");	    if (obj) var PatientNo=obj.value;	    var obj=document.getElementById("EpisodeID");	    if (obj) var EpisodeID=obj.value;	    var obj=document.getElementById("PatientName");	    if (obj) var PatientName=obj.value;	    var obj=document.getElementById("PatientAge");	    if (obj) var PatientAge=obj.value;	    var obj=document.getElementById("PatientSex");	    if (obj) var PatientSex=obj.value;	    var obj=document.getElementById("PatientCompany");	    if (obj) var PatientCompany=obj.value;	    var obj=document.getElementById("AdmDep");	    if (obj) var AdmDep=obj.value;	    var AdmDepDesc=mPiece(AdmDep,"-",1);	    if (!AdmDepDesc) AdmDepDesc=AdmDep;	    var obj=document.getElementById("AdmDate");	    if (obj) var AdmDate=obj.value;	    var mystr="00000000";	    mystr=mystr.substring(0,8-PatientNo.length);    	PatientNo=mystr+PatientNo;		var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;		var Rowid,OrderName,StartDate,Status,Spec,UserAddName;		var PackQty,RecDep,Billed,Price,Sum,BillType,Select,LabEpisodeNo;	    var MyList="";	    var Row="1";	    var RecDepArray=new Array()		for (var j=1;j<rows;j++) {			Row=j;			var Tbl_Select=document.getElementById("Selectz"+Row);			Select=Tbl_Select.checked;			var Tbl_OecCat=document.getElementById("OecCatz"+Row);			OecCat=Tbl_OecCat.innerText;			if ((Select==true)&(OecCat==30)){				var Tbl_RecDep=document.getElementById("RecDepz"+Row);		    	if (Tbl_RecDep) RecDep=Tbl_RecDep.innerText;				if (RecDep==""){RecDep=AdmDepDesc;}				var Tbl_LabEpisodeNo=document.getElementById("LabEpisodeNoz"+Row);				LabEpisodeNo=Tbl_LabEpisodeNo.innerText;		    	var RecDepLabEpisode=RecDep+"^"+LabEpisodeNo;		    	var findRecDep=false;		    	for (var i=0;i<RecDepArray.length;i++) {			    	if (RecDepArray[i]==RecDepLabEpisode){				    	findRecDep=true;				    	break;			    	}		    	}	    		if (findRecDep==false){			    	RecDepArray[RecDepArray.length]=RecDepLabEpisode;		    	}			}		}	    for (var i=0;i<RecDepArray.length;i++) {		    var MyList="";			for (var j=1;j<rows;j++) {				Row=j;				var Tbl_RecDep=document.getElementById("RecDepz"+Row);		   		if (Tbl_RecDep) {					RecDepDesc=Tbl_RecDep.innerText;			    	if (RecDepDesc==""){RecDepDesc=AdmDepDesc;}			    }				var Tbl_LabEpisodeNo=document.getElementById("LabEpisodeNoz"+Row);				LabEpisodeNo=Tbl_LabEpisodeNo.innerText;			    var Tbl_OecCat=document.getElementById("OecCatz"+Row);			    OecCat=Tbl_OecCat.innerText;                RecDepLabEpisode=RecDepDesc+"^"+LabEpisodeNo;			    //if ((RecDepDesc==RecDepArray[i])&(OecCat==30)){				if ((RecDepLabEpisode==RecDepArray[i])&(OecCat==30)){			        var Tbl_Select=document.getElementById("Selectz"+Row);					var Tbl_Rowid=document.getElementById("Rowidz"+Row);					var Tbl_OrderName=document.getElementById("OrderNamez"+Row);					var Tbl_StartDat=document.getElementById("StartDatez"+Row);					var Tbl_Status=document.getElementById("Statusz"+Row);					var Tbl_PackQty=document.getElementById("PackQtyz"+Row);					var Tbl_PackUOM=document.getElementById("PackUOMz"+Row);					var Tbl_Price=document.getElementById("Pricez"+Row);					var Tbl_Sum=document.getElementById("Sumz"+Row);					var Tbl_Billed=document.getElementById("Billedz"+Row);					var Tbl_BillType=document.getElementById("BillTypez"+Row);			        var Tbl_Spec=document.getElementById("Specz"+Row);			        var Tbl_UserAddName=document.getElementById("UserAddNamez"+Row);			        var Tbl_LabEpisodeNo=document.getElementById("LabEpisodeNoz"+Row);			        			    	if (Tbl_OrderName) OrderName=Tbl_OrderName.innerText;			    	if (Tbl_StartDat) StartDate=Tbl_StartDat.innerText;			    	if (Tbl_Status) Status=Tbl_Status.innerText;			   		if (Tbl_PackQty) PackQty=Tbl_PackQty.innerText;			   		if (Tbl_PackUOM) PackUOM=Tbl_PackUOM.innerText;			   		if (Tbl_Price) Price=Tbl_Price.innerText;			  			   		var Price1=parseFloat(Price);			   		Price=Price1.toFixed(2);			   		if (Tbl_Sum) Sum=Tbl_Sum.innerText;			   		var Sum1=parseFloat(Sum);			   		Sum=Sum1.toFixed(2);			   		if (Tbl_Billed) Billed=Tbl_Billed.innerText;			   		if (Tbl_BillType) BillType=Tbl_BillType.innerText;			   		if (Tbl_Spec) Spec=Tbl_Spec.innerText;			   		if (Tbl_UserAddName) UserAddName=Tbl_UserAddName.innerText;					//因为合肥买来的试管上已经有个预制条码?所以原来的标本号不用了					//if (Tbl_LabEpisodeNo) LabEpisodeNo=Tbl_LabEpisodeNo.innerText;					LabEpisodeNo="";			        Select=Tbl_Select.checked;					if (Select==true){					    if (MyList=="") {						    //MyList = OrderName+"^"+LabEpisodeNo+"^"+Spec+"^"+RecDepDesc+"^"+Price;						    MyList = OrderName+"^"+Spec+"^"+PackQty+"^"+Price+"^"+Sum;					    }else{				    	    MyList = MyList + String.fromCharCode(2)+OrderName+"^"+Spec+"^"+PackQty+"^"+Price+"^"+Sum;;						}					}			    }			}		    var MyPara="";			MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"";		    MyPara=MyPara+"^PANo"+String.fromCharCode(2)+PatientNo;		    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;		    MyPara=MyPara+"^AdmDate"+String.fromCharCode(2)+AdmDate;		    MyPara=MyPara+"^Name"+String.fromCharCode(2)+PatientName;		    MyPara=MyPara+"^Sex"+String.fromCharCode(2)+PatientSex;		    MyPara=MyPara+"^Age"+String.fromCharCode(2)+PatientAge;		    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;		    MyPara=MyPara+"^AdmDoc"+String.fromCharCode(2)+UserAddName;		    MyPara=MyPara+"^Diagnose"+String.fromCharCode(2)+MRDiagnos;		    MyPara=MyPara+"^RecLoc1"+String.fromCharCode(2)+mPiece(RecDepArray[i],"^",0);  //RecDepDesc;		    //MyPara=MyPara+"^RecLoc1"+String.fromCharCode(2)+RecDepArray[i];  //RecDepDesc;			var myobj=document.getElementById("ClsBillPrint");			PrintFun(myobj,MyPara,MyList);		}		} catch(e) {};}function PrintAHHFOld2(){   //如下?一个打印按钮区分两种单据?不影响原检验单	try {	    var obj=document.getElementById("PatientNo");	    if (obj) var PatientNo=obj.value;	    var obj=document.getElementById("EpisodeID");	    if (obj) var EpisodeID=obj.value;	    var obj=document.getElementById("PatientName");	    if (obj) var PatientName=obj.value;	    var obj=document.getElementById("PatientAge");	    if (obj) var PatientAge=obj.value;	    var obj=document.getElementById("PatientSex");	    if (obj) var PatientSex=obj.value;	    var obj=document.getElementById("PatientCompany");	    if (obj) var PatientCompany=obj.value;	    var obj=document.getElementById("AdmDep");	    if (obj) var AdmDep=obj.value;	    var AdmDepDesc=mPiece(AdmDep,"-",1);	    if (!AdmDepDesc) AdmDepDesc=AdmDep;	    var obj=document.getElementById("AdmDate");	    if (obj) var AdmDate=obj.value;	    var mystr="00000000";	    mystr=mystr.substring(0,8-PatientNo.length);    	PatientNo=mystr+PatientNo;		var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;		var Rowid,OrderName,StartDate,Status,Spec,UserAddName;		var PackQty,RecDep,Billed,Price,Sum,BillType,Select,LabEpisodeNo;	    var MyList="";	    var Row="1";	    var RecDepArray=new Array()		for (var j=1;j<rows;j++) {			Row=j;			var Tbl_Select=document.getElementById("Selectz"+Row);			Select=Tbl_Select.checked;			if (Select==true){				var Tbl_RecDep=document.getElementById("RecDepz"+Row);		    	if (Tbl_RecDep) RecDep=Tbl_RecDep.innerText;				if (RecDep==""){RecDep=AdmDepDesc;}		    	var findRecDep=false;		    	for (var i=0;i<RecDepArray.length;i++) {			    	if (RecDepArray[i]==RecDep){				    	//alert("find");				    	findRecDep=true;				    	break;			    	}		    	}	    		if (findRecDep==false){			    	RecDepArray[RecDepArray.length]=RecDep;		    	}			}		}	    for (var i=0;i<RecDepArray.length;i++) {		    var MyList="";			var MyPara="";		    MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"";			for (var j=1;j<rows;j++) {				Row=j;				var Tbl_RecDep=document.getElementById("RecDepz"+Row);		   		if (Tbl_RecDep) {					RecDepDesc=Tbl_RecDep.innerText;			    	if (RecDepDesc==""){RecDepDesc=AdmDepDesc;}			    }			    if (RecDepDesc==RecDepArray[i]){			        var Tbl_Select=document.getElementById("Selectz"+Row);					var Tbl_Rowid=document.getElementById("Rowidz"+Row);					var Tbl_OrderName=document.getElementById("OrderNamez"+Row);					var Tbl_StartDat=document.getElementById("StartDatez"+Row);					var Tbl_Status=document.getElementById("Statusz"+Row);					var Tbl_PackQty=document.getElementById("PackQtyz"+Row);					var Tbl_PackUOM=document.getElementById("PackUOMz"+Row);					var Tbl_Price=document.getElementById("Pricez"+Row);					var Tbl_Sum=document.getElementById("Sumz"+Row);					var Tbl_Billed=document.getElementById("Billedz"+Row);					var Tbl_BillType=document.getElementById("BillTypez"+Row);			        var Tbl_Spec=document.getElementById("Specz"+Row);			        var Tbl_UserAddName=document.getElementById("UserAddNamez"+Row);			        var Tbl_LabEpisodeNo=document.getElementById("LabEpisodeNoz"+Row);			        //lgl+ 检验和非检验打印不同的内容			        var Tbl_ordercat=document.getElementById("OecCatz"+Row);			        var Tbl_Location=document.getElementById("Locationz"+Row);			        var Tbl_DocNotes=document.getElementById("OrderNotesz"+Row);			        if (Tbl_ordercat) ordercat=Tbl_ordercat.innerText;			        if (Tbl_Location) Location=Tbl_Location.innerText;			        if (Tbl_DocNotes) DocNotes=Tbl_DocNotes.innerText;			        if (ordercat!=30){  //lgl+ 非检验			        	 var MyPara="";			        	 MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"安徽省立医院检查/治疗统一路条单";		                 MyPara=MyPara+"^OrderNameCaption"+String.fromCharCode(2)+"医嘱";		                 MyPara=MyPara+"^SampleCaption"+String.fromCharCode(2)+"备注";		                 MyPara=MyPara+"^Remark1"+String.fromCharCode(2)+"科室位置:"+Location;		                 MyPara=MyPara+"^AdmDocCaption"+String.fromCharCode(2)+"医嘱医师:";		                 MyPara=MyPara+"^AdmDateCaption"+String.fromCharCode(2)+"医嘱日期:";		                 //alert(MyPara);AdmDocCaption  AdmDateCaption		                 MyPara=MyPara+"^Remark2"+String.fromCharCode(2)+"注意事项2";		                 MyPara=MyPara+"^Remark3"+String.fromCharCode(2)+"注意事项3";				        			        }			    	if (Tbl_OrderName) OrderName=Tbl_OrderName.innerText;			    	if (Tbl_StartDat) StartDate=Tbl_StartDat.innerText;			    	if (Tbl_Status) Status=Tbl_Status.innerText;			   		if (Tbl_PackQty) PackQty=Tbl_PackQty.innerText;			   		if (Tbl_PackUOM) PackUOM=Tbl_PackUOM.innerText;			   		if (Tbl_Price) Price=Tbl_Price.innerText;			        			   		var Price1=parseFloat(Price);			   		Price=Price1.toFixed(2);			   		if (Tbl_Sum) Sum=Tbl_Sum.innerText;			   		var Sum1=parseFloat(Sum);			   		Sum=Sum1.toFixed(2);			   		if (Tbl_Billed) Billed=Tbl_Billed.innerText;			   		if (Tbl_BillType) BillType=Tbl_BillType.innerText;			   		if (Tbl_Spec) Spec=Tbl_Spec.innerText;			   		if (Tbl_UserAddName) UserAddName=Tbl_UserAddName.innerText;					//因为合肥买来的试管上已经有个预制条码?所以原来的标本号不用了					//if (Tbl_LabEpisodeNo) LabEpisodeNo=Tbl_LabEpisodeNo.innerText;					LabEpisodeNo="";					var Other=Spec+""+DocNotes;   //lgl++"\n"+DocNotes								        Select=Tbl_Select.checked;					if (Select==true){					    if (MyList=="") {						    //MyList = OrderName+"^"+LabEpisodeNo+"^"+Spec+"^"+RecDepDesc+"^"+Price;						    MyList = OrderName+"^"+Other+"^"+PackQty+"^"+Price+"^"+Sum;					    }else{				    	    MyList = MyList + String.fromCharCode(2)+OrderName+"^"+Other+"^"+PackQty+"^"+Price+"^"+Sum;;						}					}			    }			}			//var MyPara="";		    MyPara=MyPara+"^PANo"+String.fromCharCode(2)+PatientNo;		    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;		    MyPara=MyPara+"^AdmDate"+String.fromCharCode(2)+AdmDate;		    MyPara=MyPara+"^Name"+String.fromCharCode(2)+PatientName;		    MyPara=MyPara+"^Sex"+String.fromCharCode(2)+PatientSex;		    MyPara=MyPara+"^Age"+String.fromCharCode(2)+PatientAge;		    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;		    MyPara=MyPara+"^AdmDoc"+String.fromCharCode(2)+UserAddName;		    MyPara=MyPara+"^Diagnose"+String.fromCharCode(2)+MRDiagnos;		    MyPara=MyPara+"^RecLoc1"+String.fromCharCode(2)+RecDepArray[i];  //RecDepDesc;			var myobj=document.getElementById("ClsBillPrint");			PrintFun(myobj,MyPara,MyList);		}		} catch(e) {};}function InitalJST(){	try {		var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;		var Rowid,OrderName,StartDate,StatusCode,Spec,UserAddName;	    var MyList="";	    var Row="1";		for (var j=1;j<rows;j++) {            StatusCode=GetColumnData("StatusCode",j);            if (StatusCode=="E"){	            SetColumnData("Select",j,false);            }		}	} catch(e) {alert(e.message)};	}	function PrintJST(){	try {	    var obj=document.getElementById("PatientNo");	    if (obj) var PatientNo=obj.value;	    var obj=document.getElementById("EpisodeID");	    if (obj) var EpisodeID=obj.value;	    var obj=document.getElementById("PatientName");	    if (obj) var PatientName=obj.value;	    var obj=document.getElementById("PatientAge");	    if (obj) var PatientAge=obj.value;	    var obj=document.getElementById("PatientSex");	    if (obj) var PatientSex=obj.value;	    var obj=document.getElementById("PatientCompany");	    if (obj) var PatientCompany=obj.value;	    var obj=document.getElementById("AdmDep");	    if (obj) var AdmDep=obj.value;	    var AdmDepDesc=mPiece(AdmDep,"-",1);	    if (!AdmDepDesc) AdmDepDesc=AdmDep;	    var obj=document.getElementById("AdmDate");	    if (obj) var AdmDate=obj.value;			var obj=document.getElementById('PrintDate');			if (obj) var PrintDate=obj.value;	    var mystr="00000000";	    mystr=mystr.substring(0,8-PatientNo.length);    	PatientNo=mystr+PatientNo;		var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;		var Rowid,OrderName,StartDate,Status,Spec,UserAddName;		var PackQty,RecDep,Billed,Price,Sum,BillType,Select,LabEpisodeNo,ExecuteTime;	    var MyList="";	    var Row="1";	    var LabEpisodeNoArray=new Array();	    var find=false;		var MyList="";	    var RecDepLabEpisodeNo="";	    var LabGroupNumber="";	    var GroupCount=0;	    		for (var j=1;j<rows;j++) {			Row=j;			var Tbl_Select=document.getElementById("Selectz"+Row);			Select=Tbl_Select.checked;			if (Select==true){				LabEpisodeNo=GetColumnData("LabEpisodeNo",j) 		    	RecDep=GetColumnData("RecDep",j);				if (RecDep==""){RecDep=AdmDepDesc;}				RecDepLabEpisodeNo=RecDep+"^"+LabEpisodeNo				var find=false;		    	for (var i=0;i<LabEpisodeNoArray.length;i++) {			    	if (LabEpisodeNoArray[i]==RecDepLabEpisodeNo){				    	find=true;				    	break;			    	}		    	}	    		if (find==false){			    	LabEpisodeNoArray[LabEpisodeNoArray.length]=RecDepLabEpisodeNo;		    	}			}		}		var GroupFirst;	    for (var i=0;i<LabEpisodeNoArray.length;i++) {            GroupFirst=true;			for (var j=1;j<rows;j++) {				Row=j;				RecDepDesc=GetColumnData("RecDep",j);		    	if (RecDepDesc==""){RecDepDesc=AdmDepDesc;}				LabEpisodeNo=GetColumnData("LabEpisodeNo",j);	            RecDepLabEpisodeNo=RecDepDesc+"^"+LabEpisodeNo;	            Select=GetColumnData("Select",j)				if ((Select==true)&&(RecDepLabEpisodeNo==LabEpisodeNoArray[i])){					if (GroupFirst==true) {						GroupCount=GroupCount+1;						LabGroupNumber=GroupCount;						GroupFirst=false;					}else{						LabGroupNumber="";					}			                            OrderName=GetColumnData("OrderName",j);			   		Billed=GetColumnData("Billed",j);			   		BillType=GetColumnData("BillType",j);			   		UserAddName=GetColumnData("UserAddName",j);			   		Spec=GetColumnData("Spec",j);		            ExecuteTime=GetColumnData("ExecuteTime",j);         			    	StartDate=GetColumnData("StartDate",j);     			    	Status=GetColumnData("Status",j);  			   		PackQty=GetColumnData("PackQty",j);			   		PackUOM=GetColumnData("PackUOM",j);			   		Price=GetColumnData("Price",j);			        Sum=GetColumnData("Sum",j);  			        			   		var Price1=parseFloat(Price);			   		Price=Price1.toFixed(2);			   		var Sum1=parseFloat(Sum);			   		Sum=Sum1.toFixed(2);                                        OrderName=GetTrimStr(OrderName,26)				    if (MyList=="") {					    MyList = LabGroupNumber+"^"+OrderName+"^"+RecDepDesc+"^"+LabEpisodeNo+"^"+Spec+"^"+ExecuteTime;				    }else{			    	    MyList = MyList + String.fromCharCode(2)+LabGroupNumber+"^"+OrderName+"^"+RecDepDesc+"^"+LabEpisodeNo+"^"+Spec+"^"+ExecuteTime;					}				}		    }        }     		if (MyList==""){			alert(t['NoPrintOrder']);			return;		}	    var MyPara="";		MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"";	    MyPara=MyPara+"^PANo"+String.fromCharCode(2)+PatientNo;	    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;	    MyPara=MyPara+"^AdmDate"+String.fromCharCode(2)+AdmDate;	    MyPara=MyPara+"^Name"+String.fromCharCode(2)+PatientName;	    MyPara=MyPara+"^Sex"+String.fromCharCode(2)+PatientSex;	    MyPara=MyPara+"^Age"+String.fromCharCode(2)+PatientAge;	    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;	    MyPara=MyPara+"^AdmDoc"+String.fromCharCode(2)+UserAddName;	    MyPara=MyPara+"^Diagnose"+String.fromCharCode(2)+MRDiagnos;	    MyPara=MyPara+"^RecLoc1"+String.fromCharCode(2)+RecDepDesc; 	    MyPara=MyPara+"^PrintDate"+String.fromCharCode(2)+PrintDate; 	    //MyPara=MyPara+"^RecLoc1"+String.fromCharCode(2)+RecDepArray[i];  //RecDepDesc;		var myobj=document.getElementById("ClsBillPrint");		PrintFun(myobj,MyPara,MyList);	} catch(e) {alert(e.message)};}function PrintBJZYY(){	try {		var obj=document.getElementById("PatientNo");		if (obj) var PatientNo=obj.value;		var obj=document.getElementById("EpisodeID");		if (obj) var EpisodeID=obj.value;		var obj=document.getElementById("PatientName");		if (obj) var PatientName=obj.value;		var obj=document.getElementById("PatientAge");		if (obj) var PatientAge=obj.value;		var obj=document.getElementById("PatientSex");		if (obj) var PatientSex=obj.value;		var obj=document.getElementById("PatientCompany");		if (obj) var PatientCompany=obj.value;		var obj=document.getElementById("AdmDep");		if (obj) var AdmDep=obj.value;		var AdmDepDesc=mPiece(AdmDep,"-",1);		if (!AdmDepDesc) AdmDepDesc=AdmDep;		var obj=document.getElementById("AdmDate");		if (obj) var AdmDate=obj.value;		var obj=document.getElementById('PrintDate');		if (obj) var PrintDate=obj.value;		var mystr="00000000";		mystr=mystr.substring(0,8-PatientNo.length);		PatientNo=mystr+PatientNo;		var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;		var Rowid,OrderName,StartDate,Status,Spec,UserAddName;		var PackQty,RecDep,Billed,Price,Sum,BillType,Select,LabEpisodeNo,ExecuteTime;		var MyList="";		var Row="1";		var LabEpisodeNoArray=new Array();		var find=false;		var MyList="";		var RecDepLabEpisodeNo="";		var LabGroupNumber="";		var GroupCount=0;		for (var j=1;j<rows;j++) {			Row=j;			var Tbl_Select=document.getElementById("Selectz"+Row);			Select=Tbl_Select.checked;			if (Select==true){				LabEpisodeNo=GetColumnData("LabEpisodeNo",j) 		    RecDep=GetColumnData("RecDep",j);				if (RecDep==""){RecDep=AdmDepDesc;}				RecDepLabEpisodeNo=RecDep+"^"+LabEpisodeNo				var find=false;	    	for (var i=0;i<LabEpisodeNoArray.length;i++) {		    	if (LabEpisodeNoArray[i]==RecDepLabEpisodeNo){			    	find=true;			    	break;		    	}	    	}    		if (find==false){		    	LabEpisodeNoArray[LabEpisodeNoArray.length]=RecDepLabEpisodeNo;	    	}			}		}		var GroupFirst;    for (var i=0;i<LabEpisodeNoArray.length;i++) {			GroupFirst=true;			for (var j=1;j<rows;j++) {				Row=j;				RecDepDesc=GetColumnData("RecDep",j);	    	if (RecDepDesc==""){RecDepDesc=AdmDepDesc;}				LabEpisodeNo=GetColumnData("LabEpisodeNo",j);        RecDepLabEpisodeNo=RecDepDesc+"^"+LabEpisodeNo;        Select=GetColumnData("Select",j)				if ((Select==true)&&(RecDepLabEpisodeNo==LabEpisodeNoArray[i])){					if (GroupFirst==true) {						GroupCount=GroupCount+1;						LabGroupNumber=GroupCount;						GroupFirst=false;					}else{						LabGroupNumber="";					}        					OrderName=GetColumnData("OrderName",j);		   		Billed=GetColumnData("Billed",j);		   		BillType=GetColumnData("BillType",j);		   		UserAddName=GetColumnData("UserAddName",j);		   		Spec=GetColumnData("Spec",j);					ExecuteTime=GetColumnData("ExecuteTime",j);         		    	StartDate=GetColumnData("StartDate",j);     		    	Status=GetColumnData("Status",j);  		   		PackQty=GetColumnData("PackQty",j);		   		PackUOM=GetColumnData("PackUOM",j);		   		Price=GetColumnData("Price",j);					Sum=GetColumnData("Sum",j);  		        		   		var Price1=parseFloat(Price);		   		Price=Price1.toFixed(2);		   		var Sum1=parseFloat(Sum);		   		Sum=Sum1.toFixed(2);                  					OrderName=GetTrimStr(OrderName,26)			    if (MyList=="") {				    MyList = LabGroupNumber+"^"+OrderName+"^"+RecDepDesc+"^"+LabEpisodeNo+"^"+Spec+"^"+ExecuteTime;			    }else{						MyList = MyList + String.fromCharCode(2)+LabGroupNumber+"^"+OrderName+"^"+RecDepDesc+"^"+LabEpisodeNo+"^"+Spec+"^"+ExecuteTime;					}				}	    }		}     		if (MyList==""){			alert(t['NoPrintOrder']);			return;		}    var MyPara="";		MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"";    MyPara=MyPara+"^PANo"+String.fromCharCode(2)+PatientNo;    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;    MyPara=MyPara+"^AdmDate"+String.fromCharCode(2)+AdmDate;    MyPara=MyPara+"^Name"+String.fromCharCode(2)+PatientName;    MyPara=MyPara+"^Sex"+String.fromCharCode(2)+PatientSex;    MyPara=MyPara+"^Age"+String.fromCharCode(2)+PatientAge;    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;    MyPara=MyPara+"^AdmDoc"+String.fromCharCode(2)+UserAddName;    MyPara=MyPara+"^Diagnose"+String.fromCharCode(2)+MRDiagnos;    MyPara=MyPara+"^RecLoc1"+String.fromCharCode(2)+RecDepDesc;     MyPara=MyPara+"^PrintDate"+String.fromCharCode(2)+PrintDate; 	    //MyPara=MyPara+"^RecLoc1"+String.fromCharCode(2)+RecDepArray[i];  //RecDepDesc;		var myobj=document.getElementById("ClsBillPrint");		PrintFun(myobj,MyPara,MyList);	} catch(e) {alert(e.message)};}function PrintYKYZLYY(){		try {    var Loccount=0;	  LocArray=ReLoccount(Loccount);	 		var obj=document.getElementById("PatientNo");		if (obj) var PatientNo=obj.value;		var obj=document.getElementById("EpisodeID");		if (obj) var EpisodeID=obj.value;		var obj=document.getElementById("PatientName");		if (obj) var PatientName=obj.value;		var obj=document.getElementById("PatientAge");		if (obj) var PatientAge=obj.value;		var obj=document.getElementById("PatientSex");		if (obj) var PatientSex=obj.value;		var obj=document.getElementById("PatientCompany");		if (obj) var PatientCompany=obj.value;		var obj=document.getElementById("AdmDep");		if (obj) var AdmDep=obj.value;		var AdmDepDesc=mPiece(AdmDep,"-",1);		if (!AdmDepDesc) AdmDepDesc=AdmDep;		var obj=document.getElementById("AdmDate");		if (obj) var AdmDate=obj.value;		var obj=document.getElementById('PrintDate');		if (obj) var PrintDate=obj.value;		var mystr="00000000";		mystr=mystr.substring(0,8-PatientNo.length);		PatientNo=mystr+PatientNo;			  var CTLOCID=session['LOGON.CTLOCID']	  var EpisodeID=document.getElementById("EpisodeID").value;	  var GetPatientInfoAc=document.getElementById("GetNowTime");	  if (GetPatientInfoAc) {var encmeth=GetPatientInfoAc.value;} else {var encmeth=""};	  if (encmeth!="") {		PatientInfo=cspRunServerMethod(encmeth,EpisodeID,CTLOCID);    if (PatientInfo!=""){                         	                 RegNo=PatientInfo.split("^")[1];			                 PName=PatientInfo.split("^")[2];			                 Sex=PatientInfo.split("^")[3];			                 Age=PatientInfo.split("^")[4];			                 InMedicare=PatientInfo.split("^")[18];			                 MedicareType=PatientInfo.split("^")[6];			                 Company=PatientInfo.split("^")[14];			                 CTLOCName=PatientInfo.split("^")[25];			                 PrintTime=PatientInfo.split("^")[26];			                 }	                 }		var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;		var Rowid,OrderName,StartDate,Status,Spec,UserAddName;		var PackQty,RecDep,Billed,Price,Sum,BillType,Select,LabEpisodeNo,ExecuteTime;		var MyList="";		var Row="1";		var LabEpisodeNoArray=new Array();		var find=false;		var MyList="";		var RecDepLabEpisodeNo="";		var LabGroupNumber="";		var GroupCount=0;		for (var j=1;j<rows;j++) {			Row=j;			var Tbl_Select=document.getElementById("Selectz"+Row);						var LabEpisodeNo1=document.getElementById('LabEpisodeNoz'+Row);			Select=Tbl_Select.checked;			if (Select==true){							LabEpisodeNo=LabEpisodeNo1.innerText; 						    RecDep=GetColumnData("RecDep",j);				if (RecDep==""){RecDep=AdmDepDesc;}				RecDepLabEpisodeNo=RecDep+"^"+LabEpisodeNo				var find=false;	    	for (var i=0;i<LabEpisodeNoArray.length;i++) {		    	if (LabEpisodeNoArray[i]==RecDepLabEpisodeNo){			    	find=true;			    	break;		    	}	    	}    		if (find==false){		    	LabEpisodeNoArray[LabEpisodeNoArray.length]=RecDepLabEpisodeNo;	    	}			}		} for (k=0;k<LocArray.split("^").length;k++){ 	  LocKey=LocArray.split("^")[k]; 	  RecDepDesc1=""; 	  MyList="";RecDepDesc="" 		var GroupFirst;    for (var i=0;i<LabEpisodeNoArray.length;i++) {			GroupFirst=true;			for (var j=1;j<LabEpisodeNoArray.length+1;j++) {				Row=j;				RecDepDesc=GetColumnData("RecDep",j);				if (RecDepDesc==""){RecDepDesc=AdmDepDesc;}				//LabEpisodeNo=GetColumnData("LabEpisodeNo",j);				var LabEpisodeNo=document.getElementById('LabEpisodeNoz'+j).innerText        RecDepLabEpisodeNo=RecDepDesc+"^"+LabEpisodeNo;        Select=GetColumnData("Select",j)				if ((Select==true)&&(RecDepLabEpisodeNo==LabEpisodeNoArray[i])){				        					OrderName=GetColumnData("OrderName",j);		   		Billed=GetColumnData("Billed",j);		   		BillType=GetColumnData("BillType",j);		   		UserAddName=GetColumnData("UserAddName",j);		   		Spec=GetColumnData("Spec",j);					ExecuteTime=GetColumnData("ExecuteTime",j);         		    	StartDate=GetColumnData("StartDate",j);     		    	Status=GetColumnData("Status",j);  		   		PackQty=GetColumnData("PackQty",j);		   		PackUOM=GetColumnData("PackUOM",j);		   		Price=GetColumnData("Price",j);					Sum=GetColumnData("Sum",j);  		      spec=GetColumnData("Spec",j);		      note=GetColumnData("OrderNotes",j);  		   		var Price1=parseFloat(Price);		   		Price=Price1.toFixed(2);		   		var Sum1=parseFloat(Sum);		   		Sum=Sum1.toFixed(2);                  					OrderName=GetTrimStr(OrderName,40)			    if ((MyList=="")&(RecDepDesc==LocKey)) {			    	if (GroupFirst==true) {						GroupCount=GroupCount+1;						LabGroupNumber=GroupCount;						GroupFirst=false;					}else{						LabGroupNumber="";					}				    MyList = LabGroupNumber+"^"+OrderName+"^"+spec+"^"+LabEpisodeNo+"^"+note;				    }else{if (RecDepDesc==LocKey){				    	if (GroupFirst==true) {						GroupCount=GroupCount+1;						LabGroupNumber=GroupCount;						GroupFirst=false;					}else{						LabGroupNumber="";					}					MyList = MyList + String.fromCharCode(2)+LabGroupNumber+"^"+OrderName+"^"+spec+"^"+LabEpisodeNo+"^"+note;}					}				}	    }		}     		if (MyList==""){			alert(t['NoPrintOrder']);			return;		}	    var MyPara="";		MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"";    MyPara=MyPara+"^PANo"+String.fromCharCode(2)+PatientNo;    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;    MyPara=MyPara+"^AdmDate"+String.fromCharCode(2)+AdmDate;    MyPara=MyPara+"^Name"+String.fromCharCode(2)+PatientName;    MyPara=MyPara+"^Sex"+String.fromCharCode(2)+PatientSex;    MyPara=MyPara+"^Age"+String.fromCharCode(2)+PatientAge;    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;    MyPara=MyPara+"^AdmDoc"+String.fromCharCode(2)+UserAddName;    MyPara=MyPara+"^InMedicare"+String.fromCharCode(2)+InMedicare;    MyPara=MyPara+"^Diagnose"+String.fromCharCode(2)+MRDiagnos    MyPara=MyPara+"^PrintDate"+String.fromCharCode(2)+PrintTime;     MyPara=MyPara+"^RecLoc"+String.fromCharCode(2)+"["+LocKey+"]"; 			var myobj=document.getElementById("ClsBillPrint");	PrintFun(myobj,MyPara,MyList);}	} catch(e) {alert(e.message)};}function GetTrimStr(Str,maxlen){		var len=Str.length;		var len1=0;		for (var j=0;j<len;j++) {			var char1=Str.substring(j,j+1);			if (CheckChinese(char1)) {len1=len1+2}else{len1=len1+1	}			if (len1>maxlen) {				return Str.substring(0,j);			}		}		return Str;}function ReLoccount(Loccount){	  var LocArray="";    var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;	  for (var j=1;j<rows;j++) {	  	   var reloc=document.getElementById('LabEpisodeNoz'+j).innerText;	  	   var selectflag=document.getElementById('Selectz'+j).checked;	       if ((LocArray=="")&(selectflag==true))  { LocArray=reloc	                          }else{  var LocFlag="Y";	                          	      for (j1=0;j1<LocArray.split("^").length;j1++){	                          	      	                 if ((reloc==LocArray.split("^")[j1])&&(selectflag==true)){LocFlag="N"}	                          	      	                 }	                          	      if ((LocFlag=="Y")&&(selectflag==true)){LocArray=LocArray+"^"+reloc;}	          	                             	                	                  	          	                   }	          	      	          	               } 		          	              	     return(LocArray);   }function  SelectRowHandler()	{  var eSrc=window.event.srcElement;  var rowObj=getRow(eSrc);	var selectrow=rowObj.rowIndex;	if (!selectrow) return;if (selectrow !=0) {		var LabEpisodeNoLink='LabEpisodeNoz'+selectrow;	var RowidLink='Rowidz'+selectrow;		if (eSrc.id==LabEpisodeNoLink)	{			//var LabEpisodeNo=document.getElementById('LabEpisodeNoz'+selectrow).innerText			//var Str="http://173.116.11.32/hh_lis_new/Query/zl_query_record.aspx?t=4&p="+LabEpisodeNo			//newWindow=window.open(Str,"LabReports","top=100,right=100,height=600,width=1000")			return false;		}		if (eSrc.id==RowidLink)	{			//alert(document.getElementById('Rowidz'+selectrow).innerText);			return false;		}			}	}function PrintZGYDYY(){	try {        var Loccount=0;	    LocArray=ReLoccount(Loccount);        //alert(LocArray)	    if (LocArray==''){alert('没有可以打印的信息!');	return;}		var obj=document.getElementById("PatientNo");		if (obj) var PatientNo=obj.value;		var obj=document.getElementById("EpisodeID");		if (obj) var EpisodeID=obj.value;		var obj=document.getElementById("PatientName");		if (obj) var PatientName=obj.value;		var obj=document.getElementById("PatientAge");		if (obj) var PatientAge=obj.value;		var obj=document.getElementById("PatientSex");		if (obj) var PatientSex=obj.value;		var obj=document.getElementById("PatientCompany");		if (obj) var PatientCompany=obj.value;		var obj=document.getElementById("AdmDep");		if (obj) var AdmDep=obj.value;		var AdmDepDesc=mPiece(AdmDep,"-",1);		if (!AdmDepDesc) AdmDepDesc=AdmDep;		var obj=document.getElementById("AdmDate");		if (obj) var AdmDate=obj.value;		var obj=document.getElementById('PrintDate');		if (obj) var PrintDate=obj.value;		var mystr="00000000";		mystr=mystr.substring(0,8-PatientNo.length);		PatientNo=mystr+PatientNo;	    var CTLOCID=session['LOGON.CTLOCID']	    var EpisodeID=document.getElementById("EpisodeID").value;	    var GetPatientInfoAc=document.getElementById("GetNowTime");	    if (GetPatientInfoAc) {var encmeth=GetPatientInfoAc.value;} else {var encmeth=""};	    if (encmeth!="") {		     PatientInfo=cspRunServerMethod(encmeth,EpisodeID,CTLOCID);             //alert(PatientInfo)             if (PatientInfo!=""){                 RegNo=PatientInfo.split("^")[1];                 PName=PatientInfo.split("^")[2];                 Sex=PatientInfo.split("^")[3];                 Age=PatientInfo.split("^")[4];                 InMedicare=PatientInfo.split("^")[18];                 MedicareType=PatientInfo.split("^")[6];                 Company=PatientInfo.split("^")[14];                 CTLOCName=PatientInfo.split("^")[24];                 PrintTime=PatientInfo.split("^")[25];                 PatType=PatientInfo.split("^")[6];                 var HospName=PatientInfo.split("^")[37];			 }	     }	     //add by wangli20081118                    if (PatType!='科研') var PatType=""		var objtbl=document.getElementById('tUDHCOrderItem_Lab_Print');		var rows=objtbl.rows.length;		var Rowid,OrderName,StartDate,Status,Spec,UserAddName;		var PackQty,RecDep,Billed,Price,Sum,BillType,Select,LabEpisodeNo,ExecuteTime,ProcessingNotes;		var MyList="";		var Row="1";		var LabEpisodeNoArray=new Array();		var find1=false;		var MyList="";		var RecDepLabEpisodeNo="";		var LabGroupNumber="";		var GroupCount=0;				/*for (var j=1;j<rows;j++) {			Row=j;			var Tbl_Select=document.getElementById("Selectz"+Row);		   			var LabEpisodeNo1=document.getElementById('LabEpisodeNoz'+Row);			Tbl_Select.checked;					if (Tbl_Select.checked==true){			   				LabEpisodeNo=LabEpisodeNo1.innerText; 						    RecDep=GetColumnData("RecDep",j);				if (RecDep==""){RecDep=AdmDepDesc;}				RecDepLabEpisodeNo=RecDep+"^"+LabEpisodeNo								var find1=false;	    	for (var i=0;i<LabEpisodeNoArray.length;i++) {		    	if (LabEpisodeNoArray[i]==RecDepLabEpisodeNo){			     	find1=true;			    	break;		    	}	    	}    		if (find1==false){		    	LabEpisodeNoArray[LabEpisodeNoArray.length]=RecDepLabEpisodeNo;		    		    	}			}		}*/	//alert(LocArray.split("^").length)	MyList="";	    for (k=0;k<LocArray.split("^").length;k++){ 	  LocKey=LocArray.split("^")[k]; 	  RecDepDesc1=""; 	  RecDepDesc=""; 	  ProcessingNotes=""; 	  ProcessingNotes1=""; 	  ProcessingNotes2=""; 	  ProcessingNotes3=""; 	  var GroupFirst;total=0;	  for (var j=1;j<rows;j++) {			Row=j;			var Tbl_Select=document.getElementById("Selectz"+Row);			RecDepDesc=GetColumnData("LabEpisodeNo",j)			if (RecDepDesc==""){RecDepDesc=AdmDepDesc;}			var LabEpisodeNo=document.getElementById('LabEpisodeNoz'+j).innerText	        RecDepLabEpisodeNo=RecDepDesc+"^"+LabEpisodeNo;	        Tbl_Select.checked=GetColumnData("Select",j)		    OrderName=GetColumnData("OrderName",j);	   		Billed=GetColumnData("Billed",j);	   		BillType=GetColumnData("BillType",j);	   		UserAddName=GetColumnData("UserAddName",j);	   		Spec=GetColumnData("Spec",j);			ExecuteTime=GetColumnData("ExecuteTime",j);         	    	StartDate=GetColumnData("StartDate",j);     	    	Status=GetColumnData("Status",j);  	   		PackQty=GetColumnData("PackQty",j);	   		PackUOM=GetColumnData("PackUOM",j);	   		Price=GetColumnData("Price",j);			Sum=GetColumnData("Sum",j);  	        spec=GetColumnData("Spec",j);	        note=GetColumnData("ProcessingNotes",j);	        ProcessingNotes=note+GetColumnData("OrderNotes",j);  //医嘱备注	        OrderName=OrderName+"("+Price+"元)"; 	   		var Price1=parseFloat(Price);	   		Price=Price1.toFixed(2);	   		var Sum1=parseFloat(Sum);	   		Sum=Sum1.toFixed(2);		    if ((MyList=="")&(RecDepDesc==LocKey)&(Tbl_Select.checked==true)) { 		    	GroupCount=0;  		    	if (GroupFirst==true) {					GroupCount=GroupCount+1;					LabGroupNumber="";					GroupFirst=false;										MyList = LabGroupNumber+"^"+OrderName+"^"+spec+"^"+LabEpisodeNo+"^"+ProcessingNotes;				}else if ((RecDepDesc==LocKey)&(Tbl_Select.checked==true)){						RecDepDesc1=GetColumnData("RecDep",j);						LabGroupNumber="";					total=total+Sum;					//alert(spec.length)					 if ((OrderName.length>22)||(ProcessingNotes.length>20)){						 if (spec.length<6){							 RecDepDesc1=GetColumnData("RecDep",j);							 OrderName1=OrderName.substr(0,22);OrderName2=OrderName.substr(22,OrderName.length-1);							 ProcessingNotes1=ProcessingNotes.substr(0,20);ProcessingNotes2=ProcessingNotes.substr(20,ProcessingNotes.length-1);							 if(ProcessingNotes.length>40){ProcessingNotes1=ProcessingNotes.substr(0,20);ProcessingNotes2=ProcessingNotes.substr(20,20);ProcessingNotes3=ProcessingNotes.substr(40,ProcessingNotes.length-1);}							 MyList = LabGroupNumber+"^"+OrderName1+"^"+spec+"^"+LabEpisodeNo+"^"+ProcessingNotes1;							 MyList = MyList + String.fromCharCode(2)+""+"^"+OrderName2+"^"+""+"^"+""+"^"+ProcessingNotes2;							 if(ProcessingNotes3!=""){MyList = MyList + String.fromCharCode(2)+""+"^"+""+"^"+""+"^"+""+"^"+ProcessingNotes3;}							 MyList = MyList + String.fromCharCode(2)+""+"^"+""+"^"+""+"^"+""+"^"+"";							 ProcessingNotes3="";					    }else{							  RecDepDesc1=GetColumnData("RecDep",j);						 	  OrderName1=OrderName.substr(0,22);OrderName2=OrderName.substr(22,OrderName.length-1);						 	  if(ProcessingNotes.length>40){ProcessingNotes1=ProcessingNotes.substr(0,20);ProcessingNotes2=ProcessingNotes.substr(20,20);ProcessingNotes3=ProcessingNotes.substr(40,ProcessingNotes.length-1);}						      MyList = LabGroupNumber+"^"+OrderName1+"^"+spec+"^"+LabEpisodeNo+"^"+ProcessingNotes1;						      MyList = MyList + String.fromCharCode(2)+""+"^"+OrderName2+"^"+""+"^"+""+"^"+ProcessingNotes2;						      if(ProcessingNotes3!=""){MyList = MyList + String.fromCharCode(2)+""+"^"+""+"^"+""+"^"+""+"^"+ProcessingNotes3;}						      MyList = MyList + String.fromCharCode(2)+""+"^"+""+"^"+""+"^"+""+"^"+"";							  ProcessingNotes3="";  						 }					}else{						if(spec.length<6){							RecDepDesc1=GetColumnData("RecDep",j);							MyList = LabGroupNumber+"^"+OrderName+"^"+spec+"^"+LabEpisodeNo+"^"+ProcessingNotes;}						else{							RecDepDesc1=GetColumnData("RecDep",j);						 	MyList = LabGroupNumber+"^"+OrderName+"^"+spec.substr(0,6)+"^"+LabEpisodeNo+"^"+ProcessingNotes;						    MyList = MyList + String.fromCharCode(2)+""+"^"+""+"^"+spec.substr(6,spec.length-1)+"^"+""+"^"+"";							 }											}					}			}else{				if ((RecDepDesc==LocKey)&(Tbl_Select.checked==true)){			    	total=total+Sum;			    	if (GroupFirst==true) {						GroupCount=GroupCount+1;						LabGroupNumber=GroupCount;						GroupFirst=false;				    }else{					    LabGroupNumber="";				    }				    if ((OrderName.length>22)||(ProcessingNotes.length>20)){						RecDepDesc1=GetColumnData("RecDep",j);						OrderName1=OrderName.substr(0,22);OrderName2=OrderName.substr(22,OrderName.length-1);						ProcessingNotes1=ProcessingNotes.substr(0,20);ProcessingNotes2=ProcessingNotes.substr(20,ProcessingNotes.length-1);						if(ProcessingNotes.length>40){ProcessingNotes1=ProcessingNotes.substr(0,20);ProcessingNotes2=ProcessingNotes.substr(20,20);ProcessingNotes3=ProcessingNotes.substr(40,ProcessingNotes.length-1);}						MyList = MyList + String.fromCharCode(2)+LabGroupNumber+"^"+OrderName1+"^"+spec+"^"+LabEpisodeNo+"^"+ProcessingNotes1;						MyList = MyList + String.fromCharCode(2)+""+"^"+OrderName2+"^"+""+"^"+""+"^"+ProcessingNotes2;						if(ProcessingNotes3!=""){MyList = MyList + String.fromCharCode(2)+""+"^"+""+"^"+""+"^"+""+"^"+ProcessingNotes3;}						MyList = MyList + String.fromCharCode(2)+""+"^"+""+"^"+""+"^"+""+"^"+"";						ProcessingNotes3="";					}else{						RecDepDesc1=GetColumnData("RecDep",j);						MyList = MyList + String.fromCharCode(2)+LabGroupNumber+"^"+OrderName+"^"+spec+"^"+LabEpisodeNo+"^"+ProcessingNotes;						MyList = MyList + String.fromCharCode(2)+""+"^"+""+"^"+""+"^"+""+"^"+"";				    }				}	       }		}   		if (MyList==""){			alert(t['NoPrintOrder']);			return;		}    		var obj=document.getElementById("PatientID");	    if (obj) var PateintID=obj.value;	    var PoliticalLevel="",SecretLevel=""		var PatEncryptLevel=tkMakeServerCall("web.DHCBL.CARD.UCardPaPatMasInfo","GetPatEncryptLevel",PateintID,"");		if (PatEncryptLevel!="") {			var PatEncryptLevelArr=PatEncryptLevel.split("^");			var PoliticalLevel=PatEncryptLevelArr[1];			var SecretLevel=PatEncryptLevelArr[0];		}			    var MyPara="";	  	MyPara=MyPara+"PrescTitle"+String.fromCharCode(2)+"";	    MyPara=MyPara+"^PANo"+String.fromCharCode(2)+PatientNo;	    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;	    MyPara=MyPara+"^AdmDate"+String.fromCharCode(2)+AdmDate;	    MyPara=MyPara+"^Name"+String.fromCharCode(2)+PatientName;	    MyPara=MyPara+"^Sex"+String.fromCharCode(2)+PatientSex;	    MyPara=MyPara+"^Age"+String.fromCharCode(2)+Age;	    MyPara=MyPara+"^AdmDep"+String.fromCharCode(2)+AdmDepDesc;	    MyPara=MyPara+"^AdmDoc"+String.fromCharCode(2)+UserAddName;	    MyPara=MyPara+"^InMedicare"+String.fromCharCode(2)+InMedicare;	    MyPara=MyPara+"^PatType"+String.fromCharCode(2)+PatType	    MyPara=MyPara+"^PrintDate"+String.fromCharCode(2)+StartDate; 	    MyPara=MyPara+"^MRDiagnos"+String.fromCharCode(2)+MRDiagnos; 	    MyPara=MyPara+"^total"+String.fromCharCode(2)+'金额:'+total+'元'; 	    MyPara=MyPara+"^RecLoc"+String.fromCharCode(2)+"["+RecDepDesc1+"]";	    MyPara=MyPara+"^PANoBarCord"+String.fromCharCode(2)+"*"+PatientNo+"*";		MyPara=MyPara+"^PoliticalLevel"+String.fromCharCode(2)+PoliticalLevel;		MyPara=MyPara+"^HosName"+String.fromCharCode(2)+HospName+"检验告知单";  	 	var myobj=document.getElementById("ClsBillPrint");		//PrintFun(myobj,MyPara,MyList);		//alert(MyPara)	}	var myListAry=new Array();	var TempAry=new Array();	var TempOEderName="",TempNote="",mNum=0;	var TmpListAr=MyList.split(String.fromCharCode(2));	var ListLen=MyList.split(String.fromCharCode(2)).length;	var MyListTMP="";	for(var k=0;k<ListLen;k++){		myListAry[k]=TmpListAr[k];	}	if(ListLen>16){		var i=(parseInt(ListLen)/15);		//alert(i+"^"+Math.ceil(i));	    var j=0;		for(j=1;j<=Math.ceil(i);j++){			MyListTMP="";			for(var m=(j-1)*15;m<(j*15);m++){				if(!myListAry[m])break;				//start				/*				  if(m==(j*15-5)){					for(var n=j*15-6;n<j*15;n++){						TempAry[n]=myListAry[n].split("^")[2];						if(TempAry[n]!=""){							TempOEderName=myListAry[n].split("^")[1];							TempNote=myListAry[n].split("^")[4];							mNum=j*15-1-n;						}					}				  }				 */ 				//alert(TempOEderName+"$"+TempNote+"$"+mNum);				//var ComNum=parseFloat((parseInt(TempOEderName.length)/22))				//if(parseFloat((parseInt(TempNote.length)/20))>ComNum){ComNum=parseFloat((parseInt(TempNote.length)/22));}				//if(ComNum>mNum)				//var ExitNum=j*15-1-mNum;				//if(ExitNum==m)break;				//end				if(MyListTMP=="")MyListTMP=myListAry[m];	   			else MyListTMP=MyListTMP+String.fromCharCode(2)+myListAry[m];	   						}	        MyPara=MyPara+"^PageNum"+String.fromCharCode(2)+("第"+(j)+"页"+"/ 共"+Math.ceil(i)+"页");		    PrintFun(myobj,MyPara,MyListTMP);		    MyPara=MyPara.replace(/\PageNum/g,"aa");		}    }else{		MyPara=MyPara+"^PageNum"+String.fromCharCode(2)+"第1页"+"/ 共1页";		PrintFun(myobj,MyPara,MyList);	}		var total=0;		SavePrescEventLog(EpisodeID);	} catch(e) {alert(e.message)};}///日志保存function SavePrescEventLog(EpisodeID){	try{		var EventLogData=tkMakeServerCall("web.DHCDocPrescript","GetPrescEventLogInfo",EpisodeID);		var infoarr=EventLogData.split("^");		var ModelName="UDHCORDERITEMLABPRINT";		var Condition="{RegNo:"+infoarr[0]+"}";    	var Content="{EpisodeId:"+infoarr[1]+"}";		var SecretCode=infoarr[2];		if (SecretCode!="") {			var EventLogRowId=tkMakeServerCall("web.DHCEventLog","EventLog",ModelName,Condition,Content,SecretCode);			//websys_EventLog(ModelName,Condition,Content,SecretCode);			//alert("ok");		}	} catch (e) { alert(e.message) }    return 0;}