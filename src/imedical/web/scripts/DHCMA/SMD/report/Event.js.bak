function InitReportWinEvent(obj) {
	// 保存报告状态
	obj.SaveRepStatus = function (aReportID,aStatusCode,aTxt,aUserID) {  
		var ret = $m({                  
			ClassName:"DHCMed.SMD.Report",
			MethodName:"CheckReport",
			ReportID:aReportID, 
			StatusCode:aStatusCode, 
			ResumeText:aTxt,
			UserID:aUserID
		},false);
		return ret;
	}
	obj.LoadEvent = function () {
		
		///loadingWindow();
		window.setTimeout(function () {
			obj.InitReport();                    //初始化页面
			//disLoadWindow();
		}, 100);
		//初始 删除追加隐藏元素，用于强制报告保存失败时删除诊断
		top.$("#WinModalEasyUI").empty();
	}
	/// 报卡数据相关操作
	// 初始加载
	obj.InitReport = function () {
		//下诊断弹出报卡时，疾病名称自动置为诊断名称
		if (obj.DiseaseID !='') {
			var objDisease = $cm({                  
				ClassName:"DHCMed.SS.Disease",
				MethodName:"GetObjById",
				aId:obj.DiseaseID
			},false);
			$('#cboDisease').lookup('setText',objDisease.Desc);
		}

		var strReport = $m({
			ClassName: "DHCMed.SMDService.ReportSrv",
			MethodName: "GetReportString",
			aReportID: obj.ReportID,
			aRepTypeCode: obj.RepTypeCode,
			aEpisodeID: obj.EpisodeID
		}, false);
		var objEpisode = $cm({
			ClassName: "DHCMed.Base.PatientAdm",
			MethodName: "GetObjById",
			paadm: obj.EpisodeID
		}, false);
		strReport=strReport+ CHR_1+objEpisode.AdmitDate+CHR_1+objEpisode.DisDate+CHR_1+obj.RepTypeCode;
		var Status=SetRepData(strReport);
		obj.InitRepPowerByStatus(Status);          //按钮显示事件
		return;
	}

	// 保存
	obj.SaveReport = function(StatusCode){
	    var StatusID = $m({                  
			ClassName:"DHCMed.SSService.DictionarySrv",
			MethodName:"GetIdByTypeCode",
			code:StatusCode, 
			type:"SMDRepStatus"
		},false);
	    
	    ///16-详细地址
	    var RegProvinceID = $.trim($('#cboRegProvince').combobox('getValue'));
	    var RegProvince = $.trim($('#cboRegProvince').combobox('getText'));
	    var RegCityID = $.trim($('#cboRegCity').combobox('getValue')); 
	    var RegCity = $.trim($('#cboRegCity').combobox('getText')); 
	    var RegCountyID = $.trim($('#cboRegCounty').combobox('getValue')); 
	    var RegCounty = $.trim($('#cboRegCounty').combobox('getText'));
	    var RegVillageID = $.trim($('#cboRegVillage').combobox('getValue')); 
	    var RegVillage = $.trim($('#cboRegVillage').combobox('getText')); 
	    //23-现住址
	    var CurrProvinceID = $.trim($('#cboCurrProvince').combobox('getValue'));
	    var CurrProvince = $.trim($('#cboCurrProvince').combobox('getText'));
	    var CurrCityID = $.trim($('#cboCurrCity').combobox('getValue'));
	    var CurrCity = $.trim($('#cboCurrCity').combobox('getText'));
	    var CurrCountyID = $.trim($('#cboCurrCounty').combobox('getValue'));
	    var CurrCounty = $.trim($('#cboCurrCounty').combobox('getText'));
	    var CurrVillageID =  $.trim($('#cboCurrVillage').combobox('getValue'));
	    var CurrVillage =  $.trim($('#cboCurrVillage').combobox('getText')); 
	    var strPatInfo = "";
		strPatInfo +=  $.trim($('#txtPatName').val()) + String.fromCharCode(2);
		strPatInfo +=  $.trim($('#txtSex').val()) + String.fromCharCode(2);
		strPatInfo +=  $.trim($('#txtBirthday').datebox("getValue")) + String.fromCharCode(2);
		strPatInfo +=  $.trim($('#txtPersonalID').val()) + String.fromCharCode(2);
		strPatInfo +=  (IsExist('cboNation') ? $.trim($('#cboNation').combobox('getValue')):'') + String.fromCharCode(2); //民族
		strPatInfo +=  (IsExist('txtOPMrNo') ? $.trim($('#txtOPMrNo').val()):'') + String.fromCharCode(2); //门诊号
		strPatInfo +=  (IsExist('txtIPMrNo') ? $.trim($('#txtIPMrNo').val()):'') + String.fromCharCode(2); //住院号
		strPatInfo +=  $.trim($('#txtHomeTel').val())  + String.fromCharCode(2); //电话
		strPatInfo +=  $.trim($('#txtInsurNo').val()) + String.fromCharCode(2); //医保号
		
		var inputStr = "",strMentalSymptom = "",strTreatPharmacy = "",strRehabPharmacy = "";
		inputStr += obj.ReportID                                    		+ CHR_1;
		inputStr += obj.RepTypeID                                   		+ CHR_1;
		inputStr += (IsExist('cboAdmType') ? $.trim($('#cboAdmType').combobox('getValue')):'')          + CHR_1;
		inputStr += (IsExist('cboPatType') ? $.trim($('#cboPatType').combobox('getValue')):'')          + CHR_1;
		inputStr += obj.EpisodeID                                   		+ CHR_1;
		inputStr += obj.PatientID                                   		+ CHR_1;
		inputStr += $.trim($('#cboLocal').combobox('getValue'))             + CHR_1;
		inputStr += $.trim($('#DiseaseId').val())                           + CHR_1;
		inputStr += ($.trim($('#DiseaseId').val()) ? $.trim($('#cboDisease').lookup('getText')):'')              + CHR_1;
		inputStr += StatusID 	                                    		+ CHR_1;
		inputStr += $.trim($('#txtCardNo').val())                           + CHR_1;	            //CardNo
		inputStr += (IsExist('cboIsComplete') ? $.trim($('#cboIsComplete').combobox('getValue')):'')    + CHR_1;
		inputStr += strPatInfo                                      		+ CHR_1;				//13-病人信息
		inputStr += $.trim($('#txtContactor').val())                        + CHR_1;			    //14-联系人姓名
		inputStr += $.trim($('#txtContactorTel').val())                     + CHR_1;             	//15-联系人电话
		inputStr += (RegProvinceID ? RegProvince:'') +(RegCityID ? RegCity:'')+ (RegCountyID ? RegCounty:'') + (RegVillageID ? RegVillage:'') + $.trim($('#txtRegRoad').val()) + CHR_1; 			//16-详细地址
		
		inputStr += $.trim($('#cboRegAddType').combobox('getValue')) 		+ CHR_1;				//17-户籍地址类型
		inputStr += $.trim($('#cboRegProvince').combobox('getValue'))		+ CHR_1;				//18-
		inputStr += $.trim($('#cboRegCity').combobox('getValue')) 			+ CHR_1;                //19-
		inputStr += $.trim($('#cboRegCounty').combobox('getValue')) 		+ CHR_1;                //20-
		inputStr += $.trim($('#cboRegVillage').combobox('getValue'))		+ CHR_1;               	//21-
		inputStr += $.trim($('#txtRegRoad').val())			                + CHR_1;                 //22-
		inputStr += (CurrProvinceID ? CurrProvince:'') +(CurrCityID ? CurrCity:'')+ (CurrCountyID ? CurrCounty:'') + (CurrVillageID ? CurrVillage:'') + $.trim($('#txtCurrRoad').val()) + CHR_1; 			//23-现住址
		inputStr += $.trim($('#cboCurrAddType').combobox('getValue'))		+ CHR_1;				//24-现住址地址类型
		inputStr += $.trim($('#cboCurrProvince').combobox('getValue')) 		+ CHR_1;             	//25-
		inputStr += $.trim($('#cboCurrCity').combobox('getValue')) 			+ CHR_1;                //26-
		inputStr += $.trim($('#cboCurrCounty').combobox('getValue')) 		+ CHR_1;               	//27-
		inputStr += $.trim($('#cboCurrVillage').combobox('getValue')) 		+ CHR_1;              	//28-
		inputStr += $.trim($('#txtCurrRoad').val())                         + CHR_1;                //29-
		inputStr += (IsExist('cboOccupation') ? $.trim($('#cboOccupation').combobox('getValue')):'')	+ CHR_1;               	//30-职业
		inputStr += $.trim($('#txtCompany').val()) 		                    + CHR_1;                //31-工作单位
		inputStr += $.trim($('#txtCompanyTel').val())	                    + CHR_1;               	//32-工作单位电话
		inputStr += $('#txtSickDate').datebox('getValue') 		   			+ CHR_1;                //33-初次发病时间
		inputStr += Common_CheckboxValue('chkReferralList') 				+ CHR_1;				//34-送诊主体
		inputStr += $.trim($('#txtReferralTxt').val()) 	                    + CHR_1;              	//35-送诊主体（其它）
		inputStr += $.trim($('#txtDiagHospital').val()) 		            + CHR_1;             	//36-确诊医院
		inputStr += $.trim($('#txtDiagDate').combobox('getValue')) 			+ CHR_1;                //37-确诊日期
		inputStr += session['LOGON.CTLOCID'] 				       			+ CHR_1;                //38-上报科室
		inputStr += session['LOGON.USERID'] 				        		+ CHR_1;                //39-上报医师
		inputStr += $.trim($('#txtRepLocTel').val()) 		                + CHR_1;                //40-科室电话
		inputStr += $.trim($('#txtRepDate').datebox('getValue'))			+ CHR_1;                //41-上报日期
		inputStr += ""	                                            		+ CHR_1;                //42-上报时间
		inputStr += $.trim($('#txtResume').val()) 		                    + CHR_1;            	//43-备注
		inputStr += $.trim($('#cboAdmitReason').combobox('getValue'))		+ CHR_1;				//44-本次入院原因

		if ((obj.RepTypeCode=="2")||(obj.RepTypeCode=="4")){
			inputStr += $.trim($('#txtCause').val())+","+ $.trim($('#txtCause1').val()) +","+ $.trim($('#txtCause2').val()) + "," + $.trim($('#txtCause3').val())+ "," + $.trim($('#txtCause4').val()) + "," + $.trim($('#txtCause5').val()) + CHR_1;		//45-家庭社会影响
			inputStr += $.trim($('#txtCauseNote').val()) 	                + CHR_1;				//46-其他补充说明
			inputStr += Common_RadioValue('radOPTreatmentList')     		+ CHR_1;                //47-门诊治疗情况
			inputStr += $('#txtFDTreatDate').datebox('getValue') 			+ CHR_1;                //48-首次抗精神药物治疗时间
			inputStr += $.trim($('#txtTreatTimes').val()) 	                + CHR_1;                //49-住院次数
			inputStr += $.trim(obj.Disease)                  		       	+ CHR_1;                //50-住院诊断
			inputStr += $.trim($('#cboPrognosis').combobox('getValue')) 	+ CHR_1;                //51-住院疗效
			inputStr += Common_CheckboxValue('chkTreatMeasureList') 		+ CHR_1;				//52-本次住院康复措施
			inputStr += $.trim($('#txtTreatMeasureTxt').val())              + CHR_1;                //53-本次住院康复措施其他 
			inputStr += Common_CheckboxValue('chkRehabMeasureList') 		+ CHR_1;				//54-康复措施
			inputStr += $.trim($('#txtRehabMeasureTxt').val())              + CHR_1;                //55-康复措施其他  
			inputStr += $.trim($('#txtRehabResume').val())  	            + CHR_1;                //56-其他注意事项
			inputStr += Common_RadioValue('radIsFundingList')  	    		+ CHR_1;				//57-是否获得经费补助
			inputStr += Common_RadioValue('radFundsTypeList')       		+ CHR_1;				//58-补助类型
			inputStr += Common_RadioValue('radFundsSourceList')  			+ CHR_1;				//59-经费来源
			inputStr += $.trim($('#txtFundsSource').val())  	            + CHR_1;                //60-经费其他
			inputStr += $.trim($('#cboPayment').combobox('getValue'))    	+ CHR_1;                //61-付费方式
			strMentalSymptom = SaveMentalSymptomToString();              //精神症状
			strTreatPharmacy = SaveTreatPharmacyToString();	            //治疗用药
			strRehabPharmacy = SaveRehabPharmacyToString();				//康复用药	
		}else{
			for(var i=0;i<3 ;i++){
				inputStr =inputStr + CHR_1;
			}
			inputStr += $('#txtFDTreatDate').datebox('getValue') 			+ CHR_1;                //48-首次抗精神药物治疗时间
			inputStr += $.trim($('#txtTreatTimes').val()) 	                + CHR_1;                //49-住院次数
			for(var i=0;i<12 ;i++){
				inputStr =inputStr + CHR_1;
			}
			strTreatPharmacy = SaveTreatPharmacyToString();	            //治疗用药
		}
			
		inputStr += $.trim($('#cboPatRelationList').combobox('getValue'))    	+ CHR_1;             //62-与患者关系
		inputStr += $.trim($('#cboPatNation').combobox('getValue'))         	+ CHR_1;             //63-国籍
		inputStr += $.trim($('#cboCertType').combobox('getValue'))          	+ CHR_1;             //64-证件类型
		inputStr += $.trim($('#cboNational').combobox('getValue'))          	+ CHR_1;             //65-民族
		inputStr += (IsExist('cboHuBie') ? $.trim($('#cboHuBie').combobox('getValue')):'')       			+ CHR_1;             //66-户别
		inputStr += (IsExist('cboDegree') ?$.trim($('#cboDegree').combobox('getValue')):'')             	+ CHR_1;             //67-文化程度
		inputStr += (IsExist('cboWedLock') ?$.trim($('#cboWedLock').combobox('getValue')):'')              	+ CHR_1;             //68-婚姻状况
		inputStr += (IsExist('cboHouseHold') ? $.trim($('#cboHouseHold').combobox('getValue')) :'')         + CHR_1;             //69-两系三代严重精神障碍家族史
		var checkedRadioJObj = $("input[name='IsDrugTreatment']:checked");
		inputStr += $.trim(checkedRadioJObj.val())             	+ CHR_1;           						//70-是否已进行抗精神药物治疗
		inputStr += (IsExist('cboLockStatus') ? $.trim($('#cboLockStatus').combobox('getValue')):'')  	                + CHR_1;        //71-既往关锁情况
		inputStr += $.trim($('#cboAssessment').combobox('getValue'))  	            + CHR_1;            //72-既往危险性评估
		inputStr += (IsExist('cboAgree') ? $.trim($('#cboAgree').combobox('getValue')):'')   	            + CHR_1;             //73-知情同意
		inputStr +=  (IsExist('txtAgreeDate') ?  $.trim($('#txtAgreeDate').datebox('getValue')):'')	            + CHR_1;             //74-知情同意时间
		inputStr += Common_CheckboxValue('chkBehaviors') 				       + CHR_1;			 //75-危险行为
		inputStr += $.trim($('#txtContactorTel2').val())                     + CHR_1;             	//76-联系人电话副
		
		var ret = $m({                  
			ClassName:"DHCMed.SMD.Report",
			MethodName:"Update",
			aInputStr:inputStr, 
			aMentalSymptom:strMentalSymptom,
			aTreatPharmacy:strTreatPharmacy,
			aRehabPharmacy:strRehabPharmacy,
			aSeparate:CHR_1
		},false);
	    if (parseInt(ret)>0){
			obj.ReportID = ret;
			$.messager.alert("提示",StatusCode== "0" ? "草稿保存成功":"报卡提交成功",'info');
			obj.InitReport();    //初始化页面
			//追加隐藏元素，用于强制报告保存失败时作废诊断
			top.$("#WinModalEasyUI").append("<input type='hidden' id='flag' value='1'>");
		} else {
			$.messager.alert("提示",StatusCode== "0" ? "草稿保存失败!":"报卡提交失败",'info');
			return;
		}
	}
	
	// 校验
	obj.CheckReport=function(){
		var errStr = "";
		//*************************************** ↓↓↓公共部分
		var PatName = $.trim($('#txtPatName').val());
		var Sex = $.trim($('#txtSex').val());
		var Birthday  = $.trim($('#txtBirthday').datebox('getValue'));
		var PatNation = $.trim($('#cboPatNation').combobox('getValue'));  //国籍
		var CertType = $.trim($('#cboCertType').combobox('getValue'));    //证件类型
		var PatCardNo = $.trim($('#txtPersonalID').val()); 
		
		var RegProvince = $.trim($('#cboRegProvince').combobox('getValue'));
		var National = $('#cboNational').combobox('getValue');      //民族     
		var Contactor = $.trim($('#txtContactor').val());
		var ContactorTel = $.trim($('#txtContactorTel').val());   //联系人电话
		if ($.trim(ContactorTel) != ""){
			if (!(/(^\d{11}$)/.test(ContactorTel))) {
				errStr += '输入的联系人电话号码长度不对，或者号码不符合规定！11位号码应全为数字，手机号或者座机加区号。<br>';
			}
		}	
		var ContactorTel2 = $.trim($('#txtContactorTel2').val());   //联系人电话副
		if ($.trim(ContactorTel2) != ""){
			if (!(/(^\d{11}$)/.test(ContactorTel2))) {
				errStr += '输入的联系人电话号码(副)长度不对，或者号码不符合规定！11位号码应全为数字，手机号或者座机加区号。<br>';
			}
		}	
		var RegProvince = $.trim($('#cboRegProvince').combobox('getValue'));
		var RegCity = $.trim($('#cboRegCity').combobox('getValue'));
		var RegCounty = $.trim($('#cboRegCounty').combobox('getValue'));  
		var RegVillage = $.trim($('#cboRegVillage').combobox('getValue'));
		var RegRoad = $.trim($('#txtRegRoad').val());
		var RegAddType = $.trim($('#cboRegAddType').combobox('getValue')); 
		
		var CurrProvince = $.trim($('#cboCurrProvince').combobox('getValue'));
		var CurrCity = $.trim($('#cboCurrCity').combobox('getValue'));
		var CurrCounty = $.trim($('#cboCurrCounty').combobox('getValue'));  
		var CurrVillage = $.trim($('#cboCurrVillage').combobox('getValue'));
		var CurrRoad = $.trim($('#txtCurrRoad').val());
		var CurrAddType = $.trim($('#cboCurrAddType').combobox('getValue')); 
		var SickDate = $('#txtSickDate').datebox('getValue');	
		var RepLocTel = $.trim($('#txtRepLocTel').val());	
		var PatRelationList = $.trim($('#cboPatRelationList').combobox('getValue'));             //与患者关系
		var FDTreatDate = $.trim($('#txtFDTreatDate').datebox('getValue')); //首次抗精神病治疗时间 txtFDTreatDate
		var TreatTimes = $.trim($('#txtTreatTimes').val()); 				//住院曾住精神专科医院/综合医院精神科 
		var Assessment = $.trim($('#cboAssessment').combobox('getValue')); 	//既往危险性评估
		var CertTypeDesc = $.trim($('#cboCertType').combobox('getText'));    //证件类型描述
		if ($.trim(RepLocTel) != ""){
			if (!(/(^\d{11}$)/.test(RepLocTel))) {
				errStr += '输入的科室电话号码长度不对，或者号码不符合规定！11位号码应全为数字，手机号或者座机加区号。<br>';
			}
		}	
		var DiagDate = $('#txtDiagDate').datebox('getValue');
		var AdmitDate = $('#txtAdmitDate').datebox('getValue');
		var Disease = $.trim($('#cboDisease').lookup('getText'));
		var RepDate = $('#txtRepDate').datebox('getValue');
		if ((obj.RepTypeCode != '1')&&(PatName=="")) { errStr = errStr + "请填写姓名!<br>"; }
		if ((obj.RepTypeCode != '1')&&(Sex=="")) { errStr = errStr + "请填写性别!<br>"; }
		if (Birthday=="") { errStr = errStr + "请填写出生日期!<br>"; }
		if (CertType=="") { errStr = errStr + "请选择证件类型!<br>"; }
		if (!$.trim(PatCardNo)){
			errStr += '请填写'+CertTypeDesc+'号!<br>';
		}
		if (($.trim(PatCardNo) != "")&&(CertTypeDesc == "身份证")){
			if (!(/(^\d{15}$)|(^\d{17}([0-9]|X|x)$)/.test(PatCardNo))) {
				errStr += '输入的身份证号长度不对，或者号码不符合规定！15位号码应全为数字，18位号码末位可以为数字或X。<br>';
			}
			var strPatDOB = "";
			var tmpYear,tmpMonth,tmpDay;
			// 如果身份证号是15位,例如：350424870506202
			if (PatCardNo.length == 15) {
				tmpYear = PatCardNo.substr(6,2);
				if (tmpYear != "19") {
					tmpMonth = PatCardNo.substr(8,2);
					tmpDay = PatCardNo.substr(10,2);
					strPatDOB = "19" + tmpYear + "-" + tmpMonth + "-" + tmpDay;
				}
			}
			// 如果身份证号是18位,例如：420536198109216301
			if (PatCardNo.length == 18) {
				tmpYear = PatCardNo.substr(6,4);
				tmpMonth = PatCardNo.substr(10,2);
				tmpDay = PatCardNo.substr(12,2);
				strPatDOB = tmpYear + "-" + tmpMonth + "-" + tmpDay;
			}
		}
		if (PatNation=="") { errStr = errStr + "请选择国籍或地区!<br>"; }
		if (National=="") { errStr = errStr + "请选择民族!<br>"; }
		if (Contactor=="") { errStr = errStr + "请填写联系人姓名!<br>"; }
		if (ContactorTel=="") { errStr = errStr + "请填写联系人电话!<br>"; }
		if (PatRelationList=="") { errStr = errStr + "请选择与患者关系!<br>"; }
		if (RegProvince=="") { errStr = errStr + "请选择户籍地省!<br>"; }
		if (RegCity=="") { errStr = errStr + "请选择户籍地市!<br>"; }
		if (RegCounty=="") { errStr = errStr + "请选择户籍地县!<br>"; }
		if (RegVillage=="") { errStr = errStr + "请选择户籍地乡/镇(街道)!<br>"; }
		if (RegRoad=="") { errStr = errStr + "请填写户籍地村(居委会)!<br>"; }	
		if (RegAddType=="") { errStr = errStr + "请选择户籍地类型!<br>"; }			
		if (CurrProvince=="") { errStr = errStr + "请选择现住址省!<br>"; }
		if (CurrCity=="") { errStr = errStr + "请选择现住址市!<br>"; }
		if (CurrCounty=="") { errStr = errStr + "请选择现住址县!<br>"; }
		if (CurrVillage=="") { errStr = errStr + "请选择现住址乡/镇(街道)!<br>"; }
		if (CurrRoad=="") { errStr = errStr + "请填写现住址村(居委会)!<br>"; }
		if (CurrAddType=="") { errStr = errStr + "请选择现住址类型!<br>"; }
		
		if (SickDate=="") { errStr = errStr + "请填写初次发病时间!<br>"; }
		if (RepLocTel=="") { errStr = errStr + "请填写科室电话!<br>"; }
		if (FDTreatDate=="") { errStr = errStr + "请填写首次抗精神病治疗时间!<br>"; }
		if (TreatTimes=="") { errStr = errStr + "请填写住院曾住精神专科医院/综合医院精神科次数!<br>"; }
		if (DiagDate=="") { errStr = errStr + "请填写本次确诊日期!<br>"; }
		if (AdmitDate=="") { errStr = errStr + "请填写入院时间!<br>"; }
		if (Disease=="") { errStr = errStr + "请选择疾病名称!<br>"; }
		if ((Disease!="")&&(obj.Disease=="")) { errStr = errStr + "请选择疾病名称!<br>"; }

		if ((obj.RepTypeCode=="2")||(obj.RepTypeCode=="4"))
		{
			
			var Local = $.trim($('#cboLocal').combobox('getValue'));  
			var OPTreatmentList = Common_RadioValue('radOPTreatmentList');
			var AdmitReason = $.trim($('#cboAdmitReason').combobox('getValue'));
			if (Local=="") { errStr = errStr + "请选择常住类型!<br>"; }
			
			if (AdmitReason=="") { errStr = errStr + "请选择本次入院原因!<br>"; }
			var DischDate = $.trim($('#txtDischDate').datebox('getValue'));
			if(DischDate ==""){
				errStr += "出院日期为空，不允许提交报卡，请先保存为草稿，待患者出院后再提交出院信息单！<br>";
			}	
			if(SaveMentalSymptomToString().length == 0){
				errStr += "请选择“精神症状”！<br>";
			}else{	//判断精神症状前6项是否填写
				for (var ind = 0; ind < 6; ind++){
				
				}
			}
			if (OPTreatmentList=="") { errStr = errStr + "请选择门诊治疗情况!<br>"; }
			
			
			var Payment = $.trim($('#cboPayment').combobox('getValue'));
			if (Payment=="") { errStr = errStr + "请选择医疗付费方式!<br>"; }	
			var Prognosis = $.trim($('#cboPrognosis').combobox('getValue'));
			if (Prognosis=="") { errStr = errStr + "请选择住院疗效!<br>"; }	
			
			var IsFunding=Common_RadioLabel('radIsFundingList');
			if (IsFunding=="") { errStr = errStr + "请填写本次住院是否获得经费补助!<br>"; }
			if (IsFunding=="有"){ //是否获得补助为"有"时，补助类型、补助来源必填
				var FundsType = Common_RadioValue('radFundsTypeList');
				var FundsSource = Common_RadioValue('radFundsSourceList');  
				if (FundsType=="") { errStr = errStr + "请选择补助类型!<br>"; }
				if (FundsSource=="") { errStr = errStr + "请选择经费来源!<br>"; }
				var FundsSourceDesc = Common_RadioLabel('radFundsSourceList');
				var FundsSourceTxt = $.trim($('#txtFundsSource').val());	
				if ((FundsSourceDesc.indexOf("其他")> -1)&&($.trim(FundsSourceTxt)=="")) {
					errStr += "请填写“经费来源”的“其他”！<br>";
				}				
			}
			var TreatMeasure = Common_CheckboxValue('chkTreatMeasureList');  
			if(TreatMeasure.length == 0){
				errStr += "请选择“本次住院康复措施”！<br>";
			}else{
				var TreatMeasureTDesc = Common_CheckboxLabel('chkTreatMeasureList'); 
				var TreatMeasureTxt = $.trim($('#txtTreatMeasureTxt').val());				
				if ((TreatMeasureTDesc.indexOf("其他")> -1)&&($.trim(TreatMeasureTxt)=="")) {
					errStr += "请填写“本次住院康复措施”的“其他”！<br>";
				}	
			}
			var RehabMeasure = Common_CheckboxValue('chkRehabMeasureList');  
			if(RehabMeasure.length == 0){
				errStr += "请选择下一步治疗“康复措施”！<br>";
			}else{
				var RehabMeasureTDesc = Common_CheckboxLabel('chkRehabMeasureList'); 
				var RehabMeasureTxt = $.trim($('#txtRehabMeasureTxt').val());				
				if ((RehabMeasureTDesc.indexOf("其他")> -1)&&($.trim(RehabMeasureTxt)=="")) {
					errStr += "请填写下一步治疗“康复措施”的“其他”！<br>";
				}
					
			}
			//时间逻辑判断   出生时间＜初次发病时间≤首次抗精神病药治疗时间≤本次入院时间≤本次确诊时间≤填卡时间
			if (Common_CompareDate(Birthday,SickDate)>0){
				errStr = errStr + "初次发病时间不能小于出生时间！<br>"; 
			}
			if (Common_CompareDate(SickDate,FDTreatDate)>0){
				errStr = errStr + "首次抗精神病药治疗时间不能小于初次发病时间！<br>"; 
			}
			if (Common_CompareDate(FDTreatDate,AdmitDate)>0){
				errStr = errStr + "首次抗精神病药治疗时间不能大于本次入院时间！<br>"; 
			}
			if (Common_CompareDate(AdmitDate,DiagDate)>0){
				errStr = errStr + "本次确诊时间不能小于本次入院时间！<br>"; 
			}
			if (Common_CompareDate(DiagDate,RepDate)>0){
				errStr = errStr + "本次确诊时间不能大于填卡时间！<br>"; 
			}
		}else{
			var PatType  = $.trim($('#cboPatType').combobox('getValue'));      //患者类型
			var AdmType  = $.trim($('#cboAdmType').combobox('getValue'));      //报卡类型
			var HB = $.trim($('#cboHuBie').combobox('getValue'))                 //户别
			var Degree = $.trim($('#cboDegree').combobox('getValue'));    //文化程度
			var WedLock = $.trim($('#cboWedLock').combobox('getValue'));    			//婚姻状况
			var Occupation = $.trim($('#cboOccupation').combobox('getValue')) 			 //就业情况
			var Local = $.trim($('#cboLocal').combobox('getValue'));  		  			 //人员属地
			//var IsComplete = $.trim($('#cboIsComplete').combobox('getValue')); 			//完整性
			var HouseHold = $.trim($('#cboHouseHold').combobox('getValue')); 			//两系三代严重精神疾病 cboHouseHold
			var IsDrugTreatment=$("input[name='IsDrugTreatment']:checked").val();
			var LockStatus = $.trim($('#cboLockStatus').combobox('getValue')); 			//既往关锁情况 LockStatus
			var Agree = $.trim($('#cboAgree').combobox('getValue'));  		   			//知情同意
			var AgreeDate = $.trim($('#txtAgreeDate').datebox('getValue'));  		   //知情同意时间
		
			if ((PatType=="")&&(obj.RepTypeCode != '1')) { errStr = errStr + "请选择患者类型!<br>"; }
			if ((obj.RepTypeCode != '1')&&(AdmType=="")) { errStr = errStr + "请选择报卡类型!<br>"; }
		
			if (HB=="") { errStr = errStr + "请选择户别!<br>"; }
			if (Degree=="") { errStr = errStr + "请选择文化程度!<br>"; }
			if (WedLock=="") { errStr = errStr + "请选择婚姻状况!<br>"; }
			if (Occupation=="") { errStr = errStr + "请选择就业情况!<br>"; }
			if (Local=="") { errStr = errStr + "请选择人员属地!<br>"; }
			
			if (HouseHold=="") { errStr = errStr + "请选择两系三代严重精神疾病!<br>"; }
			if (IsDrugTreatment=="") { errStr = errStr + "请选择是否已进行抗精神药物治疗!<br>"; }
			
			if (LockStatus=="") { errStr = errStr + "请选择既往关锁情况!<br>"; }
			if (Assessment=="") { errStr = errStr + "请选择既往危险性评估!<br>"; }
			if (Agree=="") { errStr = errStr + "请选择”知情同意“项目!<br>"; }
			if (AgreeDate=="") { errStr = errStr + "请选择“知情同意时间”!<br>"; }
			
			//初次发病时间≤知情同意时间≤当前时间
			if (Common_CompareDate(SickDate,AgreeDate)>0){
				errStr = errStr + "知情同意时间不能小于初次发病时间！<br>"; 
			}
			if (Common_CompareDate(AgreeDate,Common_GetDate(new Date()))>0){
				errStr = errStr + "知情同意时间不能大于当前时间！<br>"; 
			}
			if (Common_CompareDate(SickDate,FDTreatDate)>0){
				errStr = errStr + "首次抗精神病药治疗时间不能小于初次发病时间！<br>"; 
			}
			if (Common_CompareDate(Birthday,SickDate)>0){
				errStr = errStr + "出生时间不能大于初次发病时间！<br>"; 
			}
			if (Common_CompareDate(SickDate,AdmitDate)>0){
				errStr = errStr + "初次发病时间不能大于本次入院时间！<br>"; 
			}
			if (Common_CompareDate(AdmitDate,DiagDate)>0){
				errStr = errStr + "本次入院时间不能大于本次确诊时间！<br>"; 
			}
			if (Common_CompareDate(DiagDate,RepDate)>0){
				errStr = errStr + "本次确诊时间不能大于填卡时间！<br>"; 
			}
			if (Common_CompareDate(RepDate,Common_GetDate(new Date()))>0){
				errStr = errStr + "填卡时间不能大于当前时间！<br>"; 
			}
		}
		if(errStr != "")
		{
			$.messager.alert("提示", errStr, 'info');
			return false;
		}
		return true;
	}
	// ****************************** ↓↓↓ 单选、多选事件
	$HUI.checkbox("[name='chkReferralList']",{  //送诊主体选项触发事件
		onChecked:function(e,value){
			var value = $(e.target).attr("label");   //当前选中的值
			if (value=='其他') {	
				$('#txtReferralTxt').removeAttr("disabled");
			}
		},onUnchecked :function(e,value){
			var value = $(e.target).attr("label");
			if (value=='其他') {	
				$('#txtReferralTxt').attr('disabled','disabled');
				$('#txtReferralTxt').val('');
			}
		}
	});
	$HUI.checkbox("[name='chkTreatMeasureList']",{  //本次住院康复措施选项触发事件
		onChecked:function(e,value){
			var value = $(e.target).attr("label");   //当前选中的值
			if (value=='其他') {	
				$('#txtTreatMeasureTxt').removeAttr("disabled");
			}
		},onUnchecked :function(e,value){
			var value = $(e.target).attr("label");
			if (value=='其他') {	
				$('#txtTreatMeasureTxt').attr('disabled','disabled');
				$('#txtTreatMeasureTxt').val('');
			}
		}
	});
	$HUI.checkbox("[name='chkRehabMeasureList']",{  //下一步治疗康复措施选项触发事件
		onChecked:function(e,value){
			var value = $(e.target).attr("label");   //当前选中的值
			if (value=='其他') {	
				$('#txtRehabMeasureTxt').removeAttr("disabled");
			}
		},onUnchecked :function(e,value){
			var value = $(e.target).attr("label");
			if (value=='其他') {	
				$('#txtRehabMeasureTxt').attr('disabled','disabled');
				$('#txtRehabMeasureTxt').val('');
			}
		}
	});
	
	$('#radFundsTypeList').radio('disable');
	$('#radFundsSourceList').radio('disable');
	$HUI.radio("[name='radIsFundingList']",{  //本次住院是否获得经费补助选项触发事件
		onChecked:function(e,value){
			var value = $(e.target).attr("label");   //当前选中的值
			if (value=='有') {	
				$('#radFundsTypeList').radio('enable');
				$('#radFundsSourceList').radio('enable');
				$HUI.radio("[name='radFundsSourceList']",{  //经费来源选项触发事件
					onChecked:function(e,value){
						var value = $(e.target).attr("label");   //当前选中的值
						if (value=='其他') {	
							$('#txtFundsSource').removeAttr("disabled");
						}else{
							$('#txtFundsSource').attr('disabled','disabled');
							$('#txtFundsSource').val('');
						}
					}
				});				
			}else{
				$HUI.radio("[name='radFundsTypeList']").setValue('');	
				$HUI.radio("[name='radFundsSourceList']").setValue('');	
				$('#txtFundsSource').val('');
				$('#radFundsTypeList').radio('disable');
				$('#radFundsSourceList').radio('disable');
				$('#txtFundsSource').attr('disabled','disabled');	
			}
		}
	});
	///  按钮对应事件
	//按钮监听事件
	$('#btnRepTmp').on("click", function(){
		obj.btnRepTmp_click();
	});
	$('#btnSubmit').on("click", function(){
		obj.btnSubmit_click()
	});
	$('#btnCheck').on("click",function(){
		obj.btnCheck_click()
	});
	$('#btnCanCheck').on("click",function(){
		obj.btnCanCheck_click()
	});
	$('#btnReturn').on("click", function(){
		obj.btnReturn_click()
	});
	$('#btnDelete').on("click",function(){
		obj.btnDelete_click()
	});
	$('#btnPrint').on("click",function(){
		obj.btnPrint_click()
	});
	$('#btnClose').on("click", function(){
		obj.btnClose_click()
	});	
	//草稿
	obj.btnRepTmp_click = function () {
		obj.SaveReport("0");
	}
	//提交
	obj.btnSubmit_click = function () {
		if (obj.CheckReport() != true) return;
		obj.SaveReport("1");
	}
	//显示按钮操作权限 根据报告状态与操作权限控制
	obj.InitRepPowerByStatus = function (StatusCode) {
		$('#btnCheck').hide();
		$('#btnCanCheck').hide();
		$('#btnReturn').hide();
		$('#btnDelete').hide();
		$('#btnPrint').hide();
		if (obj.ReportID != "") {
			switch (StatusCode) {
				case "":
				case "1": //上报
					$('#btnSubmit').show();
					$('#btnRepTmp').hide();
					$('#btnCheck').show();
					$('#btnCanCheck').hide();
					$('#btnReturn').show();
					$('#btnDelete').show();
					$('#btnPrint').show();
					$('#btnClose').show();
					break;
				case "2": //审核
					$('#btnSubmit').hide();
					$('#btnRepTmp').hide();
					$('#btnCheck').hide();
					$('#btnCanCheck').show();
					$('#btnReturn').hide();
					$('#btnDelete').hide();
					$('#btnPrint').show();
					$('#btnClose').show();
					break;
				case "3": //退回
					$('#btnSubmit').show();
					$('#btnRepTmp').show();
					$('#btnCheck').hide();
					$('#btnCanCheck').hide();
					$('#btnReturn').hide();
					$('#btnDelete').hide();
					$('#btnPrint').hide();
					$('#btnClose').show();
					break;
				case "4": //作废
					$('#btnSubmit').hide();
					$('#btnRepTmp').hide();
					$('#btnCheck').hide();
					$('#btnCanCheck').hide();
					$('#btnReturn').hide();
					$('#btnDelete').hide();
					$('#btnPrint').hide();
					$('#btnClose').show();
					break;
				case "0": //草稿
					$('#btnSubmit').show();
					$('#btnRepTmp').show();
					$('#btnCheck').hide();
					$('#btnCanCheck').hide();
					$('#btnReturn').hide();
					$('#btnDelete').show();
					$('#btnPrint').hide();
					$('#btnClose').show();
					break;
				case "5":	//取消审核
					$('#btnSubmit').show();
					$('#btnRepTmp').hide();
					$('#btnCheck').show();
					$('#btnCanCheck').hide();
					$('#btnReturn').show();
					$('#btnDelete').show();
					$('#btnPrint').show();
					$('#btnClose').show();
					break;
			}
		}
		if (!tDHCMedMenuOper['Report']) {
			$('#btnSubmit').hide();
			$('#btnRepTmp').hide();
			$('#btnPrint').show();
			$('#btnDelete').hide();
		}
		if (!tDHCMedMenuOper['Check']) {
			$('#btnCheck').hide();
			$('#btnCanCheck').hide();
			$('#btnReturn').hide();
			$('#btnPrint').show();
		}
	}
	//作废
	obj.btnDelete_click = function () {
		if (obj.ReportID == "") return;
		$.messager.confirm("作废报告", "您确定要作废这份报告吗？", function (r) {
			if (r) {
				var ret = obj.SaveRepStatus(obj.ReportID, "4", '', session['LOGON.USERID']);
				if (ret == "1") {
					$.messager.alert("提示", "作废成功！", 'info');
					obj.InitReport();
				} else {
					$.messager.alert("提示", "作废失败，错误代码：" + ret + "！", 'info');
				}
			}
		});
	}
	//审核
	obj.btnCheck_click = function () {
		$.messager.confirm("审核报告", "您确定要审核这份报告吗？", function (r) {
			if (r) {
				var ret = obj.SaveRepStatus(obj.ReportID, "2", "", session['LOGON.USERID']);
				if (ret == "1") {
					$.messager.alert("提示", "审核成功！", 'info');
					obj.InitReport();
				} else if(ret=="-1") {
					$.messager.alert("提示", "不是提交状态的报卡，不能审核！", 'info');
				}
				else{
					$.messager.alert("提示", "审核失败，错误代码：" + ret + "！", 'info');
				}
			}
		});
	}
	//取消审核
	obj.btnCanCheck_click = function () {
		$.messager.confirm("取消审核报告", "您确定要取消审核这份报告吗？", function (r) {
			if (r) {
				var ret = obj.SaveRepStatus(obj.ReportID, "5", "", session['LOGON.USERID']);
				if (ret == "1") {
					$.messager.alert("提示", "取消审核成功！", 'info');
					obj.InitReport();
				} else {
					$.messager.alert("提示", "取消审核失败，错误代码：" + ret + "！", 'info');
				}
			}
		});
	}
	//退回
	obj.btnReturn_click = function () {
		$.messager.confirm("退回报告", "您确定要退回这份报告吗？", function (r) {
			if (r) {
				$.messager.prompt("退回报告", "请输入退回原因!", function (txt) {
					if (txt) {
						var ret = obj.SaveRepStatus(obj.ReportID, "3", txt, session['LOGON.USERID']);
						if (ret == "1") {
							$.messager.alert("提示", "退回成功！", 'info');
							obj.InitReport();
						} else {
							$.messager.alert("提示", "退回失败，错误代码：" + ret + "！", 'info');
						}
					} else if (txt === '') {
						$.messager.alert("提示", "未输入退回原因,报告不能退回！", 'info');
					}
				});
			}

		});
	}
	//打印
	obj.btnPrint_click = function () {
        debugger
		if (obj.RepTypeCode == "1") {
			debugger
			var fileName="{DHCMed.FBD.Report.raq(aReportID="+1+")}";
			//var fileName="{DHCMed.SMD.ReportIP.raq(aReportID="+obj.ReportID+")}";
		} else if (obj.RepTypeCode == "3") {
			alert(3)
			var fileName="{DHCMed.FBD.Report.raq(aReportID="+1+")}";
			//var fileName="{DHCMed.SMD.ReportOP.raq(aReportID="+obj.ReportID+")}";
		} else if (obj.RepTypeCode == "4") {
			var fileName="{DHCMed.SMD.DisReport.raq(aReportID="+obj.ReportID+")}";
		} 
		DHCCPM_RQDirectPrint(fileName);
	}
	
	
	//关闭
	obj.btnClose_click = function () {
		//if(top.$ && top.$("#WinModalEasyUI").length>0) top.$("#WinModalEasyUI").window("close");
		//websys_showModal支持多层弹出，使用websys_showModel('close')关闭最近一次界面 ,websys_showModel('options') 拿到最近一次界面的配置
		websys_showModal('close');

	}
	///  各触发事件


}



//弹出加载层
function loadingWindow() {
	var left = ($(window).outerWidth(true) - 190) / 2;
	var top = ($(window).height() - 35) / 2;
	var height = $(window).height() * 2;
	$("<div class=\"datagrid-mask\"></div>").css({ display: "block", width: "100%", height: height }).appendTo("#SMDReport");
	$("<div class=\"datagrid-mask-msg\"></div>").html("数据加载中,请稍候...").appendTo("#SMDReport").css({ display: "block", left: left, top: top });
}

//取消加载层  
function disLoadWindow() {
	$(".datagrid-mask").remove();
	$(".datagrid-mask-msg").remove();
}



function SetRepData(strReport){
	if (!strReport){
		return false;
	} 
	var arrFieldData = strReport.split(CHR_1);
	var ReportID     = arrFieldData[0];
	var EpisodeID    = arrFieldData[1];
	var PatientID    = arrFieldData[2];
	var RepTypeDr = arrFieldData[3].split(CHR_2);
	var AdmTypeDr = arrFieldData[4].split(CHR_2);
	var PatTypeDr = arrFieldData[5].split(CHR_2);
	var LocalDr   = arrFieldData[6].split(CHR_2);
	var DiseaseDr = arrFieldData[7].split(CHR_2);
	var DiseaseText = arrFieldData[8];
	var StatusDr  = arrFieldData[9].split(CHR_2);
	var Status =(StatusDr==""?"":StatusDr[1]);
	var CardNo    = arrFieldData[10];
	var WholenessDr = arrFieldData[11].split(CHR_2);
	//患者信息
	var arrFieldItem = arrFieldData[12].split(CHR_2);
	var PatInfo = new Object();
	{
		
		if (arrFieldItem.length > 9) {
			PatInfo.PatName = arrFieldItem[0];
			PatInfo.Sex = arrFieldItem[1];
			PatInfo.Birthday = arrFieldItem[2];
			PatInfo.PersonalID = arrFieldItem[3];
			PatInfo.Telephone = arrFieldItem[4];

			PatInfo.OPMrNo = arrFieldItem[6];
			PatInfo.IPMrNo = arrFieldItem[7];
			PatInfo.InsurNo = arrFieldItem[8];
			PatInfo.AdmType = arrFieldItem[9];
			PatInfo.arrNation = arrFieldItem[5].split(CHR_3);
		}
		DisplayPatient(PatInfo);
	}
	var Contactor = arrFieldData[13];
	var ContactorTel = arrFieldData[14];
	var HomeTel = arrFieldData[15];
	var RegAddrTypeDr = arrFieldData[16].split(CHR_2);
	var RegAddress = arrFieldData[17];
	var RegProvince = arrFieldData[18];
	var RegCity = arrFieldData[19];
	var RegCounty = arrFieldData[20];
	var RegVillage = arrFieldData[21];
	var RegRoad = arrFieldData[22];
	var CurrAddrTypeDr = arrFieldData[23].split(CHR_2);
	var CurrAddress = arrFieldData[24];
	var CurrProvince = arrFieldData[25];
	var CurrCity = arrFieldData[26];
	var CurrCounty = arrFieldData[27];
	var CurrVillage = arrFieldData[28];
	var CurrRoad = arrFieldData[29];
	var OccupationDr = arrFieldData[30].split(CHR_2);
	var Company = arrFieldData[31];
	var CompanyTel = arrFieldData[32];
	var SickDate = arrFieldData[33];
	var ReferralDr = arrFieldData[34];
	var ReferralTxt = arrFieldData[35];
	var DiagHospital = arrFieldData[36];
	var DiagDate = arrFieldData[37];
	var AdmitReasonDr = arrFieldData[38].split(CHR_2);
	var SymptomDr = arrFieldData[39];
	var SocietyImpact = arrFieldData[40];
	var SocietyImpactTxt = arrFieldData[41];
	var OPTreatmentDr = arrFieldData[42].split(CHR_2);
	var IPTreatTimes = arrFieldData[43];
	var FirstDrugTreatDate = arrFieldData[44];
	var DischDiagnos = arrFieldData[45].split(CHR_2);
	var PrognosisDr = arrFieldData[46].split(CHR_2);
	var IsFunding = arrFieldData[47].split(CHR_2)
	var FundsType = arrFieldData[48].split(CHR_2);
	var FundsSourceDr = arrFieldData[49].split(CHR_2);
	var FundsSource = arrFieldData[50];  					//修复经费来源其他不显示
	var TreatPharmacy = arrFieldData[51];
	var TreatMeasureDr = arrFieldData[52];
	var TreatMeasureTxt = arrFieldData[53];
	var RehabPharmacy = arrFieldData[54];
	var RehabMeasureDr = arrFieldData[55];
	var RehabMeasureTxt = arrFieldData[56];
	var RehabResume = arrFieldData[57];
	var ReportNote = arrFieldData[58];
	var ReportLoc = arrFieldData[59];
	var RepLocTel = arrFieldData[60];
	var ReportUser = arrFieldData[61];
	var ReportDate = arrFieldData[62];
	var ReportTime = arrFieldData[63];
	var CheckUser = arrFieldData[64];
	var CheckDate = arrFieldData[65];
	var CheckTime = arrFieldData[66];
	var PaymentDr = arrFieldData[67].split(CHR_2);
	var PatRelationDr = arrFieldData[68].split(CHR_2);
	var PatNationDr = arrFieldData[69].split(CHR_2);
	var CertTypeDr = arrFieldData[70].split(CHR_2);
	var NationalDr = arrFieldData[71].split(CHR_2);
	var HuBieDr = arrFieldData[72].split(CHR_2);
	var DegreeDr  = arrFieldData[73].split(CHR_2);
	var WedLockDr = arrFieldData[74].split(CHR_2);
	var HouseHoldDr = arrFieldData[75].split(CHR_2);
	var IsDrugTreatment = arrFieldData[76];
	var LockStatusDr = arrFieldData[77].split(CHR_2);
	var AssessmentDr = arrFieldData[78].split(CHR_2);   //既往危险性评估
	var Agree  = arrFieldData[79].split(CHR_2);   //知情同意
	var AgreeDate = arrFieldData[80];
	var Behaviors = arrFieldData[81];
	var Telephone2 = arrFieldData[82];
	var AdmitDate = arrFieldData[83];
	var DisDate = arrFieldData[84];
	var RepTypeCode=arrFieldData[85];
	$('#txtContactor').val(Contactor);
	$('#txtContactorTel').val(ContactorTel);
	$('#txtContactorTel2').val(Telephone2);
	$('#txtCompany').val(Company);
	$('#txtCompanyTel').val(CompanyTel);
	
	if (AdmTypeDr != ''){
		$('#cboAdmType').combobox('setValue',AdmTypeDr[0]);
		$('#cboAdmType').combobox('setText',AdmTypeDr[2]);
	}
	if (PatTypeDr != ''){
		$('#cboPatType').combobox('setValue',PatTypeDr[0]);
		$('#cboPatType').combobox('setText',PatTypeDr[2]);
	}
	$('#txtAdmitDate').datebox('setValue',AdmitDate);
	if (AdmTypeDr[2]=='住院'){
			$('#txtDischDate').datebox("setValue","");
	}
	if (RepTypeCode=="4"){
		var arrNation = arrFieldItem[5].split(CHR_3);
		if (arrNation != ''){
			$('#cboNation').combobox('setValue',arrNation[0]);
			$('#cboNation').combobox('setText',arrNation[2]);	
		}
		$('#txtDischDate').datebox('setValue',DisDate);		
	}else if ((RepTypeCode=="1")||(RepTypeCode=="3")){
		if (CertTypeDr!=""){
			$('#cboCertType').combobox('setValue',CertTypeDr[0]);
			$('#cboCertType').combobox('setText',CertTypeDr[2]);    //证件类型
		}
	}else{

	}
	if (!ReportID){
		var RepUser = session['LOGON.USERNAME'];
		var LocID = session['LOGON.CTLOCID'];
		var LocInfo = $m({                  
			ClassName:"DHCMed.Base.Ctloc",
			MethodName:"GetStringById",
			ctloc:LocID
		},false);
		var arrLocInfo = ($.trim(LocInfo) ? LocInfo.split('^'):'');
		$('#txtRepLoc').val(arrLocInfo[2]);
		$('#txtRepUser').val(RepUser);
		$('#txtRepDate').datebox('setValue',Common_GetDate(new Date()));

	}else{
		//显示报告信息
		if (StatusDr != ''){
			$('#txtRepStatus').val(StatusDr[2]);
		}
		if (WholenessDr != ''){
			$('#cboIsComplete').combobox('setValue',WholenessDr[0]);
			$('#cboIsComplete').combobox('setText',WholenessDr[2]);
		}
		if (OccupationDr != ''){
			$('#cboOccupation').combobox('setValue',OccupationDr[0]);
			$('#cboOccupation').combobox('setText',OccupationDr[2]);
		}
		
		if (AdmitReasonDr != ''){
			$('#cboAdmitReason').combobox('setValue',AdmitReasonDr[0]);
			$('#cboAdmitReason').combobox('setText',AdmitReasonDr[2]);
		}
		$('#txtCardNo').val(CardNo);
		$('#cboDisease').lookup('setText',DiseaseDr[1]);
		$('#DiseaseId').val(DiseaseDr[0]);   //用隐藏样式存储公用信息
		$('#txtDiseaseICD').val(DiseaseDr[2]);
			
		$('#txtSickDate').datebox('setValue',SickDate);
		$('#txtDiagHospital').val(DiagHospital);
		$('#txtDiagDate').datebox('setValue',DiagDate);   
		$('#txtRepLoc').val(ReportLoc);
		$('#txtRepLocTel').val(RepLocTel);
		$('#txtRepUser').val(ReportUser);
		$('#txtRepDate').datebox('setValue',ReportDate);
		$('#txtCheckUser').val(CheckUser);
		$('#txtCheckDate').datebox('setValue',CheckDate);
		$('#txtResume').val(ReportNote);
		
		if (DischDiagnos!=""){
			$('#cboDiagnose').lookup('setText',DischDiagnos[2]);
			$('#txtDiseaseICD').val(DischDiagnos[3]);
		}
		if (LocalDr!=""){
			$('#cboLocal').combobox('setValue',LocalDr[0]);
			$('#cboLocal').combobox('setText',LocalDr[2]);
		}
		if (RegAddrTypeDr!=""){
			$('#cboRegAddType').combobox('setValue',RegAddrTypeDr[0]);
			$('#cboRegAddType').combobox('setText',RegAddrTypeDr[2]);	
		}
		$('#cboRegProvince').combobox('setValue',RegProvince);
		$('#cboRegCity').combobox('setValue',RegCity);
		$('#cboRegCounty').combobox('setValue',RegCounty);
		$('#cboRegVillage').combobox('setValue',RegVillage);
		$('#txtRegRoad').val(RegRoad);
		if (CurrAddrTypeDr!=""){
			$('#cboCurrAddType').combobox('setValue',CurrAddrTypeDr[0]);
			$('#cboCurrAddType').combobox('setText',CurrAddrTypeDr[2]);	
		}
		$('#cboCurrProvince').combobox('setValue',CurrProvince);
		$('#cboCurrCity').combobox('setValue',CurrCity);
		$('#cboCurrCounty').combobox('setValue',CurrCounty);
		$('#cboCurrVillage').combobox('setValue',CurrVillage);
		$('#txtCurrRoad').val(CurrRoad);
		//送诊主体
		var strValue = '';
		var arrDic = ReferralDr.split("#");
		if (arrDic!=""){
			for (var i =0; i < arrDic.length; i ++) {
				var strDic = arrDic[i];
				if (strDic == "") continue;
				strValue = strDic.split("^")[0];
				$('#chkReferralList'+strValue).checkbox('setValue', true);
			}
		}
		$('#txtReferralTxt').val(ReferralTxt);
		
		if (PatRelationDr!=""){
			$('#cboPatRelationList').combobox('setValue',PatRelationDr[0]);
			$('#cboPatRelationList').combobox('setText',PatRelationDr[2]);
		}
		if (PatNationDr!=""){
			$('#cboPatNation').combobox('setValue',PatNationDr[0]);
			$('#cboPatNation').combobox('setText',PatNationDr[2]);    //国籍
		}
		if (CertTypeDr!=""){
			$('#cboCertType').combobox('setValue',CertTypeDr[0]);
			$('#cboCertType').combobox('setText',CertTypeDr[2]);    //证件类型
		}
		if (NationalDr!=""){
			$('#cboNational').combobox('setValue',NationalDr[0]);
			$('#cboNational').combobox('setText',NationalDr[2]);    //民族
		}
		if (HuBieDr!=""){
			$('#cboHuBie').combobox('setValue',HuBieDr[0]);
			$('#cboHuBie').combobox('setText',HuBieDr[2]);    //户别
		}
		if (DegreeDr !=""){
			$('#cboDegree ').combobox('setValue',DegreeDr [0]);
			$('#cboDegree ').combobox('setText',DegreeDr [2]);    //文化程度
		}
		if (WedLockDr!=""){
			$('#cboWedLock').combobox('setValue',WedLockDr[0]);
			$('#cboWedLock').combobox('setText',WedLockDr[2]);    //婚姻状况
		}
		if (HouseHoldDr!=""){
			$('#cboHouseHold').combobox('setValue',HouseHoldDr[0]);
			$('#cboHouseHold').combobox('setText',HouseHoldDr[2]);    //两系三代严重精神障碍家族史
		}
		if (IsDrugTreatment!=""){
			$HUI.radio("#IsDrugTreatment"+IsDrugTreatment).setValue(true);   //是否已进行抗精神药物治疗
		}
		if (LockStatusDr!=""){
			$('#cboLockStatus').combobox('setValue',LockStatusDr[0]);
			$('#cboLockStatus').combobox('setText',LockStatusDr[2]);      //既往关锁情况
		}
		if (AssessmentDr!=""){
			$('#cboAssessment').combobox('setValue',AssessmentDr[0]);
			$('#cboAssessment').combobox('setText',AssessmentDr[2]);      //既往危险性评估
		}
		if (Agree !=""){
			$('#cboAgree ').combobox('setValue',Agree [0]);
			$('#cboAgree ').combobox('setText',Agree [2]);      //知情同意
		}
		$('#txtAgreeDate').datebox('setValue',AgreeDate);       //知情同意时间
		$('#txtFDTreatDate').datebox('setValue',FirstDrugTreatDate);//首次抗精神疾病治疗时间
		$('#txtTreatTimes').val(IPTreatTimes);
		//既往危险行为
		var strValue = '';
		var arrDic = Behaviors.split("#");
		if (arrDic!=""){
			for (var i =0; i < arrDic.length; i ++) {
				var strDic = arrDic[i];
				if (strDic == "") continue;
				strValue = strDic.split("^")[0];
				$('#chkBehaviors'+strValue).checkbox('setValue', true);
			}
		}
		var arrayTreatPharmacy = TreatPharmacy.split("#");
		if (arrayTreatPharmacy!=""){
			for (var i = 0;i < arrayTreatPharmacy.length; i++) {
				var strDrug = arrayTreatPharmacy[i];
				if(strDrug == "") continue;
				var arrDrugInfo = strDrug.split("^");
				var index = parseInt(i)+1;
				$('#cboDrug'+index).lookup('setText',arrDrugInfo[1]);
				$('#txtNumber'+index).val(arrDrugInfo[2]);
				$('#txtTreatDoseQty'+index).val(arrDrugInfo[3]);
				//$('#cboDrug'+ind).val(arrDrugInfo[5]);
				$('#cboTreatUnit'+index).combobox("setValue",arrDrugInfo[6]);
				var IsLongTerm=arrDrugInfo[8];
				if (IsLongTerm!=""){
					$HUI.radio("#chkIsLong"+index+IsLongTerm).setValue(true);  
					$('#txtDrugSpec'+index+IsLongTerm).val(arrDrugInfo[9]);
				}else{
					$('#txtDrugSpec'+index+"1").val(arrDrugInfo[9]);
					$('#txtDrugSpec'+index+"0").val(arrDrugInfo[9]);
				}
				
				$('#txtUsageMorn'+index).val(arrDrugInfo[10]);
				$('#txtUsageNoon'+index).val(arrDrugInfo[11]);
				$('#txtUsageEven'+index).val(arrDrugInfo[12]);

			}
		}
		if ((RepTypeDr!=="")&&(RepTypeDr[1]==4))
		{
			//付费方式
			if (PaymentDr!=""){
				$('#cboPayment').combobox('setValue',PaymentDr[0]);
				$('#cboPayment').combobox('setText',PaymentDr[2]);
			}
			if (PatInfo!=""){
				$('#txtInsurNo').val(PatInfo.InsurNo);
			}
			
			if (OPTreatmentDr!=""){
				$HUI.radio('#radOPTreatmentList'+OPTreatmentDr[0]).setValue(true);
			}
			if (PrognosisDr!="")
			{	
				$('#cboPrognosis').combobox('setValue',PrognosisDr[0]);	
				$('#cboPrognosis').combobox('setText',PrognosisDr[2]);	
			}
			
			//家庭社会影响
			if (SocietyImpact!=""){
				var arrayStr = SocietyImpact.split(",");
				$('#txtCause').val(arrayStr[0]);
				$('#txtCause1').val(arrayStr[1]);
				$('#txtCause2').val(arrayStr[2]);
				$('#txtCause3').val(arrayStr[3]);
				$('#txtCause4').val(arrayStr[4]);
				$('#txtCause5').val(arrayStr[5]);
				$('#txtCauseNote').val(SocietyImpactTxt);
			}
			
			//精神症状
			var strValue = '';
			var arrDic = SymptomDr.split("#");
			if (arrDic!=""){
				for (var i =0; i < arrDic.length; i ++) {
					var strDic = arrDic[i];
					if (strDic == "") continue;
					strValue = strDic.split("^")[0];
					$('#chkSymptom'+strValue).checkbox('setValue', true);
					
				}
			}

			//住院经费
			if (IsFunding!=""){
				$HUI.radio('#radIsFundingList'+IsFunding[0]).setValue(true);
			}
			if (FundsType!=""){
				$HUI.radio('#radFundsTypeList'+FundsType[0]).setValue(true);
				$HUI.radio('#radFundsSourceList'+FundsSourceDr[0]).setValue(true);
				$('#txtFundsSource').val(FundsSource); 
			}
						
			//住院康复措施
			var strValue = '';
			var arrDic = TreatMeasureDr.split("#");
			if (arrDic!=""){
				for (var i =0; i < arrDic.length; i ++) {
					var strDic = arrDic[i];
					if (strDic == "") continue;
					strValue = strDic.split("^")[0];
					$('#chkTreatMeasureList'+strValue).checkbox('setValue', true);
					
				}
			}
			$('#txtTreatMeasureTxt').val(TreatMeasureTxt);
			
			//康复措施
			var strValue = '';
			var arrDic = RehabMeasureDr.split("#");
			if (arrDic!=""){
				for (var i =0; i < arrDic.length; i ++) {
					var strDic = arrDic[i];
					if (strDic == "") continue;
					strValue = strDic.split("^")[0];
					$HUI.radio('#chkRehabMeasureList'+strValue).setValue(true);
				}
			}
			$('#txtRehabMeasureTxt').val(RehabMeasureTxt);
			$('#txtRehabResume').val(RehabResume);
			//康复用药
			var arrayRehabPharmacy = RehabPharmacy.split("#");
			if (arrayRehabPharmacy!=""){
				for (var i = 0;i < arrayRehabPharmacy.length; i++) {
					var strDrug = arrayRehabPharmacy[i];
					if(strDrug == "") continue;
					var arrDrugInfo = strDrug.split("^");
					var index = parseInt(i)+1;
					$('#cboRehabDrug'+index).lookup('setText',arrDrugInfo[1]);
					$('#txtRehabNumber'+index).val(arrDrugInfo[2]);
					$('#txtRehabDoseQty'+index).val(arrDrugInfo[3]);
					//$('#cboDrug'+ind).val(arrDrugInfo[5]);
					$('#cboRehabUnit'+index).combobox("setValue",arrDrugInfo[6]);
					var IsLongTerm=arrDrugInfo[8];
					if (IsLongTerm!=""){
						$HUI.radio("#chkRehabIsLong"+index+IsLongTerm).setValue(true);  
						$('#txtRehabDrugSpec'+index+IsLongTerm).val(arrDrugInfo[9]);
					}else{
						$('#txtRehabDrugSpec'+index+"1").val(arrDrugInfo[9]);
						$('#txtRehabDrugSpec'+index+"0").val(arrDrugInfo[9]);
					}
					
					$('#txtRehabMorn'+index).val(arrDrugInfo[10]);
					$('#txtRehabNoon'+index).val(arrDrugInfo[11]);
					$('#txtRehabEven'+index).val(arrDrugInfo[12]);

				}
			}
		
		}
		return Status;
	}
	return Status;
}

//显示患者信息
function DisplayPatient(PatientObj) {
	$('#txtAdmitDate').datebox('disable');	//入院时间
	$('#txtPatName').val(PatientObj.PatName);
	$('#txtHomeTel').val(PatientObj.Telephone);
	$('#txtSex').val(PatientObj.Sex);
	$('#txtPersonalID').val(PatientObj.PersonalID);
	$('#txtBirthday').datebox('setValue', PatientObj.Birthday);
	$('#txtOPMrNo').val(PatientObj.OPMrNo);
	$('#txtIPMrNo').val(PatientObj.IPMrNo);
	$('#txtDiagHospital').val(HospDesc);
}
//精神症状
function SaveMentalSymptomToString()
{
	var strRet = "";
	$("input[name='chkSymptom']:checked").each(function(){
		strRet = strRet + $(this).val()+ "#";
	});
	return strRet;
} 
//住院/治疗用药
 function SaveTreatPharmacyToString()
{
	var strRet = "";
	strRet += "";
	strRet += "^" +  $.trim($('#cboDrug1').lookup('getText'));
	strRet += "^" +	 $.trim($('#txtNumber1').val());
	strRet += "^" +	 $.trim($('#txtTreatDoseQty1').val());
	strRet += "^" +  "mg";
	strRet += "^" +   $.trim($('#cboDrug1').val());
	strRet += "^" +	 $.trim($('#cboTreatUnit1').combobox("getValue"));
	strRet += "^" +  ""
	var IsLongTerm1=$.trim($("input[name='chkIsLong1']:checked").val());
	strRet += "^" +  IsLongTerm1;
	strRet += "^" + (IsLongTerm1==1?$.trim($('#txtDrugSpec11').val()):$.trim($('#txtDrugSpec10').val()));
	strRet += "^" + $.trim($('#txtUsageMorn1').val())
	strRet += "^" + $.trim($('#txtUsageNoon1').val())
	strRet += "^" + $.trim($('#txtUsageEven1').val())
	strRet += String.fromCharCode(1);
	strRet += "";
	strRet += "^" +  $.trim($('#cboDrug2').lookup('getText'));
	strRet += "^" +	 $.trim($('#txtNumber2').val());
	strRet += "^" +	 $.trim($('#txtTreatDoseQty2').val());
	strRet += "^" +  "mg";
	strRet += "^" +   $.trim($('#cboDrug2').val());
	strRet += "^" +	  $.trim($('#cboTreatUnit2').combobox("getValue"));
	strRet += "^" +  ""
	var IsLongTerm1=$.trim($("input[name='chkIsLong2']:checked").val());
	strRet += "^" +  IsLongTerm1;
	strRet += "^" + (IsLongTerm1==1?$.trim($('#txtDrugSpec21').val()):$.trim($('#txtDrugSpec20').val()));
	strRet += "^" + $.trim($('#txtUsageMorn2').val())
	strRet += "^" + $.trim($('#txtUsageNoon2').val())
	strRet += "^" + $.trim($('#txtUsageEven2').val())
	return strRet;
}
//康复用药
function SaveRehabPharmacyToString()
{
	var strRet = "";
	strRet += "";
	strRet += "^" +  $.trim($('#cboRehabDrug1').lookup('getText'));
	strRet += "^" +	 $.trim($('#txtRehabNumber1').val());
	strRet += "^" +	 $.trim($('#txtRehabDoseQty1').val());
	strRet += "^" +  "mg";
	strRet += "^" +   $.trim($('#cbRehabDrug1').val());
	strRet += "^" +	 $.trim($('#cboRehabUnit1').combobox("getValue"));
	strRet += "^" +  ""
	var IsLongTerm1=$.trim($("input[name='chkRehabIsLong1']:checked").val());
	strRet += "^" +  IsLongTerm1;
	strRet += "^" + (IsLongTerm1==1?$.trim($('#txtRehabDrugSpec11').val()):$.trim($('#txtRehabDrugSpec10').val()));
	strRet += "^" + $.trim($('#txtRehabMorn1').val())
	strRet += "^" + $.trim($('#txtRehabNoon1').val())
	strRet += "^" + $.trim($('#txtRehabEven1').val())
	strRet += String.fromCharCode(1);
	strRet += "";
	strRet += "^" +  $.trim($('#cboRehabDrug2').lookup('getText'));
	strRet += "^" +	 $.trim($('#txtRehabNumber2').val());
	strRet += "^" +	 $.trim($('#txtRehabDoseQty2').val());
	strRet += "^" +  "mg";
	strRet += "^" +   $.trim($('#cboRehabDrug2').val());
	strRet += "^" +	  $.trim($('#cboTreatUnit2').combobox("getValue"));
	strRet += "^" +  ""
	var IsLongTerm2=$.trim($("input[name='chkRehabIsLong1']:checked").val());
	strRet += "^" +  IsLongTerm2;
	strRet += "^" + (IsLongTerm2==1?$.trim($('#txtRehabDrugSpec21').val()):$.trim($('#txtDrugSpec20').val()));
	strRet += "^" + $.trim($('#txtRehabMorn2').val())
	strRet += "^" + $.trim($('#txtRehabNoon2').val())
	strRet += "^" + $.trim($('#txtRehabEven2').val())
	return strRet;
}
//判断某一元素在加载的html中是否存在
function IsExist(obj) {
	if ($('#'+obj).length > 0) {
		return 1;
	}else {
		return 0;
	}
}
