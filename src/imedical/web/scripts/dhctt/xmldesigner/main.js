var invoiceData,mycontext,xmlEditInited=!1,XmlViewContentModifyFlag=!1,isOpenXmlFlag=!1,basesrc=location.href.split("/web/")[0]+"/web/",defaultImgPath="scripts/xmldesigner/img/defaultimg.jpg",mycanvas=document.getElementById("lineLayout");mycanvas.getContext&&(mycontext=mycanvas.getContext("2d"));var _attrCellTpl='<tr id="tr-${id}" class="trCtrlAttr"><td class ="tdCtrlAttrLeft">${desc}</td><td class ="tdCtrlAttrRight"><input id="t-${id}" type="text" class ="numberStyle" maxlength="3"/></td></tr>',dragParams={target:null,mouseDownFlag:!1,top:0,left:0,currentX:0,currentY:0},selectCompSet=[];dragParams.left=$("#dbLayout").css("left"),dragParams.top=$("#dbLayout").css("top");var getCss=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]};function subFloat(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a}function pxToPt(e){return subFloat(parseFloat(e,10)/3.78,3)}function ptToPx(e){return subFloat(3.78*parseFloat(e,10),0)}function windowToCanvas(e,t){var a=mycanvas.getBoundingClientRect();return{x:Math.round(e-a.left),y:Math.round(t-a.top)}}var resizeLayout=function(e,t){$("#dbLayout").css("height",t).css("width",e),$("#lineLayout").attr("width",e).attr("height",t),xmldesigner.line.method.draw()},xmlChangeCallback=function(){xmlTextAreaKeyDown()},xmlEditInitCallback=function(){xmlEditInited=!0},showXmlView=function(){$("#lo").layout("collapse","west"),$("#lo").layout("collapse","east");var e=getCurrXml();if(0==$("#frame_xmlTextArea").length){var t=$("#centerdesignebar").parent().parent().layout("panel","center").panel("options");$("#xmlTextArea").css("width",t.width-22).css("height",t.height-13).show(),editAreaLoader.init({id:"xmlTextArea",start_highlight:!0,allow_resize:"both",allow_toggle:!1,word_wrap:!0,language:"zh",toolbar:"go_to_line",syntax:"xml",change_callback:"xmlChangeCallback",EA_init_callback:"xmlEditInitCallback"})}else $("#frame_xmlTextArea").show();editAreaLoader.setValue("xmlTextArea",e),$("#dbLayout").hide()},showDesView=function(){$("#frame_xmlTextArea").hide(),$("#dbLayout").show(),$("#lo").layout("expand","east"),$("#lo").layout("expand","west");var e=editAreaLoader.getValue("xmlTextArea");drawByXml(e)},xmlTextAreaKeyDown=function(){$("#SaveMenu").hasClass("imggray")&&enableMenuItem("SaveMenu","save")},drawLayout=function(){var e=invoiceData.height,t=invoiceData.width;"Z"==invoiceData.LandscapeOrientation&&(e=20),resizeLayout(ptToPx(10*t),ptToPx(10*e))},recordBoxLeftAndTop=function(e){"auto"!=getCss(e,"left")&&(dragParams.left=getCss(e,"left")),"auto"!=getCss(e,"top")&&(dragParams.top=getCss(e,"top"))},setDragParams=function(e){dragParams.mouseDownFlag=!0,dragParams.target=e.target,dragParams.currentX=e.clientX,dragParams.currentY=e.clientY,recordBoxLeftAndTop(dragParams.target)},disableMenuItem=function(e,t){$("#"+e).addClass("imggray"),$("#"+e).removeClass("pic").removeClass("pic_"+t).addClass("graypic").addClass("gray_"+t)},enableMenuItem=function(e,t){$("#"+e).removeClass("imggray"),$("#"+e).removeClass("graypic").removeClass("gray_"+t).addClass("pic_"+t).addClass("pic")},setCtrlAttr=function(e){var t=$("#t-type").val(),a=$("#t-ind").val();enableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas"),"layout"==t&&("t-PrtPaperSet"!=e.target.id&&"t-LandscapeOrientation"!=e.target.id||validPrtPaperSet(),invoiceData.LandscapeOrientation=$("#t-LandscapeOrientation").val(),invoiceData.PrtPaperSet=$("#t-PrtPaperSet").val(),invoiceData.height=$("#t-height").val(),invoiceData.width=$("#t-width").val(),invoiceData.PaperDesc=$("#t-PaperDesc").val(),invoiceData.PrtDevice=$("#t-PrtDevice").val(),invoiceData.PrtPage=$("#t-PrtPage").val(),invoiceData.XMLClassMethod=$("#t-XMLClassMethod").val(),invoiceData.XMLClassQuery=$("#t-XMLClassQuery").val(),drawLayout()),"undefined"!=typeof xmldesigner[t]&&xmldesigner[t].method&&xmldesigner[t].method.drawByAttrTable&&xmldesigner[t].method.drawByAttrTable(a)},resetAttrTable=function(e){var t=e.attr("data-ind"),a=e.attr("data-type");if(-1<t){if("lineLayout"==e.attr("id"))for(var r in invoiceData)-1<r.indexOf("-")?($("#tr"+r).show(),$("#t"+r).val(invoiceData[r])):($("#tr-"+r).show(),$("#t-"+r).val(invoiceData[r]));"layout"==a&&validPrtPaperSet(),"undefined"!=typeof xmldesigner[a]&&xmldesigner[a].method.showAttrsByInd&&xmldesigner[a].method.showAttrsByInd(t),xmldesigner.line.method.draw()}},selectItem=function(e,t){if($("#t-height").attr("disabled",!1),$("#t-width").attr("disabled",!1),$("#t-PrtPage").attr("disabled",!1),$("#tr-height .tdCtrlAttrLeft a").text("高度"),$(".trCtrlAttr").hide(),e){if(enableMenuItem("DelMenu","del"),e=$(e),t.ctrlKey){var a=selectCompSet.indexOf(e);-1<a?(e.removeClass("x-selected"),selectCompSet.splice(a,1)):(e.addClass("x-selected"),selectCompSet.push(e))}else clearSelectItem(),e.addClass("x-selected"),selectCompSet.push(e);resetAttrTable(e)}else clearSelectItem(),disableMenuItem("DelMenu","del"),validPrtPaperSet()},clearSelectItem=function(){for(var e=!1,t=selectCompSet.length-1;-1<t;t--)$(selectCompSet[t]).removeClass("x-selected"),"line"==$(selectCompSet[t]).attr("data-type")&&(e=!0),selectCompSet.pop();e&&xmldesigner.line.method.draw()},drawByXml=function(e){invoiceData={},disableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas"),enableMenuItem("PrintViewMenu","printview"),enableMenuItem("PrintOutMenu","printout"),enableMenuItem("PrintOutLODOPMenu","printout"),xmldesigner.label.method.init(),xmldesigner.line.method.init(),xmldesigner.list.method.init(),xmldesigner.listItem.method.init(),xmldesigner.qrcode.method.init(),xmldesigner.barcode.method.init(),xmldesigner.img.method.init(),dragParams={target:null,mouseDownFlag:!1,top:0,left:0,currentX:0,currentY:0},selectItem(""),selectCompSet=[],$("#lineLayout").siblings().remove(),xmlEditInited&&editAreaLoader.setValue("xmlTextArea",e);var t=e;if(""!=t){var a=new XML.ObjTree,r=$.trim(t),i=a.parseXML(r);if(i.html)alert("XML格式错误");else{(invoiceData=i.appsetting.invoice)["-LandscapeOrientation"]=invoiceData["-LandscapeOrientation"]||"Y",invoiceData.LandscapeOrientation=invoiceData["-LandscapeOrientation"]||"Y",invoiceData.ind=0,invoiceData.type="layout",invoiceData.height=invoiceData["-height"]||"",invoiceData.width=invoiceData["-width"]||"",invoiceData.PrtPaperSet=invoiceData["-PrtPaperSet"]||"",invoiceData.PaperDesc=invoiceData["-PaperDesc"]||"",invoiceData.PrtDevice=invoiceData["-PrtDevice"]||"",invoiceData.PrtPage=invoiceData["-PrtPage"]||"",invoiceData.XMLClassMethod=invoiceData["-XMLClassMethod"]||"",invoiceData.XMLClassQuery=invoiceData["-XMLClassQuery"]||"",drawLayout();var n="";if("object"==typeof i.appsetting.invoice.TxtData){if($.isArray(invoiceData.TxtData)){invoiceData.TxtDataAll={},invoiceData.TxtDataAll["-RePrtHeadFlag"]="N",invoiceData.TxtDataAll.txtdatapara=[];for(var l=0;l<invoiceData.TxtData.length;l++){var o=invoiceData.TxtData[l].txtdatapara;"object"==typeof o&&($.isArray(o)||(o=[o]),invoiceData.TxtDataAll.txtdatapara=invoiceData.TxtDataAll.txtdatapara.concat(o))}invoiceData.TxtData=invoiceData.TxtDataAll,delete invoiceData.TxtDataAll}if("object"==typeof(n=i.appsetting.invoice.TxtData.txtdatapara)){$.isArray(n)||(n=[n]);for(l=0;l<n.length;l++)"undefined"!=typeof n[l]["-isqrcode"]&&"true"==n[l]["-isqrcode"]?(xmldesigner.qrcode.data.push(n[l]),xmldesigner.qrcode.method.drawByInd(xmldesigner.qrcode.data.length-1)):"undefined"!=typeof n[l]["-barcodetype"]?(xmldesigner.barcode.data.push(n[l]),xmldesigner.barcode.method.drawByInd(xmldesigner.barcode.data.length-1)):(xmldesigner.label.data.push(n[l]),xmldesigner.label.method.drawByInd(xmldesigner.label.data.length-1));delete i.appsetting.invoice.TxtData.txtdatapara}}if("object"==typeof i.appsetting.invoice.PLData&&"object"==typeof(n=i.appsetting.invoice.PLData.PLine)){$.isArray(n)||(n=[n]);for(l=0;l<n.length;l++){var s=xmldesigner.line.method.item2Json(n,l);xmldesigner.line.data.push(s)}xmldesigner.line.method.draw(),delete i.appsetting.invoice.PLData.PLine}if("object"==typeof i.appsetting.invoice.ListData){n=i.appsetting.invoice.ListData;s=xmldesigner.list.method.item2Json(n,0);if(xmldesigner.list.data.push(s),xmldesigner.list.method.drawByInd(xmldesigner.list.data.length-1),"object"==typeof(n=i.appsetting.invoice.ListData.Listdatapara)){$.isArray(n)||(n=[n]);for(l=0;l<n.length;l++)xmldesigner.listItem.data.push(n[l]),xmldesigner.listItem.method.drawByInd(l),0==l&&(xmldesigner.list.data[xmldesigner.list.data.length-1].y=n[l].y,xmldesigner.list.method.drawByInd(xmldesigner.list.data.length-1));delete i.appsetting.invoice.ListData.Listdatapara}}if("object"==typeof i.appsetting.invoice.PICData&&(n=i.appsetting.invoice.PICData.PICdatapara)){$.isArray(n)||(n=[n]);for(l=0;l<n.length;l++){s=xmldesigner.img.method.item2Json(n,l);xmldesigner.img.data.push(s),xmldesigner.img.method.drawByInd(l)}delete i.appsetting.invoice.PICData.PICdatapara}}return!0}},validPrtPaperSet=function(){"WIN"==$("#t-PrtPaperSet").val()?($("#t-height").attr("disabled",!0),$("#t-width").attr("disabled",!0),$("#t-PrtPage").attr("disabled",!1)):($("#t-height").attr("disabled",!1),$("#t-width").attr("disabled",!1),$("#t-PrtPage").attr("disabled",!0)),"Z"==$("#t-LandscapeOrientation").val()?$("#tr-height .tdCtrlAttrLeft a").text("底边空白高度(cm)"):$("#tr-height .tdCtrlAttrLeft a").text("高度")},loadXmlTpl=function(e,t,a){$.ajaxRunServerMethod({ClassName:"web.DHCXMLPConfig",MethodName:"ReadXmlByID",RowID:e},function(e){drawByXml(e),validPrtPaperSet()}),$("#currentXmlTplDesc").html(a),$("#currentXmlTplName").html(t)},deleteProps=function(e,t){for(var a=0;a<t.length;a++)delete e[t[a]]},OpenXml=function(){isOpenXmlFlag||$("#XMLListTbl").datagrid({fit:!0,rownumbers:!0,pagination:!0,striped:!0,singleSelect:!0,pageSize:100,pageList:[100],queryParams:{QueryName:"ReadAllByName",ClassName:"web.DHCXMLPConfig",Name:$("#XMLTplName").val()},onDblClickRow:function(e,t){loadXmlTpl(t.ID,t.XPC_Flag,t.XPC_Note1),reportId=t.ID,reportName=t.XPC_Flag,$("#XMLListWin").window("minimize")},url:"jquery.easyui.querydatatrans.csp",columns:[[{field:"ID",title:"ID",width:100,align:"left",hidden:!0},{field:"XPC_Flag",title:"XML模板名",width:200,align:"left",hidden:!1},{field:"XPC_Note1",title:"描述",width:200,align:"right"}]]}),$("#XMLListWin").window("open")},printView=function(){""==$("#currentXmlTplName").html()||websys_printview(reportName,"showPrintBtn=1&xmldesigner=1")},printOut=function(){websys_printout(reportName)},printOutLODOP=function(){websys_printout(reportName,"isLodop=1")},delCtrl=function(){if($("#DelMenu").hasClass("imggray"));else{for(var e=0,t="",a=!1,r=0;r<selectCompSet.length;r++)t=selectCompSet[r].attr("data-type"),e=selectCompSet[r].attr("data-ind"),"line"==t&&(a=!0),"undefined"!=typeof xmldesigner[t]&&xmldesigner[t].method.delItem&&xmldesigner[t].method.delItem(e),selectCompSet.splice(r,1);a&&xmldesigner.line.method.draw()}};function getCurrXml(){if(void 0===invoiceData)return"";if("none"==$("#dbLayout").css("display"))return editAreaLoader.getValue("xmlTextArea");var e=$.extend(!0,{},invoiceData,{"-LandscapeOrientation":invoiceData.LandscapeOrientation,"-PrtPaperSet":invoiceData.PrtPaperSet||"","-PrtDevice":invoiceData.PrtDevice||"","-PrtPage":invoiceData.PrtPage||"","-PaperDesc":invoiceData.PaperDesc,"-width":invoiceData.width,"-height":invoiceData.height,"-XMLClassMethod":invoiceData.XMLClassMethod,"-XMLClassQuery":invoiceData.XMLClassQuery});deleteProps(e,["ind","type","LandscapeOrientation","PrtPaperSet","PrtDevice","PrtPage","PaperDesc","width","height","XMLClassMethod","XMLClassQuery"]),e.TxtData||(e.TxtData={"-RePrtHeadFlag":invoiceData.TxtData&&invoiceData.TxtData["-RePrtHeadFlag"]||"N"}),e.PLData||(e.PLData={"-RePrtHeadFlag":invoiceData.PLData&&invoiceData.PLData["-RePrtHeadFlag"]||"Y"}),e.PICData||(e.PICData={"-RePrtHeadFlag":invoiceData.PICData&&invoiceData.PICData["-RePrtHeadFlag"]||"N"}),e.TxtData.txtdatapara=xmldesigner.label.method.genXmlJson(),Array.prototype.push.apply(e.TxtData.txtdatapara,xmldesigner.qrcode.method.genXmlJson()),Array.prototype.push.apply(e.TxtData.txtdatapara,xmldesigner.barcode.method.genXmlJson()),e.PLData.PLine=xmldesigner.line.method.genXmlJson();var t=xmldesigner.list.method.genXmlJson();return 0<t.length&&(e.ListData=t[0],e.ListData.Listdatapara=xmldesigner.listItem.method.genXmlJson()),e.PICData.PICdatapara=xmldesigner.img.method.genXmlJson(),(new XML.ObjTree).writeXML({appsetting:{invoice:e}})}var SaveXml=function(){if($("#SaveMenu").hasClass("imggray"));else{if(""==$("#currentXmlTplName").html())return!1;var e=getCurrXml();$.ajax({url:"jquery.easyui.broker.csp",data:{ClassName:"web.DHCXMLPConfig",MethodName:"UpdateReport",ID:reportId,xml:e},type:"POST",success:function(e){1!=e?$.messager.alert("提示","保存失败!"+e):disableMenuItem("SaveMenu","save")},error:function(e,t){alert("JQuery: RunClassMethodError !\n"+t)}})}},NewXMLTplClick=function(){var t=$("#xmlNewId").val(),a=$("#xmlNewName").val(),r=$("#xmlNewDesc").val(),i=$("#XMLNewNameError");if(""!=a)if(""!=r){var e="",n="AddNewReport",l=$("#XMLNewNameWin").attr("data-opener");"saveas"==l?e=getCurrXml():"modifyflagnote"==l&&(n="ModifyFlagNote"),$.ajax({url:"jquery.easyui.broker.csp",data:{ClassName:"web.DHCXMLPConfig",MethodName:n,ID:t,xml:e,flgName:a,Note:r},type:"POST",success:function(e){0<e?($("#XMLNewNameWin").window("minimize"),"modifyflagnote"==l&&($("#currentXmlTplName").html(a),$("#currentXmlTplDesc").html(r)),""==t&&(loadXmlTpl(e,a,r),reportId=e,reportName=a,$("#currentXmlTplName").html(a),$("#currentXmlTplDesc").html(r))):i.html(e)},error:function(e,t){alert("JQuery: RunClassMethodError !\n"+t)}})}else i.html("描述不能为空.");else i.html("名字不能为空.")},moveAllItem=function(r,i){i=parseInt(i);$.each("label,line,img,barcode,qrcode".split(","),function(e,t){for(var a=0;a<xmldesigner[t].data.length;a++)xmldesigner[t].method.move(r,a,i)}),xmldesigner.line.method.draw()},moveItem=function(e,t){for(var a,r,i,n=!1,l=0;l<selectCompSet.length;l++)r=(a=selectCompSet[l]).attr("data-ind"),"line"==(i=a.attr("data-type"))&&(n=!0),xmldesigner[i].method.move(e,r,t);n&&xmldesigner.line.method.draw()},alignSelectItem=function(e,t,a,r){xmldesigner.line.data,xmldesigner.label.data;for(var i,n,l,o=!1,s=1;s<selectCompSet.length;s++)n=(i=selectCompSet[s]).attr("data-ind"),"line"==(l=i.attr("data-type"))&&(o=!0),xmldesigner[l].method.alignItem(n,t,a,r);o&&xmldesigner.line.method.draw()},AlignCtrl=function(e){var t,a,r,i,n,l,o,s,d=selectCompSet[0],m=d.attr("data-type"),c=xmldesigner[m].method.getItemOffset(d);switch(t=c.x,a=c.y,r=c.w,n=a+(i=c.h),l=t+r,o=a+i/2,s=t+r/2,e){case"LEFTALIGN":alignSelectItem(m,"x",t);break;case"TOPALIGN":alignSelectItem(m,"y",a);break;case"BOTTOMALIGN":alignSelectItem(m,"b",n);break;case"RIGHTALIGN":alignSelectItem(m,"r",l);break;case"H-ALIGN":alignSelectItem(m,"ha",o);break;case"V-ALIGN":alignSelectItem(m,"va",s);break;case"H-EQUAL":alignSelectItem(m,"h",i);break;case"W-EQUAL":alignSelectItem(m,"w",r);break;case"S-EQUAL":alignSelectItem(m,"s",i,r)}},newXml=function(){$("#xmlNewId").val(""),$("#xmlNewName").val(""),$("#xmlNewDesc").val(""),$("#XMLNewNameWin").window("open").window("setTitle","新建模板"),$("#XMLNewNameWin").attr("data-opener","new"),$("#XMLNewNameError").html("")},SaveAs=function(){$("#xmlNewId").val(""),$("#xmlNewName").val(""),$("#xmlNewDesc").val(""),""!=$("#currentXmlTplName").html()&&($("#XMLNewNameWin").window("open").window("setTitle","另存为模板"),$("#XMLNewNameWin").attr("data-opener","saveas"),$("#XMLNewNameError").html(""))},modifyCurrXmlTplDesc=function(){var e=$("#currentXmlTplName").html(),t=$("#currentXmlTplDesc").html();$("#xmlNewId").val(reportId),$("#xmlNewName").val(e),$("#xmlNewDesc").val(t),$("#XMLNewNameWin").window("open").window("setTitle","修改描述"),$("#XMLNewNameWin").attr("data-opener","modifyflagnote"),$("#XMLNewNameError").html("")},OpenXMLTpl=function(){var e=$("#XMLListTbl").datagrid("getSelected");e&&(loadXmlTpl(e.ID,e.XPC_Flag,e.XPC_Note1),reportId=e.ID,reportName=e.XPC_Flag,$("#XMLListWin").window("minimize"))},DelXMLTpl=function(){var t=$("#XMLListTbl").datagrid("getSelected");t&&$.messager.confirm("确认","您确定删除"+t.XPC_Flag+"?",function(e){e&&$.ajaxRunServerMethod({ClassName:"web.DHCXMLPConfig",MethodName:"DeleteReportByID",ID:t.ID},function(e){0<e?$("#XMLListTbl").datagrid("load",{QueryName:"ReadAllByName",ClassName:"web.DHCXMLPConfig",Name:$("#XMLTplName").val()}):$.messager.alert("提示","删除错误!"+e)})})},excuteCmd=function(e){var t=e.toUpperCase();switch(t){case"NEWXML":newXml();break;case"OPENXML":OpenXml();break;case"PRINTVIEW":printView();break;case"PRINTOUT":printOut();break;case"PRINTOUTLODOP":printOutLODOP();break;case"SAVE":SaveXml();break;case"SAVEAS":SaveAs();break;case"CUT":0<this.options.selectCtrls.length&&excuteSaveUnDo.apply(this),copyCtrl(),document.execCommand("Delete"),this.options.selectCtrls=new Array;break;case"COPY":copyCtrl();break;case"PASTE":pastCtrl();break;case"DELETE":delCtrl();break;case"UNDO":this.UnDo();break;case"REDO":this.ReDo();break;case"TOFRONT":adjustCtrlPosition(!0);break;case"TOBACK":adjustCtrlPosition(!1);break;case"SELECTEDMOVE":$('<div id="allItemMove" style="padding:10px;"></div>').appendTo(document.body).window({title:"整体元素位置移动",resizable:!1,width:250,height:280,maximizable:!1,minimizable:!1,collapsible:!1,content:'<div style="margin:20px auto;text-align: center;"><label>一次移动长度(mm)：</label><input id="moveStepNpt" value="10" style="width:25px;"/></div>\t\t\t\t\t\t\t<table style="margin:30px auto;"><tr><td></td><td><a href="javascript:moveAllItem(\'top\',document.getElementById(\'moveStepNpt\').value);" class="easyui-linkbutton">上</a></td><td></td></tr>\t\t\t\t\t\t\t<tr><td><a href="javascript:moveAllItem(\'left\',document.getElementById(\'moveStepNpt\').value);" class="easyui-linkbutton">左</a></td><td></td>\t\t\t\t\t\t\t<td><a href="javascript:moveAllItem(\'right\',document.getElementById(\'moveStepNpt\').value);" class="easyui-linkbutton">右</a></td>\t\t\t\t\t\t\t<tr><td></td><td><a href="javascript:moveAllItem(\'bottom\',document.getElementById(\'moveStepNpt\').value);" class="easyui-linkbutton">下</a></td><td></td></tr>'}).show().window("move",{right:300});break;default:AlignCtrl(t)}},init=function(){var e=$("#centerdesignebar").height();$("#lo").css("height",document.body.clientHeight),$("#lo").layout("resize");$(document).width();$("#lineLayout").attr("width",$("#dbLayout").width()).attr("height",e),$(".toolbar").on("mousedown",function(e){var t=$(e.target);if(t.hasClass("CtrlItem")||t.parent().hasClass("CtrlItem")){enableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas");var a="";t.hasClass("CtrlItem")&&(a=t.attr("ctrltype")),t.parent().hasClass("CtrlItem")&&(a=t.parent().attr("ctrltype")),"object"==typeof xmldesigner[a]&&"object"==typeof xmldesigner[a].method&&xmldesigner[a].method.drawNew()}}),$("#centerdesignebar").on("mousedown",function(e){var t=$(e.target);t.attr("data-type");if(t.hasClass("ctrldrag"))enableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas"),e=e||window.event,t.hasClass("ctrldrag")&&(e.target.onselectstart=function(){return!1},setDragParams(e)),selectItem(e.target,e);else{var a=xmldesigner.line.method.getLineByPoint(e.offsetX,e.offsetY);-1<a?selectItem(document.getElementById("midline"+a),e):"lineLayout"==e.target.id?(enableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas"),e=e||window.event,selectItem(e.target,e)):selectItem("")}}),$("#dbLayout").delegate(".ctrldrag","mousemove",function(e){e.preventDefault();e=e||window.event;var t=$(dragParams.target);if(dragParams.mouseDownFlag){var a=t.attr("data-type");xmldesigner[a].method.dragMove(e,dragParams)}else;}),$("body").on("mouseup",function(e){e.preventDefault();var t=$(e.target);if(t.attr("cmd")&&excuteCmd(t.attr("cmd")),t.hasClass("pic")&&excuteCmd(t.parent().attr("cmd")),dragParams.mouseDownFlag&&dragParams.target){var a=$(dragParams.target),r=a.attr("data-ind"),i=a.attr("data-type");xmldesigner[i].method.dragEnd(dragParams.target,r,e)}dragParams.mouseDownFlag=!1,dragParams.target=null}),$(".centerlayout").on("keydown",function(e){var t=$(dragParams.target),a=(t.attr("data-ind"),t.attr("data-type"),e.ctrlKey?10:1);if(-1<[37,38,39,40].indexOf(e.keyCode)){if(e.stopPropagation(),37==e.keyCode)return moveItem("left",a),!1;if(38==e.keyCode)return moveItem("top",a),!1;if(39==e.keyCode)return moveItem("right",a),!1;if(40==e.keyCode)return moveItem("bottom",a),!1}}),$("body").on("keydown",function(e){if(46==e.keyCode||17==e.keyCode||e.ctrlKey&&83==e.keyCode){if(e.ctrlKey&&83==e.keyCode)return excuteCmd("Save"),!1;if(46==e.keyCode)return"INPUT"==e.target.tagName.toUpperCase()||(excuteCmd("DELETE"),!1)}e.returnValue=!1}),$("#tbCtrlAttr").delegate(".numberStyle,.txtStyle","keydown",function(e){13==(e.keyCode?e.keyCode:e.which)&&setCtrlAttr(e)}),$("#tbCtrlAttr").delegate(".numberStyle,.txtStyle","focusout",function(e){setCtrlAttr(e)}),$("#tbCtrlAttr").delegate("#t-defaultvalue","dblclick",function(e){1==selectCompSet.length&&$(selectCompSet[0]).attr("data-type")}),$("#tbCtrlAttr").delegate(".selStyle","change",function(e){setCtrlAttr(e)}),"undefined"!=typeof reportId&&0<reportId&&loadXmlTpl(reportId,reportName,"6666"),$("#XMLTplName").on("keyup",function(){$("#XMLListTbl").datagrid("load",{QueryName:"ReadAllByName",ClassName:"web.DHCXMLPConfig",Name:$("#XMLTplName").val()})}),$("#currentXmlTplName,#currentXmlTplDesc").on("click",modifyCurrXmlTplDesc),$("#printTestA").on("click",function(){return websys_createWindow("dhctt.xmlprinttest.csp","1","width=330,height=180,top=200,left=450,toolbar=no,location=no,directories=no,menubar=no,scrollbars=yes,resizable=yes"),!1}),$("#printTestB").on("click",function(){return websys_createWindow("dhctt.xmlprinttest2.csp","1","width=330,height=180,top=200,left=450,toolbar=no,location=no,directories=no,menubar=no,scrollbars=yes,resizable=yes"),!1}),$("#printTestC").on("click",function(){return websys_createWindow("dhctt.xmlprinttest3.csp","1","width=330,height=180,top=200,left=450,toolbar=no,location=no,directories=no,menubar=no,scrollbars=yes,resizable=yes"),!1}),$("#printHelpA").on("click",function(){return websys_createWindow("../html/help/CH/XML打印.pdf","2","width=530,height=600,top=10,left=150,toolbar=no,location=no,directories=no,menubar=no,scrollbars=yes,resizable=yes"),!1}),$("#printFontA").on("click",function(){return 0==$("#dg").length&&$('<table id="dg"></table>').append("body"),$("#dg").datagrid({width:300,height:500,data:[{f1:"宋体",f2:"宋体"},{f1:"jjjj",f2:"雅黑"}],columns:[[{field:"f1",title:"代码",width:100},{field:"f2",title:"名称",width:100}]]}),!1})};$(init);