var invoiceData,mycontext,xmlEditInited=!1,XmlViewContentModifyFlag=!1,isOpenXmlFlag=!1,basesrc=location.href.split("/web/")[0]+"/web/",defaultImgPath="scripts/xmldesigner/img/defaultimg.jpg",mycanvas=document.getElementById("lineLayout"),_attrCellTpl=(mycanvas.getContext&&(mycontext=mycanvas.getContext("2d")),'<tr id="tr-${id}" class="trCtrlAttr"><td class ="tdCtrlAttrLeft">${desc}</td><td class ="tdCtrlAttrRight"><input id="t-${id}" type="text" class ="numberStyle" maxlength="3"/></td></tr>'),dragParams={target:null,mouseDownFlag:!1,top:0,left:0,currentX:0,currentY:0},selectCompSet=[],getCss=(dragParams.left=$("#dbLayout").css("left"),dragParams.top=$("#dbLayout").css("top"),function(e,t){return(e.currentStyle||document.defaultView.getComputedStyle(e,!1))[t]});function subFloat(e,t){t=Math.pow(10,t);return Math.round(e*t)/t}function pxToPt(e){return subFloat(parseFloat(e,10)/3.78,3)}function ptToPx(e){return subFloat(3.78*parseFloat(e,10),0)}function windowToCanvas(e,t){var a=mycanvas.getBoundingClientRect();return{x:Math.round(e-a.left),y:Math.round(t-a.top)}}var resizeLayout=function(e,t){$("#dbLayout").css("height",t).css("width",e),$("#lineLayout").attr("width",e).attr("height",t),xmldesigner.line.method.draw()},xmlChangeCallback=function(){xmlTextAreaKeyDown()},xmlEditInitCallback=function(){xmlEditInited=!0},showXmlView=function(){$("#lo").layout("collapse","west"),$("#lo").layout("collapse","east");var e,t=getCurrXml();0==$("#frame_xmlTextArea").length?(e=$("#centerdesignebar").parent().parent().layout("panel","center").panel("options"),$("#xmlTextArea").css("width",e.width-22).css("height",e.height-13).show(),editAreaLoader.init({id:"xmlTextArea",start_highlight:!0,allow_resize:"both",allow_toggle:!1,word_wrap:!0,language:"zh",toolbar:"go_to_line",syntax:"xml",change_callback:"xmlChangeCallback",EA_init_callback:"xmlEditInitCallback"})):$("#frame_xmlTextArea").show(),editAreaLoader.setValue("xmlTextArea",t),$("#dbLayout").hide()},showDesView=function(){$("#frame_xmlTextArea").hide(),$("#dbLayout").show(),$("#lo").layout("expand","east"),$("#lo").layout("expand","west");var e=editAreaLoader.getValue("xmlTextArea");drawByXml(e)},xmlTextAreaKeyDown=function(){$("#SaveMenu").hasClass("imggray")&&enableMenuItem("SaveMenu","save")},drawLayout=function(){var e=invoiceData.height,t=invoiceData.width;"Z"==invoiceData.LandscapeOrientation&&(e=20),resizeLayout(ptToPx(10*t),ptToPx(10*e))},recordBoxLeftAndTop=function(e){"auto"!=getCss(e,"left")&&(dragParams.left=getCss(e,"left")),"auto"!=getCss(e,"top")&&(dragParams.top=getCss(e,"top"))},setDragParams=function(e){dragParams.mouseDownFlag=!0,dragParams.target=e.target,dragParams.currentX=e.clientX,dragParams.currentY=e.clientY,recordBoxLeftAndTop(dragParams.target)},disableMenuItem=function(e,t){$("#"+e).addClass("imggray"),$("#"+e).removeClass("pic").removeClass("pic_"+t).addClass("graypic").addClass("gray_"+t)},enableMenuItem=function(e,t){$("#"+e).removeClass("imggray"),$("#"+e).removeClass("graypic").removeClass("gray_"+t).addClass("pic_"+t).addClass("pic")},setCtrlAttr=function(e){var t=$("#t-type").val(),a=$("#t-ind").val();enableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas"),"layout"==t&&("t-PrtPaperSet"!=e.target.id&&"t-LandscapeOrientation"!=e.target.id||validPrtPaperSet(),"t-PrtDevice"==e.target.id&&validPrtPaperSet(),invoiceData.LandscapeOrientation=$("#t-LandscapeOrientation").val(),invoiceData.PrtPaperSet=$("#t-PrtPaperSet").val(),invoiceData.height=$("#t-height").val(),invoiceData.width=$("#t-width").val(),invoiceData.PaperDesc=$("#t-PaperDesc").val(),invoiceData.PrtDevice=$("#t-PrtDevice").val(),invoiceData.PrtPage=$("#t-PrtPage").val(),invoiceData.XMLClassMethod=$("#t-XMLClassMethod").val(),invoiceData.XMLClassQuery=$("#t-XMLClassQuery").val(),invoiceData.PageFooter=$("#t-PageFooter").val(),invoiceData.NotFindPrtDevice=$("#t-NotFindPrtDevice").val()||"",invoiceData.Duplex=$("#t-Duplex").val()||"",drawLayout()),"undefined"!=typeof xmldesigner[t]&&xmldesigner[t].method&&xmldesigner[t].method.drawByAttrTable&&xmldesigner[t].method.drawByAttrTable(a)},resetAttrTable=function(e){var t=e.attr("data-ind"),a=e.attr("data-type");if(-1<t){if("lineLayout"==e.attr("id"))for(var r in invoiceData)-1<r.indexOf("-")?($("#tr"+r).show(),$("#t"+r).val(invoiceData[r])):($("#tr-"+r).show(),$("#t-"+r).val(invoiceData[r]));"layout"==a&&validPrtPaperSet(),"undefined"!=typeof xmldesigner[a]&&xmldesigner[a].method.showAttrsByInd&&xmldesigner[a].method.showAttrsByInd(t),xmldesigner.line.method.draw()}},selectItem=function(e,t){$("#t-height").attr("disabled",!1),$("#t-width").attr("disabled",!1),$("#t-PrtPage").attr("disabled",!1),$("#tr-height .tdCtrlAttrLeft a").text("高度"),$(".trCtrlAttr").hide(),e?(enableMenuItem("DelMenu","del"),e=$(e),t.ctrlKey?-1<(t=selectCompSet.indexOf(e))?(e.removeClass("x-selected"),selectCompSet.splice(t,1)):(e.addClass("x-selected"),selectCompSet.push(e)):(clearSelectItem(),e.addClass("x-selected"),selectCompSet.push(e)),resetAttrTable(e)):(clearSelectItem(),disableMenuItem("DelMenu","del"),validPrtPaperSet())},clearSelectItem=function(){for(var e=!1,t=selectCompSet.length-1;-1<t;t--)$(selectCompSet[t]).removeClass("x-selected"),"line"==$(selectCompSet[t]).attr("data-type")&&(e=!0),selectCompSet.pop();e&&xmldesigner.line.method.draw()},drawByXml=function(e){invoiceData={},disableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas"),enableMenuItem("PrintViewMenu","printview"),enableMenuItem("PrintOutMenu","printout"),enableMenuItem("PrintOutLODOPMenu","printout"),xmldesigner.label.method.init(),xmldesigner.line.method.init(),xmldesigner.list.method.init(),xmldesigner.listItem.method.init(),xmldesigner.qrcode.method.init(),xmldesigner.barcode.method.init(),xmldesigner.img.method.init(),dragParams={target:null,mouseDownFlag:!1,top:0,left:0,currentX:0,currentY:0},selectItem(""),selectCompSet=[],$("#lineLayout").siblings().remove(),xmlEditInited&&editAreaLoader.setValue("xmlTextArea",e);if(""!=e){var t=new XML.ObjTree,e=$.trim(e),e=t.parseXML(e);if(e.html)alert("XML格式错误");else{(invoiceData=e.appsetting.invoice)["-LandscapeOrientation"]=invoiceData["-LandscapeOrientation"]||"",invoiceData.LandscapeOrientation=invoiceData["-LandscapeOrientation"]||"",invoiceData.ind=0,invoiceData.type="layout",invoiceData.height=invoiceData["-height"]||"",invoiceData.width=invoiceData["-width"]||"",invoiceData.PrtPaperSet=invoiceData["-PrtPaperSet"]||"",invoiceData.PaperDesc=invoiceData["-PaperDesc"]||"",invoiceData.PrtDevice=invoiceData["-PrtDevice"]||"",invoiceData.PrtPage=invoiceData["-PrtPage"]||"",invoiceData.XMLClassMethod=invoiceData["-XMLClassMethod"]||"",invoiceData.XMLClassQuery=invoiceData["-XMLClassQuery"]||"",invoiceData.PageFooter=invoiceData["-PageFooter"]||"",invoiceData.NotFindPrtDevice=invoiceData["-NotFindPrtDevice"]||"",invoiceData.Duplex=invoiceData["-Duplex"]||0,drawLayout();var a="";if("object"==typeof e.appsetting.invoice.TxtData&&(handlerRePrtHeadFlag2Sub(invoiceData,"TxtData","txtdatapara"),"object"==typeof(a=e.appsetting.invoice.TxtData.txtdatapara))){$.isArray(a)||(a=[a]);for(var r=0;r<a.length;r++)"undefined"!=typeof a[r]["-isqrcode"]&&"true"==a[r]["-isqrcode"]?(xmldesigner.qrcode.data.push(a[r]),xmldesigner.qrcode.method.drawByInd(xmldesigner.qrcode.data.length-1)):"undefined"!=typeof a[r]["-barcodetype"]?(xmldesigner.barcode.data.push(a[r]),xmldesigner.barcode.method.drawByInd(xmldesigner.barcode.data.length-1)):(xmldesigner.label.data.push(a[r]),xmldesigner.label.method.drawByInd(xmldesigner.label.data.length-1));delete e.appsetting.invoice.TxtData.txtdatapara}if("object"==typeof e.appsetting.invoice.PLData&&(handlerRePrtHeadFlag2Sub(invoiceData,"PLData","PLine"),"object"==typeof(a=e.appsetting.invoice.PLData.PLine))){$.isArray(a)||(a=[a]);for(r=0;r<a.length;r++){var i=xmldesigner.line.method.item2Json(a,r);xmldesigner.line.data.push(i)}xmldesigner.line.method.draw(),delete e.appsetting.invoice.PLData.PLine}if("object"==typeof e.appsetting.invoice.ListData){a=e.appsetting.invoice.ListData,i=xmldesigner.list.method.item2Json(a,0);if(xmldesigner.list.data.push(i),xmldesigner.list.method.drawByInd(xmldesigner.list.data.length-1),"object"==typeof(a=e.appsetting.invoice.ListData.Listdatapara)){$.isArray(a)||(a=[a]);for(r=0;r<a.length;r++)xmldesigner.listItem.data.push(a[r]),xmldesigner.listItem.method.drawByInd(r),0==r&&(xmldesigner.list.data[xmldesigner.list.data.length-1].y=a[r].y,xmldesigner.list.method.drawByInd(xmldesigner.list.data.length-1));delete e.appsetting.invoice.ListData.Listdatapara}}if("object"==typeof e.appsetting.invoice.PICData&&(handlerRePrtHeadFlag2Sub(invoiceData,"PICData","PICdatapara"),a=e.appsetting.invoice.PICData.PICdatapara)){$.isArray(a)||(a=[a]);for(r=0;r<a.length;r++){i=xmldesigner.img.method.item2Json(a,r);xmldesigner.img.data.push(i),xmldesigner.img.method.drawByInd(r)}delete e.appsetting.invoice.PICData.PICdatapara}}return!0}};function handlerRePrtHeadFlag2Sub(t,a,e){if($.isArray(t[a])){t.All={},t.All["-RePrtHeadFlag"]=t[a][0]["-RePrtHeadFlag"]||"N",t.All[e]=[];for(var r=0;r<t[a].length;r++){var i=t[a][r][e];"object"==typeof i&&($.isArray(i)?i.forEach(function(e){e["-RePrtHeadFlag"]=t[a][r]["-RePrtHeadFlag"]||"N"}):(i["-RePrtHeadFlag"]=t[a][r]["-RePrtHeadFlag"]||"N",i=[i]),t.All[e]=t.All[e].concat(i))}t[a]=t.All,delete t.All}else t[a]&&t[a][e]&&($.isArray(t[a][e])?t[a][e].forEach(function(e){e["-RePrtHeadFlag"]=t[a]["-RePrtHeadFlag"]||"N"}):t[a][e]["-RePrtHeadFlag"]=t[a]["-RePrtHeadFlag"]||"N")}function handlerRePrtHeadFlag2Parent(a,r,e){var i;0<a[r][e].length&&(i={Y:[],N:[]},a[r][e].forEach(function(e){var t=e["-RePrtHeadFlag"]||a[r]["-RePrtHeadFlag"];delete e["-RePrtHeadFlag"],i[t].push(e)}),delete a[r],0<i.Y.length&&0<i.N.length?(a[r]=[],a[r].push({"-RePrtHeadFlag":"Y"}),a[r][0][e]=i.Y,a[r].push({"-RePrtHeadFlag":"N"}),a[r][1][e]=i.N):0<i.Y.length?(a[r]={"-RePrtHeadFlag":"Y"},a[r][e]=i.Y):(a[r]={"-RePrtHeadFlag":"N"},a[r][e]=i.N))}var validPrtPaperSet=function(){"WIN"==$("#t-PrtPaperSet").val()?($("#t-height").attr("disabled",!0),$("#t-width").attr("disabled",!0),$("#t-PrtPage").attr("disabled",!1)):($("#t-height").attr("disabled",!1),$("#t-width").attr("disabled",!1),$("#t-PrtPage").attr("disabled",!0)),"Z"==$("#t-LandscapeOrientation").val()?$("#tr-height .tdCtrlAttrLeft a").text("底边空白高度(cm)"):$("#tr-height .tdCtrlAttrLeft a").text("高度"),""==$("#t-PrtDevice").val()?($("#t-NotFindPrtDevice").attr("disabled",!0),$("#tr-NotFindPrtDevice .tdCtrlAttrLeft a").text("未找到指定打印机时")):($("#tr-NotFindPrtDevice .tdCtrlAttrLeft a").text("未找到"+$("#t-PrtDevice").val()+"打印机时"),$("#t-NotFindPrtDevice").attr("disabled",!1))},loadXmlTpl=function(e,t,a){$.ajaxRunServerMethod({ClassName:"web.DHCXMLPConfig",MethodName:"ReadXmlByID",RowID:e},function(e){drawByXml(e),validPrtPaperSet()}),$("#currentXmlTplDesc").html(a),$("#currentXmlTplName").html(t)},deleteProps=function(e,t){for(var a=0;a<t.length;a++)delete e[t[a]]},OpenXml=function(){isOpenXmlFlag||$("#XMLListTbl").datagrid({fit:!0,rownumbers:!0,pagination:!0,striped:!0,singleSelect:!0,pageSize:100,pageList:[100],queryParams:{QueryName:"ReadAllByName",ClassName:"web.DHCXMLPConfig",Name:$("#XMLTplName").val()},onDblClickRow:function(e,t){loadXmlTpl(t.ID,t.XPC_Flag,t.XPC_Note1),reportId=t.ID,reportName=t.XPC_Flag,$("#XMLListWin").window("minimize")},url:"jquery.easyui.querydatatrans.csp",columns:[[{field:"ID",title:"ID",width:100,align:"left",hidden:!0},{field:"XPC_Flag",title:"XML模板名",width:200,align:"left",hidden:!1},{field:"XPC_Note1",title:"描述",width:200,align:"right"}]]}),$("#XMLListWin").window("open")},printView=function(){""!=$("#currentXmlTplName").html()&&websys_printview(reportName,"showPrintBtn=1&xmldesigner=1")},printOut=function(){websys_printout(reportName,"")},printOutLODOP=function(){websys_printout(reportName,"isLodop=1")},delCtrl=function(){if(!$("#DelMenu").hasClass("imggray")){for(var e,t,a=!1,r=0;r<selectCompSet.length;r++)t=selectCompSet[r].attr("data-type"),e=selectCompSet[r].attr("data-ind"),"line"==t&&(a=!0),"undefined"!=typeof xmldesigner[t]&&xmldesigner[t].method.delItem&&xmldesigner[t].method.delItem(e),selectCompSet.splice(r,1);a&&xmldesigner.line.method.draw()}};function getCurrXml(){return void 0===invoiceData?"":"none"!=$("#dbLayout").css("display")?(e=$.extend(!0,{},invoiceData,{"-LandscapeOrientation":invoiceData.LandscapeOrientation,"-PrtPaperSet":invoiceData.PrtPaperSet||"","-PrtDevice":invoiceData.PrtDevice||"","-PrtPage":invoiceData.PrtPage||"","-PaperDesc":invoiceData.PaperDesc,"-width":invoiceData.width,"-height":invoiceData.height,"-XMLClassMethod":invoiceData.XMLClassMethod,"-XMLClassQuery":invoiceData.XMLClassQuery,"-PageFooter":invoiceData.PageFooter,"-NotFindPrtDevice":invoiceData.NotFindPrtDevice,"-Duplex":invoiceData.Duplex||""}),""==invoiceData.LandscapeOrientation&&deleteProps(e,["-LandscapeOrientation"]),""==invoiceData.NotFindPrtDevice&&deleteProps(e,["-NotFindPrtDevice"]),""==invoiceData.PageFooter&&deleteProps(e,["-PageFooter"]),""==invoiceData.XMLClassMethod&&deleteProps(e,["-XMLClassMethod"]),""==invoiceData.XMLClassQuery&&deleteProps(e,["-XMLClassQuery"]),""!=invoiceData.Duplex&&0!=invoiceData.Duplex||deleteProps(e,["-Duplex"]),deleteProps(e,["ind","type","LandscapeOrientation","PrtPaperSet","PrtDevice","PrtPage","PaperDesc","width","height","XMLClassMethod","XMLClassQuery","PageFooter","NotFindPrtDevice","Duplex"]),e.TxtData||(e.TxtData={"-RePrtHeadFlag":invoiceData.TxtData&&invoiceData.TxtData["-RePrtHeadFlag"]||"N"}),e.PLData||(e.PLData={"-RePrtHeadFlag":invoiceData.PLData&&invoiceData.PLData["-RePrtHeadFlag"]||"Y"}),e.PICData||(e.PICData={"-RePrtHeadFlag":invoiceData.PICData&&invoiceData.PICData["-RePrtHeadFlag"]||"N"}),e.TxtData.txtdatapara=xmldesigner.label.method.genXmlJson(),Array.prototype.push.apply(e.TxtData.txtdatapara,xmldesigner.qrcode.method.genXmlJson()),Array.prototype.push.apply(e.TxtData.txtdatapara,xmldesigner.barcode.method.genXmlJson()),handlerRePrtHeadFlag2Parent(e,"TxtData","txtdatapara"),e.PLData.PLine=xmldesigner.line.method.genXmlJson(),handlerRePrtHeadFlag2Parent(e,"PLData","PLine"),0<(t=xmldesigner.list.method.genXmlJson()).length&&(e.ListData=t[0],e.ListData.Listdatapara=xmldesigner.listItem.method.genXmlJson()),e.PICData.PICdatapara=xmldesigner.img.method.genXmlJson(),handlerRePrtHeadFlag2Parent(e,"PICData","PICdatapara"),checkPaperBoundary(e),(new XML.ObjTree).writeXML({appsetting:{invoice:e}})):(t=editAreaLoader.getValue("xmlTextArea"),r=!1,t.replace(/xcol="(.+?)"/gi,function(e,t,a){if(/[^0-9.]/.test(t))return $.messager.alert("格式错误",e+"内容不合法"),r=!0,e}),r?"":(t.replace(/yrow="(.+?)"/gi,function(e,t,a){if(/[^0-9.]/.test(t))return $.messager.alert("格式错误",e+"内容不合法"),r=!0,e}),r?"":(t.replace(/width="(.+?)"/gi,function(e,t,a){if(/[^0-9.]/.test(t))return $.messager.alert("格式错误",e+"内容不合法"),r=!0,e}),r?"":(t.replace(/height="(.+?)"/gi,function(e,t,a){if(/[^0-9.]/.test(t))return $.messager.alert("格式错误",e+"内容不合法"),r=!0,e}),r?"":t))));var e,t,r}var checkPaperBoundary=function(e){try{var t=e["-width"];if((t=10*parseFloat(t)-10)<0)return;var a=e["-height"];if((a=10*parseFloat(a)-3)<0)return;for(var r=[],i=["TxtData","PLData","PICData","ListData"],n=["txtdatapara","PLine","PICdatapara","Listdatapara"],l=0;l<i.length;l++){var o=i[l],d=n[l];if(e[o]instanceof Array)for(var s=0;s<e[o].length;s++)var m=e[o][s][d],r=r.concat(checkBoundaryItem(m,t,a));else(m=e[o][d])&&0<m.length&&(r=r.concat(checkBoundaryItem(m,t,a)))}for(var c="",s=0;s<r.length;s++)r[s]&&(c+=r[s]+"\n");c&&alert(c)}catch(g){}};function checkBoundaryItem(e,t,a){for(var r=[],i=0;i<e.length;i++){var n=e[i],l=n["-xcol"]||n["-BeginX"]||0,o=((t<l||l<0)&&r.push("元素的位置将超越纸张边界警告： "+n["-name"]+" : "+(n["-defaultvalue"]||"")+l),n["-yrow"]||n["-BeginY"]||0);(a<o||o<0)&&r.push("元素的位置将超越纸张边界警告： "+n["-name"]+" : "+(n["-defaultvalue"]||"")+o),(t+10<(l=n["-EndX"]||0)||l<0)&&r.push("元素的位置将超越纸张边界警告：线条 "+l),(a<(o=n["-EndY"]||0)||o<0)&&r.push("元素的位置将超越纸张边界警告：线条 "+o)}return r}var SaveXml=function(){if(!$("#SaveMenu").hasClass("imggray")){if(""==$("#currentXmlTplName").html())return!1;var e=getCurrXml();""!=e&&$.ajax({url:"jquery.easyui.broker.csp",data:{ClassName:"web.DHCXMLPConfig",MethodName:"UpdateReport",ID:reportId,xml:e},type:"POST",success:function(e){1!=e?$.messager.alert("提示","保存失败!"+e):disableMenuItem("SaveMenu","save")},error:function(e,t){alert("JQuery: RunClassMethodError !\n"+t)}})}},NewXMLTplClick=function(){var e,t,a,r=$("#xmlNewId").val(),i=$("#xmlNewName").val(),n=$("#xmlNewDesc").val(),l=$("#XMLNewNameError");""==i?l.html("名字不能为空."):""==n?l.html("描述不能为空."):(e="",t="AddNewReport","saveas"==(a=$("#XMLNewNameWin").attr("data-opener"))?e=getCurrXml():"modifyflagnote"==a&&(t="ModifyFlagNote"),$.ajax({url:"jquery.easyui.broker.csp",data:{ClassName:"web.DHCXMLPConfig",MethodName:t,ID:r,xml:e,flgName:i,Note:n},type:"POST",success:function(e){0<e?($("#XMLNewNameWin").window("minimize"),"modifyflagnote"==a&&($("#currentXmlTplName").html(i),$("#currentXmlTplDesc").html(n)),""==r&&(loadXmlTpl(e,i,n),reportId=e,reportName=i,$("#currentXmlTplName").html(i),$("#currentXmlTplDesc").html(n))):l.html(e)},error:function(e,t){alert("JQuery: RunClassMethodError !\n"+t)}}))},moveAllItem=function(r,i){i=parseInt(i);$.each("label,line,img,barcode,qrcode".split(","),function(e,t){for(var a=0;a<xmldesigner[t].data.length;a++)xmldesigner[t].method.move(r,a,i)}),xmldesigner.line.method.draw()},moveItem=function(e,t){for(var a,r,i=!1,n=0;n<selectCompSet.length;n++)a=(r=selectCompSet[n]).attr("data-ind"),"line"==(r=r.attr("data-type"))&&(i=!0),xmldesigner[r].method.move(e,a,t);i&&xmldesigner.line.method.draw()},alignSelectItem=function(e,t,a,r){xmldesigner.line.data,xmldesigner.label.data;for(var i,n,l=!1,o=1;o<selectCompSet.length;o++)i=(n=selectCompSet[o]).attr("data-ind"),"line"==(n=n.attr("data-type"))&&(l=!0),xmldesigner[n].method.alignItem(i,t,a,r);l&&xmldesigner.line.method.draw()},AlignCtrl=function(e){var t=selectCompSet[0],a=t.attr("data-type"),t=xmldesigner[a].method.getItemOffset(t),r=t.x,i=t.y,n=t.w,l=t.h,o=i+l,d=r+n,s=i+l/2,m=r+n/2;switch(e){case"LEFTALIGN":alignSelectItem(a,"x",r);break;case"TOPALIGN":alignSelectItem(a,"y",i);break;case"BOTTOMALIGN":alignSelectItem(a,"b",o);break;case"RIGHTALIGN":alignSelectItem(a,"r",d);break;case"H-ALIGN":alignSelectItem(a,"ha",s);break;case"V-ALIGN":alignSelectItem(a,"va",m);break;case"H-EQUAL":alignSelectItem(a,"h",l);break;case"W-EQUAL":alignSelectItem(a,"w",n);break;case"S-EQUAL":alignSelectItem(a,"s",l,n)}},newXml=function(){$("#xmlNewId").val(""),$("#xmlNewName").val(""),$("#xmlNewDesc").val(""),$("#XMLNewNameWin").window("open").window("setTitle","新建模板"),$("#XMLNewNameWin").attr("data-opener","new"),$("#XMLNewNameError").html("")},SaveAs=function(){$("#xmlNewId").val(""),$("#xmlNewName").val(""),$("#xmlNewDesc").val(""),""!=$("#currentXmlTplName").html()&&($("#XMLNewNameWin").window("open").window("setTitle","另存为模板"),$("#XMLNewNameWin").attr("data-opener","saveas"),$("#XMLNewNameError").html(""))},modifyCurrXmlTplDesc=function(){var e=$("#currentXmlTplName").html(),t=$("#currentXmlTplDesc").html();$("#xmlNewId").val(reportId),$("#xmlNewName").val(e),$("#xmlNewDesc").val(t),$("#XMLNewNameWin").window("open").window("setTitle","修改描述"),$("#XMLNewNameWin").attr("data-opener","modifyflagnote"),$("#XMLNewNameError").html("")},OpenXMLTpl=function(){var e=$("#XMLListTbl").datagrid("getSelected");e&&(loadXmlTpl(e.ID,e.XPC_Flag,e.XPC_Note1),reportId=e.ID,reportName=e.XPC_Flag,$("#XMLListWin").window("minimize"))},DelXMLTpl=function(){var t=$("#XMLListTbl").datagrid("getSelected");t&&$.messager.confirm("确认","您确定删除"+t.XPC_Flag+"?",function(e){e&&$.ajaxRunServerMethod({ClassName:"web.DHCXMLPConfig",MethodName:"DeleteReportByID",ID:t.ID},function(e){0<e?$("#XMLListTbl").datagrid("load",{QueryName:"ReadAllByName",ClassName:"web.DHCXMLPConfig",Name:$("#XMLTplName").val()}):$.messager.alert("提示","删除错误!"+e)})})},excuteCmd=function(e){var t=e.toUpperCase();switch(t){case"NEWXML":newXml();break;case"OPENXML":OpenXml();break;case"PRINTVIEW":printView();break;case"PRINTOUT":printOut();break;case"PRINTOUTLODOP":printOutLODOP();break;case"SAVE":SaveXml();break;case"SAVEAS":SaveAs();break;case"CUT":0<this.options.selectCtrls.length&&excuteSaveUnDo.apply(this),copyCtrl(),document.execCommand("Delete"),this.options.selectCtrls=new Array;break;case"COPY":copyCtrl();break;case"PASTE":pastCtrl();break;case"DELETE":delCtrl();break;case"UNDO":this.UnDo();break;case"REDO":this.ReDo();break;case"TOFRONT":adjustCtrlPosition(!0);break;case"TOBACK":adjustCtrlPosition(!1);break;case"SELECTEDMOVE":$('<div id="allItemMove" style="padding:10px;"></div>').appendTo(document.body).window({title:"整体元素位置移动",resizable:!1,width:250,height:280,maximizable:!1,minimizable:!1,collapsible:!1,content:'<div style="margin:20px auto;text-align: center;"><label>一次移动长度(mm)：</label><input id="moveStepNpt" value="10" style="width:25px;"/></div>\t\t\t\t\t\t\t<table style="margin:30px auto;"><tr><td></td><td><a href="javascript:moveAllItem(\'top\',document.getElementById(\'moveStepNpt\').value);" class="easyui-linkbutton">上</a></td><td></td></tr>\t\t\t\t\t\t\t<tr><td><a href="javascript:moveAllItem(\'left\',document.getElementById(\'moveStepNpt\').value);" class="easyui-linkbutton">左</a></td><td></td>\t\t\t\t\t\t\t<td><a href="javascript:moveAllItem(\'right\',document.getElementById(\'moveStepNpt\').value);" class="easyui-linkbutton">右</a></td>\t\t\t\t\t\t\t<tr><td></td><td><a href="javascript:moveAllItem(\'bottom\',document.getElementById(\'moveStepNpt\').value);" class="easyui-linkbutton">下</a></td><td></td></tr>'}).show().window("move",{right:300});break;default:AlignCtrl(t)}},init=function(){var e=$("#centerdesignebar").height();$("#lo").css("height",document.body.clientHeight),$("#lo").layout("resize"),$(document).width();$("#lineLayout").attr("width",$("#dbLayout").width()).attr("height",e),$(".toolbar").on("mousedown",function(e){var t,e=$(e.target);(e.hasClass("CtrlItem")||e.parent().hasClass("CtrlItem"))&&(enableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas"),t="",e.hasClass("CtrlItem")&&(t=e.attr("ctrltype")),e.parent().hasClass("CtrlItem")&&(t=e.parent().attr("ctrltype")),"object"==typeof xmldesigner[t]&&"object"==typeof xmldesigner[t].method&&xmldesigner[t].method.drawNew())}),$("#centerdesignebar").on("mousedown",function(e){var t=$(e.target);t.attr("data-type");t.hasClass("ctrldrag")?(enableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas"),e=e||window.event,t.hasClass("ctrldrag")&&(e.target.onselectstart=function(){return!1},setDragParams(e)),selectItem(e.target,e)):-1<(t=xmldesigner.line.method.getLineByPoint(e.offsetX,e.offsetY))?selectItem(document.getElementById("midline"+t),e):"lineLayout"==e.target.id?(enableMenuItem("SaveMenu","save"),enableMenuItem("SaveAsMenu","saveas"),e=e||window.event,selectItem(e.target,e)):selectItem("")}),$("#dbLayout").delegate(".ctrldrag","mousemove",function(e){e.preventDefault();var e=e||window.event,t=$(dragParams.target);dragParams.mouseDownFlag&&(t=t.attr("data-type"),xmldesigner[t].method.dragMove(e,dragParams))}),$("body").on("mouseup",function(e){e.preventDefault();var t,a=$(e.target);a.attr("cmd")&&excuteCmd(a.attr("cmd")),a.hasClass("pic")&&excuteCmd(a.parent().attr("cmd")),dragParams.mouseDownFlag&&dragParams.target&&(t=(a=$(dragParams.target)).attr("data-ind"),a=a.attr("data-type"),xmldesigner[a].method.dragEnd(dragParams.target,t,e)),dragParams.mouseDownFlag=!1,dragParams.target=null}),$(".centerlayout").on("keydown",function(e){var t=$(dragParams.target),t=(t.attr("data-ind"),t.attr("data-type"),e.ctrlKey?10:1);if(-1<[37,38,39,40].indexOf(e.keyCode))return e.stopPropagation(),37==e.keyCode?(moveItem("left",t),!1):38==e.keyCode?(moveItem("top",t),!1):39==e.keyCode?(moveItem("right",t),!1):40==e.keyCode?(moveItem("bottom",t),!1):void 0}),$("body").on("keydown",function(e){if(46==e.keyCode||17==e.keyCode||e.ctrlKey&&83==e.keyCode){if(e.ctrlKey&&83==e.keyCode)return excuteCmd("Save"),!1;if(46==e.keyCode)return"INPUT"==e.target.tagName.toUpperCase()||(excuteCmd("DELETE"),!1)}e.returnValue=!1}),$("#tbCtrlAttr").delegate(".numberStyle,.txtStyle","keydown",function(e){13==(e.keyCode||e.which)&&setCtrlAttr(e)}),$("#tbCtrlAttr").delegate(".numberStyle,.txtStyle","focusout",function(e){setCtrlAttr(e)}),$("#tbCtrlAttr").delegate("#t-defaultvalue","dblclick",function(e){1==selectCompSet.length&&$(selectCompSet[0]).attr("data-type")}),$("#tbCtrlAttr").delegate(".selStyle","change",function(e){setCtrlAttr(e)}),"undefined"!=typeof reportId&&0<reportId&&loadXmlTpl(reportId,reportName,"6666"),$("#XMLTplName").on("keyup",function(){"undefined"!=typeof XMLTplNameTimer&&clearTimeout(XMLTplNameTimer),$("#XMLTplName").data("preValue",$("#XMLTplName").val()),XMLTplNameTimer=setTimeout(function(){$("#XMLTplName").data("preValue")==$("#XMLTplName").val()&&$("#XMLListTbl").datagrid("load",{QueryName:"ReadAllByName",ClassName:"web.DHCXMLPConfig",Name:$("#XMLTplName").val()})},300)}),$("#currentXmlTplName,#currentXmlTplDesc").on("click",modifyCurrXmlTplDesc),$("#printTestA").on("click",function(){return websys_createWindow("dhctt.xmlprinttest.csp","1","width=530,height=320,top=200,left=450,toolbar=no,location=no,directories=no,menubar=no,scrollbars=yes,resizable=yes"),!1}),$("#printTestB").on("click",function(){return websys_createWindow("dhctt.xmlprinttest2.csp","1","width=530,height=320,top=200,left=450,toolbar=no,location=no,directories=no,menubar=no,scrollbars=yes,resizable=yes"),!1}),$("#printTestC").on("click",function(){return websys_createWindow("dhctt.xmlprinttest3.csp","1","width=530,height=320,top=200,left=450,toolbar=no,location=no,directories=no,menubar=no,scrollbars=yes,resizable=yes"),!1}),$("#printHelpA").on("click",function(){return websys_createWindow("../html/help/CH/XML打印.pdf","2","width=530,height=600,top=10,left=150,toolbar=no,location=no,directories=no,menubar=no,scrollbars=yes,resizable=yes"),!1}),$("#printFontA").on("click",function(){return 0==$("#dg").length&&$('<table id="dg"></table>').append("body"),$("#dg").datagrid({width:300,height:500,data:[{f1:"宋体",f2:"宋体"},{f1:"jjjj",f2:"雅黑"}],columns:[[{field:"f1",title:"代码",width:100},{field:"f2",title:"名称",width:100}]]}),!1})};$(init);