webpackJsonp([262],{QmD7:function(e,t){},me1a:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("bOdI"),l=a.n(o),n=a("Dd8w"),i=a.n(n),r=a("NYxO"),s=a("zL8q"),d=a("XlQt"),c=a("W5Fe"),g=a("qfDe").create_excel,u={components:{hgbutton:d.default,hgpagination:c.default},name:"WardNightFee",computed:i()({},Object(r.b)(["Height","styleCode"])),created:function(){this.loadWardStore(),this.getPostData();var e=this.$router.currentRoute.path.slice(1,this.$router.currentRoute.path.length);this.loadElementsForRouter("elementlist",e)},data:function(){var e;return e={loading:!1,elrowstyle:{height:"20px"},tablelist:[],PostData:[],tableHeight:"",pageSize:20,currentPage:1,totalCount:0,wardstore:[],toolForm:{Ward:"",stdate:new Date((new Date).getFullYear(),(new Date).getMonth(),1),enddate:new Date((new Date).getFullYear(),(new Date).getMonth()+1,0),Month:new Date},dialogVisible:!1},l()(e,"loading",!1),l()(e,"nightDetail",[]),l()(e,"elementlist",[]),e},methods:{exportTableListOld:function(){},exportTableList:function(){if(this.tablelist&&0!=this.tablelist.length){for(var e=[{label:"病区",prop:"WardDesc",width:200}],t=0;t<this.PostData.length;t++)e.push({label:this.PostData[t].PostDesc,prop:"Post"+this.PostData[t].rw,width:100});e.push({label:"合计",prop:"Subtotal",width:100});var a=s.Loading.service({fullscreen:!0,text:"拼命加载中..."}),o=new Array,l=new Array;g(e,this.tablelist,o,"","export","夜班统计","夜班统计",l,a),a.close()}else this.$message({type:"warning",message:"请查询数据",showClose:!0,customClass:"warning_class"})},exportData:function(){var e=this,t=this;t.nightDetail&&0!=t.nightDetail.length?new Promise(function(e){e()}).then(function(){for(var o=a("qfDe").create_excel,l=[{label:"病区",prop:"WardDesc",width:180},{label:"姓名",prop:"PerName",width:80},{label:"工号",prop:"PerId",width:80}],n=0;n<t.PostData.length;n++)l.push({label:t.PostData[n].PostDesc,prop:"Post"+t.PostData[n].rw,width:100});l.push({label:"小计",prop:"Subtotal",width:100});var i=s.Loading.service({fullscreen:!0,text:"拼命加载中..."}),r=new Array;o(l,e.nightDetail,r,"","export","夜班费统计表","夜班费统计表",new Array,i)}.bind(null,a)).catch(a.oe):t.$message({type:"warning",message:"无数据可导出，请先查询数据",showClose:!0,customClass:"warning_class"})},getSummaries:function(e){var t=e.columns,a=e.data,o=[];return t.forEach(function(e,t){if(0!==t)if(3!=t||"PerId"!=e.property){var l=a.map(function(t){return Number(t[e.property])});l.every(function(e){return isNaN(e)})?o[t]="":(o[t]=l.reduce(function(e,t){var a=Number(t);return isNaN(a)?e:e+t},0),"Subtotal"==e.property?o[t]+=" 元":o[t]+="")}else o[t]="";else o[t]="合计"}),o},rowDblClick:function(e,t){var a=this;a.dialogVisible=!0;var o=a.toolForm.stdate,l=a.toolForm.enddate;if(o)if(o instanceof Date&&(o=o.Format("YYYY-MM-dd")),l){l instanceof Date&&(l=l.Format("YYYY-MM-dd"));var n=o+"^"+l;a.$nextTick(function(){var t=e.WardCode;a.$ajax.request(a.axiosConfig("web.INMArgComm","FindNightDetail","RecQuery","ward$"+t,"month$"+n)).then(function(e){a.nightDetail=e.data.rows})})}else a.$message({type:"warning",message:"请选择结束日期",showClose:!0,customClass:"warning_class"});else a.$message({type:"warning",message:"请选择开始日期",showClose:!0,customClass:"warning_class"})},loadTableList:function(){var e=this,t=e.toolForm.Ward,a=e.toolForm.stdate,o=e.toolForm.enddate;if(a)if(a instanceof Date&&(a=a.Format("YYYY-MM-dd")),o){o instanceof Date&&(o=o.Format("YYYY-MM-dd"));var l=(e.currentPage-1)*e.pageSize,n=e.pageSize,i=a+"^"+o;e.loading=!0,e.$ajax.request(e.axiosConfig("web.INMArgComm","FindNightFee","RecQuery","ward$"+t,"month$"+i,"start$"+l,"limit$"+n,"role$"+sessionStorage.getItem("loginRoleCodes"),"nurseId$"+sessionStorage.loginID)).then(function(t){e.tablelist=t.data.rows,e.totalCount=parseInt(t.data.results),e.loading=!1})}else e.$message({type:"warning",message:"请选择结束日期",showClose:!0,customClass:"warning_class"});else e.$message({type:"warning",message:"请选择开始日期",showClose:!0,customClass:"warning_class"})},getPostData:function(){var e=this,t=e.toolForm.Ward;e.loading=!0;var a=e.axiosConfig("web.INMDBComm","FindArgNightPostList","RecQuery","parr$N^"+t);e.$ajax.request(a).then(function(t){e.PostData=t.data.rows,e.loading=!1}).catch(function(t){e.loading=!1})},loadWardStore:function(){var e=this,t=e.axiosConfig("web.INMDataLimit","FindRoleWardList","RecQuery","role$"+sessionStorage.getItem("loginRoleCodes"),"nurseid$"+sessionStorage.getItem("loginID"));e.$ajax.request(t).then(function(t){e.wardstore=t.data.rows}).catch(function(e){})},sizeChange:function(e){this.pageSize=e,this.loadTableList()},currentChange:function(e){this.currentPage=e.currentPage,this.loadTableList()}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.body",value:e.loading,expression:"loading",modifiers:{body:!0}}],staticClass:"wardnightfee-panel",attrs:{"element-loading-text":e.$t("menu.WardNightFee.5nrnav82fco0")}},[a("div",{staticClass:"top-tool-input"},[a("el-form",{attrs:{model:e.toolForm,inline:!0}},[a("el-form-item",{attrs:{label:e.$t("menu.WardNightFee.5nrnav84mno0")}},[a("el-select",{staticStyle:{width:"140px"},attrs:{filterable:"",clearable:"",size:"mini"},on:{change:e.getPostData},model:{value:e.toolForm.Ward,callback:function(t){e.$set(e.toolForm,"Ward",t)},expression:"toolForm.Ward"}},e._l(e.wardstore,function(e){return a("el-option",{key:e.rw,attrs:{label:e.WardDesc,value:e.rw}})}),1)],1),e._v(" "),e._e(),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.WardNightFee.5nrnav8cito0"),prop:"stdate"}},[a("el-date-picker",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:e.toolForm.stdate,callback:function(t){e.$set(e.toolForm,"stdate",t)},expression:"toolForm.stdate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.WardNightFee.5nrnav8emg40"),prop:"enddate"}},[a("el-date-picker",{staticStyle:{width:"120px"},attrs:{size:"mini"},model:{value:e.toolForm.enddate,callback:function(t){e.$set(e.toolForm,"enddate",t)},expression:"toolForm.enddate"}})],1),e._v(" "),a("el-form-item",[this.elementlist.feeSearch||0==this.$store.state.login.LoginId?a("hgbutton",{ref:"feeSearch",attrs:{type:"default",styleCode:e.styleCode,icon:"nm-icon-w-find"},on:{click:e.loadTableList}},[e._v(e._s(e.$t("menu.WardNightFee.5nrnav8epfg0")))]):e._e(),e._v(" "),this.elementlist.feeExport||0==this.$store.state.login.LoginId?a("hgbutton",{ref:"feeExport",attrs:{type:"default",styleCode:e.styleCode,icon:"nm-icon-w-export"},on:{click:e.exportTableList}},[e._v(e._s(e.$t("menu.WardNightFee.5nrnav8eqgk0")))]):e._e()],1)],1)],1),e._v(" "),a("div",{staticClass:"top-tool-table"},[e.loading?e._e():a("el-table",{ref:"tablelist",staticStyle:{width:"100%"},attrs:{data:e.tablelist,"header-cell-style":e.headerCellFontWeight,"row-style":e.elrowstyle,"highlight-current-row":!0,border:e.styleCode,height:e.styleCode?e.Height-93:e.Height-91},on:{"row-dblclick":e.rowDblClick}},[a("el-table-column",{attrs:{type:"index",width:"40",align:"center"}}),e._v(" "),e._e(),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.WardNightFee.5nrnav84mno0"),prop:"WardDesc",width:""}}),e._v(" "),e._l(e.PostData,function(e){return a("el-table-column",{key:e.rw,attrs:{label:e.PostDesc,prop:"Post"+e.rw,width:"100"}})}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.WardNightFee.5nrnav8n3i00"),prop:"Subtotal",width:""}}),e._v(" "),e._e()],2),e._v(" "),a("hgpagination",{attrs:{styleCode:e.styleCode,sizes:[20,40,50,100],totalCount:e.totalCount,pageNumber:e.currentPage,pageSize:e.pageSize},on:{changePage:e.currentChange,getPageSize:e.sizeChange}})],1),e._v(" "),a("div",[a("el-dialog",{attrs:{title:e.$t("menu.WardNightFee.5ncy62jn97g0"),visible:e.dialogVisible,"close-on-click-modal":!1,align:"center",height:e.Height-115,width:"1160px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{staticClass:"nm-icon-w-paper"}):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("menu.WardNightFee.5ncy62jn97g0")))])]),e._v(" "),a("div",{staticClass:"top-tool-dialog-table",staticStyle:{"border-radius":"4px"}},[a("el-table",{ref:"nightDetail",staticClass:"dialog-div-top-radius dialog-table-bottom-radius",staticStyle:{width:"100%"},attrs:{data:e.nightDetail,"header-cell-style":e.headerCellFontWeight,"highlight-current-row":!0,border:e.styleCode}},[a("el-table-column",{attrs:{type:"index",width:"50",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.WardNightFee.5nrnav84mno0"),prop:"WardDesc",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.WardNightFee.5nrnav8rx5k0"),prop:"PerName",width:""}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.WardNightFee.5nrnav8w2kg0"),prop:"PerId",width:""}}),e._v(" "),e._l(e.PostData,function(e){return a("el-table-column",{key:e.rw,attrs:{label:e.PostDesc,prop:"Post"+e.rw,width:"100","header-align":"left",align:"left"}})}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.WardNightFee.5ncy62jndrk0"),prop:"Subtotal"}})],2)],1),e._v(" "),a("div",{staticClass:"bottom-button"},[a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:e.exportData}},[e._v(e._s(e.$t("menu.WardNightFee.5nrnav8eqgk0")))]),e._v(" "),a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("menu.WardNightFee.5nrnav8w73g0")))])],1)])],1)])},staticRenderFns:[]};var m=a("VU/8")(u,h,!1,function(e){a("QmD7")},null,null);t.default=m.exports}});