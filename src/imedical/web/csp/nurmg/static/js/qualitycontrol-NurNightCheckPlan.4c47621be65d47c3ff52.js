webpackJsonp([218],{"+aVq":function(e,t){},"j/4q":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Dd8w"),s=a.n(l),n=a("NYxO"),o=a("XlQt"),r=a("W5Fe"),i={components:{hgbutton:o.default,hgpagination:r.default},name:"NurNightCheckPlan",computed:s()({},Object(n.b)(["Height","styleCode"])),data:function(){return{elementlist:{},Loading:!1,TaskTool:{TaskYear:"",TaskType:""},PlanTypeStore:[],ElRowStyle:{height:"20px"},PageSize:20,CurrentPage:1,TotalCount:0,PlanDialogVisible:!1,PlanListTable:[],PlanQualListTable:[],NewPlanDialogVisible:!1,PlanEditForm:{TaskYear:new Date,TaskType:""},PlanEditFormRules:{TaskYear:[{required:!0,message:"年份不为空",trigger:"change",type:"date"}],TaskType:[{required:!0,message:"类型不为空",trigger:"change"}]},SelectYear:"",SelectType:""}},methods:{LoadCheckPlanType:function(){var e=this,t=e.axiosConfig("web.INMQualControlComm","FindQualTypeList","RecQuery","type$N");e.$ajax.request(t).then(function(t){t.data instanceof Object?e.PlanTypeStore=t.data.rows:e.$message({type:"error",message:"获取质控类型失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取质控类型失败",showClose:!0,customClass:"error_class"})})},SearchTaskList:function(){var e=this,t=e.TaskTool.TaskYear;t=t instanceof Date?t.Format("YYYY"):"";var a=e.TaskTool.TaskType,l=(e.CurrentPage-1)*e.PageSize,s=e.PageSize;e.$ajax.request(e.axiosConfig("web.INMQualControlComm","FindCheckPlanList","RecQuery","year$"+t,"type$"+a,"start$"+l,"limit$"+s)).then(function(t){t.data instanceof Object?(e.PlanListTable=t.data.rows,e.TotalCount=parseInt(t.data.results)):e.$message({type:"error",message:"获取计划列表失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取计划列表失败",showClose:!0,customClass:"error_class"})})},AddCheckPlan:function(){var e=this;this.NewPlanDialogVisible=!0,this.$nextTick(function(){e.$refs.PlanEditForm.resetFields()})},ConfirmClick:function(){var e=this;e.$refs.PlanEditForm.validate(function(t){if(t){var a=e.PlanEditForm.TaskYear.Format("YYYY"),l=e.PlanEditForm.TaskType,s=l+"^"+a,n=e.axiosConfig("web.INMQualControlComm","IsExistCheckPlan","Method","parr$"+s);e.$ajax.request(n).then(function(t){0==t.data?(e.NewPlanDialogVisible=!1,e.PlanDialogVisible=!0,e.LoadTaskForm(a,l)):e.$message({type:"warning",message:"选定年分已存在同类型巡查计划",showClose:!0,customClass:"warning_class"})}).catch(function(t){e.$message({type:"error",message:"获取巡查计划失败",showClose:!0,customClass:"error_class"})})}})},RowDblClickEvent:function(e,t){var a=this;this.PlanDialogVisible=!0,this.$nextTick(function(){a.LoadTaskForm(e.PlanYear,e.PlanType)})},LoadTaskForm:function(e,t){var a=this;a.Loading=!0,a.SelectYear=e,a.SelectType=t;var l=a.axiosConfig("web.INMQualControlComm","FindCheckPlanDetailList","RecQuery","year$"+e,"type$"+t);a.$ajax.request(l).then(function(e){a.Loading=!1,e.data instanceof Object?a.PlanQualListTable=e.data.rows:a.$message({type:"error",message:"获取计划列表详情失败",showClose:!0,customClass:"error_class"})}).catch(function(e){a.Loading=!1,a.$message({type:"error",message:"获取计划列表详情失败",showClose:!0,customClass:"error_class"})})},SaveTaskItem:function(){var e=this,t="";e.PlanQualListTable.forEach(function(e){for(var a in e)t=t?t+"^"+a+"|"+e[a]:a+"|"+e[a];t+="「"}),e.$ajax.request(e.axiosConfig("web.INMQualControlComm","SavePlanItems","Method","year$"+e.SelectYear,"type$"+e.SelectType,"parr$"+t)).then(function(t){1==t.data?(e.$message({type:"success",message:"保存成功",showClose:!0,customClass:"success_class"}),e.PlanDialogVisible=!1,e.SearchTaskList()):e.$message({type:"error",message:"保存失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"保存失败",showClose:!0,customClass:"error_class"})})},FindClick:function(){this.CurrentPage=1,this.SearchTaskList()},HandleSizeChange:function(e){this.PageSize=e,this.SearchTaskList()},HandleCurrentChange:function(e){this.CurrentPage=e.currentPage,this.SearchTaskList()}},created:function(){this.LoadCheckPlanType(),this.SearchTaskList();var e=this.$router.currentRoute.path.slice(1,this.$router.currentRoute.path.length);this.loadElementsForRouter("elementlist",e)}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"nightcheckplan-plan"},[a("div",{staticClass:"top-tool-inputDiv"},[a("el-form",{attrs:{model:e.TaskTool,inline:!0}},[a("el-form-item",{attrs:{label:e.$t("menu.NurNightCheckPlan.5nrnbrbb4ug0")}},[a("el-date-picker",{staticStyle:{width:"100px"},attrs:{placeholder:"",type:"year",size:"mini"},model:{value:e.TaskTool.TaskYear,callback:function(t){e.$set(e.TaskTool,"TaskYear",t)},expression:"TaskTool.TaskYear"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.NurNightCheckPlan.5nrnbrbc9gk0")}},[a("el-select",{staticStyle:{width:"120px"},attrs:{clearable:"",placeholder:"",size:"mini"},model:{value:e.TaskTool.TaskType,callback:function(t){e.$set(e.TaskTool,"TaskType",t)},expression:"TaskTool.TaskType"}},e._l(e.PlanTypeStore,function(e){return a("el-option",{key:e.rw,attrs:{value:e.rw,label:e.SubDesc}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode,icon:"nm-icon-w-find"},on:{click:e.FindClick}},[e._v(e._s(e.$t("menu.NurNightCheckPlan.5nrnbrbcb480")))])],1)],1)],1),e._v(" "),a("div",{staticClass:"top-tool-button"},[0==this.$store.state.login.LoginId||e.elementlist.planadd?a("hgbutton",{attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-add":"nm-icon-lite-add"},on:{click:e.AddCheckPlan}},[e._v(e._s(e.$t("menu.NurNightCheckPlan.5nrnbrbcbt80")))]):e._e()],1),e._v(" "),a("div",{staticClass:"top-tool-table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.PlanListTable,"row-style":e.ElRowStyle,"highlight-current-row":!0,"header-cell-style":e.headerCellFontWeight,border:e.styleCode,height:e.styleCode?e.Height-130:e.Height-124},on:{"row-dblclick":e.RowDblClickEvent}},[a("el-table-column",{attrs:{type:"index",width:"40",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5nrnbrbb4ug0"),prop:"PlanYear"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5nrnbrbc9gk0"),prop:"PlanTypeDesc"}})],1),e._v(" "),a("hgpagination",{attrs:{styleCode:e.styleCode,sizes:[20,40,50,100],totalCount:e.TotalCount,pageNumber:e.CurrentPage,pageSize:e.PageSize},on:{changePage:e.HandleCurrentChange,getPageSize:e.HandleSizeChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.$t("menu.NurNightCheckPlan.5nrnbrbcbt80"),visible:e.NewPlanDialogVisible,width:"350px","close-on-click-modal":!1,modal:"",align:"center"},on:{"update:visible":function(t){e.NewPlanDialogVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{staticClass:"nm-icon-w-plus"}):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("menu.NurNightCheckPlan.5nrnbrbcbt80")))])]),e._v(" "),a("el-form",{ref:"PlanEditForm",attrs:{model:e.PlanEditForm,rules:e.PlanEditFormRules,"label-width":"103px",inline:!0,"label-position":"right",align:"left"}},[a("el-form-item",{attrs:{label:e.$t("menu.NurNightCheckPlan.5nrnbrbb4ug0"),prop:"TaskYear"}},[a("el-date-picker",{staticStyle:{width:"200px"},attrs:{placeholder:e.$t("menu.NurNightCheckPlan.5nrnbrbht0c0"),type:"year",size:"mini"},model:{value:e.PlanEditForm.TaskYear,callback:function(t){e.$set(e.PlanEditForm,"TaskYear",t)},expression:"PlanEditForm.TaskYear"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.NurNightCheckPlan.5nrnbrbin1g0"),prop:"TaskType"}},[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:e.$t("menu.NurNightCheckPlan.5nrnbrbjfm00"),size:"mini"},model:{value:e.PlanEditForm.TaskType,callback:function(t){e.$set(e.PlanEditForm,"TaskType",t)},expression:"PlanEditForm.TaskType"}},e._l(e.PlanTypeStore,function(e){return a("el-option",{key:e.rw,attrs:{value:e.rw,label:e.SubDesc}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"bottom-button"},[a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:e.ConfirmClick}},[e._v(e._s(e.$t("menu.NurNightCheckPlan.5nrnbrbjgsc0")))]),e._v(" "),a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:function(t){e.NewPlanDialogVisible=!1}}},[e._v(e._s(e.$t("menu.NurNightCheckPlan.5nrnbrbjh4s0")))])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.$t("menu.NurNightCheckPlan.5ncy6kczht40"),modal:"",visible:e.PlanDialogVisible,"show-close":!0,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.PlanDialogVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{staticClass:"nm-icon-w-edit"}):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("menu.NurNightCheckPlan.5ncy6kczht40")))])]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.Loading,expression:"Loading"}],attrs:{"element-loading-text":e.$t("menu.NurNightCheckPlan.5nrnbrbkd380")}},[a("div",{staticClass:"top-tool-dialog-table",staticStyle:{"border-radius":"4px"}},[a("el-table",{ref:"PlanQualListTable",staticClass:"dialog-div-top-radius dialog-table-bottom-radius",staticStyle:{width:"100%"},attrs:{data:e.PlanQualListTable,"row-style":e.ElRowStyle,"highlight-current-row":!0,"header-cell-style":e.headerCellFontWeight,border:e.styleCode,height:300}},[a("el-table-column",{attrs:{type:"index",width:"40",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5nrnbrbm33g0"),prop:"QualItemDesc"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczkvg0"),prop:"Jan",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.JanFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Jan,callback:function(a){e.$set(t.row,"Jan",a)},expression:"scope.row.Jan"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczm4o0"),prop:"Feb",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.FebFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Feb,callback:function(a){e.$set(t.row,"Feb",a)},expression:"scope.row.Feb"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczn4c0"),prop:"Mar",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.MarFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Mar,callback:function(a){e.$set(t.row,"Mar",a)},expression:"scope.row.Mar"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczo2g0"),prop:"Apr",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.AprFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Apr,callback:function(a){e.$set(t.row,"Apr",a)},expression:"scope.row.Apr"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczp3o0"),prop:"May",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.MayFlag,"true-label":"true","false-label":"false"},model:{value:t.row.May,callback:function(a){e.$set(t.row,"May",a)},expression:"scope.row.May"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczq6o0"),prop:"Jun",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.JunFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Jun,callback:function(a){e.$set(t.row,"Jun",a)},expression:"scope.row.Jun"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczr6c0"),prop:"Jul",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.JulFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Jul,callback:function(a){e.$set(t.row,"Jul",a)},expression:"scope.row.Jul"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczs5o0"),prop:"Aug",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.AugFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Aug,callback:function(a){e.$set(t.row,"Aug",a)},expression:"scope.row.Aug"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczt740"),prop:"Sep",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.SepFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Sep,callback:function(a){e.$set(t.row,"Sep",a)},expression:"scope.row.Sep"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczu680"),prop:"Oct",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.OctFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Oct,callback:function(a){e.$set(t.row,"Oct",a)},expression:"scope.row.Oct"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczv5k0"),prop:"Nov",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.NovFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Nov,callback:function(a){e.$set(t.row,"Nov",a)},expression:"scope.row.Nov"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightCheckPlan.5ncy6kczw780"),prop:"Dece",width:"60",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{attrs:{disabled:"false"==t.row.DeceFlag,"true-label":"true","false-label":"false"},model:{value:t.row.Dece,callback:function(a){e.$set(t.row,"Dece",a)},expression:"scope.row.Dece"}})]}}])}),e._v(" "),e._e(),e._v(" "),e._e()],1)],1),e._v(" "),a("div",{staticClass:"bottom-button"},[0==this.$store.state.login.LoginId||e.elementlist.planadd?a("hgbutton",{attrs:{type:e.styleCode?"default":"success",styleCode:e.styleCode},on:{click:e.SaveTaskItem}},[e._v(e._s(e.$t("menu.NurNightCheckPlan.5nrnbrbm9yw0")))]):e._e(),e._v(" "),a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:function(t){e.PlanDialogVisible=!1}}},[e._v(e._s(e.$t("menu.NurNightCheckPlan.5nrnbrbjh4s0")))])],1)])])],1)},staticRenderFns:[]};var u=a("VU/8")(i,c,!1,function(e){a("+aVq")},null,null);t.default=u.exports}});