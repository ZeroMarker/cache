webpackJsonp([210],{CuZ6:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Dd8w"),r=a.n(n),l=(a("zL8q"),a("NYxO")),i=a("XlQt"),o=a("W5Fe"),s={name:"InternTrainPlanSub",components:{hgbutton:i.default,hgpagination:o.default},data:function(){return{tableHeight:"",planData:[],TableDataAll:[],planForm:{Title:"",Level:"",Speaker:[],TrainDate:"",TrainTime:"",PlanDate:"",Content:"",Refer:[],Place:"",Member:[]},isIndeterminate:!0,checkAll:!1,members:[],statusstore:[{code:"N",desc:"未培训"},{code:"D",desc:"待指定"},{code:"Y",desc:"已培训"},{code:"E",desc:"已结束"}],plans:{Speaker:[{required:!0,message:"主讲人不能为空!",trigger:"change",type:"array"}],Place:[{required:!0,message:"培训地点不能为空!",trigger:"change"}]},levelstore:[],speakertypestore:[{code:"T",desc:"统一指定"},{code:"L",desc:"科室指定"}],speakerstore:[],wardstore:[],speakershow:!1,buttonshow:!1,searchForm:{StDate:new Date((new Date).Format("YYYY")+"/01/01"),EndDate:new Date((new Date).Format("YYYY")+"/12/31"),Status:"",Ward:""},row:"",dialogPlanVisible:!1,fileUrl:"",elementlist:[],currentPage:1,currentPageSize:20,totalCount:0,toprole:""}},created:function(){this.tableHeight=this.$store.state.mainframe.Height-130,this.LoadPlanData(),this.LoadSpeaker(),this.LoadTopRole(),this.LoadWardData();var e=this.$router.currentRoute.path.slice(1,this.$router.currentRoute.path.length);this.loadElementsForRouter("elementlist",e)},watch:{filerw:function(e,t){this.fileUrl=this.$store.state.systemset.SysTomcat+"Fileupdate/servlet/VueFileuploadServlet?filesname=refer/trainplan/"+e}},computed:r()({},Object(l.b)(["styleCode"]),{filerw:function(){return this.planForm.rw}}),methods:{handleCheckedMemberChange:function(e){var t=e.length;this.checkAll=t===this.members.length,this.isIndeterminate=t>0&&t<this.members.length},handleCheckAllChange:function(e){this.planForm.Member=e?this.members:[],this.isIndeterminate=!1},LoadTopRole:function(){var e=this;e.$ajax.request(e.axiosConfig("web.INMLoginComm","GetTopRoleByLoginId","Method","id$"+sessionStorage.loginPerID)).then(function(t){e.toprole=t.data.split("^")[1],e.levelstore=new Array,"hlb"==e.toprole||"hlbzr"==e.toprole||"DEMO"==e.toprole||"admin"==e.toprole?e.levelstore=[{code:"H",desc:"护理部"},{code:"L",desc:"科室"}]:e.levelstore=[{code:"L",desc:"科室"}]})},LoadWardData:function(){var e=this,t=e.axiosConfig("web.INMDataLimit","FindRoleWardList","RecQuery","nurseid$"+sessionStorage.getItem("loginID"));e.$ajax.request(t).then(function(t){e.wardstore=t.data.rows})},LoadSpeaker:function(){var e=this,t=e.axiosConfig("web.INMHRComm","FindPersonList","RecQuery","parr$","input$","qward$","loginID$"+sessionStorage.loginID);e.$ajax.request(t).then(function(t){e.speakerstore=t.data.rows})},LoadPlanData:function(){var e=this,t=e.searchForm.StDate,a=e.searchForm.EndDate;if(t instanceof Date&&a instanceof Date&&t>a)e.$message({type:"warning",message:"查询开始日期大于结束日期",showClose:!0,customClass:"warning_class"});else{t=t instanceof Date?t.Format("YYYY-MM-dd"):"",a=a instanceof Date?a.Format("YYYY-MM-dd"):"";var n=e.searchForm.Status+"^"+t+"^"+a+"^"+e.searchForm.Ward,r=(e.currentPage-1)*e.currentPageSize,l=e.currentPageSize;e.$ajax.request(e.axiosConfig("web.INMInternComm","FindTrainPlanSubList","RecQuery","parr$"+n,"nurseid$"+sessionStorage.loginID)).then(function(t){e.planData=t.data.rows.slice(r,r+l),e.TableDataAll=t.data.rows,e.totalCount=parseInt(t.data.results)})}},SavePlan:function(e){var t=this,a="";t.$refs.planForm.validate(function(n){if(n){var r=t.planForm.Speaker.join(","),l=t.planForm.Member.join(","),i="";t.planForm.TrainDate instanceof Date&&(i=t.planForm.TrainDate.Format("YYYY-MM-dd")),a=r+"^"+l+"^"+t.planForm.Place+"^"+i+"^"+t.planForm.TrainTime.toString()+"^"+e,t.$ajax.request(t.axiosConfig("web.INMInternComm","SaveTrainPlanSub","Method","parr$"+a,"par$"+t.row.Par,"ward$"+t.row.Ward,"status$"+t.row.Status)).then(function(e){return 0!=e.data?(t.dialogPlanVisible=!1,t.LoadPlanData(),void t.$message({type:"success",message:"保存成功",showClose:!0,customClass:"success_class"})):void t.$message({type:"warning",message:"保存失败",showClose:!0,customClass:"warning_class"})})}})},RowClick:function(e){this.row=e},RowDbClick:function(){var e=this;e.buttonshow=!1,"已培训"!=e.row.Status&&"已结束"!=e.row.Status||(e.buttonshow=!0),e.$ajax.request(e.axiosConfig("web.INMInternComm","GetTrainMemberList","Method","par$"+e.row.Par,"ward$"+e.row.Ward)).then(function(t){e.members=t.data.toString().split(","),e.$ajax.request(e.axiosConfig("web.INMInternComm","GetTrainPlanSub","RecMethod","par$"+e.row.Par,"ward$"+e.row.Ward)).then(function(t){e.dialogPlanVisible=!0,e.$nextTick(function(){e.setForm(e.$refs.planForm,e.planForm,t.data),e.planForm.Member=new Array,t.data.Member&&e.SetMemberToArray(t.data.Member),e.isIndeterminate=!0})})})},SetMemberToArray:function(e){for(var t=0;t<e.split(",").length;t++)this.planForm.Member.push(e.split(",")[t])},handlerUploadPreview:function(e){"success"===e.status?"pdf"==e.name.substring(e.name.lastIndexOf(".")+1)&&window.open(this.$store.state.systemset.SysTomcat+e.url):this.$message({type:"warning",message:"文件未上传"})},handleSizeChange:function(e){this.currentPageSize=e,this.LoadPlanData()},handleCurrentChange:function(e){this.currentPage=e.currentPage,this.LoadPlanData()}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"intern-train-plansub-panel"},[a("div",{staticClass:"top-tool-inputDiv"},[a("el-form",{ref:"searchForm",attrs:{model:e.searchForm,inline:!0,"label-position":"left"}},[a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5ncy6hl5unk0")}},[a("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,size:"mini"},model:{value:e.searchForm.StDate,callback:function(t){e.$set(e.searchForm,"StDate",t)},expression:"searchForm.StDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmz828k0")}},[a("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,size:"mini"},model:{value:e.searchForm.EndDate,callback:function(t){e.$set(e.searchForm,"EndDate",t)},expression:"searchForm.EndDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmz9jt40")}},[a("el-select",{staticStyle:{width:"140px"},attrs:{filterable:"",clearable:"",placeholder:e.$t("menu.InternTrainPlanSub.5nrnbmzbb5g0"),size:"mini"},model:{value:e.searchForm.Ward,callback:function(t){e.$set(e.searchForm,"Ward",t)},expression:"searchForm.Ward"}},e._l(e.wardstore,function(e){return a("el-option",{key:e.rw,attrs:{label:e.WardDesc,value:e.rw}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzcce40")}},[a("el-select",{staticStyle:{width:"100px"},attrs:{filterable:"",clearable:"",placeholder:e.$t("menu.InternTrainPlanSub.5nrnbmzbb5g0"),size:"mini"},model:{value:e.searchForm.Status,callback:function(t){e.$set(e.searchForm,"Status",t)},expression:"searchForm.Status"}},e._l(e.statusstore,function(e){return a("el-option",{key:e.code,attrs:{label:e.desc,value:e.desc}})}),1)],1),e._v(" "),a("el-form-item",[a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode,icon:"nm-icon-w-find"},on:{click:e.LoadPlanData}},[e._v(e._s(e.$t("menu.InternTrainPlanSub.5nrnbmzdde80")))])],1)],1)],1),e._v(" "),a("div",{staticClass:"top-tool-button"},[a("hgbutton",{attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-export":"nm-icon-lite-export"},on:{click:function(t){e.exportData("planData",e.TableDataAll,e.$t("menu.InternTrainPlanSub.5ncy6hl75wg0"))}}},[e._v(e._s(e.$t("menu.InternTrainPlanSub.5nrnbmzdecw0")))])],1),e._v(" "),a("div",{staticClass:"top-tool-table"},[a("el-table",{ref:"planData",attrs:{data:e.planData,height:e.styleCode?e.tableHeight:e.tableHeight+6,border:e.styleCode,"highlight-current-row":"","header-cell-style":e.headerCellFontWeight},on:{"row-click":e.RowClick,"row-dblclick":e.RowDbClick}},[a("el-table-column",{attrs:{width:"40",type:"index",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzfkpc0"),width:"200",prop:"Title"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzcce40"),width:"100",prop:"Status"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzikrw0"),width:"100",prop:"LevelDesc"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzjmrs0"),width:"150",prop:"PlanDateTime",formatter:e.PTableDateHisShow}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzl3280"),prop:"Range",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.InternTrainPlanSub.5ncy6hl8d7k0"),prop:"WardDesc","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzmq400"),width:"100",prop:"Place"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.InternTrainPlanSub.5ncy6hl8dlg0"),prop:"State",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.InternTrainPlanSub.5ncy6hl8dss0"),width:"150",prop:"TrainDate",formatter:e.PTableDateHisShow}}),e._v(" "),e._e(),e._v(" "),e._e()],1),e._v(" "),a("hgpagination",{attrs:{styleCode:e.styleCode,sizes:[20,40,50,100],totalCount:e.totalCount,pageNumber:e.currentPage,pageSize:e.currentPageSize},on:{changePage:e.handleCurrentChange,getPageSize:e.handleSizeChange}})],1),e._v(" "),a("div",[a("el-dialog",{attrs:{title:e.$t("menu.InternTrainPlanSub.5nrnbmznrt80"),modal:"","close-on-click-modal":!1,top:"0%",visible:e.dialogPlanVisible,width:"744px"},on:{"update:visible":function(t){e.dialogPlanVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{staticClass:"nm-icon-w-paper"}):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("menu.InternTrainPlanSub.5nrnbmznrt80")))])]),e._v(" "),a("el-form",{ref:"planForm",attrs:{model:e.planForm,rules:e.plans,inline:!0,"label-position":"right","label-width":"100px",align:"left"}},[a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzfkpc0"),prop:"Title"}},[a("el-input",{staticStyle:{width:"600px"},attrs:{size:"mini",disabled:""},model:{value:e.planForm.Title,callback:function(t){e.$set(e.planForm,"Title",t)},expression:"planForm.Title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5ncy6hl8g7g0"),prop:"TrainDate"}},[a("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,size:"mini",disabled:""},model:{value:e.planForm.TrainDate,callback:function(t){e.$set(e.planForm,"TrainDate",t)},expression:"planForm.TrainDate"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"TrainTime"}},[a("el-time-select",{staticStyle:{width:"100px"},attrs:{size:"mini",disabled:"","picker-options":{start:"00:00",step:"00:01",end:"23:59"}},model:{value:e.planForm.TrainTime,callback:function(t){e.$set(e.planForm,"TrainTime",t)},expression:"planForm.TrainTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzikrw0"),prop:"Level"}},[a("el-select",{staticStyle:{width:"120px"},attrs:{disabled:"",clearable:"",filterable:"",size:"mini"},model:{value:e.planForm.Level,callback:function(t){e.$set(e.planForm,"Level",t)},expression:"planForm.Level"}},e._l(e.levelstore,function(e){return a("el-option",{key:e.code,attrs:{label:e.desc,value:e.code}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzjmrs0"),prop:"PlanDate"}},[a("el-date-picker",{staticStyle:{width:"140px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,size:"mini",disabled:""},model:{value:e.planForm.PlanDate,callback:function(t){e.$set(e.planForm,"PlanDate",t)},expression:"planForm.PlanDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzsnwo0"),prop:"Speaker"}},[a("el-select",{staticStyle:{width:"600px"},attrs:{multiple:"",clearable:"",filterable:"",size:"mini"},model:{value:e.planForm.Speaker,callback:function(t){e.$set(e.planForm,"Speaker",t)},expression:"planForm.Speaker"}},e._l(e.speakerstore,function(e){return a("el-option",{key:e.perdr,attrs:{label:e.PerName+"-"+e.PerID,value:e.perdr}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzmq400"),prop:"Place"}},[a("el-input",{staticStyle:{width:"600px"},attrs:{size:"mini"},model:{value:e.planForm.Place,callback:function(t){e.$set(e.planForm,"Place",t)},expression:"planForm.Place"}})],1),a("br"),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzuozw0"),prop:"Content"}},[a("el-input",{staticStyle:{width:"600px","margin-top":"5px"},attrs:{type:"textarea",rows:10,size:"mini",disabled:""},model:{value:e.planForm.Content,callback:function(t){e.$set(e.planForm,"Content",t)},expression:"planForm.Content"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5nrnbmzxaik0"),prop:"Refer"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{disabled:"",action:e.fileUrl,"on-preview":e.handlerUploadPreview,"file-list":e.planForm.Refer,"auto-upload":!1,multiple:!0,accept:".pdf,.doc,.ppt,.docx,.pptx"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.InternTrainPlanSub.5ncy6hl8lik0"),prop:"Member"}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v(e._s(e.$t("menu.InternTrainPlanSub.5nrnbmzxcgs0")))]),e._v(" "),a("div",{staticClass:"checkboxclass"},[a("el-checkbox-group",{on:{change:e.handleCheckedMemberChange},model:{value:e.planForm.Member,callback:function(t){e.$set(e.planForm,"Member",t)},expression:"planForm.Member"}},e._l(e.members,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1)],1),e._v(" "),a("div",{staticClass:"bottom-button"},[a("hgbutton",{directives:[{name:"intervalclick",rawName:"v-intervalclick",value:{func:e.SavePlan,time:500,value:"N"},expression:"{func:SavePlan,time:500,value:'N'}"}],attrs:{type:e.styleCode?"default":"success",styleCode:e.styleCode,disabled:e.buttonshow}},[e._v(e._s(e.$t("menu.InternTrainPlanSub.5nrnbmzxea40")))]),e._v(" "),a("hgbutton",{directives:[{name:"intervalclick",rawName:"v-intervalclick",value:{func:e.SavePlan,time:500,value:"Y"},expression:"{func:SavePlan,time:500,value:'Y'}"}],staticStyle:{width:"120px"},attrs:{type:"default",styleCode:e.styleCode,disabled:e.buttonshow}},[e._v(e._s(e.$t("menu.InternTrainPlanSub.5nrnbmzxer00")))]),e._v(" "),a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:function(t){e.dialogPlanVisible=!1}}},[e._v(e._s(e.$t("menu.InternTrainPlanSub.5nrnbmzxf200")))])],1)],1)],1)])},staticRenderFns:[]};var c=a("VU/8")(s,m,!1,function(e){a("Hrkv")},null,null);t.default=c.exports},Hrkv:function(e,t){}});