webpackJsonp([281],{"4fIF":function(t,e){},K2FC:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r("pFYg"),n=r.n(a),i=r("Dd8w"),s=r.n(i),o=r("NYxO"),l=r("s5sJ"),c={components:{hgbutton:r("XlQt").default},props:["argid","showArgRemarkFlag","tableColumns"],computed:s()({},Object(o.b)(["styleCode"]),{printColumns:function(){return this.tableColumns.filter(function(t){return t.printFlag})},dateColumnIndex:function(){return this.printColumns.findIndex(function(t){return t.prop.indexOf("Date")>-1})}}),data:function(){return{Finds:{ward:"",warddesc:"",stdate:(new Date).getWeekDate(1),enddate:(new Date).getWeekDate(7),remark:""},DateData:[],TableData:[],StyleData:[],Loading:!1,ArgRemarkStore:["病人总数","手术总数","病危总数"],isDOM:"object"===("undefined"==typeof HTMLElement?"undefined":n()(HTMLElement))?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"===(void 0===t?"undefined":n()(t))&&1===t.nodeType&&"string"==typeof t.nodeName},Dom:"",PrintByGroup:!1,PrintParams:{Orientation:2,Left:1,Right:1,Top:3,Bottom:5},PrintRules:{Orientation:[{required:!0,message:"请选择打印方向",trigger:"change"}],Left:[{required:!0,message:"请填写左边距",trigger:"blur"}],Right:[{required:!0,message:"请填写右边距",trigger:"blur"}],Top:[{required:!0,message:"请填写上边距",trigger:"blur"}],Bottom:[{required:!0,message:"请填写下边距",trigger:"blur"}]},WeekDescTrans:{}}},methods:{LoadPrintParram:function(){var t=this,e=this.axiosConfig("web.INMSetComm","FindParamSubList","RecQuery","parr$^ArgPrintParram");this.$ajax.request(e).then(function(e){if(e.data instanceof Object&&e.data.rows.length>0){var r={};e.data.rows.forEach(function(t){r[t.SubCode]=t.SubDesc}),t.WeekDescTrans["星期一"]=r["星期一"]?r["星期一"]:"星期一",t.WeekDescTrans["星期二"]=r["星期二"]?r["星期二"]:"星期二",t.WeekDescTrans["星期三"]=r["星期三"]?r["星期三"]:"星期三",t.WeekDescTrans["星期四"]=r["星期四"]?r["星期四"]:"星期四",t.WeekDescTrans["星期五"]=r["星期五"]?r["星期五"]:"星期五",t.WeekDescTrans["星期六"]=r["星期六"]?r["星期六"]:"星期六",t.WeekDescTrans["星期日"]=r["星期日"]?r["星期日"]:"星期日"}else t.WeekDescTrans={"星期一":"星期一","星期二":"星期二","星期三":"星期三","星期四":"星期四","星期五":"星期五","星期六":"星期六","星期日":"星期日"};t.FindData()}).catch(function(e){t.$message({type:"error",message:"获取排班打印参数失败",showClose:!0,customClass:"error_class"})})},FindData:function(){var t=this;if(t.argid){t.Loading=!0;var e=t.axiosConfig("web.INMArgComm","GetArrange","RecMethod","id$"+t.argid);t.$ajax.request(e).then(function(e){if(e.data instanceof Object){t.Finds.ward=e.data.ArgWardDR,t.Finds.warddesc=e.data.WardDesc,t.Finds.stdate=new Date(e.data.ArgStDate),t.Finds.enddate=new Date(e.data.ArgEndDate),t.Finds.remark=e.data.ArgRemarks.replace(/「/g,"<br>");for(var r=new Date(t.Finds.stdate);r<=t.Finds.enddate;r=r.addDate(1))t.DateData.push({desc:r.Format("M-d"),id:r.Format("YYYY-MM-dd"),weekDesc:t.WeekDescTrans[r.getWeek()]});var a=e.data.ArgOtherRemark;t.Finds.ArgOtherRemark=a?a.split(","):new Array(t.DateData.length*t.ArgRemarkStore.length).fill("");var n=e.data.ArgWardDR+"^"+t.Finds.stdate.Format("YYYY-MM-dd")+"^"+t.Finds.enddate.Format("YYYY-MM-dd"),i=t.axiosConfig("web.INMArgComm","FindArrangeSubList","RecQuery","parr$"+n,"input$","nurseid$"+sessionStorage.getItem("loginID"));t.$ajax.request(i).then(function(e){if(e.data instanceof Object){t.TableData=e.data.rows;var r=t.axiosConfig("web.INMArgComm","FindArgStyle","RecQuery","parr$"+n,"input$");t.$ajax.request(r).then(function(e){t.Loading=!1,e.data instanceof Object?t.StyleData=e.data.rows:t.$message({type:"error",message:"获取排班表样式失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.Loading=!1,t.$message({type:"error",message:"获取排班表样式失败",showClose:!0,customClass:"error_class"})})}else t.Loading=!1,t.$message({type:"error",message:"获取排班表详情失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.Loading=!1,t.$message({type:"error",message:"获取排班表详情失败",showClose:!0,customClass:"error_class"})})}else t.Loading=!1,t.$message({type:"error",message:"获取排班表信息失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.Loading=!1,t.$message({type:"error",message:"获取排班表信息失败",showClose:!0,customClass:"error_class"})})}},GetCellStyle:function(t,e){if(!(t&&e&&this.StyleData&&this.StyleData[t]))return"padding-left:2px;";var r="padding-left:2px;";if(this.StyleData[t][e]&&"!"!=this.StyleData[t][e])if(-1!=e.indexOf("Date")){r="";for(var a=this.StyleData[t][e].split("@"),n=0;n<a.length;n++)if(a[n]){var i="padding-left:2px;",s=a[n].split("!")[0],o=a[n].split("!")[1];s&&(i=i+"color:"+s+";"),o&&(i=i+"background-color:"+o),r=""==r?i:r+"@"+i}}else{var l=this.StyleData[t][e].split("!")[0],c=this.StyleData[t][e].split("!")[1];l&&(r=r+"color:"+l+";"),c&&(r=r+"background-color:"+c)}return r},getStyle:function(){for(var t="",e=document.querySelectorAll("style,link"),r=0;r<e.length;r++)t+=e[r].outerHTML;return t},getHtml:function(){for(var t=document.querySelectorAll("input"),e=document.querySelectorAll("textarea"),r=document.querySelectorAll("select"),a=0;a<t.length;a++)"checkbox"==t[a].type||"radio"==t[a].type?1==t[a].checked?t[a].setAttribute("checked","checked"):t[a].removeAttribute("checked"):(t[a].type,t[a].setAttribute("value",t[a].value));for(var n=0;n<e.length;n++)"textarea"==e[n].type&&(e[n].innerHTML=e[n].value);for(var i=0;i<r.length;i++)if("select-one"==r[i].type){var s=r[i].children;for(var o in s)"OPTION"==s[o].tagName&&(1==s[o].selected?s[o].setAttribute("selected","selected"):s[o].removeAttribute("selected"))}return this.Dom.outerHTML},getDom:function(t){"string"==typeof t?this.Dom=document.querySelector(t):(this.isDOM(t),this.Dom=this.isDOM(t)?t:t.$el)},printClickByGroup:function(){this.PrintByGroup=!0,this.print_click()},printClickNoByGroup:function(){this.PrintByGroup=!1,this.print_click()},print_click:function(){var t=this;t.$refs.PrintParams.validate(function(e){if(e){t.getDom(t.$refs.divPrint);var r=t.getStyle(),a=t.getHtml(),n=a.match(/<table[\s\S]*?tbody>/g)[0],i=a.match(/<tr class=\"group-class\"[\s\S]*?<tr class=\"[\s\S]*?group-end-class\"[\s\S]*?<\/tr>/g),s=a.match(/<tr class=\"ArgRemarkClass\"[\s\S]*?<\/tr>/g),o=document.getElementById("arg_print_remark").innerHTML;o='<tr><td colspan="14">'+o+"</td></tr>";var c=Object(l.a)();if(c.PRINT_INIT(""),c.SET_PRINT_PAGESIZE(t.PrintParams.Orientation,"210mm","297mm","A4"),t.PrintByGroup)i.forEach(function(e){var a=r+n+e+o+"</tbody></table>";c.ADD_PRINT_TABLE(t.PrintParams.Top+"mm",t.PrintParams.Left+"mm","RightMargin:"+t.PrintParams.Right+"mm","BottomMargin:"+t.PrintParams.Bottom+"mm",a),c.NewPageA()});else{var d=i.reduce(function(t,e){return t+e},""),m="";s&&(m=s.reduce(function(t,e){return t+e},"")),d=r+n+d+m+o+"</tbody></table>",c.ADD_PRINT_TABLE(t.PrintParams.Top+"mm",t.PrintParams.Left+"mm","RightMargin:"+t.PrintParams.Right+"mm","BottomMargin:"+t.PrintParams.Bottom+"mm",d)}return 2==t.PrintParams.Orientation&&c.SET_SHOW_MODE("LANDSCAPE_DEFROTATED",1),void c.PREVIEW()}})},GetDateData:function(t){var e=this.printColumns.findIndex(function(t){return t.prop.indexOf("Date")>-1});if(e)return this.DateData[t-e]},GetColMaxWidth:function(t){var e="";switch(t){case"PerName":case"PerPost":case"ArgPerBeds":e="70px";break;case"LevelDesc":e="40px";break;case"ArgTotalHour":case"ArgProductHour":case"ArgAllProductHour":e="60px";break;default:e=""}return e}},created:function(){this.LoadPrintParram()}},d={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{directives:[{name:"loading",rawName:"v-loading.body",value:t.Loading,expression:"Loading",modifiers:{body:!0}}],staticClass:"div-main-arg-print",attrs:{"element-loading-text":t.$t("menu.ArrangePrint.5nrnasupqjk0")}},[r("div",{attrs:{width:"100%",align:"right"}},[r("el-form",{ref:"PrintParams",attrs:{model:t.PrintParams,rules:t.PrintRules,inline:!0,align:"left"}},[r("el-form-item",{attrs:{prop:"Orientation",label:t.$t("menu.ArrangePrint.5ncy62c77240")}},[r("el-radio-group",{model:{value:t.PrintParams.Orientation,callback:function(e){t.$set(t.PrintParams,"Orientation",e)},expression:"PrintParams.Orientation"}},[r("el-radio",{attrs:{label:2}},[t._v(t._s(t.$t("menu.ArrangePrint.5ncy62c785o0")))]),t._v(" "),r("el-radio",{attrs:{label:1}},[t._v(t._s(t.$t("menu.ArrangePrint.5ncy62c78x00")))])],1)],1),t._v(" "),r("el-form-item",{attrs:{prop:"Left",label:t.$t("menu.ArrangePrint.5ncy62c79y80")}},[r("el-input-number",{staticStyle:{width:"100px"},attrs:{size:"mini",min:0,placeholder:"mm"},model:{value:t.PrintParams.Left,callback:function(e){t.$set(t.PrintParams,"Left",e)},expression:"PrintParams.Left"}})],1),t._v(" "),r("el-form-item",{attrs:{prop:"Right",label:t.$t("menu.ArrangePrint.5ncy62c7b980")}},[r("el-input-number",{staticStyle:{width:"100px"},attrs:{size:"mini",min:0,placeholder:"mm"},model:{value:t.PrintParams.Right,callback:function(e){t.$set(t.PrintParams,"Right",e)},expression:"PrintParams.Right"}})],1),t._v(" "),r("el-form-item",{attrs:{prop:"Top",label:t.$t("menu.ArrangePrint.5ncy62c7ca80")}},[r("el-input-number",{staticStyle:{width:"100px"},attrs:{size:"mini",min:0,placeholder:"mm"},model:{value:t.PrintParams.Top,callback:function(e){t.$set(t.PrintParams,"Top",e)},expression:"PrintParams.Top"}})],1),t._v(" "),r("el-form-item",{attrs:{prop:"Bottom",label:t.$t("menu.ArrangePrint.5ncy62c7d740")}},[r("el-input-number",{staticStyle:{width:"100px"},attrs:{size:"mini",min:0,placeholder:"mm"},model:{value:t.PrintParams.Bottom,callback:function(e){t.$set(t.PrintParams,"Bottom",e)},expression:"PrintParams.Bottom"}})],1),t._v(" "),r("el-form-item",[r("hgbutton",{staticStyle:{"margin-right":"0"},attrs:{type:"default",styleCode:t.styleCode},on:{click:t.printClickByGroup}},[t._v(t._s(t.$t("menu.ArrangePrint.5ncy62c7gec0")))])],1),t._v(" "),r("el-form-item",[r("hgbutton",{attrs:{type:"default",styleCode:t.styleCode},on:{click:t.printClickNoByGroup}},[t._v(t._s(t.$t("menu.ArrangePrint.5nrnasupyos0")))])],1)],1)],1),t._v(" "),r("div",{ref:"divPrint",attrs:{id:"div-print"}},[r("div",[r("table",{staticStyle:{width:"100%"},attrs:{border:"1px solid #ccc",cellspacing:"0",cellpadding:"0"}},[r("caption",{staticStyle:{"margin-bottom":"10px"}},[r("span",{staticStyle:{"font-size":"14px",color:"#000","font-weight":"bold"}},[t._v(t._s(t.Finds.warddesc)+t._s(t.$t("menu.ArrangePrint.5ncy62c7v340"))+t._s(t.Finds.stdate.Format("YYYY-MM-dd")+" - "+t.Finds.enddate.Format("YYYY-MM-dd")+")"))])]),t._v(" "),r("thead",[r("tr",t._l(t.printColumns,function(e,a){return r("th",{key:e.prop,class:{"week-arg-print":e.prop.indexOf("Date")>-1},staticStyle:{color:"#000","font-weight":"normal","font-size":"14px"},attrs:{rowspan:-1==e.prop.indexOf("Date")?2:1,width:e.width?e.width+"px":""}},[t._v(t._s(-1==e.prop.indexOf("Date")?e.label:t.GetDateData(a)?t.GetDateData(a).weekDesc:""))])}),0),t._v(" "),r("tr",t._l(t.DateData,function(e){return r("th",{key:e.id,staticStyle:{color:"#000","font-weight":"normal","font-size":"14px"}},[t._v(t._s(e.desc))])}),0)]),t._v(" "),r("tbody",[t.showArgRemarkFlag&&!isNaN(t.dateColumnIndex)?t._l(t.ArgRemarkStore.length,function(e){return r("tr",{key:e,staticClass:"ArgRemarkClass"},t._l(t.printColumns,function(a,n){return r("td",{key:a.prop},[t._v(t._s(-1==a.prop.indexOf("Date")?0==n?t.ArgRemarkStore[e-1]:"":t.Finds.ArgOtherRemark[(e-1)*t.DateData.length+(n-t.dateColumnIndex)]))])}),0)}):t._e(),t._v(" "),t._l(t.TableData,function(e,a){return[e.ArgPerDR?r("tr",{key:a,staticClass:"arg-post-tr",class:a!=t.TableData.length-1&&t.TableData[a+1].ArgPerDR?"":"group-end-class",staticStyle:{height:"30px"}},t._l(t.printColumns,function(n,i){return r("td",{key:n.prop,class:{"arg-print-date":n.prop.indexOf("Date")>-1,"arg-print-normal":-1==n.prop.indexOf("Date")},style:{maxWidth:t.GetColMaxWidth(n.prop)},attrs:{width:n.prop.indexOf("Date")>-1?"50px":n.width?n.width+"px":"",align:n.prop.indexOf("Date")>-1||["PerSort","PerPost","LevelDesc","ArgPerBeds"].includes(n.prop)?"center":"left"}},[-1==n.prop.indexOf("Date")?[t._v(t._s(e[n.prop]))]:t.GetDateData(i)?r("span",[t._l(e["Date"+t.GetDateData(i).id].split("%")[0].split("「"),function(n,s){return r("font",{key:s,attrs:{"v-if":!!n}},[r("font",{style:t.GetCellStyle(a,"Date"+t.GetDateData(i).id).split("@")[s]},[t._v(t._s(n.split("」")[1]?n.split("」")[1].split("『")[0]:n.split("」")[1]))]),t._v(" "),r("font",{staticStyle:{color:"#000","background-color":"#FFF"}},[t._v(t._s(e["Date"+t.GetDateData(i).id].split("%")[0].split("「").length-1>s?"、":""))])],1)}),t._v(" "),r("font",[t._v(t._s(e["Date"+t.GetDateData(i).id].split("%")[0]&&e["Date"+t.GetDateData(i).id].split("%")[1]?"/":""))]),t._v(" "),e["Date"+t.GetDateData(i).id].split("%")[1]?r("font",{style:t.GetCellStyle(a,"Date"+t.GetDateData(i).id).split("@")[0]},[t._v("\n                                    "+t._s(e["Date"+t.GetDateData(i).id].split("%")[1])+"\n                                    ")]):t._e()],2):t._e()],2)}),0):r("tr",{key:a,staticClass:"group-class",staticStyle:{height:"30px","text-align":"left"}},[r("td",{staticStyle:{"background-color":"#DCF8A8","padding-left":"2px",height:"24px",color:"#000"},attrs:{colspan:t.printColumns.length}},[t._v("\n                                "+t._s(e.PerName)+"\n                            ")])])]})],2)]),t._v(" "),r("div",{staticStyle:{"min-width":"34px",color:"#000","padding-left":"10px","border-right":"1px solid #ccc","border-left":"1px solid #ccc","border-bottom":"1px solid #ccc","font-size":"14px","white-space":"pre-wrap","text-align":"left"},attrs:{id:"arg_print_remark"},domProps:{innerHTML:t._s(t.$t("menu.ArrangePrint.5ncy62cfp2o0")+t.Finds.remark)}})])])])},staticRenderFns:[]};var m=r("VU/8")(c,d,!1,function(t){r("4fIF")},null,null);e.default=m.exports}});