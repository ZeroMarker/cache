webpackJsonp([250],{KyaN:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("Dd8w"),r=o.n(a),l=o("NYxO"),s=o("u0bH"),n=(o("zL8q"),{components:{hgbutton:o("XlQt").default},computed:r()({},Object(l.b)(["Height","LoginId","Width","styleCode"])),data:function(){return{WardStore:[],tableData:[],table:{columns:[]},ToolForm:{Ward:"",StDate:(new Date).getMonthDate(1),EndDate:(new Date).getMonthDate((new Date).getMonthDay()).addDate(1).getMonthDate(0)},elementlist:{},loading:!1,PostData:[],PostDialogVisible:!1,PostTitle:"",curPosition:0,leftArray:[],rightArray:[],ViewColumn:0,rightFixed:"right",leftFixed:!0}},created:function(){this.getWardData(),this.setWeek(),this.getViewColumn();var t=this.$router.currentRoute.path.slice(1,this.$router.currentRoute.path.length);this.loadElementsForRouter("elementlist",t)},watch:{"ToolForm.StDate":function(t,e){if(t&&this.ToolForm.EndDate){if(t.getTime()>this.ToolForm.EndDate.getTime())return this.$message({message:"开始日期不能大于结束日期!",type:"warning",showClose:!0,customClass:"warning_class"}),void(this.ToolForm.StDate="");this.changeWeek()}},"ToolForm.EndDate":function(t,e){if(t&&this.ToolForm.StDate){if(t.getTime()<this.ToolForm.StDate.getTime())return this.$message({message:"结束日期不能小于开始日期!",type:"warning",showClose:!0,customClass:"warning_class"}),void(this.ToolForm.EndDate="");this.changeWeek()}},"table.columns":function(t,e){t.length<this.viewColumn?(this.rightFixed=!1,this.leftFixed=!1):(this.rightFixed="right",this.leftFixed=!0)}},mounted:function(){var t=this,e=this.$refs.argtable.bodyWrapper;e.addEventListener("scroll",function(){var o=e.scrollLeft,a=e.clientWidth,r=e.scrollWidth;if(t.curPosition=o,o+a>r-10){for(var l=t.table.columns,s=l[l.length-1].prop.split("Date")[1],n=t.ToolForm.EndDate.Format("YYYY-MM-dd"),i=new Date(n),d=new Date(s),c=0,m=d.addDate(1);m.between(d,i);m=m.addDate(1)){c+=1;var h=m.Format("YYYY-MM-dd"),u=m.getWeek();if(c>t.viewColumn)break;t.table.columns.push({prop:"Date"+h,label:u+"\n"+m.Format("M-d"),width:80,printFlag:!0,show:!0})}t.$nextTick(function(){t.$refs.argtable.doLayout()})}})},methods:{getViewColumn:function(){this.viewColumn=((this.Width-192-40-120-50-80-80)/80).toFixed(0)},getWardData:function(){var t=this,e=t.axiosConfig("web.INMDataLimit","FindRoleWardList","RecQuery","nurseid$"+t.LoginId);t.$ajax.request(e).then(function(e){t.WardStore=e.data.rows,e.data instanceof Object?t.ToolForm.Ward=t.WardStore[0].rw:t.$message({type:"error",message:"获取权限病区失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.$message({type:"error",message:"获取权限病区失败",showClose:!0,customClass:"error_class"})})},changeWeek:function(){var t=this;this.table.columns=new Array;for(var e=this.ToolForm.StDate.Format("YYYY-MM-dd"),o=this.ToolForm.EndDate.Format("YYYY-MM-dd"),a=new Date(e),r=new Date(o),l=0,s=new Date(e);s.between(a,r);s=s.addDate(1)){l+=1;var n=s.Format("YYYY-MM-dd"),i=s.getWeek();if(l>this.viewColumn)break;this.table.columns.push({prop:"Date"+n,label:i+"\n"+s.Format("M-d"),width:80,printFlag:!0,show:!0})}this.$nextTick(function(){t.$refs.argtable.doLayout()})},setWeek:function(){this.ToolForm.StDate=(new Date).getMonthDate(1),this.ToolForm.EndDate=(new Date).getMonthDate((new Date).getMonthDay()).addDate(1).getMonthDate(0),this.changeWeek()},getDaysBetween:function(t,e){var o=Date.parse(t),a=Date.parse(e);return o>a?0:o==a?1:(a-o)/864e5},FindTableData:function(){var t=this,e=t.ToolForm.Ward;if(""!=e&&void 0!=e){var o=t.ToolForm.StDate;if(o){o instanceof Date&&(o=o.Format("YYYY-MM-dd"));var a=t.ToolForm.EndDate;if(a){a instanceof Date&&(a=a.Format("YYYY-MM-dd")),t.tableData=[],t.loading=!0,t.changeWeek();var r=e+"^"+o+"^"+a,l=t.axiosConfig("web.INMArgComm","GetArrangeLook","Method","parr$"+r,"input$","nurseid$"+t.LoginId);t.$ajax.request(l).then(function(e){e.data instanceof Object?t.tableData=e.data:t.$message({type:"error",message:"后台方法错了,请联系开发工程师^_^",showClose:!0,customClass:"error_class"}),t.loading=!1}).catch(function(e){t.$message({type:"error",message:"获取数据失败",showClose:!0,customClass:"error_class"}),t.loading=!1})}else this.$message({type:"warning",message:"请选择结束日期",showClose:!0,customClass:"warning_class"})}else this.$message({type:"warning",message:"请选择开始日期",showClose:!0,customClass:"warning_class"})}},cellClick:function(t,e,o){if(t.ArgPerDR&&-1!=e.property.indexOf("Date")&&t[e.property]&&0!=t[e.property].length){var a=this,r=t.ArgPerDR,l=e.property.split("Date")[1],s=r+"^"+l;a.PostTitle=t.RealPerName+"  "+l.split("-")[0]+"年"+l.split("-")[1]+"月"+l.split("-")[2]+"日";var n=a.axiosConfig("web.INMArgComm","FindArrangeDate","RecQuery","parr$"+s,"input$","nurseid$"+a.LoginId);a.$ajax.request(n).then(function(t){a.PostData=t.data.rows,a.PostData.length>0?a.PostDialogVisible=!0:a.$message({type:"warning",message:"当天无排班",showClose:!0,customClass:"warning_class"})}).catch(function(t){a.$message({type:"error",message:"获取数据失败",showClose:!0,customClass:"error_class"})})}},groupRowClassName:function(t){var e=t.row;t.rowIndex;return e.ArgPerDR?"":"groupRowClass"},cellStyle:function(t){t.row;var e=t.column;t.rowIndex,t.columnIndex;if(-1==e.property.indexOf("Date"))return"line-height: 29px;"},rowClick:function(t){t.ArgPerDR?this.$refs.argtable.setCurrentRow(t):this.$refs.argtable.setCurrentRow()},PrintClick:function(){var t=this.table.columns,e=this.tableData,o=this.styleData,a=this.ToolForm.ArgRemarks;Object(s.a)(t,e,o,a,"print")},ExportClick:function(){var t=this.table.columns,e=this.tableData,o=this.styleData,a=this.ToolForm.ArgRemarks;Object(s.a)(t,e,o,a,"export")},getCell:function(t,e){if(!isNaN(t)&&!isNaN(e)&&(this.$refs.argtable&&this.$refs.argtable.$el.childNodes[2].childNodes[0].rows[t]))return this.$refs.argtable.$el.childNodes[2].childNodes[0].rows[t].cells[e]}}}),i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"argtablelook-panel",attrs:{"element-loading-text":t.$t("menu.ArrangeTableLook.5nrnatwrcj40")}},[o("div",{staticClass:"top-tool-input"},[o("el-form",{attrs:{model:t.ToolForm,inline:!0,"label-position":"left"}},[o("el-form-item",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatwthok0")}},[o("el-select",{staticClass:"wardSelect",staticStyle:{width:"140px"},attrs:{filterable:"",clearable:"",placeholder:"",size:"mini"},model:{value:t.ToolForm.Ward,callback:function(e){t.$set(t.ToolForm,"Ward",e)},expression:"ToolForm.Ward"}},t._l(t.WardStore,function(t){return o("el-option",{key:t.rw,attrs:{value:t.rw,label:t.WardDesc}})}),1)],1),t._v(" "),o("el-form-item",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatwveds0")}},[o("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,size:"mini"},model:{value:t.ToolForm.StDate,callback:function(e){t.$set(t.ToolForm,"StDate",e)},expression:"ToolForm.StDate"}})],1),t._v(" "),o("el-form-item",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatwxv2k0")}},[o("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,size:"mini"},model:{value:t.ToolForm.EndDate,callback:function(e){t.$set(t.ToolForm,"EndDate",e)},expression:"ToolForm.EndDate"}})],1),t._v(" "),o("el-form-item",[this.elementlist.looksearch||0==t.LoginId?o("hgbutton",{attrs:{type:"default",styleCode:t.styleCode,icon:"nm-icon-w-find"},on:{click:t.FindTableData}},[t._v(t._s(t.$t("menu.ArrangeTableLook.5nrnatwxy3w0")))]):t._e()],1)],1)],1),t._v(" "),o("div",{staticClass:"top-tool-table"},[o("el-table",{ref:"argtable",attrs:{id:"argtable",data:t.tableData,fit:"",height:t.Height-110,"header-cell-style":t.headerCellFontWeight,border:t.styleCode,"highlight-current-row":"","row-class-name":t.groupRowClassName},on:{"row-click":t.rowClick,"cell-click":t.cellClick}},[o("el-table-column",{attrs:{prop:"PerSort",width:"40",fixed:t.leftFixed,align:"center"}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatx2hrk0"),prop:"PerName","show-overflow-tooltip":"",width:"120",fixed:t.leftFixed}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatx4z140"),prop:"LevelDesc","show-overflow-tooltip":"",width:"50"}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5ncy6250v5o0"),prop:"WorkYear","show-overflow-tooltip":"",width:"50"}}),t._v(" "),t._l(t.table.columns,function(e){return[e.show?o("el-table-column",{key:e.prop,staticStyle:{margin:"0px"},attrs:{prop:e.prop,label:e.label,width:e.width,align:(e.prop.indexOf("Date"),"left"),"header-align":"left"},scopedSlots:t._u([{key:"default",fn:function(a){return[-1!=e.prop.indexOf("Date")&&a.row[e.prop]?o("span",t._l(a.row[e.prop],function(r,l){return o("font",{key:l,attrs:{"v-if":!!r}},[o("font",{style:{color:r.FontColor,backgroundColor:r.BgColor}},[t._v(t._s(r.PostDesc))]),t._v(" "),o("font",[t._v(t._s(a.row[e.prop].length-1>l?"/":""))])],1)}),1):a.row[e.prop]&&a.row.ArgGroupDR&&!a.row.ArgPerDR?o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("menu.ArrangeTableLook.5nrnatx8jyc0")+a.row.bedCodes,placement:"bottom-start"}},[o("span",[t._v(t._s(a.row[e.prop]))])]):a.row[e.prop]?o("span",[t._v(t._s(a.row[e.prop]))]):t._e()]}}],null,!0)}):t._e()]}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatxerns0"),prop:"ArgTotalHour","show-overflow-tooltip":"",width:"80",fixed:t.rightFixed}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatxglk40"),prop:"ArgProductHour","show-overflow-tooltip":"",width:"80",fixed:t.rightFixed}})],2),t._v(" "),o("div",{staticClass:"table-remark"},[o("el-form",{ref:"form2",staticStyle:{"padding-left":"6px"},attrs:{inline:!0,model:t.ToolForm,"label-suffix":":"}},[o("el-form-item",{staticClass:"tool-item",staticStyle:{width:"1000px"},attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatxi3r80")}},[o("span",[t._v(t._s(t.$t("menu.ArrangeTableLook.5nrnatxi53s0")))])])],1)],1)],1),t._v(" "),o("el-dialog",{attrs:{title:t.PostTitle+t.$t("menu.ArrangeTableLook.5ncy6253src0"),visible:t.PostDialogVisible,"close-on-click-modal":!0,align:"center",height:t.Height-115,width:"900px"},on:{"update:visible":function(e){t.PostDialogVisible=e}}},[o("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[t.styleCode?o("i",{staticClass:"nm-icon-w-paper"}):t._e(),t._v(" "),o("span",[t._v(t._s(t.PostTitle+t.$t("menu.ArrangeTableLook.5ncy6253src0")))])]),t._v(" "),o("div",{staticClass:"top-tool-dialog-table",staticStyle:{"border-radius":"4px"}},[o("el-table",{ref:"PostData",staticClass:"dialog-div-top-radius dialog-table-bottom-radius",attrs:{data:t.PostData,"header-cell-style":t.headerCellFontWeight,"highlight-current-row":!0,border:t.styleCode}},[o("el-table-column",{attrs:{type:"index",width:"50",align:"center"}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatwthok0"),prop:"WardDesc","show-overflow-tooltip":"",width:"150"}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatxmoys0"),prop:"PostType","show-overflow-tooltip":"",width:"100"}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatxpovo0"),prop:"PostDesc","show-overflow-tooltip":"",width:"110"}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5ncy6255t5c0"),prop:"WorkTime","show-overflow-tooltip":"",width:""}}),t._v(" "),o("el-table-column",{attrs:{label:t.$t("menu.ArrangeTableLook.5nrnatxqvng0"),prop:"PostRemarks","show-overflow-tooltip":"",width:"150"}})],1)],1)])],1)},staticRenderFns:[]};var d=o("VU/8")(n,i,!1,function(t){o("Xv6Q")},null,null);e.default=d.exports},Xv6Q:function(t,e){}});