webpackJsonp([299],{"1A6j":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Dd8w"),s=a.n(n),r=a("NYxO"),i=a("XlQt"),o=a("z8xk"),l={name:"QualItemSetSub",components:{hgbutton:i.default,hgpanel:o.default},computed:s()({},Object(r.b)(["styleCode","Height"])),props:["parId","OperaDesc","OperaMode"],data:function(){var e=this;return{labelWidth:"width:400px",pageSize:{width:"",height:""},fieldSetSize:{height:""},dialogTreeVisible:!1,selectNode:{id:"",level:1},editForm:{SubDesc:"",SubStandard:"",SubScore:"",SubStand:[],StartDate:"",EndDate:"",rw:""},rules:{SubDesc:[{required:!0,message:"请输入描述",trigger:"blur"}],SubScore:[{required:!0,message:"请输入分值！",trigger:"blur"}],StartDate:[{required:!0,type:"date",message:"请选择启用日期！",trigger:"change"},{validator:function(t,a,n){e.editForm.StartDate&&e.editForm.EndDate&&e.editForm.StartDate>e.editForm.EndDate?n("开始日期大于结束日期"):n()}}],SubStandDesc:[{required:!0,message:"请输入标准描述！",trigger:"blur"}],SubStandScore:[{required:!0,message:"请输入分值！",trigger:"blur"}]},treedata:[{id:"",label:"",children:[]}],defaultProps:{children:"children",label:"label"},TeaOpera:{OperaType:"",OperaDesc:"",OperaMode:"",OperaModeDesc:"",OperaStandType:"",OperaScore:"",OperaStand:[],OperaResult:[],OperaPass:"",StartDate:(new Date).addDate(-1),EndDate:"",rw:""},winFlag:0}},methods:{RenderContent:function(e,t){var a=this,n=(t.node,t.data),s=(t.store,new Array);return 1==n.stopFlag&&s.push(e("i",{style:{color:"#FF0000"},class:"el-icon-remove"})),e("span",{style:{width:"100%"},class:"custom-tree-node",on:{dblclick:function(e){a.NodeDblClick()}}},[n.label,s])},AddStandard:function(){this.editForm.SubStand.push({desc:"",score:""})},DelStandard:function(e){this.editForm.SubStand.splice(e,1)},HandleTreeContextmenu:function(e,t,a,n){this.selectNode.id=a.key,this.selectNode.level=a.level;var s=document.getElementById("treeRightMenu");if(s){var r=e.clientX-(document.documentElement.clientWidth-this.$parent.$refs.dialog.clientWidth)/2,i=e.clientY-(document.documentElement.clientHeight-this.$parent.$refs.dialog.clientHeight)/2;document.documentElement.clientHeight,s.style.left=r-1+"px",s.style.top=i+"px",s.style.display="block"}},SetSize:function(){this.pageSize.width=this.$store.state.systemset.width+"px",this.pageSize.height=this.$store.state.systemset.height+"px"},LoadTreeRootId:function(){this.treedata[0].id=0,this.treedata[0].label=this.OperaDesc},CloseTreeData:function(){this.dialogTreeVisible=!1,this.LoadTreeData()},LoadTreeData:function(){var e=this;e.$ajax.request(e.axiosConfig("web.INMDBComm","FindTeaOperaSubTree","Method","parref$"+e.parId,"par$")).then(function(t){e.treedata[0].children=t.data,e.selectNode.id="",e.$ajax.request(e.axiosConfig("web.INMDBComm","GetTeaOpera","RecMethod","rw$"+e.parId)).then(function(t){t.data instanceof Object?(t.data.OperaStand=t.data.OperaStand.split("「").map(function(e){return{desc:e.split("」")[0],score:e.split("」")[1]}}),t.data.OperaResult=t.data.OperaResult.split("「").map(function(e){return{desc:e.split("」")[0],dual:e.split("」")[1],stScore:e.split("」")[2],endScore:e.split("」")[3]}}),t.data.StartDate&&(t.data.StartDate=new Date(t.data.QualStDate)),t.data.EndDate&&(t.data.EndDate=new Date(t.data.QualEndDate)),e.TeaOpera=t.data,t.data.OperaScore=t.data.OperaScore?t.data.OperaScore:0,e.treedata[0].label=t.data.OperaDesc+"("+t.data.OperaScore+")"):e.$message({type:"error",message:"获取数据失败",showClose:!0,customClass:"error_class"})})})},AddTreeData:function(){var e=this;this.winFlag=0;var t=document.getElementById("treeRightMenu");t&&(t.style.display="none"),0==this.selectNode.id||this.selectNode.id?(this.dialogTreeVisible=!0,this.$nextTick(function(){e.$refs.editForm.resetFields(),e.ClearForm(),("F"==e.TeaOpera.OperaMode||"E"==e.TeaOpera.OperaMode&&"O"==e.TeaOpera.OperaStandType)&&e.editForm.SubStand.push({desc:"",score:""})})):this.$message({type:"warning",message:"请选中节点",showClose:!0,customClass:"warning_class"})},ClearForm:function(){this.editForm={SubDesc:"",SubStandard:"",SubScore:"",SubStand:new Array,StartDate:(new Date).addDate(-1),EndDate:"",rw:""}},DeleteTreeData:function(){var e=document.getElementById("treeRightMenu");e&&(e.style.display="none");var t=this;0!=t.selectNode.id?t.selectNode.id?this.$confirm("删除节点及其下所有节点, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$ajax.request(t.axiosConfig("web.INMDBComm","DeleteTeaOperaSub","Method","rw$"+t.selectNode.id)).then(function(e){2==e.data&&t.$message({type:"warning",message:"此节点已被使用不可删除！",showClose:!0,customClass:"warning_class"}),t.LoadTreeData()})}).catch(function(){t.$message({type:"info",message:"已取消删除",showClose:!0,customClass:"info_class"})}):t.$message({type:"warning",message:"请选择要删除的节点",showClose:!0,customClass:"warning_class"}):t.$message({type:"warning",message:"此节点不能删除！",showClose:!0,customClass:"warning_class"})},SaveClick:function(){var e=this,t="",a=e.editForm;for(var n in a){var s=a[n];void 0==s&&(s=""),s instanceof Date?t=t+n+"|"+s.Format("YYYY-MM-dd")+"^":"SubStand"==n?"E"==e.TeaOpera.OperaMode&&"O"==e.TeaOpera.OperaStandType||"F"==e.TeaOpera.OperaMode?function(){var a="";e.editForm.SubStand.forEach(function(e){a=a?a+"「"+e.desc+"」"+e.score:e.desc+"」"+e.score}),t=t+n+"|"+a+"^"}():t=t+n+"|^":t=t+n+"|"+s+"^"}t=t+"SubPar|"+e.selectNode.id+"^SubSort|"+e.selectNode.level+"^parref|"+e.parId,e.$refs.editForm.validate(function(a){if(a){var n=e.axiosConfig("web.INMDBComm","SaveTeaOperaSub","Method","parr$"+t);e.$ajax.request(n).then(function(t){1==t.data?(e.$message({message:"保存成功！",type:"success",showClose:!0,customClass:"success_class"}),e.dialogTreeVisible=!1,e.LoadTreeData()):t.data.length<100?e.$message({type:"warning",message:t.data,showClose:!0,customClass:"warning_class"}):e.$message({type:"warning",message:"后台方法错了^_^",showClose:!0,customClass:"warning_class"})}).catch(function(t){e.$message({type:"warning",message:"保存失败！",showClose:!0,customClass:"warning_class"})})}})},NodeKeyClick:function(e,t,a){this.selectNode.id=t.key,this.selectNode.level=t.level;var n=document.getElementById("treeRightMenu");n&&(n.style.display="none")},NodeDblClick:function(){var e=this;e.winFlag=1,0!=e.$refs.treedata.currentNode.node.key&&(this.ClearForm(),e.dialogTreeVisible=!0,e.$nextTick(function(){e.$refs.editForm.resetFields(),e.$ajax.request(e.axiosConfig("web.INMDBComm","GetTeaOperaSub","RecMethod","rw$"+e.selectNode.id)).then(function(t){e.setForm(e.$refs.editForm,e.editForm,t.data),t.data.SubStand?e.editForm.SubStand=t.data.SubStand.split("「").map(function(e){return{desc:e.split("」")[0],score:e.split("」")[1]}}):e.editForm.SubStand=[{desc:"",score:""}]})}))}},created:function(){this.fieldSetSize.height=document.documentElement.clientHeight-58+"px",this.SetSize(),this.LoadTreeRootId(),this.LoadTreeData(),document.onclick=function(){var e=document.getElementById("treeRightMenu");e&&(e.style.display="none")},document.oncontextmenu=function(){var e=document.getElementById("treeRightMenu");e&&(e.style.display="none")}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tea-operationsub-panel",style:e.pageSize},[a("hgpanel",{staticStyle:{width:"100%"},attrs:{title:e.$t("menu.TeaOperationSub.5ncy6564mk40"),styleCode:e.styleCode,icon:"#nm-icon-paper",panelHeight:600}},[a("div",{staticStyle:{overflow:"auto"},style:{height:e.styleCode?"563px":"564px"}},[a("el-tree",{ref:"treedata",staticStyle:{height:"100%",overflow:"auto",border:"none"},attrs:{data:e.treedata,"default-expand-all":"","node-key":"id","expand-on-click-node":!1,"render-content":e.RenderContent,"highlight-current":"","check-on-click-node":"",props:e.defaultProps},on:{"node-click":e.NodeKeyClick,"node-contextmenu":e.HandleTreeContextmenu}})],1)]),e._v(" "),a("el-dialog",{attrs:{title:0==e.winFlag?e.$t("menu.TeaOperationSub.5nrnazn7v2s0"):e.$t("menu.TeaOperationSub.5nrnazn7v2s1"),"modal-append-to-body":!0,"append-to-body":!0,"close-on-click-modal":!1,width:"544px",visible:e.dialogTreeVisible,"before-close":e.CloseTreeData,"custom-class":"tea-operation-sub-dialog"},on:{"update:visible":function(t){e.dialogTreeVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{class:[0==e.winFlag?"nm-icon-w-plus":"nm-icon-w-edit"]}):e._e(),e._v(" "),0==e.winFlag?a("span",[e._v(e._s(e.$t("menu.TeaOperationSub.5nrnazn7v2s0")))]):1==e.winFlag?a("span",[e._v(e._s(e.$t("menu.TeaOperationSub.5nrnazn7v2s1")))]):e._e()]),e._v(" "),a("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.rules,inline:!0,"label-position":"right","label-width":"100px",align:"left"}},[a("el-form-item",{attrs:{label:e.$t("menu.TeaOperationSub.5nrnazn9lj00"),prop:"SubDesc"}},[a("el-input",{staticStyle:{"margin-bottom":"10px","margin-top":"5px"},style:e.labelWidth,attrs:{placeholder:e.$t("menu.TeaOperationSub.5nrnaznaua40"),type:"textarea",autosize:{minRows:2},size:"mini"},model:{value:e.editForm.SubDesc,callback:function(t){e.$set(e.editForm,"SubDesc",t)},expression:"editForm.SubDesc"}})],1),e._v(" "),"C"==e.OperaMode||"D"==e.OperaMode||"E"==e.OperaMode||"F"==e.OperaMode?a("el-form-item",{attrs:{label:e.$t("menu.TeaOperationSub.5nrnaznc9ss0"),prop:"SubScore"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{type:"number",placeholder:e.$t("menu.TeaOperationSub.5nrnaznddwo0"),size:"mini"},model:{value:e.editForm.SubScore,callback:function(t){e.$set(e.editForm,"SubScore",t)},expression:"editForm.SubScore"}})],1):e._e(),e._v(" "),"A"==e.TeaOpera.OperaMode||"B"==e.editForm.OperaMode?a("el-form-item",{staticClass:"tea-operate-sub-content",staticStyle:{"margin-bottom":"16px"},attrs:{label:e.$t("menu.TeaOperationSub.5nrnaznejk80")}},[a("div",{staticClass:"tea-op-sub-table"},[a("table",{staticStyle:{"text-align":"left","border-collapse":"collapse"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("tr",[a("th",{attrs:{width:"297"}},[e._v(e._s(e.$t("menu.TeaOperationSub.5nrnaznels40")))]),e._v(" "),a("th",{attrs:{width:"60"}},[e._v(e._s(e.$t("menu.TeaOperationSub.5nrnaznc9ss0")))])]),e._v(" "),e._l(e.TeaOpera.OperaStand,function(t){return a("tr",{key:t.desc},[a("td",[e._v(e._s(t.desc))]),e._v(" "),a("td",[e._v(e._s(t.score))])])})],2)])]):e._e(),e._v(" "),"E"==e.TeaOpera.OperaMode&&"O"==e.TeaOpera.OperaStandType||"F"==e.TeaOpera.OperaMode?a("el-form-item",{attrs:{label:e.$t("menu.TeaOperationSub.5nrnaznejk80"),required:""}},e._l(e.editForm.SubStand,function(t,n){return a("div",{key:n,staticClass:"add-tea-sub-item"},[a("el-form-item",{attrs:{prop:"SubStand."+n+".desc",rules:e.rules.SubStandDesc}},[a("div",{staticStyle:{display:"flex"}},[a("el-input",{staticStyle:{width:"230px"},attrs:{size:"mini",placeholder:e.$t("menu.TeaOperationSub.5nrnaznh16k0")},model:{value:t.desc,callback:function(a){e.$set(t,"desc",a)},expression:"item.desc"}})],1)]),e._v(" "),a("el-form-item",{attrs:{prop:"SubStand."+n+".score",rules:e.rules.SubStandScore}},[a("div",{staticStyle:{display:"flex"}},[a("el-input",{staticStyle:{width:"60px"},attrs:{type:"number",placeholder:e.$t("menu.TeaOperationSub.5nrnaznc9ss0"),size:"mini"},model:{value:t.score,callback:function(a){e.$set(t,"score",a)},expression:"item.score"}})],1)]),e._v(" "),n==e.editForm.SubStand.length-1?a("hgbutton",{attrs:{type:"text",issvg:e.styleCpde,icon:e.styleCode?"#nm-icon-add":"nm-icon-lite-add"},on:{click:e.AddStandard}}):e._e(),e._v(" "),1!=e.editForm.SubStand.length?a("hgbutton",{attrs:{type:"text",issvg:e.styleCpde,icon:e.styleCode?"#nm-icon-cancel":"nm-icon-lite-cancel"},on:{click:e.DelStandard}}):e._e()],1)}),0):e._e(),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.TeaOperationSub.5nrnaznjl600"),prop:"SubStandard"}},[a("el-input",{staticStyle:{"margin-top":"5px","margin-bottom":"10px"},style:e.labelWidth,attrs:{placeholder:e.$t("menu.TeaOperationSub.5nrnaznaua40"),type:"textarea",autosize:{minRows:2},size:"mini"},model:{value:e.editForm.SubStandard,callback:function(t){e.$set(e.editForm,"SubStandard",t)},expression:"editForm.SubStandard"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.TeaOperationSub.5nrnaznlfko0"),prop:"StartDate"}},[a("el-date-picker",{style:e.labelWidth,attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,placeholder:e.$t("menu.TeaOperationSub.5nrnaznml4s0"),size:"mini"},model:{value:e.editForm.StartDate,callback:function(t){e.$set(e.editForm,"StartDate",t)},expression:"editForm.StartDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.TeaOperationSub.5nrnaznntyk0"),prop:"EndDate"}},[a("el-date-picker",{style:e.labelWidth,attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,placeholder:e.$t("menu.TeaOperationSub.5nrnaznml4s0"),size:"mini"},model:{value:e.editForm.EndDate,callback:function(t){e.$set(e.editForm,"EndDate",t)},expression:"editForm.EndDate"}})],1)],1),e._v(" "),a("div",{staticClass:"bottom-button"},[a("hgbutton",{directives:[{name:"intervalclick",rawName:"v-intervalclick",value:{func:e.SaveClick,time:500},expression:"{func:SaveClick,time:500}"}],attrs:{type:e.styleCode?"default":"success",styleCode:e.styleCode}},[e._v(e._s(e.$t("menu.TeaOperationSub.5nrnaznoueg0")))]),e._v(" "),a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:e.CloseTreeData}},[e._v(e._s(e.$t("menu.TeaOperationSub.5nrnaznouz80")))])],1)],1),e._v(" "),a("div",{staticClass:"right-menu",staticStyle:{display:"none",width:"140px",position:"absolute"},attrs:{id:"treeRightMenu"}},[a("ul",[a("li",[a("a",{staticClass:"right-menu-btn",attrs:{href:"javascript:void(0)"},on:{click:e.AddTreeData}},[e._v(e._s(e.$t("menu.TeaOperationSub.5nrnaznovqo0")))])]),e._v(" "),a("li",{staticStyle:{"border-top":"1px solid #DCDCDC"}},[a("a",{staticClass:"right-menu-btn",attrs:{href:"javascript:void(0)"},on:{click:e.DeleteTreeData}},[e._v(e._s(e.$t("menu.TeaOperationSub.5nrnaznow5o0")))])])])])],1)},staticRenderFns:[]};var c=a("VU/8")(l,d,!1,function(e){a("nGAL")},null,null);t.default=c.exports},nGAL:function(e,t){}});