webpackJsonp([126,197],{OYGT:function(e,t){},Shyh:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),r=a.n(s),o=a("a6/g"),n=a("NYxO"),i=a("XlQt"),l={name:"NurNightSchedule",computed:r()({},Object(n.b)(["Height","styleCode"])),components:{NurNightSchedulePrint:o.default,Hgbutton:i.default},data:function(){return{isDemo:0==this.$store.state.login.LoginId,lang:"zh",firstDay:1,weekNames:[],langSets:{zh:{weekNames:["周日","周一","周二","周三","周四","周五","周六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],titleFormat:"yyyy年MM月"}},Loading:!0,ChecktableHeight:"",currentDate:new Date,currentDates:[],title:"",leftArrow:"上月",rightArrow:"下月",ScheduleVisible:!1,GroupTypes:[],CheckPerVisibility:!1,CheckGroupVisibility:!1,SchduleForm:{CheckPerson:[],GroupType:"",CheckTask:[],RowID:"",CheckGroup:"",Remark:""},schudulerules:{CheckPerson:[{required:!0,message:"检查人员不能为空",trigger:"change",type:"array"}],CheckGroup:[{required:!0,message:"检查组别不能为空",trigger:"change"}],GroupType:[{required:!0,message:"检查科室不能为空",trigger:"change"}],CheckTask:[{required:!0,message:"检查任务不能为空",trigger:"change",type:"array"}]},CheckPpersonStore:[],CheckGroupStore:[],CheckDay:"",CheckTaskStore:[],TaskType:"",SelectDay:{},SelectDayIndex:0,taskContextMenuData:{menuName:"TaskMenu",axis:{x:null,y:null},menulists:[]},contextMenuData:{menuName:"taskmenulist",axis:{x:null,y:null},menulists:[],checkedValueList:[]},CheckScoreVisible:!1,selectrow:null,selectcolumn:null,ActivePanel:"",CheckTabPanels:[],PrintVisible:!1,printflag:"",elementlist:[],CheckBasicData:[],CheckWards:[],SignVisible:!1,SignForm:{username:"",password:""},PerToolTip:"",IsPrintEmpty:!1,CheckTypeStore:[],CheckTypeShort:{NIGHTCHECK:"夜",WEEKCHECK:"周",HOLIDAYCHECK:"节",QUALCHECK:"质",SPECIALCHECK:"特"},CheckTypeColor:{NIGHTCHECK:"#e54d42",WEEKCHECK:"#39b54a",HOLIDAYCHECK:"#0081ff",QUALCHECK:"#e03997",SPECIALCHECK:"#8799a3"},SaveLoading:!1,ShiftDialogVisible:!1,ShiftForm:{ShiftToDate:"",ShiftToPer:"",ShiftDate:"",ShiftPer:"",ShiftPost:"",ShiftRemark:"",rw:""},ExChangeFormRules:{ShiftToDate:[{required:!0,message:"换班日期不能为空",trigger:"change",type:"date"}],ShiftToPer:[{required:!0,message:"换班人员不能为空",trigger:"change"}],ShiftDate:[{required:!0,message:"交换日期不能为空",trigger:"change",type:"date"}],ShiftPer:[{required:!0,message:"交换人员不能为空",trigger:"change"}],ShiftPost:[{required:!0,message:"交换班次不能为空",trigger:"change"}]},ShiftToPersonStore:[],ShiftPersonStore:[],ShiftSchduleStore:[],PickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},SignType:[],IsOverHlb:!1,Today:new Date((new Date).Format("YYYY-MM-dd")),IsDisable:!1,CheckerPost:"",SignPasswordShow:!1,TipWidth:0,ToStatus:"",CurStatus:""}},methods:{GetAlertMessage:function(){var e=this;if(!((new Date).Format("dd")<20)){var t="";e.CheckTypeStore.forEach(function(e){t=t?t+"^"+e.rw:e.rw});var a=(new Date).getMonthLastDate().addDate(1).Format("YYYY-MM-dd"),s=e.axiosConfig("web.INMQualControlComm","IsExistCheckNextMonth","Method","type$"+t,"date$"+a);e.$ajax.request(s).then(function(t){1!=t.data&&e.$message({type:"warning",message:"下月未排班，请及时排班",showClose:!0,customClass:"warning_class"})}).catch(function(t){e.$message({type:"error",message:"获取下月排班失败",showClose:!0,customClass:"error_class"})})}},GetCheckType:function(){var e=this,t=e.axiosConfig("web.INMQualControlComm","FindQualTypeList","RecQuery","type$N");e.$ajax.request(t).then(function(t){t.data instanceof Object?(e.CheckTypeStore=t.data.rows,e.CheckTypeStore.forEach(function(t){t.SubSymbol&&(e.CheckTypeShort[t.SubCode.toUpperCase()]=t.SubSymbol),t.SubColor&&(e.CheckTypeColor[t.SubCode.toUpperCase()]=t.SubColor),e.SignType.push({isNeedSign:"Y"==t.IsNeedSign,isNeedPass:"Y"==t.IsNeedPass,isNeedDiff:"Y"==t.IsNeedDiff,rw:t.rw})}),e.CalTipWidth(),e.GetCalendar(),e.GetAlertMessage()):e.$message({type:"error",message:"获取质控类型失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取质控类型失败",showClose:!0,customClass:"error_class"})})},GoPrev:function(){this.currentDate.setDate(0),this.GetCalendar()},GoNext:function(){this.currentDate.setDate(32),this.currentDate.setDate(1),this.GetCalendar()},getCurrentMonth:function(){this.currentDate=new Date,this.GetCalendar()},GetCalendar:function(){for(var e=this,t=[0,1,2,3,4,5,6],a=t.findIndex(function(t){return t==e.firstDay}),s=[];s.length<7;)s.push(t[a%7]),a++;var r=new Date,o=new Date(e.currentDate);o.setDate(1);var n=o.getDay(),i=s.findIndex(function(e){return e==n});o=o.addDate(-i),e.title=e.currentDate.Format(e.langSets[e.lang].titleFormat);var l="";e.CheckTypeStore.forEach(function(e){l=l?l+"^"+e.rw:e.rw});var c=[];e.$ajax.request(e.axiosConfig("web.INMQualControlComm","FindSchduleList","RecQuery","type$"+l,"date$"+o.Format("YYYY-MM-dd"),"nurseid$"+sessionStorage.loginID)).then(function(t){for(var a=t.data.rows,s=0;s<6;s++){for(var n=[],i=function(t){var i=a[7*s+t],l=[],c=[];i.TaskTypeCode&&i.TaskTypeCode.split("ˇ").forEach(function(t){l.push(e.CheckTypeShort[t]?e.CheckTypeShort[t]:t),c.push(e.CheckTypeColor[t]?e.CheckTypeColor[t]:t)}),n.push({MonthDay:o.getDate(),IsToday:r.toDateString()==o.toDateString(),IsCurMonth:o.getMonth()==e.currentDate.getMonth(),date:new Date(o),IsHoliday:i.IsHoliday,DayTaskCheckPeroson:i.TaskPerson?i.TaskPerson.split("ˇ"):[],DayTaskCheckPerosonName:i.TaskPersonDesc?i.TaskPersonDesc.split("ˇ"):[],DayTaskItem:i.TaskItemDesc?i.TaskItemDesc.split("ˇ"):[],DayTaskEditFlag:i.EditAble?i.EditAble.split("ˇ"):[],DayTaskCheckType:i.TaskType?i.TaskType.split("ˇ"):[],DayTaskCheckTypeDesc:l,DayTaskCheckTypeColor:c,DayTaskWardDesc:i.TaskWardDesc?i.TaskWardDesc.split("ˇ"):[],DayTaskItemId:i.rw?i.rw.split("ˇ"):[],DayTaskChecked:i.IsChecked?i.IsChecked.split("ˇ"):[],DayTaskResultPerosonName:i.RecorderName?i.RecorderName.split("ˇ"):[],DayTaskWardGroupDesc:i.WardGroup?i.WardGroup.split("ˇ"):[],IsChecker:i.IsChecker?i.IsChecker.split("ˇ"):[],DayTaskRemark:i.TaskRemark?i.TaskRemark.split("ˇ"):[]}),o.setDate(o.getDate()+1)},l=0;l<7;l++)i(l);c.push(n)}e.currentDates=c,e.Loading=!1}).catch(function(t){e.Loading=!1,e.$message({type:"error",message:"获取夜查房数据失败",showClose:!0,customClass:"error_class"})})},LoadTask:function(e,t){var a=this;a.SchduleForm.CheckTask=[],a.$ajax.request(a.axiosConfig("web.INMQualControlComm","FindPlanItemList","RecQuery","type$"+e,"date$"+t)).then(function(e){e.data instanceof Object?a.CheckTaskStore=e.data.rows:a.$message({type:"error",message:"获取检查任务失败",showClose:!0,customClass:"error_class"})}).catch(function(e){a.$message({type:"error",message:"获取检查任务失败",showClose:!0,customClass:"error_class"})})},ResetScheduleForm:function(){this.SchduleForm={CheckPerson:[],GroupType:"",CheckTask:[],RowID:"",CheckGroup:"",Remark:""}},AddSchedule:function(e){var t=this,a=t.axiosConfig("web.INMQualControlComm","GetDateQaulType","Method","date$"+e.date.Format("YYYY-MM-dd"));t.$ajax.request(a).then(function(a){if(/\d__\d/.test(a.data)){t.TaskType=a.data,t.CheckDay=e.date.Format("YYYY-MM-dd"),t.CheckPerVisibility=!1,t.CheckGroupVisibility=!1,t.ResetScheduleForm(),t.LoadTask(t.TaskType,e.date.Format("YYYY-MM-dd")),t.ScheduleVisible=!0,t.$nextTick(function(){t.$refs.SchduleForm.clearValidate()});var s=t.axiosConfig("web.INMQualControlComm","IsNurHeadGroupUsed","Method","qual$"+t.TaskType);t.$ajax.request(s).then(function(e){"True"==e.data?t.CheckGroupVisibility=!0:t.CheckPerVisibility=!0,t.$ajax.request(t.axiosConfig("web.INMQualControlComm","FindWardGroupList","RecQuery","type$"+t.TaskType,"parr$")).then(function(e){e.data instanceof Object?t.GroupTypes=e.data.rows:t.$message({type:"error",message:"获取夜查房病区分组失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.$message({type:"error",message:"获取夜查房病区分组失败",showClose:!0,customClass:"error_class"})})}).catch(function(e){t.$message({type:"error",message:"获取夜查房分组启用状态失败",showClose:!0,customClass:"error_class"})})}else t.$message({type:"error",message:"获取日期质控类型失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.$message({type:"error",message:"获取日期质控类型失败",showClose:!0,customClass:"error_class"})})},CheckWardGroupChange:function(){var e=this;if(e.CheckPerVisibility){e.SchduleForm.CheckPerson=[],e.CheckPpersonStore=[];var t=e.axiosConfig("web.INMQualControlComm","FindNightCheckPerList","RecQuery","type$"+e.TaskType,"wardgroup$"+e.SchduleForm.GroupType,"post$"+this.CheckerPost,"date$"+e.CheckDay);e.$ajax.request(t).then(function(t){t instanceof Object?e.CheckPpersonStore=t.data.rows:e.$message({type:"error",message:"获取检查人员失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取检查人员失败",showClose:!0,customClass:"error_class"})})}else{e.SchduleForm.CheckGroup="",e.CheckGroupStore=[];var a=e.axiosConfig("web.INMQualControlComm","FindNightCheckGroupList","RecQuery","type$"+e.TaskType,"wardgroup$"+e.SchduleForm.GroupType,"date$"+e.CheckDay);e.$ajax.request(a).then(function(t){t instanceof Object?e.CheckGroupStore=t.data.rows:e.$message({type:"error",message:"获取检查组失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取检查组失败",showClose:!0,customClass:"error_class"})})}},CheckAbleSave:function(){var e=this;e.$refs.SchduleForm.validate(function(t){if(t){var a=e.SchduleForm.CheckPerson.join(",")+"^"+e.SchduleForm.CheckGroup;a=a+"^"+e.SchduleForm.GroupType+"^"+e.TaskType+"^"+e.CheckDay,e.$ajax.request(e.axiosConfig("web.INMQualControlComm","IsAbleSave","Method","parr$"+a)).then(function(t){if(1==t.data){var a="GroupType|"+e.SchduleForm.GroupType+"^CheckTask|"+e.SchduleForm.CheckTask.join(",")+"^Remark|"+e.SchduleForm.Remark;a=(a=e.CheckPerVisibility?a+"^CheckPerson|"+e.SchduleForm.CheckPerson.join(","):a+"^CheckGroup|"+e.SchduleForm.CheckGroup)+"^CheckDate|"+e.CheckDay+"^CreateUser|"+sessionStorage.getItem("loginID"),e.SaveArg(a)}else e.$message({type:"warning",message:t.data,showClose:!0,customClass:"warning_class"})}).catch(function(t){e.$message({type:"error",message:"获取数据失败",showClose:!0,customClass:"error_class"})})}})},SaveArg:function(e){var t=this;t.$ajax.request(t.axiosConfig("web.INMQualControlComm","SaveNightTask","Method","parr$"+e,"checktype$"+t.TaskType)).then(function(e){1==e.data?(t.$message({type:"success",message:"保存成功",showClose:!0,customClass:"success_class"}),t.ScheduleVisible=!1,t.GetCalendar()):t.$message({type:"error",message:"保存失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.$message({type:"error",message:"保存失败",showClose:!0,customClass:"error_class"})})},getPerCheckNum:function(e,t,a){var s=this;s.PerToolTip="";var r=s.CheckTypeStore.map(function(e){return e.rw}).join("^"),o=a.date.Format("YYYY"),n=s.axiosConfig("web.INMQualControlComm","FindPerCheckNumList","RecQuery","type$"+r,"year$"+o,"nurse$"+t);s.$ajax.request(n).then(function(t){if(t instanceof Object){var a='<div><span style="width:15%;display:inline-block;font-family:Microsoft YaHei;font-weight:700;color:#000;font-size:14px;vertical-align: top;">检查人</span><span style="width:85%;display:inline-block;">'+e+"</span></div>";a+='<div style="border-bottom:1px dashed #ccc;height:0;margin:10px 0;"></div>',t.data.rows.forEach(function(t,r){a+='<div style="margin-bottom:10px;"><span style="width:15%;display:inline-block;font-family:Microsoft YaHei;font-weight:700;color:#000;font-size:14px;">'+e.split(",")[r]+'</span><span style="width:85%;display:inline-block;">',s.CheckTypeStore.forEach(function(e,r){a+=e.SubDesc+':<span style="display:inline-block;margin-left:10px;width:30px;">'+t[e.rw]+"</span>",r<s.CheckTypeStore.length-1&&(a+='<span style="display:inline-block;margin:0 4px;color:#ccc;">|</span>')}),a+="</span></div>"}),s.PerToolTip=a}else s.$message({type:"error",message:"获取人员检查次数失败",showClose:!0,customClass:"error_class"})}).catch(function(e){s.$message({type:"error",message:"获取人员检查次数失败",showClose:!0,customClass:"error_class"})})},ShowArgContextmenu:function(e,t,a,s){event.preventDefault(),this.$refs.TaskItemPopover instanceof Array&&this.$refs.TaskItemPopover.forEach(function(e){e.doClose()}),this.SelectDay=e,this.SelectDayIndex=s,this.TaskType=this.SelectDay.DayTaskCheckType[this.SelectDayIndex],this.taskContextMenuData.menulists=[],(this.IsOverHlb||this.Today.addDate(1)>=e.date)&&this.taskContextMenuData.menulists.push({fnHandler:"check",btnName:"开始检查"}),new Date(this.SelectDay.date.Format("YYYY-MM-dd")).getTime()<Date.now()-864e5||this.taskContextMenuData.menulists.push({fnHandler:"exchange",btnName:"申请换班"}),(this.elementlist.delschdule||0==sessionStorage.loginID)&&this.taskContextMenuData.menulists.push({fnHandler:"delete",btnName:"删除任务"}),this.taskContextMenuData.axis={x:event.clientX,y:event.clientY}},CheckArg:function(){var e=this;if(e.SelectDay)if("1"==e.SelectDay.DayTaskEditFlag[e.SelectDayIndex]){e.Loading=!0,e.printflag=e.SelectDay.date.Format("YYYY-MM-dd"),e.CheckBasicData=new Array,e.CheckTabPanels=new Array;var t=e.axiosConfig("web.INMQualControlComm","GetCheckPanes","Method","taskid$"+e.SelectDay.DayTaskItemId[e.SelectDayIndex]);e.$ajax.request(t).then(function(t){t.data instanceof Object?(e.CheckWards=t.data.CheckWard,e.CurStatus=t.data.Status,e.IsDisable="S"==t.data.Status&&!e.IsOverHlb,e.CheckBasicData=t.data.CheckBasic,t.data.TaskPanel.forEach(function(t){2!=t.ScoreType&&2==t.ScoreTypeSub?t.QualSubItems.forEach(function(t,a){e.CheckWards.forEach(function(e){if(t["c"+e.WardId])if("-"==t["c"+e.WardId])t["ctoshow"+e.WardId]="-";else{var a=t.CheckMenu.split(","),s="";t["c"+e.WardId].split(",").forEach(function(e,r){e&&"headnur"!=t.QualSubId&&(s=s?s+","+a[r].split("@")[0]+":"+e:a[r].split("@")[0]+":"+e)}),t["ctoshow"+e.WardId]=s}else t["ctoshow"+e.WardId]=""})}):2==t.ScoreType&&6==t.ScoreTypeSub&&t.QualSubItems.forEach(function(t,a){e.CheckWards.forEach(function(e){if(t["c"+e.WardId]){var a=t.CheckMenu.split(","),s="";t["c"+e.WardId].split(",").forEach(function(e,r){e&&"headnur"!=t.QualSubId&&(s=s?s+","+a[parseInt(e)].split("@")[0]:a[parseInt(e)].split("@")[0])}),t["ctoshow"+e.WardId]=s}else t["ctoshow"+e.WardId]=""})})}),e.CheckTabPanels=t.data.TaskPanel,e.CheckTabPanels instanceof Array&&e.CheckTabPanels.length>0&&(e.ActivePanel=e.CheckTabPanels[0].Name+"「"+e.CheckTabPanels[0].ScoreType),e.CheckScoreVisible=!0,e.Loading=!1):(e.Loading=!1,e.$message({type:"error",message:"获取检查单失败!",showClose:!0,customClass:"error_class"}))}).catch(function(t){e.Loading=!1,e.$message({type:"error",message:"获取检查单失败!",showClose:!0,customClass:"error_class"})})}else e.$message({type:"warning",message:"非检查者/护理部,不可编辑",showClose:!0,customClass:"warning_class"});else e.$message({type:"warning",message:"未获取排班，刷新重试",showClose:!0,customClass:"warning_class"})},ExChangeArg:function(){var e=this;e.ShiftDialogVisible=!0,e.$nextTick(function(){e.$refs.ShiftForm.resetFields(),e.ShiftForm.ShiftToDate=e.SelectDay.date,e.ShiftForm.rw="";var t=e.axiosConfig("web.INMQualControlComm","FindCheckPersonsList","RecQuery","id$"+e.SelectDay.DayTaskItemId[e.SelectDayIndex],"perid$"+sessionStorage.loginPerID);e.$ajax.request(t).then(function(t){t.data instanceof Object?e.ShiftToPersonStore=t.data.rows:e.$message({type:"error",message:"获取检查人员失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取检查人员失败",showClose:!0,customClass:"error_class"})})})},GetSchduleByDate:function(){var e=this;if(e.ShiftForm.ShiftPost="",e.ShiftSchduleStore=[],e.ShiftForm.ShiftDate instanceof Date){var t="";e.CheckTypeStore.forEach(function(e){t=t?t+"^"+e.rw:e.rw});var a=e.axiosConfig("web.INMQualControlComm","GetTaskByDate","Method","type$"+t,"date$"+e.ShiftForm.ShiftDate.Format("YYYY-MM-dd"));e.$ajax.request(a).then(function(t){t.data instanceof Array?e.ShiftSchduleStore=t.data:e.$message({type:"error",message:"获取检查任务失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取检查任务失败",showClose:!0,customClass:"error_class"})})}},GetSchduleChecker:function(){var e=this;e.ShiftForm.ShiftPer="",e.ShiftForm.ShiftPost&&e.$nextTick(function(){var t=e.axiosConfig("web.INMQualControlComm","FindCheckPersonsList","RecQuery","id$"+e.ShiftForm.ShiftPost,"perid$"+sessionStorage.loginPerID,"flag$1");e.$ajax.request(t).then(function(t){t.data instanceof Object?e.ShiftPersonStore=t.data.rows:e.$message({type:"error",message:"获取检查人员失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取检查人员失败",showClose:!0,customClass:"error_class"})})})},SaveExChangeArg:function(){var e=this;e.$refs.ShiftForm.validate(function(t){if(t){var a=e.ShiftForm.ShiftToDate.Format("YYYY-MM-dd"),s=e.ShiftForm.ShiftDate.Format("YYYY-MM-dd"),r=a+"^"+e.SelectDay.DayTaskItemId[e.SelectDayIndex]+"^"+e.ShiftForm.ShiftToPer+"^"+s+"^"+e.ShiftForm.ShiftPost+"^"+e.ShiftForm.ShiftPer+"^"+e.ShiftForm.ShiftRemark+"^S^"+e.ShiftForm.rw,o=e.axiosConfig("web.INMQualControlComm","SaveCheckShift","Method","parr$"+r,"nurseid$"+sessionStorage.getItem("loginID"));e.$ajax.request(o).then(function(t){1==t.data?(e.$message({type:"success",message:"保存换班信息成功",showClose:!0,customClass:"success_class"}),e.ShiftDialogVisible=!1):0==t.data?e.$message({type:"error",message:"保存换班信息失败",showClose:!0,customClass:"error_class"}):e.$message({type:"warning",message:t.data,showClose:!0,customClass:"warning_class"})}).catch(function(t){e.$message({type:"error",message:"保存换班信息失败",showClose:!0,customClass:"error_class"})})}})},DeleteArg:function(){var e=this;e.SelectDay?(this.IsOverHlb=sessionStorage.getItem("loginRoleCodes").split(",").some(function(e){return"0"==e||"1"==e||"2"==e||"3"==e||"4"==e}),this.IsOverHlb?e.$ajax.request(e.axiosConfig("web.INMQualControlComm","IsAbleDelete","Method","id$"+e.SelectDay.DayTaskItemId[e.SelectDayIndex])).then(function(t){1==t.data?e.$confirm("确认删除该天的排班, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"关闭",closeOnClickModal:!1,type:"warning"}).then(function(){e.$ajax.request(e.axiosConfig("web.INMQualControlComm","DeleteNightTask","Method","schduleid$"+e.SelectDay.DayTaskItemId[e.SelectDayIndex],"nurseid$"+sessionStorage.loginID)).then(function(t){1==t.data?(e.$message({type:"success",message:"删除成功!",showClose:!0,customClass:"success_class"}),e.GetCalendar()):t.data.length<100?e.$message({type:"warning",message:t.data,showClose:!0,customClass:"warning_class"}):e.$message({type:"error",message:"删除失败!",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"删除失败!",showClose:!0,customClass:"error_class"})})}).catch(function(){e.$message({type:"info",message:"已取消删除",showClose:!0,customClass:"info_class"})}):e.$message({type:"warning",message:t.data,showClose:!0,customClass:"warning_class"})}):e.$message({type:"warning",message:"非护理部,不可删除",showClose:!0,customClass:"warning_class"})):e.$message({type:"warning",message:"未获取排班，刷新重试",showClose:!0,customClass:"warning_class"})},SaveSchduleScore:function(e){var t=this;t.SaveLoading||(t.SaveLoading=!0,t.ToStatus=e,"S"==t.ToStatus?t.$confirm("提交后将无法修改数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"}).then(function(){var e=t.SignType.find(function(e){return e.rw==t.TaskType});e.isNeedSign?(t.SignPasswordShow=e.isNeedPass,t.SignVisible=!0,t.SignForm.username="",t.SignForm.password="",t.SaveLoading=!1):t.SaveCheckBasic("")}).catch(function(){t.SaveLoading=!1,t.$message({type:"info",message:"已取消操作",showClose:!0,customClass:"info_class"})}):t.SaveCheckBasic(""))},SaveCheckSign:function(){var e=this;if(e.IsOverHlb||"1"==e.SelectDay.IsChecker[e.SelectDayIndex]){var t=e.SignType.find(function(t){return t.rw==e.TaskType});if(t)if(!t.isNeedDiff||e.IsOverHlb||e.SignForm.username!=sessionStorage.loginCode){if(!e.SaveLoading){e.SaveLoading=!0;var a=e.axiosConfig("web.INMQualControlComm","IsPerInChecker","Method","code$"+e.SignForm.username,"taskId$"+this.SelectDay.DayTaskItemId[e.SelectDayIndex]);e.$ajax.request(a).then(function(s){var r=s.data.split("^")[1];"1"==s.data.split("^")[0]?t.isNeedPass?(a=e.axiosConfig("web.INMLoginComm","GetNursePassword","Method","usercode$"+e.SignForm.username,"password$"+e.SignForm.password),e.$ajax.request(a).then(function(t){"1"==t.data.split("^")[0]?(e.SignVisible=!1,e.SaveCheckBasic(t.data.split("^")[1])):(e.SaveLoading=!1,e.SignForm.password="",e.$message({type:"warning",message:t.data.split("^")[0],showClose:!0,customClass:"warning_class"}))}).catch(function(t){e.SaveLoading=!1,e.$message({type:"error",message:"验证密码失败",showClose:!0,customClass:"error_class"})})):(e.SignVisible=!1,e.SaveCheckBasic(r)):(e.SaveLoading=!1,e.$message({type:"warning",message:"非检查人,无法签名",showClose:!0,customClass:"warning_class"}))}).catch(function(t){e.SaveLoading=!1,e.$message({type:"error",message:"验证失败",showClose:!0,customClass:"error_class"})})}}else e.$message({type:"warning",message:"登录人与双签人不能是同一人",showClose:!0,customClass:"warning_class"});else e.$message({type:"warning",message:"获取双签配置失败",showClose:!0,customClass:"warning_class"})}else e.$message({type:"warning",message:"非护理部或检查人,不能签名",showClose:!0,customClass:"warning_class"})},SaveCheckBasic:function(e){var t=this,a="",s="";t.CheckWards.forEach(function(e){var r="";t.CheckBasicData.forEach(function(t){r=r?r+"^"+t.Code+"|"+t["b"+e.WardId]:t.Code+"|"+t["b"+e.WardId]}),a?(a=a+"^"+e.WardId,s=s+"」"+r):(a=e.WardId,s=r)}),t.$ajax.request(t.axiosConfig("web.INMQualControlComm","SaveCheckBasic","Method","parr$"+s,"wardparr$"+a,"taskid$"+t.SelectDay.DayTaskItemId[t.SelectDayIndex])).then(function(a){1==a.data?t.SaveCheckQual(e):(t.SaveLoading=!1,t.$message({type:"warning",message:"保存基本信息失败",showClose:!0,customClass:"warning_class"}))}).catch(function(e){t.SaveLoading=!1,t.$message({type:"warning",message:"保存基本信息失败",showClose:!0,customClass:"warning_class"})})},SaveCheckQual:function(e){var t=this;t.CheckTabPanels.forEach(function(a){t.CheckWards.forEach(function(s,r){var o="";a.QualSubItems.forEach(function(e){var t=e["c"+s.WardId]?e["c"+s.WardId]:"",a=e["r"+s.WardId]?e["r"+s.WardId]:"",r=e["a"+s.WardId]?e["a"+s.WardId]:"",n=e.QualSubId;o=o?o+"ˇ"+t+"^"+a+"^"+n+"^"+r:t+"^"+a+"^"+n+"^"+r});var n=t.CalculateScore(a.QualSubItems,a,"c"+s.WardId),i=a.QualId?a.QualId:"";e=e||"",t.$ajax.request(t.axiosConfig("web.INMQualControlComm","SaveCheckScore","Method","parr$"+o,"wardid$"+s.WardId,"taskid$"+t.SelectDay.DayTaskItemId[t.SelectDayIndex],"qualid$"+i,"score$"+n,"nurseid$"+sessionStorage.loginID+","+e,"status$"+t.ToStatus)).then(function(e){e.data instanceof Object?"1"==e.data.code?e.data.ward==t.CheckWards[t.CheckWards.length-1].WardId&&e.data.qual==t.CheckTabPanels[t.CheckTabPanels.length-1].QualId&&(t.SaveLoading=!1,t.$message({type:"success",message:"保存成功",showClose:!0,customClass:"success_class"}),t.CheckScoreVisible=!1,t.GetCalendar()):(t.SaveLoading=!1,t.$message({type:"error",message:"保存检查信息失败(病区ID:"+e.data.ward+",质控项目ID:"+e.data.qual+")",showClose:!0,customClass:"error_class"})):(t.SaveLoading=!1,t.$message({type:"error",message:"保存检查信息失败",showClose:!0,customClass:"error_class"}))}).catch(function(e){t.SaveLoading=!1,t.$message({type:"error",message:"保存检查信息失败",showClose:!0,customClass:"error_class"})})})})},PrinSchdule:function(e){this.IsPrintEmpty=e,this.PrintVisible=!0},TableRowClassName:function(e){var t=e.row;e.rowIndex;return 1==t.HasChild?"parent-row":"headnur"==t.QualSubId?"nurse-sign-row":"accord-row"},GetSummaries:function(e){var t=this,a=(e.columns,e.data),s=new Array(2*t.CheckWards.length+1).fill(0);return s[0]="合计",t.CheckTabPanels.forEach(function(e,r){e.Name==t.ActivePanel.split("「")[0]&&(2==e.ScoreType?(s.push(0),a.filter(function(e){return 1!=e.HasChild}).forEach(function(e){var t=parseFloat(e.SubScore);s[1]+=isNaN(t)?0:t}),t.CheckWards.forEach(function(o,n){var i=o.WardId;s[2*(n+1)]=0,"2"==t.CheckTabPanels[r].ScoreType&&"4"==t.CheckTabPanels[r].ScoreTypeSub&&(s[2*(n+1)]=s[1]),s[2*(n+1)+1]="",a.forEach(function(a,o){if("headnur"!=a.QualSubId)if(6==e.ScoreTypeSub){var l=t.CheckTabPanels[r].QualSubItems;if(0==l[o].HasChild){var c=l[o].CheckMenu.split(","),u=0;l[o]["c"+i]&&l[o]["c"+i].split(",").forEach(function(e){e=parseInt(e);var t=c[e].split("@")[1];u+=isNaN(parseFloat(t))?0:parseFloat(t)}),u=u>parseFloat(l[o].SubScore)?0:parseFloat(l[o].SubScore)-u,s[2*(n+1)]+=u}}else s[2*(n+1)]+=isNaN(parseFloat(a["c"+i]))||0!=a.HasChild?0:parseFloat(a["c"+i])})})):1==e.ScoreTypeSub?t.CheckWards.forEach(function(e,t){var r=e.WardId,o=0,n=0;s[2*t+1]="100%",s[2*t+2]="",a.forEach(function(e){"headnur"!=e.QualSubId&&("√"==e["c"+r]?o+=1:"×"==e["c"+r]&&(n+=1))}),s[2*t+1]=o+n==0?"100%":(o/(o+n)*100).toFixed(2)+"%"}):2==e.ScoreTypeSub&&("Y"==e.CheckScoreFlag&&s.push(0),t.CheckWards.forEach(function(t,r){var o=t.WardId,n=2,i=3,l=3,c=1;"Y"==e.CheckScoreFlag&&(n=4,i=5,c=2,s[r*(l=4)+3]=""),s[r*l+c]="",s[r*l+n]="100%",s[r*l+i]="";var u=new Array(3).fill(0),h=0;a.forEach(function(t){if("headnur"!=t.QualSubId){if("Y"==e.CheckScoreFlag&&1!=t.HasChild){if(0==r){var a=parseFloat(t.SubScore);s[1]+=isNaN(a)?0:a}var n=parseFloat(t["a"+o]);h+=isNaN(n)?0:n}t["c"+o]&&"-"!=t["c"+o]&&t["c"+o].split(",").forEach(function(e,t){u[t]+=isNaN(parseFloat(e))?0:parseFloat(e)})}});var d=u.reduce(function(e,t){return e+t}),m=[1,0,0],p=u.map(function(e,t){return e*m[t]}).reduce(function(e,t){return e+t});s[r*l+c]="总例数:"+d+",完全符合:"+p,s[r*l+n]=0==d?"100%":100*(p/d).toFixed(2)+"%",s[r*l+3]=h})))}),s},CalculateScore:function(e,t,a){var s=0;if(2==t.ScoreType)e.forEach(function(e,r){if("headnur"!=e.QualSubId)if(6==t.ScoreTypeSub){if(0==e.HasChild){var o=e.CheckMenu.split(","),n=0;e[a]&&e[a].split(",").forEach(function(e){e=parseInt(e);var t=o[e].split("@")[1];n+=isNaN(parseFloat(t))?0:parseFloat(t)}),n=n>parseFloat(e.SubScore)?0:parseFloat(e.SubScore)-n,s+=n}}else s+=isNaN(parseFloat(e[a]))||0!=e.HasChild?0:parseFloat(e[a])});else if(1==t.ScoreTypeSub){var r=0,o=0;e.forEach(function(e){"headnur"!=e.QualSubId&&("√"==e[a]?r+=1:"×"==e[a]&&(o+=1))}),s=r+o==0?"100%":(r/(r+o)*100).toFixed(2)+"%"}else if(2==t.ScoreTypeSub){var n=new Array(3).fill(0),i=0,l=0;e.forEach(function(e){if("headnur"!=e.QualSubId){if("Y"==t.CheckScoreFlag&&1!=e.HasChild){var s=parseFloat(e.SubScore);l+=isNaN(s)?0:s;var r=parseFloat(e["a"+a.substring(1,a.length)]);i+=isNaN(r)?0:r}e[a]&&"-"!=e[a]&&e[a].split(",").forEach(function(e,t){n[t]+=isNaN(parseFloat(e))?0:parseFloat(e)})}});var c=n.reduce(function(e,t){return e+t}),u=[1,0,0],h=n.map(function(e,t){return e*u[t]}).reduce(function(e,t){return e+t});s=(s=0==c?"100%":100*(h/c).toFixed(2)+"%")+","+l+","+i}return s},getScoreRate:function(e,t,a){var s="",r="c"+t;if(1!=e.HasChild){var o=new Array(3).fill(0);e[r]&&"-"!=e[r]&&e[r].split(",").forEach(function(e,t){o[t]+=isNaN(parseFloat(e))?0:parseFloat(e)});var n=o.reduce(function(e,t){return e+t}),i=o[0];s=0==n?"100%":(i/n*100).toFixed(2)+"%"}else{var l=e.SubSort,c=0,u=0;a.QualSubItems.forEach(function(e){if(1!=e.HasChild&&e.SubSort.substring(0,l.length)==l){var t=new Array(3).fill(0);e[r]&&"-"!=e[r]&&e[r].split(",").forEach(function(e,a){t[a]+=isNaN(parseFloat(e))?0:parseFloat(e)});var a=t.reduce(function(e,t){return e+t}),s=t[0];c+=a,u+=s}}),s=0==c?"100%":(u/c*100).toFixed(2)+"%"}return s},CloseSchudule:function(){this.ScheduleVisible=!1,this.CheckDay=""},CellClickEvent:function(e,t,a,s,r){if(!this.IsDisable){var o=[];t.CheckMenu&&t.CheckMenu.split(",").forEach(function(e,n){var i=e.split("@"),l=i[0],c=i[1],u=i[2]?i[2]:"",h=!(!s||"不适用"==l),d=!(!r||"不适用"==l),m=n,p="";t[a]&&"-"!=t[a]&&(p=t[a].split(",")[n]),o.push({fnHandler:h?"":"MarkScore",icoName:u,btnName:l,fnHandlerArg:c,showInput:h,inputValue:p,showCheckBox:d,checkedValue:m})}),this.selectrow=t,this.selectcolumn=a,r&&(t[a]?this.contextMenuData.checkedValueList=t[a].split(","):this.contextMenuData.checkedValueList.splice(0,this.contextMenuData.checkedValueList.length)),this.contextMenuData.menulists=o,this.contextMenuData.axis={x:e.clientX-.05*document.body.clientWidth,y:e.clientY-.1*document.body.clientHeight}}},MarkScore:function(e){this.selectrow[this.selectcolumn]=e,this.selectrow[this.selectcolumn.replace("c","ctoshow")]=e},HandleCountChange:function(e,t){var a=this.selectrow[this.selectcolumn].split(",");a[t]=e,this.selectrow[this.selectcolumn]=a.join(",");var s=this.selectrow.CheckMenu.split(","),r="";a.forEach(function(e,t){e&&(r=r?r+","+s[t].split("@")[0]+":"+e:s[t].split("@")[0]+":"+e)}),this.selectrow[this.selectcolumn.replace("c","ctoshow")]=r},HandleCheckChange:function(e,t,a){this.selectrow[this.selectcolumn]=e.join(",");var s=this.selectrow.CheckMenu.split(","),r="";e.forEach(function(e){r=r?r+","+s[e].split("@")[0]:s[e].split("@")[0]}),this.selectrow[this.selectcolumn.replace("c","ctoshow")]=r},ChangeScore:function(e,t,a,s,r){if(/^[0-9]+([.]{1}[0-9]+){0,1}$/.test(t)){var o=this.CheckTabPanels[a].QualSubItems[s].SubScore;parseFloat(t)>parseFloat(o)?("2"==this.CheckTabPanels[a].ScoreType&&"4"==this.CheckTabPanels[a].ScoreTypeSub&&(o=-o),e.target.value=o,this.CheckTabPanels[a].QualSubItems[s][r]=o):("2"==this.CheckTabPanels[a].ScoreType&&"4"==this.CheckTabPanels[a].ScoreTypeSub&&(t=-t),this.CheckTabPanels[a].QualSubItems[s][r]=t)}else e.target.value=this.CheckTabPanels[a].QualSubItems[s][r]},ChangeScore2:function(e,t,a,s,r){var o=this.CheckTabPanels[a].QualSubItems[s].SubScore,n=this.CheckTabPanels[a].QualSubItems[s][r];n=(n=isNaN(t)?"":Math.abs(t)>Number(o)?-Number(o):-Math.abs(t)).toString(),e.target.value=n,this.CheckTabPanels[a].QualSubItems[s][r]=n},CalcaulateWidthHeight:function(e,t,a,s){var r=e.split(","),o=3;r.forEach(function(e){e.length>o&&(o=e.length)});var n=e.length,i=e.replace(/\,/g,"").length,l=14*o+o%2*.4+(14*i+i%2*.4+3.2*(n-i)+(i+1)%2*.8)+10,c=(r.length,this.TipWidth),u=l>c?l:c;u>c&&(Math.ceil(u/c),u=c);return"max-width:unset;width:"+u+"px!important"},CalcaulateWidthHeightPopover:function(e,t,a){e.split(",");var s=e.length,r=e.replace(/\,/g,"").length,o=14*r+r%2*.4+3.2*(s-r)+(r+1)%2*.8,n=(t.split(","),t.length),i=t.replace(/\,/g,"").length,l=14*i+i%2*.4+3.2*(n-i)+(i+1)%2*.8,c=(a.split(","),a.length),u=a.replace(/\,/g,"").length,h=14*u+u%2*.4+3.2*(c-u)+(u+1)%2*.8,d=Math.max(o,l,h,74);return d>300?300:d},TaskInfoShow:function(e){var t=this.$refs[e][0];t&&(t.$refs.popper.style.display="none")},SpanMethod:function(e,t,a,s,r){e.row;var o=e.column,n=e.rowIndex;e.columnIndex;if(n!=t-1)return[1,1];var i=this.CheckWards.map(function(e){return"c"+e.WardId}),l=this.CheckWards.map(function(e){return"r"+e.WardId});if(2==s){var c=this.CheckWards.map(function(e){return"a"+e.WardId}),u=this.CheckWards.map(function(e){return"rate"+e.WardId});return i.indexOf(o.property)>-1?"Y"==r?[1,4]:[1,3]:l.indexOf(o.property)>-1||c.indexOf(o.property)>-1||u.indexOf(o.property)>-1?[0,0]:[1,1]}return i.indexOf(o.property)>-1?[1,2]:l.indexOf(o.property)>-1?[0,0]:[1,1]},CalTipWidth:function(){var e="",t=0;this.CheckTypeStore.forEach(function(a){e?e+=","+a.SubDesc:e=a.SubDesc,a.SubDesc.length>t&&(t=a.SubDesc.length)});var a=e.length+2*e.length,s=e.replace(/\,/g,"").length,r=14*t+t%2*.4,o=14*s+s%2*.4+3.2*(a-s)+(s+1)%2*.8;this.TipWidth=r+o+60},KeyDown:function(e,t,a,s,r,o,n){if(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode||13==e.keyCode){var i=n.length,l=0;switch(e.keyCode){case 37:case 39:l="2"==r?"Y"==o?t+1==i?4:2:3:"1"==r||"5"==r||"6"==r?2:t+1==i?2:1,a+=l=37==e.keyCode?-l:l;break;case 38:t>0&&(l="0"!=n[t-1].HasChild?2:1),t+1==i&&("2"==r?a+="Y"==o?1:2:"1"!=r&&"5"!=r&&"6"!=r||(a+=1)),t-=l;break;case 13:case 40:if(t+1<i&&(l="0"!=n[t+1].HasChild?2:1),(t+=l)+1==i){var c=this.GetColnum(s,r,o);a=parseInt(a/c)*c}}var u="qual_"+t+"_"+a,h=this.$refs[u];h instanceof Array&&h.length>=1&&h[1].focus()}},GetColnum:function(e,t,a){return 2==t?"Y"==a?4:3:2},KeyDownBasic:function(e,t,a){if(37==e.keyCode||38==e.keyCode||39==e.keyCode||40==e.keyCode||13==e.keyCode){switch(e.keyCode){case 37:a-=1;break;case 38:t-=1;break;case 39:a+=1;break;case 13:case 40:t+=1}var s="basic_"+t+"_"+a,r=this.$refs[s];r instanceof Array&&r.length>=1&&r.some(function(e){return-1==e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.className.indexOf("el-table__fixed-body-wrapper")&&(e.focus(),!0)})}},LoadCheckerParam:function(){var e=this,t=this.axiosConfig("web.INMSetComm","FindParamSubList","RecQuery","parr$^NightCheckerPost");this.$ajax.request(t).then(function(t){t.data instanceof Object&&t.data.rows.length>0&&(e.CheckerPost=t.data.rows.map(function(e){return e.SubValue}).join("!"))}).catch(function(t){e.$message({type:"error",message:"获取参数失败",showClose:!0,customClass:"error_class"})})}},created:function(){this.Loading=!0,this.ChecktableHeight=this.Height-120-54-152-31,this.IsOverHlb=sessionStorage.getItem("loginRoleCodes").split(",").some(function(e){return"0"==e||"1"==e||"2"==e||"3"==e||"4"==e}),this.weekNames=this.langSets[this.lang].weekNames.slice(this.firstDay).concat(this.langSets[this.lang].weekNames.slice(0,this.firstDay)),this.title=(new Date).Format(this.langSets[this.lang].titleFormat),this.LoadCheckerParam(),this.GetCheckType();var e=this.$router.currentRoute.path.slice(1,this.$router.currentRoute.path.length);this.loadElementsForRouter("elementlist",e)}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.body",value:e.Loading,expression:"Loading",modifiers:{body:!0}}],staticClass:"schdule-main",attrs:{"element-loading-text":e.$t("menu.NurNightSchedule.5nrnbryzgg00")}},[a("div",{staticClass:"full-calendar-header"},[a("div",{staticClass:"header-center"},[a("span",{staticClass:"prev-month",on:{click:function(t){return t.stopPropagation(),e.GoPrev(t)}}},[a("i",{staticClass:"el-icon-caret-left"})]),e._v(" "),a("span",{staticClass:"title"},[e._v(e._s(e.title))]),e._v(" "),a("span",{staticClass:"next-month",on:{click:function(t){return t.stopPropagation(),e.GoNext(t)}}},[a("i",{staticClass:"el-icon-caret-right"})]),e._v(" "),a("span",{staticClass:"current-month",on:{click:function(t){return t.stopPropagation(),e.getCurrentMonth(t)}}},[e._v(e._s(e.$t("menu.NurNightSchedule.5ncy6kh750w0")))])])]),e._v(" "),a("div",{staticClass:"full-calendar-body"},[a("div",{staticClass:"weeks"},e._l(e.weekNames,function(t){return a("strong",{key:t.index,staticClass:"week",class:{weekend:t===e.$t("menu.NurNightSchedule.5nrnbrz06y40")||t===e.$t("menu.NurNightSchedule.5nrnbrz0qv00")}},[e._v(e._s(t))])}),0),e._v(" "),a("div",{ref:"dates",staticClass:"dates",style:"overflow:auto;height:"+(e.Height-92)+"px;"},[e._l(e.currentDates,function(t,s){return a("div",{key:s,staticClass:"week-row"},e._l(t,function(t,r){return a("div",{key:r,staticClass:"day-cell",class:{today:t.IsToday,"not-cur-month":!t.IsCurMonth,holiday:t.IsHoliday&&t.IsHoliday!=e.$t("menu.NurNightSchedule.5nrnbrz2q1w0")}},[a("div",{staticClass:"day-cell-head"},[a("span",{staticClass:"day-holiday"},[e._v(e._s(t.IsHoliday?t.IsHoliday:"ㅤ"))]),e._v(" "),a("span",{staticClass:"day-number"},[e._v(e._s(t.MonthDay?t.MonthDay:"ㅤ"))])]),e._v(" "),a("div",{staticClass:"day-arg"},[a("el-scrollbar",{staticStyle:{height:"100%"}},e._l(t.DayTaskItemId,function(o,n){return a("div",{key:n},[a("el-popover",{ref:"TaskItemPopover",refInFor:!0,attrs:{placement:"right",width:t.DayTaskCheckPerosonName[n]&&t.DayTaskWardDesc[n]&&t.DayTaskItem[n]?e.CalcaulateWidthHeightPopover(t.DayTaskCheckPerosonName[n],t.DayTaskWardDesc[n],t.DayTaskItem[n]):74,trigger:"click"},on:{show:function(t){return e.TaskInfoShow("TaskItemTooltip"+s+r+n)}}},[a("div",[a("div",[a("i",{staticClass:"el-icon-school"},[a("strong",{staticStyle:{"padding-left":"4px"}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz3v040")))])])]),e._v(" "),a("div",[e._v(e._s(e.IsOverHlb||e.Today>=t.date||e.Today.addDate(1)>=t.date&&"1"==t.IsChecker[n]?t.DayTaskWardDesc[n]:t.date.addDate(-1).Format("YYYY-MM-dd")+e.$t("menu.NurNightSchedule.5ncy6khcl1c0")))]),e._v(" "),a("div",{staticStyle:{"margin-top":"4px"}},[a("i",{staticClass:"el-icon-s-custom"},[a("strong",{staticStyle:{"padding-left":"4px"}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz3wms0")))])])]),e._v(" "),a("div",[e._v(e._s(t.DayTaskCheckPerosonName[n]))]),e._v(" "),a("div",{staticStyle:{"margin-top":"4px"}},[a("i",{staticClass:"el-icon-s-claim"},[a("strong",{staticStyle:{"padding-left":"4px"}},[e._v(e._s(e.$t("menu.NurNightSchedule.5ncy6khdn1w0")))])])]),e._v(" "),a("div",[e._v(e._s(e.IsOverHlb||e.Today>=t.date||e.Today.addDate(1)>=t.date&&"1"==t.IsChecker[n]?t.DayTaskItem[n]:t.date.addDate(-1).Format("YYYY-MM-dd")+e.$t("menu.NurNightSchedule.5ncy6khcl1c0")))]),e._v(" "),a("div",{staticStyle:{"margin-top":"4px"}},[a("i",{staticClass:"el-icon-user"},[a("strong",{staticStyle:{"padding-left":"4px"}},[e._v(e._s(e.$t("menu.NurNightSchedule.5ncy6khh54w0")))])])]),e._v(" "),a("div",[e._v(e._s("1"==t.DayTaskChecked[n]?t.DayTaskResultPerosonName[n]:e.$t("menu.NurNightSchedule.5ncy6khi95c0")))]),e._v(" "),a("div",{staticStyle:{"margin-top":"4px"}},[a("i",{staticClass:"el-icon-s-comment"},[a("strong",{staticStyle:{"padding-left":"4px"}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz3yi80")))])])]),e._v(" "),a("div",[e._v(e._s(t.DayTaskRemark[n]))])]),e._v(" "),a("el-tooltip",{ref:"TaskItemTooltip"+s+r+n,refInFor:!0,attrs:{slot:"reference",effect:"light",placement:"right","popper-class":"task-person-popper"},slot:"reference"},[a("div",{style:t.DayTaskCheckPerosonName[n]?e.CalcaulateWidthHeight(t.DayTaskCheckPerosonName[n],s,r,n):"",attrs:{slot:"content"},domProps:{innerHTML:e._s(e.PerToolTip)},slot:"content"}),e._v(" "),a("div",{staticClass:"task-item",style:[{marginTop:n>0?"5px":"",marginBottom:n==t.DayTaskItemId.length-1?"1px":"",borderColor:t.DayTaskCheckTypeColor[n]}],on:{contextmenu:function(a){return e.ShowArgContextmenu(t,s,r,n)}}},[a("span",{staticClass:"task-short",style:"background:"+t.DayTaskCheckTypeColor[n]+";"},[e._v(e._s(t.DayTaskCheckTypeDesc[n]))]),e._v(" "),a("span",{staticClass:"task-person",on:{mouseover:function(a){return e.getPerCheckNum(t.DayTaskCheckPerosonName[n],t.DayTaskCheckPeroson[n],t)}}},[e._v(e._s(t.DayTaskCheckPerosonName[n]))])])])],1)],1)}),0)],1),e._v(" "),t.DayTaskItemId.length>1?a("span",{staticStyle:{position:"absolute",left:"2px",bottom:"2px","border-radius":"50%",height:"10px",width:"10px",display:"inline-block",background:"#f60505","vertical-align":"top",padding:"3px"}},[a("span",{staticStyle:{display:"block",color:"#FFFFFF",height:"10px","line-height":"10px","text-align":"center","font-size":"7px"}},[e._v(e._s(t.DayTaskItemId.length))])]):e._e(),e._v(" "),e.elementlist.addschdulebtn||e.isDemo?a("span",{staticClass:"add-arg-btn",on:{click:function(a){return a.stopPropagation(),e.AddSchedule(t)}}},[a("i",{staticClass:"nm-icon-plus"})]):e._e()])}),0)}),e._v(" "),a("vue-context-menu",{attrs:{contextMenuData:e.taskContextMenuData},on:{check:e.CheckArg,exchange:e.ExChangeArg,delete:e.DeleteArg}})],2)]),e._v(" "),a("el-dialog",{staticClass:"SchduleArg",attrs:{title:e.$t("menu.NurNightSchedule.5nrnbrz5jo80"),modal:"",visible:e.ScheduleVisible,"show-close":!0,"close-on-click-modal":!1,width:"450px",align:"center"},on:{"update:visible":function(t){e.ScheduleVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{staticClass:"nm-icon-w-paper"}):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz5jo80")))])]),e._v(" "),a("el-form",{ref:"SchduleForm",attrs:{model:e.SchduleForm,rules:e.schudulerules,"label-width":"103px"}},[a("el-form-item",{attrs:{label:e.$t("menu.NurNightSchedule.5ncy6khkxgg0"),prop:"GroupType"}},[a("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"","collapse-tags":"",size:"mini"},on:{change:e.CheckWardGroupChange},model:{value:e.SchduleForm.GroupType,callback:function(t){e.$set(e.SchduleForm,"GroupType",t)},expression:"SchduleForm.GroupType"}},e._l(e.GroupTypes,function(e){return a("el-option",{key:e.rw,attrs:{label:e.desc,value:e.rw}})}),1)],1),e._v(" "),e.CheckPerVisibility?a("el-form-item",{staticStyle:{"margin-top":"5px"},attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrz3wms0"),prop:"CheckPerson"}},[a("el-select",{staticStyle:{width:"300px"},attrs:{disabled:!e.SchduleForm.GroupType,"collapse-tags":"",placeholder:"",filterable:"",multiple:"",size:"mini"},model:{value:e.SchduleForm.CheckPerson,callback:function(t){e.$set(e.SchduleForm,"CheckPerson",t)},expression:"SchduleForm.CheckPerson"}},e._l(e.CheckPpersonStore,function(e){return a("el-option",{key:e.PerDR,attrs:{label:e.PerName,value:e.PerDR}})}),1)],1):e._e(),e._v(" "),e.CheckGroupVisibility?a("el-form-item",{staticStyle:{"margin-top":"5px"},attrs:{label:e.$t("menu.NurNightSchedule.5ncy6khl08o0"),prop:"CheckGroup"}},[a("el-select",{staticStyle:{width:"300px"},attrs:{disabled:!e.SchduleForm.GroupType,"collapse-tags":"",placeholder:"",size:"mini"},model:{value:e.SchduleForm.CheckGroup,callback:function(t){e.$set(e.SchduleForm,"CheckGroup",t)},expression:"SchduleForm.CheckGroup"}},e._l(e.CheckGroupStore,function(e){return a("el-option",{key:e.GroupCode,attrs:{label:e.GroupDesc,value:e.GroupCode}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"5px"},attrs:{label:e.$t("menu.NurNightSchedule.5ncy6khdn1w0"),prop:"CheckTask"}},[a("el-select",{staticStyle:{width:"300px"},attrs:{multiple:"","collapse-tags":"",placeholder:"",size:"mini"},model:{value:e.SchduleForm.CheckTask,callback:function(t){e.$set(e.SchduleForm,"CheckTask",t)},expression:"SchduleForm.CheckTask"}},e._l(e.CheckTaskStore,function(e){return a("el-option",{key:e.rw,attrs:{label:e.QualDesc,value:e.rw}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"11px"},attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrz3yi80"),prop:"Remark"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{type:"textarea",rows:4,maxlength:1e3,placeholder:"",size:"mini"},model:{value:e.SchduleForm.Remark,callback:function(t){e.$set(e.SchduleForm,"Remark",t)},expression:"SchduleForm.Remark"}})],1)],1),e._v(" "),a("div",{staticClass:"bottom-button"},[a("hgbutton",{attrs:{type:e.styleCode?"default":"success",styleCode:e.styleCode},on:{click:e.CheckAbleSave}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz92v80")))]),e._v(" "),a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:e.CloseSchudule}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz93ik0")))])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.$t("menu.NurNightSchedule.5ncy6khl6940"),"custom-class":"task_check",modal:"",visible:e.CheckScoreVisible,"show-close":!0,"close-on-click-modal":!1,width:"80%"},on:{"update:visible":function(t){e.CheckScoreVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{staticClass:"nm-icon-w-paper"}):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("menu.NurNightSchedule.5ncy6khl6940")))])]),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.SaveLoading,expression:"SaveLoading"}],attrs:{"element-loading-text":e.$t("menu.NurNightSchedule.5nrnbryzgg00")}},[a("div",{staticClass:"per-top-tool-button dialog-div-top-radius"},[a("hgbutton",{directives:[{name:"intervalclick",rawName:"v-intervalclick",value:{func:e.SaveSchduleScore,time:500,value1:"N"},expression:"{func:SaveSchduleScore,time:500,value1:'N'}"}],attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-save":"nm-icon-lite-save",disabled:"S"==e.CurStatus||e.IsDisable}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz92v80")))]),e._v(" "),a("hgbutton",{directives:[{name:"intervalclick",rawName:"v-intervalclick",value:{func:e.SaveSchduleScore,time:500,value1:"S"},expression:"{func:SaveSchduleScore,time:500,value1:'S'}"}],attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-paper-plane":"nm-icon-lite-plane",disabled:e.IsDisable}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrza3jk0")))]),e._v(" "),a("hgbutton",{attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-print":"nm-icon-lite-print"},on:{click:function(t){return e.PrinSchdule(!1)}}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrza46g0")))]),e._v(" "),a("hgbutton",{attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-print":"nm-icon-lite-print"},on:{click:function(t){return e.PrinSchdule(!0)}}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrza4t00")))])],1),e._v(" "),a("div",{staticClass:"top-tool-dialog-table dialog-table-bottom-radius"},[a("el-table",{staticClass:"basicDataTable multi-level-table-head multi-level-table-body",staticStyle:{width:"100%"},attrs:{data:e.CheckBasicData,"max-height":"152px","header-cell-style":e.headerCellFontWeight,border:e.styleCode}},[a("el-table-column",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzb4a40"),prop:"Item",width:"300px",fixed:""}}),e._v(" "),e._l(e.CheckWards,function(t,s){return a("el-table-column",{key:"b"+t.WardId,attrs:{align:"left","header-align":"left",label:t.WardDesc,"class-name":"nightCheckBasic"},scopedSlots:e._u([{key:"default",fn:function(r){return[a("input",{directives:[{name:"model",rawName:"v-model",value:r.row["b"+t.WardId],expression:"scope.row['b'+item.WardId]"}],ref:"basic_"+r.$index+"_"+s,refInFor:!0,staticClass:"nightCheckInput",staticStyle:{"text-align":"left"},attrs:{readonly:e.IsDisable||"N"==r.row.Editable},domProps:{value:r.row["b"+t.WardId]},on:{keydown:function(t){return e.KeyDownBasic(t,r.$index,s)},input:function(a){a.target.composing||e.$set(r.row,"b"+t.WardId,a.target.value)}}})]}}],null,!0)})})],2),e._v(" "),a("el-tabs",{attrs:{type:"border-card"},model:{value:e.ActivePanel,callback:function(t){e.ActivePanel=t},expression:"ActivePanel"}},e._l(e.CheckTabPanels,function(t,s){return a("el-tab-pane",{key:s,attrs:{label:t.Title,name:t.Name+"「"+t.ScoreType}},[a("div",{staticClass:"top-tool-dialog-table  dialog-table-bottom-radius"},[a("el-table",{ref:"CheckTable",refInFor:!0,staticClass:"CheckDataTable  dialog-table-bottom-radius multi-level-table-head multi-level-table-body",staticStyle:{width:"100%"},attrs:{data:t.QualSubItems,"header-cell-style":e.headerCellFontWeight,border:e.styleCode,"max-height":e.ChecktableHeight,"row-class-name":e.TableRowClassName,"summary-method":e.GetSummaries,"show-summary":"","span-method":function(a){return e.SpanMethod(a,t.QualSubItems.length,t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag)}}},[a("el-table-column",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzc6i00"),prop:"SubItem",width:"300px",fixed:""}}),e._v(" "),2==t.ScoreType||2==t.ScoreTypeSub&&"Y"==t.CheckScoreFlag?a("el-table-column",{attrs:{label:e.$t("menu.NurNightSchedule.5ncy6khlgtk0"),prop:"SubScore",width:"50px",align:"left",fixed:""}}):e._e(),e._v(" "),e._l(e.CheckWards,function(r,o){return[a("el-table-column",{key:r.WardId,attrs:{label:r.WardDesc,align:"left","header-align":"center"}},[a("el-table-column",{staticStyle:{padding:"1px 1px"},attrs:{label:e.$t("menu.NurNightSchedule.5ncy6khlids0"),prop:"c"+r.WardId,"class-name":"nightCheckBasic",align:"left"},scopedSlots:e._u([{key:"default",fn:function(n){return[0==n.row.HasChild?a("div",["headnur"==n.row.QualSubId?a("input",{directives:[{name:"model",rawName:"v-model",value:n.row["c"+r.WardId],expression:"scope.row['c'+item.WardId]"}],ref:"qual_"+n.$index+"_"+o*e.GetColnum(t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag),refInFor:!0,staticClass:"nightCheckInput",staticStyle:{"text-align":"left"},attrs:{readonly:e.IsDisable},domProps:{value:n.row["c"+r.WardId]},on:{keydown:function(a){e.KeyDown(a,n.$index,o*e.GetColnum(t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag),t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag,t.QualSubItems)},input:function(t){t.target.composing||e.$set(n.row,"c"+r.WardId,t.target.value)}}}):2==t.ScoreType&&5!=t.ScoreTypeSub&&6!=t.ScoreTypeSub?a("input",{ref:"qual_"+n.$index+"_"+o*e.GetColnum(t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag),refInFor:!0,staticClass:"nightCheckInput",staticStyle:{"text-align":"left"},attrs:{readonly:e.IsDisable},domProps:{value:n.row["c"+r.WardId]},on:{keydown:function(a){e.KeyDown(a,n.$index,o*e.GetColnum(t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag),t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag,t.QualSubItems)},change:function(t){return e.ChangeScore(t,t.target.value,s,n.$index,"c"+r.WardId)}}}):2==t.ScoreType&&5==t.ScoreTypeSub?a("div",{staticClass:"nightCheckInput",on:{click:function(t){return e.CellClickEvent(t,n.row,"c"+r.WardId,!1,!1)}}},[a("span",{staticClass:"task_check_cell"},[e._v(e._s(n.row["c"+r.WardId]))])]):2==t.ScoreType&&6==t.ScoreTypeSub?a("div",{staticClass:"nightCheckInput",on:{click:function(t){return e.CellClickEvent(t,n.row,"c"+r.WardId,!1,!0)}}},[a("span",{staticClass:"task_check_cell"},[e._v(e._s(n.row["ctoshow"+r.WardId]))])]):2!=t.ScoreType&&1==t.ScoreTypeSub?a("div",{staticClass:"nightCheckInput",on:{click:function(t){return e.CellClickEvent(t,n.row,"c"+r.WardId,!1,!1)}}},[a("span",{staticClass:"task_check_cell"},[e._v(e._s(n.row["c"+r.WardId]))])]):2!=t.ScoreType&&2==t.ScoreTypeSub?a("div",{staticClass:"nightCheckInput",on:{click:function(t){return e.CellClickEvent(t,n.row,"c"+r.WardId,!0,!1)}}},[a("span",{staticClass:"task_check_cell",staticStyle:{"line-height":"18px",width:"100%","text-align":"left","margin-left":"4px"}},[e._l(n.row["ctoshow"+r.WardId].split(","),function(t,s){return[a("font",{key:s,domProps:{innerHTML:e._s(t+"<br/>")}})]})],2)]):e._e()]):a("div",{staticStyle:{"background-color":"#CCCCCC",width:"100%",height:"100%"}})]}}],null,!0)}),e._v(" "),2==t.ScoreTypeSub&&"Y"==t.CheckScoreFlag?a("el-table-column",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzdr740"),prop:"a"+r.WardId,width:"70px","class-name":"nightCheckBasic",align:"left"},scopedSlots:e._u([{key:"default",fn:function(n){return[0==n.row.HasChild&&"headnur"!=n.row.QualSubId?a("div",[a("input",{ref:"qual_"+n.$index+"_"+((o+1)*e.GetColnum(t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag)-3),refInFor:!0,staticClass:"nightCheckInput",attrs:{readonly:e.IsDisable},domProps:{value:n.row["a"+r.WardId]},on:{keydown:function(a){e.KeyDown(a,n.$index,(o+1)*e.GetColnum(t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag)-3,t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag,t.QualSubItems)},change:function(t){return e.ChangeScore2(t,t.target.value,s,n.$index,"a"+r.WardId)}}})]):a("div",{staticStyle:{"background-color":"#CCCCCC",width:"100%",height:"100%"}})]}}],null,!0)}):e._e(),e._v(" "),2==t.ScoreTypeSub?a("el-table-column",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzf42g0"),prop:"rate"+r.WardId,width:"70px","class-name":"nightCheckBasic",align:"left"},scopedSlots:e._u([{key:"default",fn:function(s){return[a("div",{staticStyle:{"background-color":"#CCCCCC",width:"100%",height:"100%"}},[e._v(e._s(e.getScoreRate(s.row,r.WardId,t)))])]}}],null,!0)}):e._e(),e._v(" "),a("el-table-column",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzgmx40"),prop:"r"+r.WardId,"class-name":"nightCheckBasic",align:"left"},scopedSlots:e._u([{key:"default",fn:function(s){return[0==s.row.HasChild&&"headnur"!=s.row.QualSubId?a("div",[a("input",{directives:[{name:"model",rawName:"v-model",value:s.row["r"+r.WardId],expression:"scope.row['r'+item.WardId]"}],ref:"qual_"+s.$index+"_"+((o+1)*e.GetColnum(t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag)-1),refInFor:!0,staticClass:"nightCheckInput",attrs:{readonly:e.IsDisable},domProps:{value:s.row["r"+r.WardId]},on:{keydown:function(a){e.KeyDown(a,s.$index,(o+1)*e.GetColnum(t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag)-1,t.ScoreType,t.ScoreTypeSub,t.CheckScoreFlag,t.QualSubItems)},input:function(t){t.target.composing||e.$set(s.row,"r"+r.WardId,t.target.value)}}})]):a("div",{staticStyle:{"background-color":"#CCCCCC",width:"100%",height:"100%"}})]}}],null,!0)})],1)]})],2)],1)])}),1)],1),e._v(" "),a("vue-context-menu",{ref:"cellContextMenu",attrs:{contextMenuData:e.contextMenuData},on:{MarkScore:e.MarkScore,change:e.HandleCountChange,checkChange:e.HandleCheckChange}})],1)]),e._v(" "),a("el-dialog",{staticClass:"SchduleArg",attrs:{title:e.$t("menu.NurNightSchedule.5nrnbrzhqj80"),modal:"",visible:e.ShiftDialogVisible,"show-close":!0,top:"60px","close-on-click-modal":!1,width:"400px",align:"center"},on:{"update:visible":function(t){e.ShiftDialogVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{staticClass:"nm-icon-w-paper"}):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrzhqj80")))])]),e._v(" "),a("el-form",{ref:"ShiftForm",attrs:{model:e.ShiftForm,rules:e.ExChangeFormRules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrziqhg0"),prop:"ShiftToDate"}},[a("el-date-picker",{staticStyle:{width:"300px"},attrs:{disabled:"",type:"date",format:this.$store.state.mainframe.DateFormat,size:"mini"},model:{value:e.ShiftForm.ShiftToDate,callback:function(t){e.$set(e.ShiftForm,"ShiftToDate",t)},expression:"ShiftForm.ShiftToDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzjsx00"),prop:"ShiftToPer"}},[a("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"",size:"mini"},model:{value:e.ShiftForm.ShiftToPer,callback:function(t){e.$set(e.ShiftForm,"ShiftToPer",t)},expression:"ShiftForm.ShiftToPer"}},e._l(e.ShiftToPersonStore,function(e){return a("el-option",{key:e.PerDR,attrs:{label:e.PerName,value:e.PerDR}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzlm940"),prop:"ShiftDate"}},[a("el-date-picker",{staticStyle:{width:"300px","margin-top":"10px"},attrs:{"picker-options":e.PickerOptions,type:"date",format:this.$store.state.mainframe.DateFormat,size:"mini"},on:{change:e.GetSchduleByDate},model:{value:e.ShiftForm.ShiftDate,callback:function(t){e.$set(e.ShiftForm,"ShiftDate",t)},expression:"ShiftForm.ShiftDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzn7xs0"),prop:"ShiftPost"}},[a("el-select",{staticStyle:{width:"300px","margin-top":"10px"},attrs:{placeholder:"",size:"mini"},on:{change:e.GetSchduleChecker},model:{value:e.ShiftForm.ShiftPost,callback:function(t){e.$set(e.ShiftForm,"ShiftPost",t)},expression:"ShiftForm.ShiftPost"}},e._l(e.ShiftSchduleStore,function(e){return a("el-option",{key:e.rw,attrs:{label:e.title,value:e.rw}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzp2xw0"),prop:"ShiftPer"}},[a("el-select",{staticStyle:{width:"300px","margin-top":"10px"},attrs:{placeholder:"",size:"mini"},model:{value:e.ShiftForm.ShiftPer,callback:function(t){e.$set(e.ShiftForm,"ShiftPer",t)},expression:"ShiftForm.ShiftPer"}},e._l(e.ShiftPersonStore,function(e){return a("el-option",{key:e.PerDR,attrs:{label:e.PerName,value:e.PerDR}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"5px"},attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzq9ko0"),prop:"ShiftRemark"}},[a("el-input",{staticStyle:{width:"300px","margin-top":"10px"},attrs:{type:"textarea",placeholder:"",size:"mini"},model:{value:e.ShiftForm.ShiftRemark,callback:function(t){e.$set(e.ShiftForm,"ShiftRemark",t)},expression:"ShiftForm.ShiftRemark"}})],1)],1),e._v(" "),a("div",{staticClass:"bottom-button"},[a("hgbutton",{attrs:{type:e.styleCode?"default":"success",styleCode:e.styleCode},on:{click:e.SaveExChangeArg}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz92v80")))]),e._v(" "),a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:function(t){e.ShiftDialogVisible=!1}}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz93ik0")))])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.$t("menu.NurNightSchedule.5ncy6khm5yo0"),modal:"",visible:e.SignVisible,"close-on-click-modal":!1,width:"300px",align:"center"},on:{"update:visible":function(t){e.SignVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{staticClass:"nm-icon-w-paper"}):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("menu.NurNightSchedule.5ncy6khm5yo0")))])]),e._v(" "),a("el-form",{attrs:{inline:!0},model:{value:e.SignForm,callback:function(t){e.SignForm=t},expression:"SignForm"}},[a("el-form-item",{attrs:{label:e.$t("menu.NurNightSchedule.5ncy6khm6ls0"),prop:"username"}},[a("el-input",{attrs:{type:"text",placeholder:e.$t("menu.NurNightSchedule.5ncy6khm7800"),autofocus:!0,size:"small"},model:{value:e.SignForm.username,callback:function(t){e.$set(e.SignForm,"username",t)},expression:"SignForm.username"}})],1),e._v(" "),e.SignPasswordShow?a("el-form-item",{attrs:{label:e.$t("menu.NurNightSchedule.5nrnbrzrdes0"),prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:e.$t("menu.NurNightSchedule.5nrnbrzrdes0"),size:"small"},model:{value:e.SignForm.password,callback:function(t){e.$set(e.SignForm,"password",t)},expression:"SignForm.password"}})],1):e._e()],1),e._v(" "),a("div",{staticClass:"bottom-button"},[a("hgbutton",{ref:"argtablesure",attrs:{type:e.styleCode?"default":"success",styleCode:e.styleCode},on:{click:e.SaveCheckSign}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz92v80")))]),e._v(" "),a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:function(t){e.SignVisible=!1}}},[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrz93ik0")))])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.$t("menu.NurNightSchedule.5nrnbrza46g0"),modal:"",visible:e.PrintVisible,"close-on-click-modal":!1,width:"1300px"},on:{"update:visible":function(t){e.PrintVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{staticClass:"nm-icon-w-paper"}):e._e(),e._v(" "),a("span",[e._v(e._s(e.$t("menu.NurNightSchedule.5nrnbrza46g0")))])]),e._v(" "),e.PrintVisible?a("NurNightSchedulePrint",{attrs:{flag:e.IsPrintEmpty,activetitle:e.ActivePanel,taskid:e.SelectDay.DayTaskItemId[e.SelectDayIndex],taskDate:e.SelectDay.date,checkerName:e.SelectDay.DayTaskCheckPerosonName[e.SelectDayIndex]}}):e._e()],1)],1)},staticRenderFns:[]};var u=a("VU/8")(l,c,!1,function(e){a("twJ1")},null,null);t.default=u.exports},"a6/g":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Dd8w"),r=a.n(s),o=a("s5sJ"),n=a("XlQt"),i=a("NYxO"),l={components:{hgbutton:n.default},computed:r()({},Object(i.b)(["styleCode"])),id:"NurNightSchedulePrint",props:["activetitle","flag","taskid","taskDate","checkerName"],data:function(){return{printTitle:"",checkwards:[],TableData:[],checkBasicData:[],checkDate:"",checkPerson:"",total:{desc:"合计"},scoreType:"",scoreTypeSub:"",Deepth:1,ShowRemark:!1}},methods:{PrintSchdule:function(){var e=document.getElementById("schduleprint").innerHTML,t=Object(o.a)();t.PRINT_INIT(""),t.SET_PRINT_PAGESIZE(2,"210mm","297mm","A4"),t.ADD_PRINT_HTM("0.1cm","0.1cm","RightMargin:0.1cm","BottomMargin:0.1cm",e),t.SET_SHOW_MODE("LANDSCAPE_DEFROTATED",1),t.PREVIEW(),this.PrintWhiteFlag=!1},GetFatherShow:function(e){var t=this;return!e.some(function(e){return 1!=t.TableData.find(function(t){return t.SubSort==e}).FatherShow})},GetFatherRowSpan:function(e){return e=e.substring(0,e.lastIndexOf(".")),this.TableData.find(function(t){return t.SubSort==e}).RowSpan},GetFatherDesc:function(e){return e=e.substring(0,e.lastIndexOf(".")),this.TableData.find(function(t){return t.SubSort==e}).SubItem},GetSchduleData:function(){var e=this;e.checkwards=new Array,e.$ajax.request(e.axiosConfig("web.INMQualControlComm","GetCheckPanes","Method","taskid$"+e.taskid)).then(function(t){if(t.data instanceof Object){e.checkwards=t.data.CheckWard,e.checkBasicData=t.data.CheckBasic;for(var a=function(a){var s=t.data.TaskPanel[a];e.activetitle==s.Name+"「"+s.ScoreType&&(e.printTitle=s.Title,e.scoreType=s.ScoreType,e.scoreTypeSub=s.ScoreTypeSub,e.Deepth=isNaN(parseInt(s.Deepth))?1:parseInt(s.Deepth),e.flag||(e.checkDate=s.checkDate,e.checkPerson=s.checkPerson),2!=s.ScoreType&&2==s.ScoreTypeSub&&s.QualSubItems.forEach(function(t){e.checkwards.forEach(function(e){if(t["c"+e.WardId]){var a=t.CheckMenu.split(","),s="";t["c"+e.WardId].split(",").forEach(function(e,t){e&&(s=s?s+","+a[t].split("@")[0]+":"+e:a[t].split("@")[0]+":"+e)}),t["ctoshow"+e.WardId]=s}else t["ctoshow"+e.WardId]=""})}),e.TableData=s.QualSubItems,e.checkwards.forEach(function(t){var a=t.WardId,r=0,o=0,n=new Array(3).fill(0);if(e.TableData.forEach(function(t){"headnur"!=t.QualSubId&&1!=t.HasChild&&(2==s.ScoreType?(isNaN(e.total["c"+a])?e.total["c"+a]=0:e.total["c"+a]=parseFloat(e.total["c"+a]),e.total["c"+a]=e.total["c"+a]+(isNaN(parseFloat(t["c"+a]))?0:parseFloat(t["c"+a]))):1==s.ScoreTypeSub?"√"==t["c"+a]?r+=1:"×"==t["c"+a]&&(o+=1):2==s.ScoreTypeSub&&t["c"+a]&&t["c"+a].split(",").forEach(function(e,t){n[t]+=isNaN(parseInt(e))?0:parseInt(e)}))}),2!=s.ScoreType&&1==s.ScoreTypeSub)e.total["c"+a]=r+o==0?"100%":(r/(r+o)*100).toFixed(2)+"%";else if(2!=s.ScoreType&&2==s.ScoreTypeSub){var i=n.reduce(function(e,t){return e+t}),l=[1,0,0],c=n.map(function(e,t){return e*l[t]}).reduce(function(e,t){return e+t});e.total["c"+a]=0==i?"100%":100*(c/i).toFixed(2)+"%"}}))},s=0;s<t.data.TaskPanel.length;s++)a(s)}else e.$message({type:"error",message:"获取检查单失败!",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取检查单失败!",showClose:!0,customClass:"error_class"})})},LoadQualParram:function(){var e=this,t=this.axiosConfig("web.INMSetComm","FindParamSubList","RecQuery","parr$^QualSetting");this.$ajax.request(t).then(function(t){t.data instanceof Object&&t.data.rows.length>0&&t.data.rows.filter(function(e){return"ShowRemark"==e.SubCode}).map(function(t){return e.ShowRemark="Y"==t.SubValue}),e.GetSchduleData()}).catch(function(t){e.$message({type:"error",message:"获取参数失败",showClose:!0,customClass:"error_class"})})}},created:function(){this.LoadQualParram()}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"night-scheule-print"},[a("div",{staticClass:"print-button",attrs:{align:"right"}},[a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode,icon:"nm-icon-w-print"},on:{click:e.PrintSchdule}},[e._v(e._s(e.$t("menu.NurNightSchedulePrint.5nrnbrpi0ks0")))])],1),e._v(" "),a("div",{ref:"schduleprint",attrs:{id:"schduleprint"}},[a("div",[a("table",{staticClass:"table-to-print",attrs:{id:"TableToPrint",cellspacing:"0",cellpadding:"0"}},[a("caption",[a("div",[e._v(e._s(e.printTitle))]),a("br"),e._v(" "),a("span",[e._v(e._s(e.$t("menu.NurNightSchedulePrint.5ncy6kld2fs0")+e.checkerName+e.$t("menu.NurNightSchedulePrint.5ncy6kldzgk0")+(e.taskDate instanceof Date?e.taskDate.Format("YYYY-MM-dd"):"")))])]),e._v(" "),a("thead",[a("tr",[a("th",{attrs:{colspan:e.Deepth,rowspan:"2"}},[e._v(e._s(e.$t("menu.NurNightSchedulePrint.5nrnbrpi3y40")))]),e._v(" "),a("th",{staticStyle:{"text-align":"center"},attrs:{colspan:e.checkwards.length*(e.ShowRemark?2:1)}},[e._v(e._s(e.$t("menu.NurNightSchedulePrint.5nrnbrpi4gs0")))])]),e._v(" "),a("tr",e._l(e.checkwards,function(t,s){return a("th",{key:s,attrs:{colspan:e.ShowRemark?2:1}},[e._v(e._s(t.WardDesc))])}),0)]),e._v(" "),a("tbody",[e._l(e.checkBasicData,function(t,s){return a("tr",{key:"basic"+s},[0==s&&e.Deepth>1?a("td",{attrs:{rowspan:e.checkBasicData.length}},[e._v(e._s(e.$t("menu.NurNightSchedulePrint.5nrnbrpi5so0")))]):e._e(),e._v(" "),a("td",{attrs:{colspan:e.Deepth>1?e.Deepth-1:1}},[e._v(e._s(t.Item))]),e._v(" "),e._l(e.checkwards,function(s,r){return a("td",{key:r,attrs:{colspan:e.ShowRemark?2:1,align:"left"}},[e._v(e._s(e.flag?"":t["b"+s.WardId]))])})],2)}),e._v(" "),e._l(e.TableData,function(t,s){return[0==t.HasChild?a("tr",{key:"item"+s},[e._l(t.Roots,function(s,r){return[1==t.FatherShow&&e.GetFatherShow(t.Roots.slice(r,-1))?a("td",{key:r,attrs:{rowspan:e.GetFatherRowSpan(s)}},[e._v(e._s(e.GetFatherDesc(s)))]):e._e()]}),e._v(" "),a("td",{attrs:{colspan:e.Deepth-t.SubSort.split(".").length+2}},[e._v(e._s(t.SubItem))]),e._v(" "),e._l(e.checkwards,function(r,o){return[a("td",{key:"score"+o,attrs:{colspan:s==e.TableData.length-1&&e.ShowRemark?2:1,align:"left"}},[e._v(e._s(e.flag?"":2!=e.scoreType&&2==e.scoreTypeSub?t["ctoshow"+r.WardId]:t["c"+r.WardId]))]),e._v(" "),s!=e.TableData.length-1&&e.ShowRemark?a("td",{key:"remark"+o,attrs:{align:"left"}},[e._v(e._s(e.flag?"":t["r"+r.WardId]))]):e._e()]})],2):e._e()]}),e._v(" "),a("tr",[a("td",{attrs:{colspan:e.Deepth}},[e._v(e._s(e.total.desc))]),e._v(" "),e._l(e.checkwards,function(t,s){return a("td",{key:s,attrs:{colspan:e.ShowRemark?2:1,align:"left"}},[e._v(e._s(e.flag||!e.total["c"+t.WardId]?"":e.total["c"+t.WardId]))])})],2)],2)])])])])},staticRenderFns:[]};var u=a("VU/8")(l,c,!1,function(e){a("OYGT")},null,null);t.default=u.exports},twJ1:function(e,t){}});