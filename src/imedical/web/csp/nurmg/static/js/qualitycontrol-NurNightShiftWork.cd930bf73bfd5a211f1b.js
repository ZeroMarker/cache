webpackJsonp([213],{HJAe:function(e,t){},voPW:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s("Dd8w"),a=s.n(o),r=s("NYxO"),i=s("XlQt"),n=s("W5Fe"),l={components:{hgbutton:i.default,hgpagination:n.default},name:"NurNightShiftWork",computed:a()({},Object(r.b)(["Height","styleCode"])),data:function(){return{elementlist:{},labelWidth:"width:200px",currentPage:1,pageSize:20,totalCount:0,finds:{stDate:"",endDate:""},tableData:[],tableDataAll:[],dialogVisible:!1,editForm:{ShiftToDate:"",ShiftToPost:"",ShiftToPer:"",ShiftDate:"",ShiftPost:"",ShiftPer:"",ShiftRemark:"",rw:""},ShiftToTaskStore:[],ShiftToPersonStore:[],ShiftSchduleStore:[],ShiftPersonStore:[],rules:{ShiftDate:[{required:!0,message:"请选择日期",trigger:"change",type:"date"}],ShiftPost:[{required:!0,message:"请选择交换班次",trigger:"change"}],ShiftPer:[{required:!0,message:"交换人不能为空",trigger:"change"}],ShiftToDate:[{required:!0,message:"请选择日期",trigger:"change",type:"date"}],ShiftToPer:[{required:!0,message:"换班人不能为空",trigger:"change"}],ShiftToPost:[{required:!0,message:"请选择换班班次",trigger:"change"}]},Selection:[],CheckTypeStore:[],PickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},winFlag:0}},methods:{GetCheckType:function(){var e=this,t=e.axiosConfig("web.INMQualControlComm","FindQualTypeList","RecQuery","type$N");e.$ajax.request(t).then(function(t){t.data instanceof Object?e.CheckTypeStore=t.data.rows:e.$message({type:"error",message:"获取质控类型失败",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取质控类型失败",showClose:!0,customClass:"error_class"})})},HandleSizeChange:function(e){this.pageSize=e,this.LoadTableData()},HandleCurrentChange:function(e){this.currentPage=e.currentPage,this.LoadTableData()},LoadTableData:function(){var e=this,t=e.finds.stDate,s=e.finds.endDate,o=(t=t instanceof Date?t.Format("YYYY-MM-dd"):"")+"^"+(s=s instanceof Date?s.Format("YYYY-MM-dd"):""),a=(e.currentPage-1)*e.pageSize,r=e.pageSize,i=e.axiosConfig("web.INMQualControlComm","FindCheckShiftList","RecQuery","parr$"+o,"input$","nurseid$"+sessionStorage.getItem("loginID"));e.$ajax.request(i).then(function(t){t instanceof Object?(e.tableData=t.data.rows.slice(a,a+r),e.tableDataAll=t.data.rows,e.totalCount=parseInt(t.data.results)):e.$message({type:"error",message:"获取数据出错",showClose:!0,customClass:"error_class"})}).catch(function(t){e.$message({type:"error",message:"获取数据出错",showClose:!0,customClass:"error_class"})})},AddShift:function(){var e=this;e.winFlag=0,e.dialogVisible=!0,e.$nextTick(function(){e.$refs.editForm.resetFields(),e.editForm.rw=""})},LoadFromTask:function(e){var t=this,s="";if(t.CheckTypeStore.forEach(function(e){s=s?s+"^"+e.rw:e.rw}),e&&(t.editForm.ShiftPost="",t.ShiftSchduleStore=[],t.editForm.ShiftPer="",t.ShiftPersonStore=[]),t.editForm.ShiftDate instanceof Date){var o=t.axiosConfig("web.INMQualControlComm","GetTaskByDate","Method","type$"+s,"date$"+t.editForm.ShiftDate.Format("YYYY-MM-dd"));t.$ajax.request(o).then(function(e){e.data instanceof Array?t.ShiftSchduleStore=e.data:t.$message({type:"error",message:"获取检查任务失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.$message({type:"error",message:"获取检查任务失败",showClose:!0,customClass:"error_class"})})}},LoadFromPerson:function(e){var t=this;if(e&&(t.editForm.ShiftPer="",t.ShiftPersonStore=[]),t.editForm.ShiftPost){var s=t.axiosConfig("web.INMQualControlComm","FindCheckPersonsList","RecQuery","id$"+t.editForm.ShiftPost,"perid$"+sessionStorage.loginPerID,"flag$1");t.$ajax.request(s).then(function(e){e.data instanceof Object?t.ShiftPersonStore=e.data.rows:t.$message({type:"error",message:"获取换班人员失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.$message({type:"error",message:"获取换班人员失败",showClose:!0,customClass:"error_class"})})}},LoadToTask:function(e){var t=this,s="";if(t.CheckTypeStore.forEach(function(e){s=s?s+"^"+e.rw:e.rw}),e&&(t.editForm.ShiftToPost="",t.ShiftToTaskStore=[],t.editForm.ShiftToPer="",t.ShiftToPersonStore=[]),t.editForm.ShiftToDate instanceof Date){var o=t.axiosConfig("web.INMQualControlComm","GetTaskByDate","Method","type$"+s,"date$"+t.editForm.ShiftToDate.Format("YYYY-MM-dd"));t.$ajax.request(o).then(function(e){e.data instanceof Array?t.ShiftToTaskStore=e.data:t.$message({type:"error",message:"获取检查任务失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.$message({type:"error",message:"获取检查任务失败",showClose:!0,customClass:"error_class"})})}},LoadToPerson:function(e){var t=this;if(e&&(t.editForm.ShiftToPer="",t.ShiftToPersonStore=[]),t.editForm.ShiftToPost){var s=t.axiosConfig("web.INMQualControlComm","FindCheckPersonsList","RecQuery","id$"+t.editForm.ShiftToPost,"perid$"+sessionStorage.loginPerID);t.$ajax.request(s).then(function(e){e.data instanceof Object?t.ShiftToPersonStore=e.data.rows:t.$message({type:"error",message:"获取换班人员失败",showClose:!0,customClass:"error_class"})}).catch(function(e){t.$message({type:"error",message:"获取换班人员失败",showClose:!0,customClass:"error_class"})})}},SaveClick:function(){var e=this;this.$refs.editForm.validate(function(t){if(t){var s=e.editForm.ShiftDate.Format("YYYY-MM-dd"),o=e.editForm.ShiftToDate.Format("YYYY-MM-dd")+"^"+e.editForm.ShiftToPost+"^"+e.editForm.ShiftToPer+"^"+s+"^"+e.editForm.ShiftPost+"^"+e.editForm.ShiftPer+"^"+e.editForm.ShiftRemark+"^S^"+e.editForm.rw,a=e.axiosConfig("web.INMQualControlComm","SaveCheckShift","Method","parr$"+o,"nurseid$"+sessionStorage.getItem("loginID"));e.$ajax.request(a).then(function(t){1==t.data?(e.$message({type:"success",message:"保存换班信息成功",showClose:!0,customClass:"success_class"}),e.dialogVisible=!1,e.LoadTableData()):0==t.data?e.$message({type:"error",message:"保存换班信息失败",showClose:!0,customClass:"error_class"}):e.$message({type:"warning",message:t.data,showClose:!0,customClass:"warning_class"})}).catch(function(t){e.$message({type:"error",message:"获取数据出错",showClose:!0,customClass:"error_class"})})}})},GetRowKey:function(e){return e.rw},SelectionChange:function(e){this.Selection=e},RowDBClick:function(e){var t=this;t.winFlag=1,"C"!=e.ShiftStatus?"B"==e.ShiftStatus?e.Creator==sessionStorage.loginID?e.rw?(t.dialogVisible=!0,t.$nextTick(function(){var s=t.axiosConfig("web.INMQualControlComm","GetCheckShift","RecMethod","id$"+e.rw);t.$ajax.request(s).then(function(e){if(e.data instanceof Object){var s={ShiftDate:new Date(e.data.ShiftDate.replace(/\-/g,"/")),ShiftPer:e.data.ShiftPer,ShiftToDate:new Date(e.data.ShiftToDate.replace(/\-/g,"/")),ShiftToPer:e.data.ShiftToPer,ShiftRemark:e.data.ShiftRemark,rw:e.data.rw,ShiftPost:e.data.ShiftPost,ShiftToPost:e.data.ShiftToPost};t.editForm=s,t.LoadFromTask(),t.LoadFromPerson(),t.LoadToTask(),t.LoadToPerson()}else t.$message({type:"error",message:"获取数据出错",showClose:!0,customClass:"error_class"})}).catch(function(e){t.$message({type:"error",message:"获取数据出错",showClose:!0,customClass:"error_class"})})})):t.$message({type:"warning",message:"获取数据失败，请刷新界面",showClose:!0,customClass:"warning_class"}):t.$message({type:"warning",message:"非创建人，不可编辑",showClose:!0,customClass:"warning_class"}):t.$message({type:"warning",message:"已提交或审核不可编辑",showClose:!0,customClass:"warning_class"}):t.$message({type:"warning",message:"已作废不可操作",showClose:!0,customClass:"warning_class"})},SetStatus:function(e){var t=this,s="";if(t.Selection&&0!=t.Selection.length){for(var o in t.Selection){var a=t.Selection[o];if("C"==a.ShiftStatus)return void t.$message({type:"warning",message:"作废记录不可操作",showClose:!0,customClass:"warning_class"});if("HA"==a.ShiftStatus)return void t.$message({type:"warning",message:"记录已审核，不可操作",showClose:!0,customClass:"warning_class"});if("B"==a.ShiftStatus)return void t.$message({type:"warning",message:"选择已驳回，不可操作",showClose:!0,customClass:"warning_class"});a.rw&&(s=""==s?a.rw:s+","+a.rw)}s=s+"^"+e;var r=t.axiosConfig("web.INMQualControlComm","SaveShiftStatus","Method","parr$"+s,"nurseid$"+sessionStorage.getItem("loginID"));t.$ajax.request(r).then(function(e){1==e.data?t.$message({type:"sucess",message:"操作成功",showClose:!0,customClass:"sucess_class"}):0==e.data?t.$message({type:"error",message:"操作失败",showClose:!0,customClass:"error_class"}):e.data.length<100?t.$message({type:"warning",message:e.data,showClose:!0,customClass:"warning_class"}):t.$message({type:"error",message:"操作失败",showClose:!0,customClass:"error_class"}),t.LoadTableData()}).catch(function(){t.$message({type:"error",message:"操作失败",showClose:!0,customClass:"error_class"})})}else t.$message({type:"warning",message:"请先选择操作数据",showClose:!0,customClass:"warning_class"})}},created:function(){var e=this;e.GetCheckType(),e.LoadTableData();var t=e.$router.currentRoute.path.slice(1,e.$router.currentRoute.path.length);e.$nextTick(function(){e.loadElementsForRouter("elementlist",t)})}},c={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"nightshiftwork-panel"},[s("div",{staticClass:"top-tool-inputDiv"},[s("el-form",{ref:"form",attrs:{model:e.finds,inline:!0}},[s("el-form-item",{attrs:{label:e.$t("menu.NurNightShiftWork.5nrnbsc0no40")}},[s("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,clearable:"",placeholder:e.$t("menu.NurNightShiftWork.5nrnbsc0no40"),size:"mini"},model:{value:e.finds.stDate,callback:function(t){e.$set(e.finds,"stDate",t)},expression:"finds.stDate"}})],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("menu.NurNightShiftWork.5nrnbsc3zrg0")}},[s("el-date-picker",{staticStyle:{width:"120px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,clearable:"",placeholder:e.$t("menu.NurNightShiftWork.5nrnbsc3zrg0"),size:"mini"},model:{value:e.finds.endDate,callback:function(t){e.$set(e.finds,"endDate",t)},expression:"finds.endDate"}})],1),e._v(" "),s("el-form-item",[s("hgbutton",{attrs:{type:"default",styleCode:e.styleCode,icon:"nm-icon-w-find"},on:{click:e.LoadTableData}},[e._v(e._s(e.$t("menu.NurNightShiftWork.5nrnbsc55yc0")))])],1)],1)],1),e._v(" "),s("div",{staticClass:"top-tool-button"},[this.elementlist.shiftbtnadd||0==this.$store.state.login.LoginId?s("hgbutton",{attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-add":"nm-icon-lite-add"},on:{click:e.AddShift}},[e._v(e._s(e.$t("menu.NurNightShiftWork.5nrnbsc56zg0")))]):e._e(),e._v(" "),this.elementlist.shiftbtnaudit||0==this.$store.state.login.LoginId?s("hgbutton",{attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-stamp":"nm-icon-lite-stamp"},on:{click:function(t){return e.SetStatus("A")}}},[e._v(e._s(e.$t("menu.NurNightShiftWork.5nrnbsc57e80")))]):e._e(),e._v(" "),this.elementlist.shiftbtnreject||0==this.$store.state.login.LoginId?s("hgbutton",{attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-back":"nm-icon-lite-back"},on:{click:function(t){return e.SetStatus("B")}}},[e._v(e._s(e.$t("menu.NurNightShiftWork.5nrnbsc57rk0")))]):e._e(),e._v(" "),this.elementlist.download||0==this.$store.state.login.LoginId?s("hgbutton",{attrs:{type:"text",issvg:e.styleCode,icon:e.styleCode?"#nm-icon-export":"nm-icon-lite-export"},on:{click:function(t){e.exportData("shiftwork",e.tableDataAll,e.$t("menu.NurNightShiftWork.5ncy6l5s7x80"))}}},[e._v(e._s(e.$t("menu.NurNightShiftWork.5nrnbsc58400")))]):e._e()],1),e._v(" "),s("div",{staticClass:"top-tool-table"},[s("el-table",{ref:"shiftwork",attrs:{data:e.tableData,"row-key":e.GetRowKey,"header-cell-style":e.headerCellFontWeight,height:e.styleCode?e.Height-130:e.Height-124,border:e.styleCode,stripe:"","highlight-current-row":"",align:"left"},on:{"selection-change":e.SelectionChange,"row-dblclick":e.RowDBClick}},[s("el-table-column",{attrs:{type:"index",width:"40",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{type:"selection",width:"50",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"ShiftStatusDesc",label:e.$t("menu.NurNightShiftWork.5nrnbsc8ir00"),width:"150"}}),e._v(" "),s("el-table-column",{attrs:{prop:"ShiftDate",label:e.$t("menu.NurNightShiftWork.5nrnbsca4hs0"),"show-overflow-tooltip":"",width:"140",formatter:e.PTableDateHisShow}}),e._v(" "),s("el-table-column",{attrs:{prop:"ShiftPerName",label:e.$t("menu.NurNightShiftWork.5nrnbscbafg0"),"show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"ShiftToDate",label:e.$t("menu.NurNightShiftWork.5nrnbsccnf80"),"show-overflow-tooltip":"",width:"140",formatter:e.PTableDateHisShow}}),e._v(" "),s("el-table-column",{attrs:{prop:"ShiftToPerName",label:e.$t("menu.NurNightShiftWork.5nrnbsceako0"),"show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"CreatorName",label:e.$t("menu.NurNightShiftWork.5nrnbscfyqo0"),"show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"UpdaterName",label:e.$t("menu.NurNightShiftWork.5nrnbscihu00"),"show-overflow-tooltip":""}})],1),e._v(" "),s("hgpagination",{attrs:{styleCode:e.styleCode,sizes:[20,40,50,100],totalCount:e.totalCount,pageNumber:e.currentPage,pageSize:e.pageSize},on:{changePage:e.HandleCurrentChange,getPageSize:e.HandleSizeChange}})],1),e._v(" "),s("el-dialog",{attrs:{title:0==e.winFlag?e.$t("menu.NurNightShiftWork.5nrnbsc56zg0"):e.$t("menu.NurNightShiftWork.5nrnbsc56zg1"),visible:e.dialogVisible,width:"350px","close-on-click-modal":!1,align:"center"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?s("i",{class:[0==e.winFlag?"nm-icon-w-plus":"nm-icon-w-edit"]}):e._e(),e._v(" "),0==e.winFlag?s("span",[e._v(e._s(e.$t("menu.NurNightShiftWork.5nrnbsc56zg0")))]):1==e.winFlag?s("span",[e._v(e._s(e.$t("menu.NurNightShiftWork.5nrnbsc56zg1")))]):e._e()]),e._v(" "),s("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.rules,"label-width":"86px",inline:!0,"label-position":"right"}},[s("el-form-item",{attrs:{label:e.$t("menu.NurNightShiftWork.5nrnbsca4hs0"),prop:"ShiftDate"}},[s("el-date-picker",{style:e.labelWidth,attrs:{"picker-options":e.PickerOptions,type:"date",format:this.$store.state.mainframe.DateFormat,clearable:"",placeholder:e.$t("menu.NurNightShiftWork.5nrnbsca4hs0"),size:"mini"},on:{change:function(t){return e.LoadFromTask(!0)}},model:{value:e.editForm.ShiftDate,callback:function(t){e.$set(e.editForm,"ShiftDate",t)},expression:"editForm.ShiftDate"}})],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("menu.NurNightShiftWork.5nrnbscqeuc0"),prop:"ShiftPost"}},[s("el-select",{style:e.labelWidth,attrs:{clearable:"",placeholder:e.$t("menu.NurNightShiftWork.5nrnbscrhzg0"),size:"mini"},on:{change:function(t){return e.LoadFromPerson(!0)}},model:{value:e.editForm.ShiftPost,callback:function(t){e.$set(e.editForm,"ShiftPost",t)},expression:"editForm.ShiftPost"}},e._l(e.ShiftSchduleStore,function(e){return s("el-option",{key:e.rw,attrs:{label:e.title,value:e.rw}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("menu.NurNightShiftWork.5nrnbscbafg0"),prop:"ShiftPer"}},[s("el-select",{style:e.labelWidth,attrs:{placeholder:e.$t("menu.NurNightShiftWork.5nrnbscrhzg0"),size:"mini"},model:{value:e.editForm.ShiftPer,callback:function(t){e.$set(e.editForm,"ShiftPer",t)},expression:"editForm.ShiftPer"}},e._l(e.ShiftPersonStore,function(e){return s("el-option",{key:e.PerDR,attrs:{label:e.PerName,value:e.PerDR}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("menu.NurNightShiftWork.5nrnbsccnf80"),prop:"ShiftToDate"}},[s("el-date-picker",{style:e.labelWidth,attrs:{"picker-options":e.PickerOptions,type:"date",format:this.$store.state.mainframe.DateFormat,clearable:"",placeholder:e.$t("menu.NurNightShiftWork.5nrnbsccnf80"),size:"mini"},on:{change:function(t){return e.LoadToTask(!0)}},model:{value:e.editForm.ShiftToDate,callback:function(t){e.$set(e.editForm,"ShiftToDate",t)},expression:"editForm.ShiftToDate"}})],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("menu.NurNightShiftWork.5nrnbscyktk0"),prop:"ShiftToPost"}},[s("el-select",{style:e.labelWidth,attrs:{clearable:"",placeholder:e.$t("menu.NurNightShiftWork.5nrnbscrhzg0"),size:"mini"},on:{change:function(t){return e.LoadToPerson(!0)}},model:{value:e.editForm.ShiftToPost,callback:function(t){e.$set(e.editForm,"ShiftToPost",t)},expression:"editForm.ShiftToPost"}},e._l(e.ShiftToTaskStore,function(e){return s("el-option",{key:e.rw,attrs:{label:e.title,value:e.rw}})}),1)],1),e._v(" "),s("el-form-item",{attrs:{label:e.$t("menu.NurNightShiftWork.5nrnbsceako0"),prop:"ShiftToPer"}},[s("el-select",{style:e.labelWidth,attrs:{placeholder:e.$t("menu.NurNightShiftWork.5nrnbscrhzg0"),size:"mini"},model:{value:e.editForm.ShiftToPer,callback:function(t){e.$set(e.editForm,"ShiftToPer",t)},expression:"editForm.ShiftToPer"}},e._l(e.ShiftToPersonStore,function(e){return s("el-option",{key:e.PerDR,attrs:{label:e.PerName,value:e.PerDR}})}),1)],1),e._v(" "),s("el-form-item",{staticStyle:{"margin-top":"5px"},attrs:{label:e.$t("menu.NurNightShiftWork.5nrnbsd3yq80"),prop:"ShiftRemark"}},[s("el-input",{style:e.labelWidth,attrs:{type:"textarea",placeholder:e.$t("menu.NurNightShiftWork.5nrnbsd5dxg0"),size:"mini"},model:{value:e.editForm.ShiftRemark,callback:function(t){e.$set(e.editForm,"ShiftRemark",t)},expression:"editForm.ShiftRemark"}})],1)],1),e._v(" "),s("div",{staticClass:"bottom-button"},[s("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:e.SaveClick}},[e._v(e._s(e.$t("menu.NurNightShiftWork.5nrnbsd5fug0")))]),e._v(" "),s("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("menu.NurNightShiftWork.5nrnbsd5glg0")))])],1)],1)],1)},staticRenderFns:[]};var h=s("VU/8")(l,c,!1,function(e){s("HJAe")},null,null);t.default=h.exports}});