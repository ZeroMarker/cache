webpackJsonp([285],{"ikU+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("Dd8w"),s=a.n(l),n=a("XlQt"),u=a("NYxO"),r=a("z8xk"),i={components:{hgbutton:n.default,Hgpanel:r.default},computed:s()({},Object(u.b)(["styleCode","Height"])),name:"QualItemSetSub",props:["qualitemid","qualitemdesc"],data:function(){return{pageSize:{width:"",height:""},fieldSetSize:{height:""},dialogTreeVisible:!1,selectnodekey:"",selectnodelevel:1,qualitemsubtool:{},qualsetsubform:{SubDesc:"",SubStandard:"",SubScore:"",SubStandardList:[],SubStDate:new Date,SubEndDate:"",RowID:""},rules:{SubDesc:[{required:!0,message:"请输入描述",trigger:"blur"}],SubScore:[{required:!0,message:"请输入合法的分值！",trigger:"blur"},{validator:this.validateNumber,trigger:"blur"}],SubStDate:[{required:!0,type:"date",message:"请选择启用日期！",trigger:"change"}],QualStandardListDesc:[{required:!0,message:"请输入标准描述！",trigger:"blur"}],QualStandardListScore:[{required:!0,message:"请输入合法的分值！",trigger:"blur"}]},treedata:[{id:"",label:"",children:[]}],defaultProps:{children:"children",label:"label"},qualItem:{QualYear:"",QualCode:"",QualDesc:"",QualType:[],QualScoreType:"",QualScoreTypeSub:"",QualStandardMode:"",QualStandardList:[],QualInsert:[],QualInsertCount:1,QualPass:"",QualStDate:"",QualEndDate:"",RowID:""},validateNumber:function(e,t,a){"number"!=typeof(t=Number(t))||isNaN(t)?a(new Error("请输入合法的分值！")):t<0?a(new Error("请输入合法的分值！")):a()},winFlag:0}},methods:{renderContent:function(e,t){var a=this,l=(t.node,t.data),s=(t.store,new Array);return 1==l.stopFlag&&s.push(e("i",{style:{color:"#FF0000"},class:"el-icon-remove"})),e("span",{style:{width:"100%"},class:"custom-tree-node",on:{dblclick:function(e){a.nodeDblClick()}}},[l.label,s])},addstandard:function(){this.qualsetsubform.SubStandardList.push({desc:"",score:""})},delstandard:function(e){this.qualsetsubform.SubStandardList.splice(e,1)},handleTreeContextmenu:function(e,t,a,l){e.preventDefault(),e.returnValue=!1,e.cancelBubble=!0,this.selectnodekey=a.key,this.selectnodelevel=a.level;var s=document.getElementById("treeRightMenu");if(s){var n=e.clientX-(document.documentElement.clientWidth-this.$parent.$refs.dialog.clientWidth)/2,u=e.clientY-(document.documentElement.clientHeight-this.$parent.$refs.dialog.clientHeight)/2;u+90>document.documentElement.clientHeight&&(u-=90),s.style.left=n-1+"px",s.style.top=u+"px",s.style.display="block"}},setSize:function(){this.pageSize.width=this.$store.state.systemset.width+"px",this.pageSize.height=this.$store.state.systemset.height+"px"},loadTreeRootId:function(){this.treedata[0].id=this.qualitemid+".0",this.treedata[0].label=this.qualitemdesc},closeTreeData:function(){this.dialogTreeVisible=!1,this.loadTreeData()},loadTreeData:function(){var e=this;e.$ajax.request(e.axiosConfig("web.INMDBComm","GetQualTree","Method","par$"+e.qualitemid)).then(function(t){e.treedata[0].children=t.data,e.selectnodekey="",e.$ajax.request(e.axiosConfig("web.INMDBComm","GetQualItem","RecMethod","id$"+e.qualitemid)).then(function(t){t.data instanceof Object?(t.data.QualStandardList=t.data.QualStandardList.split(",").map(function(e){return{desc:e.split("@")[0],score:e.split("@")[1]}}),t.data.QualType=t.data.QualType.split(",").map(function(e){return e.replace("||","__")}),t.data.QualInsert?t.data.QualInsert=t.data.QualInsert.split(","):t.data.QualInsert=[],t.data.QualStDate&&(t.data.QualStDate=new Date(t.data.QualStDate)),t.data.QualEndDate&&(t.data.QualEndDate=new Date(t.data.QualEndDate)),e.qualItem=t.data,e.treedata[0].label=t.data.QualDesc+"("+t.data.QualScore+")"):e.$message({type:"error",message:"获取数据失败",showClose:!0,customClass:"error_class"})})})},addTreeData:function(){this.winFlag=0;var e=document.getElementById("treeRightMenu");e&&(e.style.display="none"),this.selectnodekey?(this.dialogTreeVisible=!0,this.clearForm(),"2"==this.qualItem.QualScoreType&&("5"==this.qualItem.QualScoreTypeSub&&"2"==this.qualItem.QualStandardMode||"6"==this.qualItem.QualScoreTypeSub)&&this.qualsetsubform.SubStandardList.push({desc:"",score:""}),this.$nextTick(function(){this.$refs.qualsetsubform.resetFields()})):this.$message({type:"warning",message:"请选中节点",showClose:!0,customClass:"warning_class"})},clearForm:function(){this.qualsetsubform={SubDesc:"",SubStandard:"",SubScore:"",SubStandardList:[],SubStDate:new Date,SubEndDate:"",RowID:""}},deleteTreeData:function(){var e=document.getElementById("treeRightMenu");e&&(e.style.display="none");var t=this;t.selectnodekey?t.selectnodekey.indexOf(".0")>-1?t.$message({type:"warning",message:"此节点不能删除！",showClose:!0,customClass:"warning_class"}):this.$confirm("删除节点及其下所有节点, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warning"}).then(function(){t.$ajax.request(t.axiosConfig("web.INMDBComm","DeleteQualItms","Method","id$"+t.selectnodekey)).then(function(e){2==e.data&&t.$message({type:"warning",message:"此节点已被使用不可删除！",showClose:!0,customClass:"warning_class"}),t.loadTreeData()})}).catch(function(){t.$message({type:"info",message:"已取消删除",showClose:!0,customClass:"info_class"})}):t.$message({type:"warning",message:"请选择要删除的节点",showClose:!0,customClass:"warning_class"})},addTreeNode:function(e,t){var a=this,l="",s=a[t];for(var n in s){var u=s[n];void 0==u&&(u=""),u instanceof Date?l=l+n+"|"+u.Format("YYYY-MM-dd")+"^":"SubStandardList"==n?"2"==a.qualItem.QualScoreType&&("5"==a.qualItem.QualScoreTypeSub&&"2"==a.qualItem.QualStandardMode||"6"==a.qualItem.QualScoreTypeSub)?function(){var e="";a.qualsetsubform.SubStandardList.forEach(function(t){e=e?e+","+t.desc+"@"+t.score:t.desc+"@"+t.score}),l=l+n+"|"+e+"^"}():l=l+n+"|^":l=l+n+"|"+u+"^"}l=l+"SubPar|"+a.selectnodekey+"^SubSort|"+a.selectnodelevel,a.$refs[t].validate(function(e){e&&a.$ajax.request(a.axiosConfig("web.INMDBComm","SaveQualSub","Method","parr$"+l)).then(function(e){1==e.data?(a.$message({type:"success",message:"保存成功",showClose:!0,customClass:"success_class"}),a.loadTreeData(),a.dialogTreeVisible=!1):2==e.data?a.$message({type:"warning",message:"计算分数失败",showClose:!0,customClass:"warning_class"}):a.$message({type:"warning",message:"保存失败",showClose:!0,customClass:"warning_class"})})})},getNodeParent:function(e,t){var a=e.parent,l=a.level;for(t=a.key+"."+t;l>1;)this.getNodeParent(a,t),l--;return t},nodeKeyClick:function(e,t,a){this.winFlag=1,this.selectnodekey=t.key,this.selectnodelevel=t.level;var l=document.getElementById("treeRightMenu");l&&(l.style.display="none")},nodeDblClick:function(){var e=this;-1==e.$refs.qualtree.currentNode.node.key.indexOf(".0")&&(this.clearForm(),e.dialogTreeVisible=!0,e.$nextTick(function(){e.$refs.qualsetsubform.resetFields(),e.$ajax.request(e.axiosConfig("web.INMDBComm","GetTreeData","RecMethod","id$"+e.selectnodekey)).then(function(t){t.data instanceof Object&&(t.data.SubStandardList?t.data.SubStandardList=t.data.SubStandardList.split(",").map(function(e){return{desc:e.split("@")[0],score:e.split("@")[1]}}):t.data.SubStandardList=[{desc:"",score:""}],t.data.SubStDate&&(t.data.SubStDate=new Date(t.data.SubStDate)),t.data.SubEndDate&&(t.data.SubEndDate=new Date(t.data.SubEndDate)),e.qualsetsubform=t.data)})}))}},created:function(){this.fieldSetSize.height=document.documentElement.clientHeight-58+"px",this.setSize(),this.loadTreeRootId(),this.loadTreeData(),document.onclick=function(){var e=document.getElementById("treeRightMenu");e&&(e.style.display="none")},document.oncontextmenu=function(){var e=document.getElementById("treeRightMenu");e&&(e.style.display="none")}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"qual-item-setsub-panel",style:e.pageSize},[a("hgpanel",{staticStyle:{width:"100%"},attrs:{title:e.$t("menu.QualItemSetSub.5ncy63ugu9w0"),styleCode:e.styleCode,icon:"#nm-icon-paper",panelHeight:600}},[a("div",{staticStyle:{overflow:"auto",background:"green"},style:{height:e.styleCode?"563px":"564px"}},[a("el-tree",{ref:"qualtree",staticStyle:{height:"100%",overflow:"auto",border:"none","text-align":"left"},attrs:{data:e.treedata,"default-expand-all":"","node-key":"id","expand-on-click-node":!1,"render-content":e.renderContent,"highlight-current":"","check-on-click-node":"",props:e.defaultProps},on:{"node-click":e.nodeKeyClick,"node-contextmenu":e.handleTreeContextmenu}})],1)]),e._v(" "),a("el-dialog",{attrs:{title:0==e.winFlag?e.$t("menu.QualItemSetSub.5nrnay1zbqc0"):e.$t("menu.QualItemSetSub.5nrnay1c80k0"),"modal-append-to-body":!1,"append-to-body":!0,"close-on-click-modal":!1,visible:e.dialogTreeVisible,"before-close":e.closeTreeData,width:"694px"},on:{"update:visible":function(t){e.dialogTreeVisible=t}}},[a("div",{staticClass:"dialog-header-title",attrs:{slot:"title"},slot:"title"},[e.styleCode?a("i",{class:[0==e.winFlag?"nm-icon-w-plus":"nm-icon-w-edit"]}):e._e(),e._v(" "),0==e.winFlag?a("span",[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1zbqc0")))]):e._e(),e._v(" "),1==e.winFlag?a("span",[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1c80k0")))]):e._e()]),e._v(" "),a("el-form",{ref:"qualsetsubform",attrs:{model:e.qualsetsubform,rules:e.rules,"label-position":"right",inline:"","label-width":"100px",align:"left"}},[a("el-form-item",{attrs:{label:e.$t("menu.QualItemSetSub.5nrnay1ebso0"),prop:"SubDesc"}},[a("el-input",{staticStyle:{width:"550px","vertical-align":"inherit","margin-bottom":"9px"},attrs:{placeholder:e.$t("menu.QualItemSetSub.5nrnay1fguc0"),type:"textarea",autosize:{minRows:1},size:"mini"},model:{value:e.qualsetsubform.SubDesc,callback:function(t){e.$set(e.qualsetsubform,"SubDesc",t)},expression:"qualsetsubform.SubDesc"}})],1),e._v(" "),"2"==e.qualItem.QualScoreType&&("3"==e.qualItem.QualScoreTypeSub||"4"==e.qualItem.QualScoreTypeSub||"5"==e.qualItem.QualScoreTypeSub&&"2"==e.qualItem.QualStandardMode||"6"==e.qualItem.QualScoreTypeSub)||"2"==e.qualItem.QualScoreTypeSub&&"Y"==e.qualItem.QualScoreFlag?a("el-form-item",{staticStyle:{"margin-bottom":"6px"},attrs:{label:e.$t("menu.QualItemSetSub.5nrnay1gnww0"),prop:"SubScore"}},[a("el-input",{staticStyle:{width:"550px"},attrs:{placeholder:e.$t("menu.QualItemSetSub.5nrnay1fguc0"),size:"mini"},model:{value:e.qualsetsubform.SubScore,callback:function(t){e.$set(e.qualsetsubform,"SubScore",t)},expression:"qualsetsubform.SubScore"}})],1):e._e(),e._v(" "),"1"==e.qualItem.QualScoreType&&e.qualItem.QualScoreTypeSub||"2"==e.qualItem.QualScoreType&&("5"==e.qualItem.QualScoreTypeSub||"6"==e.qualItem.QualScoreTypeSub)?a("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{label:e.$t("menu.QualItemSetSub.5nrnay1kzzc0"),required:""}},["1"==e.qualItem.QualScoreType&&e.qualItem.QualScoreTypeSub||"2"==e.qualItem.QualScoreType&&"5"==e.qualItem.QualScoreTypeSub&&"1"==e.qualItem.QualStandardMode?a("el-form-item",[a("div",{staticClass:"qual-item-table",staticStyle:{width:"548px"}},[a("table",{staticStyle:{"text-align":"center"},attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[a("tr",[a("th",[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1l4kg0")))]),e._v(" "),a("th",[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1gnww0")))])]),e._v(" "),e._l(e.qualItem.QualStandardList,function(t){return a("tr",{key:t.desc},[a("td",[e._v(e._s(t.desc))]),e._v(" "),a("td",[e._v(e._s(t.score))])])})],2)])]):e._e(),e._v(" "),"2"==e.qualItem.QualScoreType&&("5"==e.qualItem.QualScoreTypeSub&&"2"==e.qualItem.QualStandardMode||"6"==e.qualItem.QualScoreTypeSub)?a("el-form-item",{staticStyle:{"margin-bottom":"0"}},e._l(e.qualsetsubform.SubStandardList,function(t,l){return a("div",{key:l,staticStyle:{width:"550px"}},[a("el-row",[a("el-col",{attrs:{span:9}},[a("el-form-item",{attrs:{prop:"SubStandardList."+l+".desc",rules:e.rules.QualStandardListDesc}},[a("div",{staticStyle:{display:"flex"}},[a("label",{staticStyle:{flex:"0 1 auto"}},[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1l4kg0")))]),e._v(" "),a("el-input",{staticStyle:{"padding-left":"10px",flex:"1 3 auto"},attrs:{size:"mini"},model:{value:t.desc,callback:function(a){e.$set(t,"desc",a)},expression:"item.desc"}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-form-item",{attrs:{prop:"SubStandardList."+l+".score",rules:e.rules.QualStandardListScore}},[a("div",{staticStyle:{display:"flex"}},[a("label",{staticStyle:{"padding-left":"15px",flex:"0 0 auto"}},[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1gnww0")))]),e._v(" "),a("el-input",{staticStyle:{"padding-left":"10px",flex:"1"},attrs:{type:"number",size:"mini"},model:{value:t.score,callback:function(a){e.$set(t,"score",a)},expression:"item.score"}})],1)])],1),e._v(" "),a("el-col",{attrs:{span:1}},[l==e.qualsetsubform.SubStandardList.length-1?a("i",{staticClass:"el-icon-plus",staticStyle:{"margin-left":"10px",color:"#66CDAA",cursor:"pointer"},on:{click:e.addstandard}}):e._e()]),e._v(" "),a("el-col",{attrs:{span:1}},[1!=e.qualsetsubform.SubStandardList.length?a("i",{staticClass:"el-icon-close",staticStyle:{"margin-left":"10px",color:"red",cursor:"pointer"},on:{click:function(t){return e.delstandard(l)}}}):e._e()])],1)],1)}),0):e._e()],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.QualItemSetSub.5nrnay1n8340"),prop:"SubStandard"}},[a("el-input",{staticStyle:{width:"550px","margin-bottom":"9px"},attrs:{placeholder:e.$t("menu.QualItemSetSub.5nrnay1fguc0"),type:"textarea",autosize:{minRows:2},size:"mini"},model:{value:e.qualsetsubform.SubStandard,callback:function(t){e.$set(e.qualsetsubform,"SubStandard",t)},expression:"qualsetsubform.SubStandard"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.QualItemSetSub.5nrnay1q7wc0"),prop:"SubStDate"}},[a("el-date-picker",{staticStyle:{width:"220px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,placeholder:e.$t("menu.QualItemSetSub.5nrnay1spww0"),size:"mini"},model:{value:e.qualsetsubform.SubStDate,callback:function(t){e.$set(e.qualsetsubform,"SubStDate",t)},expression:"qualsetsubform.SubStDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("menu.QualItemSetSub.5nrnay1vz1s0"),prop:"SubEndDate"}},[a("el-date-picker",{staticStyle:{width:"220px"},attrs:{type:"date",format:this.$store.state.mainframe.DateFormat,placeholder:e.$t("menu.QualItemSetSub.5nrnay1spww0"),size:"mini"},model:{value:e.qualsetsubform.SubEndDate,callback:function(t){e.$set(e.qualsetsubform,"SubEndDate",t)},expression:"qualsetsubform.SubEndDate"}})],1)],1),e._v(" "),a("div",{staticClass:"bottom-button"},[a("hgbutton",{attrs:{type:e.styleCode?"default":"success",styleCode:e.styleCode},on:{click:function(t){return e.addTreeNode("qualtree","qualsetsubform")}}},[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1z86o0")))]),e._v(" "),a("hgbutton",{attrs:{type:"default",styleCode:e.styleCode},on:{click:e.closeTreeData}},[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1z9580")))])],1)],1),e._v(" "),a("div",{staticClass:"right-menu",staticStyle:{display:"none",width:"140px",position:"absolute"},attrs:{id:"treeRightMenu"}},[a("ul",[a("li",[a("a",{staticClass:"right-menu-btn",attrs:{href:"javascript:void(0)"},on:{click:e.addTreeData}},[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1zbqc0")))])]),e._v(" "),a("li",{staticStyle:{"border-top":"1px solid #DCDCDC"}},[a("a",{staticClass:"right-menu-btn",attrs:{href:"javascript:void(0)"},on:{click:e.deleteTreeData}},[e._v(e._s(e.$t("menu.QualItemSetSub.5nrnay1zcn80")))])])])])],1)},staticRenderFns:[]};var d=a("VU/8")(i,o,!1,function(e){a("u/3A")},null,null);t.default=d.exports},"u/3A":function(e,t){}});