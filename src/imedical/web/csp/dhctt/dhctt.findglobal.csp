<html>
<head>
	<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
		d ##class(web.Util.DHCTTLanguageManager).getLanguage().initFindGlobal(.t)
		S findpn = "packageName"
		S findgn = "globalName"
		s findtn = "tableName"
		S findurl = "dhctt.findtablestructure.csp"
		s reqPnValue = $g(%request.Data(findpn,1))
		s reqGnValue = $g(%request.Data(findgn,1))
		q 1
	</csp:method>
	<title>#(t("Find Global Title"))#</title>
	<DHCTT:HEAD/>
	<SCRIPT language=CACHE RUNAT=SERVER METHOD=CreateUrl RETURNTYPE=%String ARGUMENTS="pn:%String,tn:%String">
		q findurl_"?"_findpn_"="_pn_"&"_findtn_"="_tn
	</SCRIPT>
</head>
<body>
	<DHCTT:MENU/>
	<table>
		<tr><td class='greentitle'>#(t("findGlobal"))#:</td></tr>
		<tr>	
			<td></td>
			<td>
				<form action="dhctt.findglobal.csp">
					#(t("pn"))#: <input type="text" name="packageName" id="packageName" value="#($s(reqPnValue:reqPnValue,1:"User"))#" />
					#(t("gn"))#: <input type="search" name="globalName" id="globalName" autocomplete="off" value="#(reqGnValue)#" placeholder=#(t("gn"))# required=true/>	
					<input id='find' type="submit" value="#(t("find"))#" />
				</form>
				<!--&nbsp<a id='find' href="#(..CreateUrl())#">#(t("find"))#</a>-->
			</td>
		</tr>
		<tr><td></td><td><font class='greentitle'>#(t("ClassAndGlobal"))#</font></td></tr>
		<tr>
			<td></td>
			<td valign="top">
				<div style='height:550; overflow: auto'><table border=1 id="ClassAndGlobalTable" >
					<thead>
						<TH style="width:200px">#(t("ClassAllName"))#</TH>
						<TH style="width:200px">#(t("TableName"))#</TH>
						<TH style="width:600px">#(t("SubScriptString"))#</TH>
						<TH style="width:90px">#(t("IndexType"))#</TH>
					</thead>		
					<script language=CACHE RUNAT=SERVER>
						;ClassAllName,TableName,SubScriptString,IndexType
						s colstr=$lb("ClassAllName","TableName","SubScriptString","IndexType")
						s c1=$lg(colstr,1), c2=$lg(colstr,2), c3=$lg(colstr,3), c4=$lg(colstr,4)
						w "<tbody align='left' id='ClassAndGlobalInfo'>"
						w "<tr class='bgcolorgreen'>"
						w "<td title='"_t("ClassAllName Tip")_"'><input id='"_c1_"'></td>"
						w "<td title='"_t("TableName Tip")_"'><input id='"_c2_"'></td>"
						w "<td title='"_t("SubScriptString Tip")_"'><input id='"_c3_"'></td>"
						w "<td title='"_t("IndexType Tip")_"'><input id='"_c4_"' style='width:60'></td>"
						;set ns = $namespace						
						;zn "dhc-app"
						s len = 0
						i (reqPnValue="") || (reqGnValue="") d
						.;w "<tr><td></td><td></td><td></td><td></td></tr>"									
						e  d
						.s infoRS = ##class(%ResultSet).%New("web.Util.DHCJFClassGlobal:SelectClassByGlobal")
						.set sc=infoRS.Execute(reqPnValue,reqGnValue)  If $$$ISERR(sc) Do DisplayError^%apiOBJ(sc) Quit										
						.while infoRS.Next() {
						.s len=len+1					
						.s classAllName=infoRS.GetDataByName(c1)
						.s clen=$l(classAllName,".")
						.w "<tr><td><label id='"_c1_"z"_len_"'><a href="_..CreateUrl($p(classAllName,".",1,clen-1),$p(classAllName,".",clen))_">"_classAllName_"</a></label></td>"
						.w "<td><label id='"_c2_"z"_len_"'>"_infoRS.GetDataByName(c2)_"</label></td>"
						.w "<td><label id='"_c3_"z"_len_"'>"_infoRS.GetDataByName(c3)_"</label></td>"
						.w "<td><label id='"_c4_"z"_len_"'>"_infoRS.GetDataByName(c4)_"</label></td>"
						.}
						.d infoRS.%Close()
						.s infoRS=""
						;zn ns
						w "</tbody>"
					</script>
				</table></div>
		</tr>
	</table>
	<script type="text/javascript" src="../../scripts/dhctt/DHCTable.js"></script>	
	<script type='text/javascript'>
		var ClassAndGlobalTable = document.getElementById("ClassAndGlobalTable");
		DHC.addEventListener(ClassAndGlobalTable,"keyup",DHCTable.tableEnterKeyupHandler);	
		DHC.addEventListener(ClassAndGlobalTable,"click",DHCTable.tableClickRowHandler);	
	</script>
</body>
</html>
