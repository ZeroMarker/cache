<script runat="server" language="cache">
	s act = $g(%request.Data("act",1))
	Set dirname = ##class(web.Util.DHCJFXMLOperate).GetPhysicalPath($g(%request.Data("dirname",1)))
	if (act="download"){
		s filename = $g(%request.Data("filename",1))
		if (##class(%File).Exists(dirname_filename)){
			s stream=##class(%FileCharacterStream).%New()
			s stream.Filename=dirname_filename
			d stream.Rewind()
			while('stream.AtEnd){ w stream.ReadLine(),!}
			d stream.Clear()
			s stream=""
			d %response.Flush()	
		}else{
			d %response.Abort()
			w "404 没找到"_dirname_filename_"文件"	
		}
	} elseif(act="upload"){
		If ($data(%request.MimeData("FileStream",1))){
			New fileStream,bytes,file
			Set fileStream = %request.MimeData("FileStream",1)
			Set file = ##class(%FileBinaryStream).%New()
			Set file.Filename=dirname_fileStream.FileName			
			Do fileStream.Rewind()
			While('fileStream.AtEnd){
				Set bytes = fileStream.Read(1024)
				Do file.Write(bytes)
			}
			Do file.Flush()
			Do file.%Save()
			Do file.%Close()
			Set file=""
		}
	}
	Quit "" 
</script>
<script language=Cache method=OnPreHTTP arguments="" returntype=%Boolean>
	set filename = $g(%request.Data("filename",1))
	s act = $g(%request.Data("act",1))
	if (act="download"){
		Do %response.SetHeader("Content-Disposition", "attachment; filename="_filename)
		;set %response.ContentType = "text/xml; charset=utf-8"
	} elseif(act="upload"){
	}
	Quit 1 
</script>
