<csp:content charset="UTF-8">
<SERVER>
s Action=$Get(%request.Data("actiontype",1))
s Start=$Get(%request.Data("start",1))
s Limit=$Get(%request.Data("limit",1))
s Sort=$Get(%request.Data("sort",1))
s Dir=$Get(%request.Data("dir",1))

/// BPM: 保存,提交,通过,拒绝
i (Action="BPMSave")||(Action="BPMSubmit")||(Action="BPMPass")||(Action="BPMReject") d
	.s Param=$Get(%request.Data("Param",1))
	.s StrParam=$Get(%request.Data("StrParam",1))
	.s BPMStrParam=$Get(%request.Data("BPMStrParam",1))
	.
	.i Action="BPMSave" d
	..;保存
	..s result=##class(web.DHCSTM.DHCNewItm).BPMSave(Param,StrParam)
	.e  i Action="BPMSubmit" d
	..;提交
	..s result=##class(web.DHCSTM.DHCNewItm).BPMSubmit(Param,StrParam,BPMStrParam)
	.e  i Action="BPMPass" d
	..;通过
	..s result=##class(web.DHCSTM.DHCNewItm).BPMPass(Param,StrParam,BPMStrParam)
	.e  i Action="BPMReject" d
	..;拒绝
	..s result=##class(web.DHCSTM.DHCNewItm).BPMReject(Param,StrParam,BPMStrParam)
	.
	.i result=0 d
	..w "{success:'true',info:''}"
	.e  d
	..w "{success:'false',info:'"_result_"'}"


i Action="GetItmDetail" d
	.s RowId=$Get(%request.Data("RowId",1))
	.w ##class(web.DHCSTM.DHCNewItm).GetItmDetail(RowId)

///获取审核日志
i Action="GetNewItmAudRec" d
	.s Parref=$Get(%request.Data("Parref",1))
	.d ##class(web.DHCSTM.DHCNewItm).GetNewItmAudRec(Parref)

///获取新项相关明细信息
i Action="GetNewItmInfo" d
	.s Parref=$Get(%request.Data("Parref",1))
	.d ##class(web.DHCSTM.DHCNewItm).GetNewItmInfo(Parref)

i Action="GetNewItm" d
	.s Param=$Get(%request.Data("Param",1))
	.d ##class(web.DHCSTM.DHCNewItm).Query(Start,Limit,Param)

i Action="UpLoadPic" d
	.s File=$Get(%request.MimeData("files",1))
	.s RowId=$Get(%request.Data("RowId",1))
	.s Type=$Get(%request.Data("Type",1))
	.s result = ##class(web.DHCSTM.DHCNewItm).SavePic(File,RowId,Type)
	.i +result=0 d
	..w "{success:'true',message:'上传成功'}"
	.e  d
	..w "{success:'false',message:'上传失败'}"

i Action="GetNIPic" d
	.s RowId=$Get(%request.Data("RowId",1))
	.w ##class(web.DHCSTM.DHCNewItm).GetNIPic(RowId)



///获取我的草稿
i Action = "myDraftList" d
	.s Param=$Get(%request.Data("Param",1))
	.w ##class(web.DHCSTM.DHCNewItm).myDraftList(Start,Limit,Param)

///获取我的起草
i Action="draftByMeList" d
	.s Param=$Get(%request.Data("Param",1))
	.w ##class(web.DHCSTM.DHCNewItm).draftByMeList(Param)

///获取代办列表
i Action="todoList" d
	.s Param=$Get(%request.Data("Param",1))
	.w ##class(web.DHCSTM.DHCNewItm).todoList(Param)
	
///获取已办列表
i Action="finishList" d
	.s Param=$Get(%request.Data("Param",1))
	.w ##class(web.DHCSTM.DHCNewItm).finishList(Param)

///从SCI平台上下载供应商创建的信息
i Action="GetPbSciItm" d
	.s Param=$Get(%request.Data("Param",1))
	.s result=##class(web.DHCSTM.ServiceForSCI).getSciHopInc(Param)
	.i result=0 d
	..w "{success:'true',info:'"_result_"'}"
	.e  d
	..w "{success:'false',info:'"_result_"'}"
	
</SERVER>
