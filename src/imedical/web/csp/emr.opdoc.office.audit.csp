<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
 //i ##Class(websys.SessionEvents).SessionExpired()
 i ##Class(ext.websys.SessionEvents).SessionExpired() q 1
 quit 1
</csp:method>

<html>
    <head>
        <title>诊断证明审核</title>
        <HISUI/>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <script type="text/javascript" src="../scripts/emr/lib/tool/json2.js"></script>
        <script type="text/javascript" src="../scripts/emr/js/tools.js"></script>

    </head>
    <body style="margin:3px;padding:0;overflow:hidden;">
	    <div class="hisui-layout" style="width:100%;height:100%;">
	       <div id="patLst" data-options="region:'west',border:1,split:true" style="width:770px;padding:3px;">
	            <div class="hisui-layout" data-options="fit:true">
		            <div id="seekform" data-options="region:'north',border:false" style="height:50px;padding-top:7px;">
		               <span style="padding-left:3px;">#(..Get("登记号"))#<span style = "margin-left:5px;"><input id="regNoSearch" class="hisui-searchbox hover-dark" data-options="fit:true,border:false"></span></input></span>
		               <span style="padding-left:3px;">#(..Get("患者姓名"))#<span style = "margin-left:5px;"><input id="nameSearch" class="hisui-searchbox hover-dark" data-options="fit:true,border:false"></span></input></span>
		               <span style="padding-left:3px;">#(..Get("就诊卡号"))#<span style = "margin-left:5px;"><input id="cardNoSearch" class="hisui-searchbox hover-dark" data-options="fit:true,border:false"></span></input></span> 
		            </div>
	                <div data-options="region:'center',border:false">
	                     <table id="patientListData" title="诊断证明审核完成情况表"></table>  
	                </div>   
	            </div>
	        </div>
        
	        <div id="emrEditor" data-options="region:'center',border:1">
	            <div class="hisui-layout" data-options="fit:true,border:false">
	                <div data-options="region:'north',border:false" style="height:50px;padding:10px 0 0 0">
	                   <div id="pnlButton">
	                        <input type="password" id="chartOnBlur" value="" style="display:none"/>
	                        <lable style = "margin:0 5px 0 3px;">#(..Get("审核人"))#</lable>
	                        <select name="auditUsrCombo" id="auditUsrCombo" style="width:200px"></select>
	                        <a href="#" id="btnOpOfficeAudit" class="hisui-linkbutton" data-options="stopAllEventOnDisabled:true">审核</a>
	                        <a href="#" id="btnOpOfficePDFPrev" class="hisui-linkbutton" data-options="stopAllEventOnDisabled:true">预览</a>
	                        <!--button id="btnOpOfficePDFPrint">打&nbsp&nbsp&nbsp印</button>-->
	                     </div>
	               	     <table id="msgTable" class="right" style="width:400px;height:100%;table-layout:fixed;display:none;" border=0 cellspacing=0 cellpadding=1> 
	                        <tr> 
	                            <td id="msgtd" style="vertical-align:middle;background-color:red;text-align:center;font-family:MicrosoftYaHei;font-size:120%;color:black;display:inline-block"></td> 
	                        </tr> 
	                     </table>    
	                </div>
	                <div id="editor" data-options="region:'center',border:false" style="overflow:hidden;">
	                    <iframe id="editorFrame" src="" style="width:100%;height:100%;" frameborder="0" scrolling="no"></iframe>    
	                </div>
	            </div> 
	        </div> 
        </div>       
        
    <script language="cache" runat="server">
        s patientID = $Get(%request.Data("PatientID",1),"")
        s episodeID = $Get(%request.Data("EpisodeID",1),"")
        s mradm = ""
        s:(episodeID'="") mradm=$p($g(^PAADM(episodeID)),"^",61)
        
        s id = $Get(%request.Data("id",1),"")
        s chartItemType = $Get(%request.Data("chartItemType",1),"")
        s pluginType = $Get(%request.Data("pluginType",1),"")
        s emrDocId = $Get(%request.Data("emrDocId",1),"")
        s url = $Get(%request.Data("url",1),"")
        
        s sessionID = %session.SessionId    
        s userCode = %session.Get("LOGON.USERCODE")
        s userName = %session.Get("LOGON.USERNAME")
        s userID = %session.Get("LOGON.USERID")
        s ssgroupID = %session.Get("LOGON.GROUPID")
        s userLocID = %session.Get("LOGON.CTLOCID")
        s userLocCode = $Case(userLocID,"":"",:$p(^CTLOC(userLocID),"^",1))
        s userLocName = $Case(userLocID,"":"",:$p(^CTLOC(userLocID),"^",2))
        
        s argConnect = ##Class(EMRservice.BL.BLSysOption).GetOptionValueByName("NET_CONNECT")
        s DECRYPTKEY=##Class(EMRservice.BL.BLSysOption).GetOptionValueByName("DECRYPTKEY")    
        s setDefaultFontStyle = ##Class(EMRservice.BL.BLSysOption).GetOptionValueByName("SetOPDefaultFontStyle")
        s pluginUrl = ##Class(EMRservice.BL.BLSysOption).GetOptionValueByName("PluginUrl")
        s MessageScheme = ##Class(EMRservice.BL.BLSysOption).GetOptionValueByName2("MessageScheme","")

        s savedRecords = "" //##Class(EMRservice.BL.opInterface).getSavedRecordsForAudit(episodeID, userLocID, ssgroupID)
        s PatientNoLength = ##class(EMRservice.BL.BLSysOption).GetOptionValueByName2("PatientNoLength","N")
        s IsSetToLog = ##Class(EMRservice.BL.BLSysOption).GetOptionValueByName2("IsSetToLogOP","N")
        s DiagnoseProofDocID = ##class(EMRservice.BL.BLSysOption).GetOptionValueByName("DiagnoseProofDocID")
    </script>
    <script language="javascript">
        var patInfo = {
            SessionID: "#(sessionID)#",
            PatientID: "#(patientID)#",
            EpisodeID: "#(episodeID)#",
            MRadm: "#(mradm)#",
            UserID: "#(userID)#",
            UserCode: "#(userCode)#",
            UserName: "#(userName)#",
            SsgroupID: "#(ssgroupID)#",
            UserLocID: "#(userLocID)#",
            UserLocCode: "#(userLocCode)#",
            UserLocName: "#(userLocName)#",
            DiseaseID: "",
            IPAddress: getIpAddress(),
            SecCode: ""
        };                
                    
        var sysOption = {
            pluginUrl : "#(pluginUrl)#",
            setDefaultFontStyle : "#(setDefaultFontStyle)#",
            pluginType : "#(pluginType)#",
            argConnect : {"Params":$.parseJSON("#(argConnect)#".replace(/\'/g, "\"")),"Key":"#(DECRYPTKEY)#"},
            messageScheme : $.parseJSON("#(MessageScheme)#".replace(/\'/g, "\"")),
            PatientNoLength : '#(PatientNoLength)#',
            IsSetToLog : '#(IsSetToLog)#',
            DiagnoseProofDocID : '#(DiagnoseProofDocID)#'
        };
        var svrd = '#(savedRecords)#'
        var envVar = {
            readonly : 'true',
            savedRecords : svrd !=""?JSON.parse(svrd):"",
            docContext : null 
        };
    </script>        
        
	    <script type="text/javascript" src="../scripts/emr/js/opdoc.common.js"></script>
	    <script type="text/javascript" src="../scripts/emr/js/iEmrPluginEx.js"></script>
	    <script type="text/javascript" src="../scripts/emr/js/opdoc.hisLog.js"></script>
	    <script type="text/javascript" src="../scripts/emr/js/opdoc.office.toolbar.js"></script>
	    <script type="text/javascript" src="../scripts/emr/js/opdoc.office.editor.js"></script>
	    <script type="text/javascript" src="../scripts/emr/js/opdoc.office.audit.js"></script>
	    <script type="text/javascript" src="../scripts/emr/js/op.office.audit.pdfcreator.js"></script>
    </body>
</html>
