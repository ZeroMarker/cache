<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
    i ##Class(websys.SessionEvents).SessionExpired() q 1
    q 1
</csp:method>
<csp:content charset="UTF-8">
<script language="cache" runat="server">

    s Action=$Get(%request.Data("actiontype",1))
    s Start=$Get(%request.Data("start",1))
    s Limit=$Get(%request.Data("limit",1)) 
    s Sort=$Get(%request.Data("sort",1))
    s Dir=$Get(%request.Data("dir",1))   
    //导入货位码参数
    s stklistData=$Get(%request.Data("stklistData",1))
    s stkLoc=$Get(%request.Data("stkLoc",1))
    //导入调价
    i Action = "SaveAdjPrice" d
     .s listData=$Get(%request.Data("listData",1))
     .s AdjLoc=$Get(%request.Data("Loc",1))
     .s UserId=$Get(%request.Data("User",1))
     .s result = ##class(web.DHCSTM.Tools.InputAdjPrice).StartInput(listData,AdjLoc,UserId)
     .w "{success:'true',info:'"_result_"'}"
    
    //导入货位码
    i Action = "SaveStkBin"  d
     .s result = ##class(web.DHCSTM.Tools.InputAddStkBin).StartInput(stklistData,stkLoc)
   	 .w "{success:'true',info:'"_result_"'}"
   	 
    //导入供应商
    i Action = "SaveVendor" d
     .s listData=$Get(%request.Data("listData",1))
     .s result =  ##class(web.DHCSTM.Tools.VendorInput).inputVendor(listData)
     .w "{success:'true',info:'"_result_"'}"
     
    //导入厂商
    i Action = "SaveManf" d
    .s listData=$Get(%request.Data("listData",1))
    .s result =   ##class(web.DHCSTM.Tools.PhManfInput).inputManf(listData)
    .w "{success:'true',info:'"_result_"'}"
    
    //导入基础数据
    i Action = "SaveCode" d
    .s listData=$Get(%request.Data("listData",1))
    .s result = ##class(web.DHCSTM.Tools.CodeInput).inputCode(listData)
    .w "{success:'true',info:'"_result_"'}"
    
     i Action = "SaveArmCode" d
     .s listData=$Get(%request.Data("listData",1)) 
     .s result =##class(web.DHCSTM.Tools.CodeInput).inputArcCode(listData)
     .w "{success:'true',info:'"_result_"'}"   
     
   //查询导入的错误数据
    i Action = "QueryError"  d
    .d ##class(web.DHCSTM.Tools.SearchErrorData).QueryDetail()
    
    //删除错误数据
    i Action = "DeleteErrorData"  d
     .s result= ##class(web.DHCSTM.Tools.SearchErrorData).DeleteErrorData()
     .i result=0  d
     ..w "{success:'true',info:''}"
     .e  d
     ..w "{success:'false',info:''}"
     
    //导入库存
    i Action = "SaveStock"  d
    .s mainData=$Get(%request.Data("mainData",1))
    .s listData=$Get(%request.Data("listData",1))
    .s result= ##class(web.DHCSTM.Tools.StockRecInput).StockInput(mainData,listData)
    .i result=0 d
    ..w "{success:'true',info:''}"
    .e  d
    ..w "{success:'false',info:'"_result_"'}"
    i Action = "GetMaxSp"  d
    .s code=$Get(%request.Data("InciCode",1))
    .s result= ##class(web.DHCSTM.Tools.InputAdjPrice).GetMaxSp(code)
    .w "{success:'true',info:'"_result_"'}" 
    
    //导入注册证信息
    i Action = "SaveItmManfCert" d
    .s listData=$Get(%request.Data("listData",1))
    .s result = ##class(web.DHCSTM.Tools.ItmManfCertInput).ItmManfCertInput(listData)
    .w "{success:'true',info:'"_result_"'}"
    
      //导入禁止科室请领物资
    i Action = "SaveItmRefuesloc" d
    .s listData=$Get(%request.Data("listData",1))
    .s result = ##class(web.DHCSTM.Tools.RefuseLoc).RefuesLocItm(listData)
    .w "{success:'true',info:'"_result_"'}"
</script>