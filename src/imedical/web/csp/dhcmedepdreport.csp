<!-- Copyright (c) 2010 DHC Software Co.,Ltd. ALL RIGHTS RESERVED. -->
<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
	//i ##Class(websys.SessionEvents).SessionExpired()
 //i ##Class(ext.websys.SessionEvents).SessionExpired() q 1 q 1
	//modify by wuqk 2011-02-23 v6.9.4 发现函数名称被更改
	//s returnval=##class(web.portal.SessionLogon).LogonDirect()
	
	s mradm=$g(%request.Data("mradm",1))
 	s PatientID=$g(%request.Data("PatientID",1))
 	s EpisodeID=$g(%request.Data("EpisodeID",1))
	s url="websys.default.csp?WEBSYS.TCOMPONENT=DHCMedEpdReport&PatientBanner=1&ID=&PARREF="
	s url=url_"mradm="_mradm_"&PatientID="_PatientID_"&EpisodeID="_EpisodeID

	//s url="dhcmed.inf.reportsearch.csp?USERNAME=demo&PASSWORD=U%26dDF17k7k&LANGID=1&DEPARTMENT=XYK-西药库&SSUSERGROUPDESC=Demo%20Group"
	s returnval=##class(web.portal.SessionLogon).LogonDirect()
	s:returnval %response.Redirect=url
	q returnval
	//s ^tmpwuqk(1)=returnval
	//s ^tmpwuqk(2)=STATUS
	//w !,returnval
	//w !,STATUS
	//s ^tmpwuqk("Userid")=$g(%session.Data("LOGON.USERID"))
	//s exp=##Class(ext.websys.SessionEvents).SessionExpired()
	//s ^tmpwuqk(3)=exp
	//s ^tmpwuqk(5)=username
	//s ^tmpwuqk(6)=password
	//s username=$g(%request.Data("USERNAME",1))
 	//s password=$g(%request.Data("PASSWORD",1))
	//s department=$g(%request.Data("DEPARTMENT",1))
	//s ^tmpwuqk(7)=username
	//s ^tmpwuqk(8)=password
	//s ^tmpwuqk(9)=department
	//s userid=##Class(web.portal.SSUser).IsValidUser(username,password,1)
	//s ^tmpwuqk(4)=userid
 	
</csp:method>