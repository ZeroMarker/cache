<!-- CSP TRAK:HEAD Rules -->
<!-- Copyright (c) 2000 TRAK Systems Pty. ALL RIGHTS RESERVED. -->

<!-- HEAD TAG --------------------------------------------- -->

<csr:rule name="DHCSTM.EXTCOMMONJS" match="DHCSTM:EXTCOMMONJS">
<csr:description>
The <b>DHCSTM:EXTCOMMONJS</b> tag defines defines standard header info and initialisation for each page. For example javascript utilties, style sheet, theme and initialisation code
</csr:description>

<csr:action>
<BODY>
	<!--gCustom:库存项图片显示img-->
	<img id="gCustom" style="width:0;height:0;"/>
</BODY>
<SCRIPT LANGUAGE=CACHE RUNAT=SERVER>
    ;
    d ##class(web.DHCSTM.Common.ExtCommonLib).LoadCommonJsM()
    d ##class(web.DHCBillPrint).InvBillPrintCLSID()		//xml打印
    ;2013-04-11
    ;d ##class(web.DHCSTM.Common.ExportExcel).ExportExcel()	
    ;2016-07-21
    s stktypecode=##class(web.DHCSTM.StkTypeM).sssCode()
    s stktypedesc=##class(web.DHCSTM.StkTypeM).sssDesc()
    
    ;取CSP Name 2013-04-10
    s menuId=%request.Get("TMENU")
    s menuCspName=""
    //q:menuId=""
    i menuId'="" &sql(select linkurl into :menuCspName from websys.menu where %id=:menuId)
    e  s menuCspName=%request.PageName
    ;取CSP Name 2013-04-10 -->
    s StkLogonCTLocDesc=$G(%session.Data("LOGON.CTLOCDESC"))
    s StkLogonHospDesc=$G(%session.Data("LOGON.HOSPDESC"))
    
    s mSetStockLoc=##Class(%CSP.Page).Encrypt($lb("web.DHCSTM.Common.AppCommon.SetStockLoc"))
    ;
    d ##class(web.DHCSTM.Common.AppCommon).SetStockLoc($G(%session.Data("LOGON.CTLOCID")))
    
</SCRIPT>
<script language="javascript">
	var App_MenuCspName="#(menuCspName)#";
	var App_StkTypeCode="#(stktypecode)#";
	var App_StkTypeDesc="#(stktypedesc)#";
	var App_LogonLocDesc="#(StkLogonCTLocDesc)#";   //登陆科室名称
	var App_LogonHospDesc="#(StkLogonHospDesc)#";
	function sssSetStockLoc(loc)
	{
		var encmeth="#(mSetStockLoc)#";
		var result=cspRunServerMethod(encmeth,loc) ;
	}
</script>
</csr:action>
</csr:rule>

