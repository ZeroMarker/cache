<!-- Copyright (c) 2010 DHC Software Co.,Ltd. ALL RIGHTS RESERVED. --> 
<!--JW: do not edit this file without checking.  functionality has been lost since it was rewritten. -->
<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
 //i ##Class(websys.SessionEvents).SessionExpired()
 i ##Class(ext.websys.SessionEvents).SessionExpired() q 1
 quit 1
</csp:method>
<HTML XMLNS=TRAK>
<HEAD>
<TITLE><TRAK:TRANSLATE id=title>##(%session.Get("TITLE"))##</TRAK:TRANSLATE></TITLE>
<!-- <TRAK:HEAD></TRAK:HEAD> -->
<EXTHEALTH:HEAD></EXTHEALTH:HEAD>

</HEAD>
<BODY>
<SERVER>
	n id
	s id=$g(%request.Data("InsuranceID",1))
</SERVER>
<TRAK:COMPONENT id="PAPerson.Banner">
</TRAK:COMPONENT>
<TRAK:COMPONENT id="PAAdmInsurance.List">
</TRAK:COMPONENT>
<SCRIPT language=javascript>
var pgcnt=#(+$g(%request.Data("TPAGCNT",1)))#;
var el;
function SelectRowHandler(evt) {
	var eSrc=websys_getSrcElement(evt);
	// SB 03/03/04 (36744): Added new link on paadminsurance.list... and we dont want the screen to refresh
	var billGrpLimCheck=eSrc.parentElement.id.split("z")
	if (billGrpLimCheck[0]=="BillGrpLimit") return false;
	
	var rowObj=getRow(eSrc);
	if (rowObj.tagName != "TH") {
		//setRowClass(rowObj);
		// cjb 22/07/2003 37467 - contact link not opening
		if (eSrc.tagName == "IMG") eSrc=window.event.srcElement.parentElement;
		var eSrcAry=eSrc.id.split("z");
		if (eSrcAry[0] == "InsurContacts") {
			return true;
		} else {
			if (eSrc.tagName != "A") eSrc=websys_getParentElement(eSrc);
			if (eSrc.tagName != "A") return;
			
			// cjb 01/09/2003 38689 use rowObj.TRAKListIndex instead of rowObj.rowIndex
			//var rowsel=rowObj.rowIndex;
			var rowsel=rowObj.TRAKListIndex;
			
			// cjb 05/08/2005 54108 - pass TEVENT and TPAGCNT
			var lnk="paadm.insuranceframe.csp?TWKFL="+document.getElementById("TWKFL").value+"&TEVENT=#($g(%request.Data("TEVENT",1)))#";
			if (pgcnt) lnk+="&TPAGCNT="+pgcnt;
			el=document.forms['fPAAdmInsurance_Edit'].elements['TWKFLI'];
			//el=document.getElementById("TWKFLI");
			if (el) lnk+="&TWKFLI="+el.value;
			
			//lnk=lnk+"&TWKFLI="
			//el=document.forms['fPAAdmInsurance_Edit'].elements['TWKFLI'];
			//el=document.getElementById("TWKFLI");
			//if ((el)&&(el.value!="")&&(el.value!=0)) {
			//	el=el.value-1;
			//	alert(el);
			//	lnk+=el;
			//}
			
			el=document.getElementById("IDz"+rowsel);
			if (el) lnk+="&InsuranceID="+el.value;
			el=document.getElementById("PatientID");
			if (el) lnk+="&PatientID="+el.value;
			el=document.getElementById("EpisodeID");
			if (el) lnk+="&EpisodeID="+el.value;
			
			// cjb 01/09/2003 38649 passing context
			el=session["CONTEXT"];
			if (el) lnk+="&CONTEXT="+el;
			//alert(el);
			
			window.location=lnk;
			
			//alert(lnk);
			return false;
		}
	}
}

function LinkNewItem(evt) {
	
	// cjb 26/10/2005 54108 - pass TEVENT and TPAGCNT
	var lnk="paadm.insuranceframe.csp?TWKFL="+document.getElementById("TWKFL").value+"&TEVENT=#($g(%request.Data("TEVENT",1)))#";
	
	if (pgcnt) lnk+="&TPAGCNT="+pgcnt;
	
	el=document.forms['fPAAdmInsurance_Edit'].elements['TWKFLI'];
	//el=document.getElementById("TWKFLI");
	if (el) lnk+="&TWKFLI="+el.value;
	
	
	//el=document.getElementById("TWKFLI");
	//if ((el)&&(el.value!="")) {
	//	el=el.value-1;
	//	lnk+="&TWKFLI="+el;
	//}
	
	el=document.getElementById("PatientID");
	if (el) lnk+="&PatientID="+el.value;
	el=document.getElementById("EpisodeID");
	if (el) lnk+="&EpisodeID="+el.value;
	
	// cjb 01/09/2003 38649 passing context
	el=session["CONTEXT"];
	if (el) lnk+="&CONTEXT="+el;
	
	window.location=lnk;
	return false;
}

var selectedID='#(id)#';

try {
	if ((tbl)&&(selectedID!="")) {
		var found=0;
		for (var i=0; i<tbl.rows.length; i++) {
			el=document.getElementById("IDz"+i);
			if ((el)&&(el.value==selectedID)) {
				tbl.rows[i].className='clsRowSelected';
				selectedRowObj=tbl.rows[i];
				found=1;
			}
			if (found) break;
		}
	}
	
	for(var i = 0; i < document.all.length; i++) {
		if(document.all[i].id=="new1") {
			document.all[i].onclick = LinkNewItem;
			break;
		}
	}	

} catch(e) {}

</SCRIPT>
<server>
 s %request.Data("PARREF",1) = %request.Get("EpisodeID")
 s %request.Data("ID",1) = %request.Get("InsuranceID")
</server>

<TRAK:COMPONENT id="PAAdmInsurance.Edit" hidemenus=1>
</TRAK:COMPONENT>

<SERVER>
  //set the link bold on parent screen
 s BLinks=##class(web.PAAdm).FindIfLinksDataPAAdmEdit(%request.Get("EpisodeID"))
 s InsurDet=$p(BLinks,"^",9)
 w "<SCRIPT>",$c(13,10)
 w "if (window.opener) {",$c(13,10)
 w "	try {",$c(13,10)
 w "		if (window.opener) { "
 w "			window.opener.setBoldLinks(""InsurDet"",""",InsurDet,""");",$c(13,10)
 w "			var objBL=window.opener.document.getElementById(""BoldLinks"");",$c(13,10)
 w "			if (objBL) objBL.value=""",BLinks,""";",$c(13,10)
 w "		}"
 w "	}",$c(13,10)
 w "	catch(e) {}",$c(13,10)
 w "}",$c(13,10)
 w "</SCRIPT>",$c(13,10)
</SERVER>
</BODY>
</HTML>
