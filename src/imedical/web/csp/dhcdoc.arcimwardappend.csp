<!-- Copyright (c) 2010 DHC Software Co.,Ltd. ALL RIGHTS RESERVED. -->
<!--设置 dhcdoc.arcimwardappend.csp HUI病区绑定医嘱设置--> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML XMLNS=TRAK>
<HEAD>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Type" content="text/html;"/>
<TITLE><EXTHEALTH:TRANSLATE id=title>##(%session.Get("TITLE"))##</EXTHEALTH:TRANSLATE></TITLE>
<!--EXTHEALTH:EXT321></EXTHEALTH:EXT321-->
<EXTHEALTH:HEAD></EXTHEALTH:HEAD>
<HISUI></HISUI>
<script type="text/javascript" src="../scripts/dhcdoc/tools/tools.hui.js"></script>
<style>

</style>
 </head> 
  <body class="hisui-layout" data-options="fit:true">
  	<div data-options="region:'center',split:true,title:'',border:false" style="padding:10px;">
	  	<div class="hisui-panel" data-options="fit:true,title:'#(..Get("病区绑定医嘱设置"))#',headerCls:'panel-header-gray',iconCls:'icon-batch-cfg'" style="border-radius:0 0 4px 4px;">
	  		<div class="hisui-layout" data-options="fit:true">
		  		<div data-options="region:'west',split:true,border:false" style="width:400px;padding:10px 5px 10px 10px;"> 
			  		<div class="hisui-panel" data-options="fit:true" style="border-radius:4px;border:0;">
						<div id="tabs" class="hisui-tabs tabs-gray" data-options="fit:true" style="height:600px;">
							<div title="#(..Get("用法列表"))#" style="">   
								<!--div style="height:30px;padding:10px;border-bottom:1px solid #ccc;">
									<input id="searchInstrItem" class="hisui-searchbox" style="width:320px" data-options="searcher:searchInstrItem,prompt:'#(..Get(请输入用法'"></input>  
								</div>
								<table id="tabInstrList"></table-->
								<div class="hisui-layout" data-options="fit:true">
									<div data-options="region:'north',bodyCls:'panel-body-gray'" style="height:50px;padding:10px 5px 5px 5px;border-radius:0;border-width:0 0 1px 0;">
										<input id="searchInstrItem" class="hisui-searchbox" style="width:200px" data-options="searcher:searchInstrItem,prompt:'#(..Get("请输入用法"))#'"></input>  
										<input id="AppendedInstr" class='hisui-checkbox' data-options="onCheckChange:AppendedInstrCheckChange" type="checkbox" label="#(..Get("查询已绑定用法列表"))#">
									</div>
									<div data-options="region:'center',split:false,title:'',border:false"> 
										<table id="tabInstrList"></table> 
									</div> 
								</div> 
							</div>   
							<div title="#(..Get("医嘱列表"))#" >  
								<!--div style="height:30px;padding:10px;border-bottom:1px solid #ccc;">
									<input id="searchArcimItem" class="hisui-searchbox" style="width:320px" data-options="searcher:searchArcimItem,prompt:'#(..Get("请输入医嘱项"))'"></input>  
								</div> 
								<table id="tabArcimList"></table-->
								<div class="hisui-layout" data-options="fit:true">
									<div data-options="region:'north',split:false,bodyCls:'panel-body-gray'" style="height:50px;padding:10px 5px 5px 5px;border-radius:0;border-width:0 0 1px 0;">
										<input id="searchArcimItem" class="hisui-searchbox" style="width:200px" data-options="searcher:searchArcimItem,prompt:'#(..Get("请输入医嘱项"))#'"></input>  
										<input id="AppendedArcim" class='hisui-checkbox' type="checkbox" data-options="onCheckChange:AppendedArcimCheckChange" label="#(..Get("查询已绑定医嘱列表"))#">
									</div>
									<div data-options="region:'center',split:false,title:'',border:false"> 
										<table id="tabArcimList"></table> 
									</div> 
								</div>  
							</div>   
						</div>
					</div>
			  	</div>
			    <div data-options="region:'center',split:true,title:'',border:false"> 
			    	<div class="hisui-layout" data-options="fit:true,border:false">
			    		<!--div data-options="region:'south',split:true,border:false"style="height:200px;padding:5px 10px 10px 0;"> 
			    			<div class="hisui-panel" data-options="fit:true,title:'#(..Get("其他',headerCls:'panel-header-gray'" style="border-radius:0 0 4px 4px;border:1px solid #ccc;">
			    				<div style="margin:10px;">
			    					<input id="SingleNotFee" class='hisui-checkbox' type="checkbox" data-options="onCheckChange:SingleNotFeeChange" label="#(..Get("单条医嘱不绑定费用(仅成组医嘱绑定费用)">
			    				</div>
			    			</div>
			    		</div--> 
			    		<div data-options="region:'center',split:true,border:false" style="padding:10px 10px 10px 0;"> 
			    			<div class="hisui-panel" data-options="fit:true,title:'#(..Get("绑定医嘱"))#',headerCls:'panel-header-gray',iconCls:'icon-write-order'" style="border-radius:0 0 4px 4px;">
				    			<!--关联医嘱设置table--> 
								<table id="tabArcimWardList"></table> 
							</div>
			    		</div> 
			    	</div>			
				</div> 
			</div>
	  	</div>
	</div>
	<div id="dialog-priorSelect" title="#(..Get("医嘱类型"))#" style="display:none;padding:10px 10px 0 10px;">
      <table ALIGN="center" style="border-spacing:0 5px;">
        <tr>
        	<div style="padding-bottom: 5px;">
        		<label>#(..Get("不需要绑定的医嘱类型"))#</label>
        	</div>
	        <div style="height:280px;width:250px;">
				<select size="4" name="List_Prior" multiple="multiple" id="List_Prior"style="height:280px;width:250px;" ></select>
			</div>
        </tr>
        <tr>
        	<td>
            	<a class="hisui-linkbutton" id="cmd_OK" data-options="iconCls:''">#(..Get("确定"))#</a>
        	</td>
        </tr>
      </table>
    </div>
    <input id="excludePriType" type="text" style="display:none;" />
<script type="text/javascript">
var instrDataGrid;
var arcimDataGrid;
var instrArcimWardListDataGrid;
var editRow1;
var AddeditRow1;
$(function(){
	$('#tabs').tabs({    
	    height:$(window).height()-75    
	});  
	InitInstrList();
	InitArcimList();
	InitInstrArcimWardList();
	
	$("#cmd_OK").click(function(){
		 SaveExcludePriorSelect();
     });
});
//绑定方式 下医嘱绑定 起始数量、截止数量不可编辑，且只支持自动绑定
/*绑定方式  执行绑定
   手工绑定 起始数量、截止数量不可编辑
   自动绑定 1.一天一次、按最大频次 可编辑
            2.按此 可编辑
*/
function InitInstrArcimWardList() {
	var instrArcimWardListColumns=[[    
    	{ field: 'ARCIMDesc', title: $g('医嘱项名称'),  width:220,sortable: true, 
        	editor:{
		    	type:'combogrid',
		        options:{
		        	required: true,
					panelWidth:450,
					panelHeight:350,
					idField:'ArcimRowID',
					textField:'ArcimDesc',
					value:'',//缺省值 
					delay:300,
					mode:'remote',
					pagination : true,//是否分页   
					rownumbers:true,//序号   
					collapsible:false,//是否可折叠的   
					fit: true,//自动大小   
					pageSize: 10,//每页显示的记录条数，默认为10   
					pageList: [10],//可以设置每页记录条数的列表  
					//url:PUBLIC_CONSTANT.URL.QUERY_GRID_URL,
					//url:$URL+"?ClassName=DHCDoc.DHCDocConfig.ArcItemConfig&QueryName=FindAllItem",
					url:$URL+"?ClassName=DHCDoc.DHCDocConfig.InstrArcim&QueryName=FindItem",
					columns:[[
						{field:'ArcimDesc',title:$g('名称'),width:300,sortable:true},
						{field:'Price',title:$g('参考单价'),width:80,sortable:true},
						
						{field:'ManfName',title:$g('招标厂商'),width:120,sortable:true,hidden:true},
						{field:'ArcimRowID',title:'ID',width:120,sortable:true},
						{field:'selected',title:'ID',width:120,sortable:true,hidden:true}
					]],
					onSelect : function(rowIndex, rowData) {
						var ArcimSelRow=instrArcimWardListDataGrid.datagrid("selectRow",editRow1).datagrid("getSelected"); 
						var oldInstrArcimId=ArcimSelRow.InstrArcimId;
						if ((oldInstrArcimId!="")&&(oldInstrArcimId!=undefined)){
							ArcimSelRow.InstrArcimId=oldInstrArcimId.split("&")[0]+"&"+rowData.ArcimRowID;
						}else{
							ArcimSelRow.InstrArcimId=rowData.ArcimRowID;
						}
					},
					onLoadSuccess:function(data){
						/*var CurrentOrdName=$(this).combogrid('getValue');
						if(CurrentOrdName!=""){
							if (CurrentOrdName.indexOf("||")>=0){
								$(this).combogrid("setValue","");
								$(this).combo("setText", "")
							}
						}*/
						$(this).next('span').find('input').focus();
					},
					onBeforeLoad:function(param){
						if(!param.q||param.q.length<2) return false;
						if (param['q']) {
							var desc=param['q'];
						}else{
							//return false;
						}
						param = $.extend(param,{Alias:desc,HospId:session['LOGON.HOSPID'],GroupID:session['LOGON.GROUPID']});
					}
				}
			}
		},{ field: 'InstrArcimId', hidden:true}
		,{ field: 'Index', hidden:true},
		{field : 'AppendType',title : $g('绑定途径'),width:110,
			editor : {
				type:'combobox',
				options:{
					valueField:'code',
					textField:'desc',
					required:true,
					data:[{"code":"1","desc":$g("下医嘱绑定")},{"code":"2","desc":$g("执行绑定")}],
					onSelect:function(rec){
						var additionalNumObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'additionalNum'});
						var EndNumObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'EndNum'});
						var ByHandObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'ByHand'});
						var SingleNotFeeObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'SingleNotFee'});
						var ARCIMAddDescObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'ARCIMAddDesc'});
						var AddQtyObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'AddQty'});
						var rows=instrArcimWardListDataGrid.datagrid("selectRow",editRow1).datagrid("getSelected");
						var editors = instrArcimWardListDataGrid.datagrid('getEditors', editRow1); 
						var ExecType=editors[2].target.combobox('getValue');
						var ByHand=editors[7].target.combobox('getValue');
						if (rec.code=="1"){
							additionalNumObj.target[0].value="";
							additionalNumObj.target[0].disabled=true;
							EndNumObj.target[0].value="";
							EndNumObj.target[0].disabled=true;
							$(ByHandObj.target).combobox("select","1");
							$(SingleNotFeeObj.target).checkbox("enable");
						}else{ //执行绑定
							if (ByHand=="2"){ //手工绑定
								additionalNumObj.target[0].value="";
							    additionalNumObj.target[0].disabled=true;
							    EndNumObj.target[0].value="";
								EndNumObj.target[0].disabled=true;
								$(SingleNotFeeObj.target).checkbox("uncheck").checkbox("disable");
							}else{
								if ((ExecType=="1")||(ExecType=="3")){
									additionalNumObj.target[0].value="";
								    additionalNumObj.target[0].disabled=true;
								    EndNumObj.target[0].value="";
									EndNumObj.target[0].disabled=true;
								}else{
									additionalNumObj.target[0].value="1";
									additionalNumObj.target[0].disabled=false;
									EndNumObj.target[0].disabled=false;
								}
								$(SingleNotFeeObj.target).checkbox("enable");
							}
						}
						if ((rec.code=="2")&&(ExecType==3)){
							$(ARCIMAddDescObj.target).combogrid("enable");
						    AddQtyObj.target[0].disabled=false;
						}else{
							$(ARCIMAddDescObj.target).combogrid("clear").combogrid("disable");
							rows.InstrAddArcimId="";
						    AddQtyObj.target[0].value="";
						    AddQtyObj.target[0].disabled=true;
						}
					},
					onChange:function(newValue, oldValue){
						if (newValue==""){
							var additionalNumObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'additionalNum'});
							additionalNumObj.target[0].disabled=false;
							EndNumObj.target[0].disabled=false;
						}
					}
				}
			},formatter: function(value,row,index){
				if (value=="1"){
					return $g("下医嘱绑定");
				}else if (value=="2"){
					return $g("执行绑定");
				}
			}
			
		},{field : 'ExecType',title : $g('绑定方式'),width:100,
        	editor : {
				type:'combobox',
				options:{
					valueField:'code',
					textField:'desc',
					required:true,
					data:[{"code":"1","desc":$g("一天一次")},{"code":"2","desc":$g("按次")},{"code":"3","desc":$g("按最大频次")}],
					onSelect:function(rec){
						var additionalNumObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'additionalNum'});
						var EndNumObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'EndNum'});
						var SingleNotFeeObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'SingleNotFee'});
						
						var ARCIMAddDescObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'ARCIMAddDesc'});
						var AddQtyObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'AddQty'});
						
						var rows=instrArcimWardListDataGrid.datagrid("selectRow",editRow1).datagrid("getSelected");
						var editors = instrArcimWardListDataGrid.datagrid('getEditors', editRow1); 
						var AppendType=editors[1].target.combobox('getValue');
						if (AppendType==2){ //执行绑定
							var ByHand=editors[7].target.combobox('getValue');
							if (ByHand=="2"){ //手工绑定
								additionalNumObj.target[0].value="";
							    additionalNumObj.target[0].disabled=true;
							    EndNumObj.target[0].value="";
							    EndNumObj.target[0].disabled=true;
							    $(SingleNotFeeObj.target).checkbox("uncheck").checkbox("disable");
							}else{
								if ((rec.code=="1")||(rec.code=="3")){
									additionalNumObj.target[0].value="";
								    additionalNumObj.target[0].disabled=true;
								    EndNumObj.target[0].value="";
								    EndNumObj.target[0].disabled=true;
								}else{
									additionalNumObj.target[0].value="1";
									additionalNumObj.target[0].disabled=false;
									EndNumObj.target[0].disabled=false;
								}
								$(SingleNotFeeObj.target).checkbox("enable");
							}
						}else{
							additionalNumObj.target[0].value="";
						    additionalNumObj.target[0].disabled=true;
						    EndNumObj.target[0].value="";
						    EndNumObj.target[0].disabled=true;
						}
						if ((rec.code=="3")&&(AppendType==2)){
							$(ARCIMAddDescObj.target).combogrid("enable");
						    AddQtyObj.target[0].disabled=false;
						}else{
							$(ARCIMAddDescObj.target).combogrid("clear").combogrid("disable");
							rows.InstrAddArcimId="";
						    AddQtyObj.target[0].value="";
						    AddQtyObj.target[0].disabled=true;
						}
					}
				}
			},formatter: function(value,row,index){
				if (value=="1"){
					return $g("一天一次");
				}else if (value=="2"){
					return $g("按次");
				}else if (value=="3"){
					return $g("按最大频次");
				}else if (value=="10"){
					return $g("首次");
				}else if (value=="11"){
					return $g("接瓶");
				}
			}
     	},{
			field : 'Active',title : $g('启用'),width:60,
			formatter: function(value, row, index) {
				 if (value=="Y") return $g("是")
				 return $g("否")
                    
            },
			editor : {
				type : 'icheckbox',
				options : {
					on : 'Y',
					off : 'N'
				}
			}
		},{
			field : 'additionalNum',title : $g('起收数量'),width:80,
			editor : {type : 'text',options : {}}
		},{
			field : 'EndNum',title : $g('截止数量'),width:80,
			editor : {type : 'text',options : {}}
		},{
			field : 'Qty',title : $g('数量'),width:80,
			editor : {type : 'text',options : {}}
		},{
			field : 'ByHand',title : $g('绑定类型'),width:100,
			editor : {
				type:'combobox',
				options:{
					valueField:'code',
					textField:'desc',
					required:true,
					data:[{"code":"1","desc":$g("自动绑定")},{"code":"2","desc":$g("手工绑定")}],
					onSelect:function(rec){
						var ExecTypeObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'ExecType'});
						var ByHandObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'ByHand'});
						var AppendTypeObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'AppendType'});
						var rows=instrArcimWardListDataGrid.datagrid("selectRow",editRow1).datagrid("getSelected");
						var editors = instrArcimWardListDataGrid.datagrid('getEditors', editRow1); 
						var ByHand=$(ByHandObj.target).combobox('getValue');
						var additionalNumObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'additionalNum'});
						var EndNumObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'EndNum'});
						var SingleNotFeeObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'SingleNotFee'});
						if (ByHand=="2"){
							var data=[{"code":"10","desc":$g("首次")},{"code":"11","desc":$g("接瓶")}];
							$(ExecTypeObj.target).combobox("loadData", data).combobox("select","10");
							$(AppendTypeObj.target).combobox("select","2");
							
							additionalNumObj.target[0].value="";
							additionalNumObj.target[0].disabled=true;
							EndNumObj.target[0].value="";
							EndNumObj.target[0].disabled=true;
							$(SingleNotFeeObj.target).checkbox("uncheck").checkbox("disable");
						}else{ //自动绑定
							var ExecType=$(ExecTypeObj.target).combobox('getValue');
							if ((ExecType!="1")&&(ExecType!="2")&&(ExecType!="3")) ExecType=1
							var data=[{"code":"1","desc":$g("一天一次")},{"code":"2","desc":$g("按次")},{"code":"3","desc":$g("按最大频次")}];
							
							$(ExecTypeObj.target).combobox("loadData", data).combobox("select",ExecType);
							if ($(AppendTypeObj.target).combobox('getValue')=="1"){ //下医嘱绑定
								additionalNumObj.target[0].value="";
								additionalNumObj.target[0].disabled=true;
								EndNumObj.target[0].value="";
								EndNumObj.target[0].disabled=true;
							}else{ //执行绑定
								var ExecType=$(ExecTypeObj.target).combobox('getValue');
								if ((ExecType=="1")||(ExecType=="3")){
									additionalNumObj.target[0].value="";
									additionalNumObj.target[0].disabled=true;
									EndNumObj.target[0].value="";
									EndNumObj.target[0].disabled=true;
								}else{
									additionalNumObj.target[0].value="1";
									additionalNumObj.target[0].disabled=false;
									EndNumObj.target[0].disabled=false;
								}
							}
							$(SingleNotFeeObj.target).checkbox("enable");
						}
					}
				}
			},formatter: function(value,row,index){
				if (value=="1"){
					return $g("自动绑定");
				}else if (value=="2"){
					return $g("手工绑定");
				}
			}
		},{
			field : 'SingleNotFee',title : $g('仅成组医嘱绑定费用'),width:200,
			formatter: function(value, row, index) {
				 if (value=="Y") return $g("是")
				 return $g("否")
                    
            },
			editor : {
				type : 'icheckbox',
				options : {
					on : 'Y',
					off : 'N'
				}
			}
		},{
			field : 'ageFrom',title : $g('开始年龄'),width:80,
			editor : {type : 'text',options : {}}
		},{
			field : 'ageTo',title : $g('截止年龄'),width:80,
			editor : {type : 'text',options : {}}
		},{
			field: 'ARCIMAddDesc', title: $g('除最大频次以外加收费'),width:220, sortable: true, 
        	editor:{
		    	type:'combogrid',
		        options:{
		        	required: false,
					panelWidth:450,
					panelHeight:350,
					idField:'ArcimRowID',
					textField:'ArcimDesc',
					value:'',//缺省值 
					mode:'remote',
					pagination : true,//是否分页   
					rownumbers:true,//序号   
					collapsible:false,//是否可折叠的   
					fit: true,//自动大小   
					pageSize: 10,//每页显示的记录条数，默认为10   
					pageList: [10],//可以设置每页记录条数的列表  
					url:$URL+"?ClassName=DHCDoc.DHCDocConfig.InstrArcim&QueryName=FindItem",
					columns:[[
						{field:'ArcimDesc',title:$g('名称'),width:400,sortable:true},
						{field:'ArcimRowID',title:'ID',width:120,sortable:true},
						{field:'selected',title:'ID',width:120,sortable:true,hidden:true}
					]],
					onSelect : function(rowIndex, rowData) {
						var ArcimSelRow=instrArcimWardListDataGrid.datagrid("selectRow",editRow1).datagrid("getSelected"); 
						var oldInstrAddArcimId=ArcimSelRow.InstrAddArcimId;
						if ((oldInstrAddArcimId!="")&&(oldInstrAddArcimId!=undefined)){
							ArcimSelRow.InstrAddArcimId=oldInstrAddArcimId.split("&")[0]+"&"+rowData.ArcimRowID;
						}else{
							ArcimSelRow.InstrAddArcimId=rowData.ArcimRowID;
						}
					},
					onLoadSuccess:function(data){
						//$(this).next('span').find('input').focus();
					},
					onBeforeLoad:function(param){
						if (param['q']) {
							var desc=param['q'];
						}else{
							//return false;
						}
						param = $.extend(param,{Alias:desc});
					},
					onChange:function(newValue, oldValue){
						if (newValue =="") {
							var ArcimSelRow=instrArcimWardListDataGrid.datagrid("selectRow",editRow1).datagrid("getSelected"); 
							ArcimSelRow.InstrAddArcimId="";
						}
					}
				}
			}
		},{
			field: 'InstrAddArcimId', hidden:true
		},{
			field : 'AddQty',title : $g('加收数量'),width:80,
			editor : {type : 'text',options : {}}
		},{
			field : 'IsRepeatAppend',title : $g('与本配置的用法列表\\医嘱列表绑定的医嘱重复带出'),width:400,
			formatter: function(value, row, index) {
				 if (value=="Y") return $g("是")
				 return $g("否")
                    
            },
			editor : {
				type : 'icheckbox',
				options : {
					on : 'Y',
					off : 'N'
				}
			}
		},{
			field : 'UnitPrice',title : $g('价格'),width:85
		},{
			field : 'ManufacturerName',title : $g('厂家'),width:140
		}
 	]];
 	/*
 	医生站-  增加用法关联医嘱和医嘱关联医嘱的配置功能，
 	需要分病区维护，每个病区维护各自病区的，
 	可以用于护士执行医嘱时判断按天还是按次插入关联的补费医嘱，
 	包括病区、医嘱数量、开关指向(开医嘱，护士执行)、
 	类型(按天，按次)、
 	医嘱项目(可以多条，有启停参数)、
 	按次起始参数
	*/
	var instrArcimWardListToolBar = [{
            text: $g('新增'),
            iconCls: 'icon-add',
            handler: function() { //添加列表的操作按钮添加,修改,删除等
			    editRow1 = undefined;
                instrArcimWardListDataGrid.datagrid("rejectChanges");
                instrArcimWardListDataGrid.datagrid("unselectAll");
                if (editRow1 != undefined) {
                    instrArcimWardListDataGrid.datagrid("endEdit", editRow1);
                    return;
                }else{
	                 //添加时如果没有正在编辑的行，则在datagrid的第一行插入一行
                    instrArcimWardListDataGrid.datagrid("insertRow", {
                        index: 0,
                        // index start with 0
                        row: {

						}
                    });
                    //将新插入的那一行开户编辑状态
                    instrArcimWardListDataGrid.datagrid("beginEdit", 0);
                    //cureItemDataGrid.datagrid('addEditor',LocDescEdit);
                    //给当前编辑的行赋值
                    editRow1 = 0;
                    AddeditRow1=0;
                    
                    var editors = instrArcimWardListDataGrid.datagrid('getEditors', editRow1);
                    editors[4].target.val(1)
                    editors[5].target.val(1)
                }
              
            }
        },{
            text: $g('删除'),
            iconCls: 'icon-cancel',
            handler: function() {
	            var rows2 = instrArcimWardListDataGrid.datagrid("getSelections");
				var SelInfo=GetTabsSelect();
				var SelName=SelInfo.split("^")[0];
				var SelID=SelInfo.split("^")[1];
				if ((SelID!="")&&(SelName!="")&&(rows2.length>0)){
					$.messager.confirm('确认对话框', '您想要删除吗？', function(r){
						if (r){
						    var ids = [];
                            for (var i = 0; i < rows2.length; i++) {
                                ids.push(rows2[i].Index);
                            }
                            var Index=ids.join(',')
                            if (Index==""){
	                            editRow1 = undefined;
								AddeditRow1= undefined;
				                instrArcimWardListDataGrid.datagrid("rejectChanges");
				                instrArcimWardListDataGrid.datagrid("unselectAll");
				                return false;
	                        }
	                        $.cm({
								ClassName:"DHCDoc.DHCDocConfig.InstrArcim",
								MethodName:"DeleteArcimWardList",
								Index:Index,
								LocId:session['LOGON.CTLOCID'],
								UserID:session['LOGON.USERID'],
								dataType:"text"
							},function(value){
								if(value=="0"){
									LoadArcimWardList();
									instrArcimWardListDataGrid.datagrid("unselectAll");
								}else{
									$.messager.alert('提示',"删除失败:"+value);
								}
								editRow1 = undefined;
								AddeditRow1= undefined;
							});
						}
					});
				} else {
				    if (rows2.length>0){
						var ids = [];
                        for (var i = 0; i < rows2.length; i++) {
                            ids.push(rows2[i].Index);
                        }
                        var Index=ids.join(',')
                        if (Index==""){
                            editRow1 = undefined;
							AddeditRow1= undefined;
			                instrArcimWardListDataGrid.datagrid("rejectChanges");
			                instrArcimWardListDataGrid.datagrid("unselectAll");
			                return false;
                        }
					}
                	$.messager.alert("提示", "请选择要删除的行", "error");
				}
	         
            }
        },{
            text: $g('保存'),
            iconCls: 'icon-save',
            handler: function() {
				var SelInfo=GetTabsSelect();
				var SelName=SelInfo.split("^")[0];
				var SelID=SelInfo.split("^")[1];
				if ((SelID!="")&&(SelName!="")){
	                if (editRow1 != undefined){
	                	var editors = instrArcimWardListDataGrid.datagrid('getEditors', editRow1);  
	                	var ArcimSelRow=instrArcimWardListDataGrid.datagrid("selectRow",editRow1).datagrid("getSelected"); 
						var InstrArcimId=ArcimSelRow["InstrArcimId"];
						if ((InstrArcimId=="")||(InstrArcimId==undefined)){
							$.messager.alert("提示","请选择医嘱项!");
	                        return false;
						}
						if (InstrArcimId.indexOf("&")!=-1){
							//var selInstrRowID=InstrArcimId.split("&")[0];
							var curEditRow=editRow1
							var ArcimId=InstrArcimId.split("&")[1];
						}else{
							var curEditRow="";
							var ArcimId=InstrArcimId;
						}
						if (AddeditRow1==0){
							var curEditRow="";
						}
						if ((ArcimId=="")||(ArcimId==undefined)){
							$.messager.alert("提示","请选择医嘱项!");
	                        return false;
						}
						//绑定途径
						var AppendType=editors[1].target.combobox('getValue');
						//绑定方式
						var ExecType=editors[2].target.combobox('getValue');
						//启用
						var Active=editors[3].target.is(":checked");
						if (Active){Active="Y";}else{Active="N";}
						//起收数量
						var additionalNum=editors[4].target.val();
						//if (additionalNum==""){additionalNum=0}
						//起收数量
						var EndNum=editors[5].target.val();
						//数量
						var Qty=editors[6].target.val();
						if (Qty==""){Qty=0}
						//手工绑定
						var ByHand=editors[7].target.combobox('getValue');
						var SingleNotFee=editors[8].target.is(":checked");
						if (SingleNotFee){SingleNotFee="Y";}else{SingleNotFee="N";}
						if (ByHand==""){
							$.messager.alert("提示","请选择绑定类型!");
	                        return false;
						}
						if (AppendType==""){
							$.messager.alert("提示","请选择绑定途径!");
	                        return false;
						}
						if (ExecType==""){
							$.messager.alert("提示","请选择绑定方式!");
	                        return false;
						}
						if ((AppendType=="1")&&(additionalNum>0)){
							$.messager.alert("提示","下医嘱绑定时仅支持起收数量0");
	                        return false;
						}
						if ((AppendType=="1")&&(EndNum>0)){
							$.messager.alert("提示","下医嘱绑定时仅支持截止数量0");
	                        return false;
						}
						if ((AppendType=="1")&&(ExecType=="3")){
							$.messager.alert("提示","绑定途径是下医嘱绑定时,绑定方式不支持按最大频次");
	                        return false;
						}
						
						if (($.isNumeric(Qty)==false)||(Qty<=0)){
							$.messager.alert("提示","数量必须为有效数字!");
	                        return false;
						}
						if ((AppendType=="2")&&(ExecType!="1")&&(ExecType!="3")&&(ByHand!="2")){
							if (AppendType!="1"){
								if (($.isNumeric(additionalNum)==false)||(additionalNum<=0)){
									$.messager.alert("提示","起收数量必须为有效数字!");
			                        return false;
								}
							}
						}
						if (EndNum!=""){
							if (($.isNumeric(EndNum)==false)||(EndNum<=0)){
								$.messager.alert("提示","截止数量必须为有效数字!");
		                        return false;
							}
							if (EndNum<additionalNum) {
								$.messager.alert("提示","截止数量必须大于等于起始数量!");
		                        return false;
							}
							
						}
						if (ByHand=="2"){
							additionalNum="";
							EndNum="";
						}
						var LocId=session['LOGON.CTLOCID'];
						var ageFrom=editors[9].target.val();
		                if (ageFrom !="") {
			                if ((!$.isNumeric(ageFrom))||(ageFrom<0)){
								$.messager.alert("提示","开始年龄不是有效数字!");
		                        return false;
							}
			            }
		                var ageTo=editors[10].target.val();
		                if (ageTo !="") {
			                if ((!$.isNumeric(ageTo))||(ageTo<0)){
								$.messager.alert("提示","截止年龄年龄不是有效数字!");
		                        return false;
							}
			            }
			            //除最大频次以外加收费
			            var InstrAddArcimId=ArcimSelRow["InstrAddArcimId"];
			            if (!InstrAddArcimId) {
				            InstrAddArcimId="";
			            } else {
				            if (InstrAddArcimId.indexOf("&") != -1){
								InstrAddArcimId = InstrAddArcimId.split("&")[1];
							}else{
								InstrAddArcimId = InstrAddArcimId;
							}
			            }
			            //加收数量
						var AddQty=editors[12].target.val();
						if ((ExecType =="3")&&(AppendType =="2")) {
							if (((AddQty!="")&&((!$.isNumeric(AddQty))||(AddQty<=0)))||((InstrAddArcimId!="")&&(AddQty==""))){
								$.messager.alert("提示","加收数量不是有效数字!");
		                        return false;
							}
						}
				        if ((InstrAddArcimId!="")&&((ExecType!="3")||(AppendType!=2))){
					    	$.messager.alert("提示","加收费仅在执行绑定下，绑定方式为按最大频次时有效!");
		                    return false;  
					    }
				        //与本配置的用法列表\\医嘱列表绑定的医嘱重复带出
						var IsRepeatAppend=editors[13].target.is(":checked");
						if (IsRepeatAppend){IsRepeatAppend="Y";}else{IsRepeatAppend="N";}
				        
						var SaveInfo=LocId+"^"+ArcimId+"^"+AppendType+"^"+ExecType+"^"+Active
						var SaveInfo=SaveInfo+"^"+additionalNum+"^"+Qty+"^"+EndNum+"^"+ByHand+"^"+SingleNotFee
						var SaveInfo=SaveInfo+"^"+ageFrom+"^"+ageTo+"^"+InstrAddArcimId+"^"+AddQty+"^"+IsRepeatAppend;
	                	var Index=ArcimSelRow.Index;
	                	if (typeof Index =="undefined"){
		                	Index="";
		                }
		                
		                $.cm({
							ClassName:"DHCDoc.DHCDocConfig.InstrArcim",
							MethodName:"SaveArcimWardList",
							SaveQueryName:SelName, SaveQueryID:SelID, SaveInfo:SaveInfo, Index:Index,
							UserID:session['LOGON.USERID'],
							dataType:"text"
						},function(value){
							if(value=="0"){
	                			editRow1 = undefined;
								LoadArcimWardList();
								instrArcimWardListDataGrid.datagrid("unselectAll");
							}else{
								if (value=="-201"){
									$.messager.alert('提示',"保存失败,记录重复!");
								}else{
									$.messager.alert('提示',"保存失败:"+value);
								}
								return false;
							}
							editRow1 = undefined;
							AddeditRow1=undefined;
						});
					}
					
	             }else{
		            $.messager.alert("提示", "请选择一个左侧需要维护的数据", "error"); 
		         }
            }
        },'-',{
	       text: $g('例外的医嘱类型（按绑定项目维护）'),
            iconCls: 'icon-edit',
            handler: function() {
                ExcludePrior();
            } 
	    },'-',{
	       text: $g('例外的医嘱项(按用法维护)'),
            iconCls: 'icon-edit',
            handler: function() {
                ExcludeItemByInstr();
            } 
	    }];
	instrArcimWardListDataGrid=$('#tabArcimWardList').datagrid({  
		fit : true,
		width : 'auto',
		border : false,
		striped : true,
		singleSelect : true,
		fitColumns : false,
		autoRowHeight : false,
		url : './dhcdoc.config.query.grid.easyui.csp',
		loadMsg : $g('加载中..'),  
		pagination : true,  //
		rownumbers : true,  //
		idField:"Index",
		pageSize: 15,
		pageList : [15,50,100,200],
		columns :instrArcimWardListColumns,
		toolbar :instrArcimWardListToolBar,
		onClickRow : function(rowIndex, rowData) {
			//LoadArcimWardList();
		},onDblClickRow:function(rowIndex, rowData){
            if (editRow1 != undefined) {
				$.messager.alert("提示", "有正在编辑的行，请先点击保存", "error");
		        return false;
			}
			instrArcimWardListDataGrid.datagrid("beginEdit", rowIndex);
			editRow1=rowIndex;
			var AppendTypeObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'AppendType'});
			var AppendType=$(AppendTypeObj.target).combobox('getValue');
			var ExecTypeObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'ExecType'});
			var ByHandObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:editRow1,field:'ByHand'});
			var ByHand=$(ByHandObj.target).combobox('getValue');
			var additionalNumObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:rowIndex,field:'additionalNum'});
			var EndNumObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:rowIndex,field:'EndNum'});
			var SingleNotFeeObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:rowIndex,field:'SingleNotFee'});
			var ARCIMAddDescObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:rowIndex,field:'ARCIMAddDesc'});
			var AddQtyObj=instrArcimWardListDataGrid.datagrid('getEditor', {index:rowIndex,field:'AddQty'});
			if (AppendType=="1"){
				additionalNumObj.target[0].value="";
				additionalNumObj.target[0].disabled=true;
				EndNumObj.target[0].value="";
				EndNumObj.target[0].disabled=true;
			}else{
				if (ByHand=="2"){
					additionalNumObj.target[0].value="";
					additionalNumObj.target[0].disabled=true;
					EndNumObj.target[0].value="";
					EndNumObj.target[0].disabled=true;
					$(SingleNotFeeObj.target).checkbox("uncheck").checkbox("disable");
				}else{
					if (rowData.ExecType=="2"){
						additionalNumObj.target[0].disabled=false;
						EndNumObj.target[0].disabled=false;
					}else{
						additionalNumObj.target[0].value="";
						additionalNumObj.target[0].disabled=true;
						EndNumObj.target[0].value="";
						EndNumObj.target[0].disabled=true;
					}
					$(SingleNotFeeObj.target).checkbox("enable");
				}
			}
			if (ByHand=="2"){
				var data=[{"code":"10","desc":$g("首次")},{"code":"11","desc":$g("接瓶")}];
				$(ExecTypeObj.target).combobox("loadData", data);
			}
			if ((rowData.ExecType !="3")||(AppendType !="2")) {
				$(ARCIMAddDescObj.target).combogrid("clear").combogrid("disable");
				AddQtyObj.target[0].disabled=true;
			}else{
				$(ARCIMAddDescObj.target).combogrid("enable");
			    AddQtyObj.target[0].disabled=false;
			}
	    },onBeforeLoad:function(para){
		    editRow1 = undefined;
            $('#tabArcimWardList').datagrid("rejectChanges");
            $('#tabArcimWardList').datagrid("unselectAll");
			var SelInfo=GetTabsSelect();
			if (SelInfo.split("^")[0]=="Arcim"){
            	$('#tabArcimWardList').datagrid('setColumnTitle', {'IsRepeatAppend':$g("与本配置的用法列表绑定的医嘱一起带出")});
            	
            }else{
	           $('#tabArcimWardList').datagrid('setColumnTitle', {'IsRepeatAppend':$g("与本配置的医嘱列表绑定的医嘱一起带出")});
	        }
		}
	});
}
function AppendedInstrCheckChange(event,value){
	searchInstrItem($("#searchInstrItem").searchbox('getValue'),value?'on':'');
}
function AppendedArcimCheckChange(event,value){
	LoadItemListDataGrid($("#searchArcimItem").searchbox('getValue'),value?'on':'');
	LoadArcimWardList();
}
function searchInstrItem(value,name){
	instrDataGrid.datagrid("unselectAll");
	loadInstrDataGrid(value,$("#AppendedInstr").checkbox('getValue')?'on':'');
	//LoadArcimWardList();
}
function InitInstrList(){
	///用法列表columns
    var instrColumns=[[    
		{ field: 'InstrDesc', title: $g('用法名称'), width: 100, sortable: true, resizable: true},
		{ field: 'InstrRowID', title: $g('用法ID'), width: 100, align: 'center', sortable: true, resizable: true,hidden:true}
	 ]];
     // 用法列表Grid
	instrDataGrid=$('#tabInstrList').datagrid({  
		fit : true,
		width : 'auto', //$(window).height()-
		border : false,
		singleSelect : true,
		fitColumns : true,
		autoRowHeight : false,
		remoteSort:false,
		sortable:true,
		//multiSort : true,
		//url : PUBLIC_CONSTANT.URL.QUERY_GRID_URL,
		loadMsg : $g('加载中..'),  
		pagination : true,  //
		rownumbers : true,  //
		idField:"InstrRowID",
		pageSize: 15,
		pageList : [15,50,100,200],
		//frozenColumns : FrozenCateColumns,
		columns :instrColumns,
		onClickRow:function(rowIndex, rowData){
			arcimDataGrid.datagrid('unselectAll');
			LoadArcimWardList();
			LoadOtherInfo();
		},onUnselect:function(rowIndex, rowData){
			//instrDataGrid.datagrid('unselectRow',rowIndex);
			//LoadArcimWardList();
			var SelInfo=GetTabsSelect();
			var SelName=SelInfo.split("^")[0];
			var SelID=SelInfo.split("^")[1];
			var queryParams = new Object();
			queryParams.ClassName ='DHCDoc.DHCDocConfig.InstrArcim';
			queryParams.QueryName ='FindArcimWardLink';
			queryParams.Arg1 =session['LOGON.CTLOCID'];
			queryParams.Arg2 =SelName;
			queryParams.Arg3 ="";
			queryParams.ArgCnt =3;
			var opts = instrArcimWardListDataGrid.datagrid("options");
			opts.url = "./dhcdoc.config.query.grid.easyui.csp";
			instrArcimWardListDataGrid.datagrid('load', queryParams);
			editRow1 = undefined;
		}
		
	});
	loadInstrDataGrid("","");
}
function loadInstrDataGrid(value,AppendedInstr){
	$.cm({
	    ClassName : "DHCDoc.DHCDocConfig.InstrArcim",
	    QueryName : "FindInstr",
	    InstrAlias:value,
	    AppendedInstrFlag:AppendedInstr,
	    LogonWard:session['LOGON.WARDID'],
	    Pagerows:instrDataGrid.datagrid("options").pageSize,
	    rows:99999
	},function(GridData){
		instrDataGrid.datagrid({loadFilter:DocToolsHUI.lib.pagerFilter}).datagrid('loadData',GridData);
	});
}
function searchArcimItem(value,name){
	arcimDataGrid.datagrid('loadData', {"total":0,"rows":[]});
	LoadItemListDataGrid(value,$("#AppendedArcim").checkbox('getValue')?'on':'');
	LoadArcimWardList();
}
function InitArcimList(){
	 var ArcimColumns=[[    
		{ field: 'ArcimRowID', title: 'ID', width: 90}, 
		{ field: 'ArcimDesc', title: $g('项目名称'), width: 240}
	 ]];
	arcimDataGrid=$('#tabArcimList').datagrid({  
		fit : true,
		width : 'auto',
		border : false,
		striped : true,
		singleSelect : true,
		fitColumns : false,
		autoRowHeight : false,
		loadMsg : $g('加载中..'),  
		pagination : true,  //
		rownumbers : true,  //
		idField:"ArcimRowID",
		pageSize: 15,
		pageList : [15,50,100,200],
		columns :ArcimColumns,
		onClickRow:function(rowIndex, rowData){
			instrDataGrid.datagrid('unselectAll');
			LoadArcimWardList();
			LoadOtherInfo();
		}
	});
	arcimDataGrid.datagrid('loadData', {"total":0,"rows":[]});
}
function LoadItemListDataGrid(param,AppendedArcim)
{
	$.cm({
	    ClassName : "DHCDoc.DHCDocConfig.ArcItemConfig",
	    QueryName : "FindAllItem",
	    Alias:param,
	    AppendedArcimFlag:AppendedArcim,
	    LogonWard:session['LOGON.WARDID'],
		GroupID:String.fromCharCode(1),
	    Pagerows:arcimDataGrid.datagrid("options").pageSize,
	    page:arcimDataGrid.datagrid("options").pageNumber,
	    rows:99999
	},function(GridData){
		arcimDataGrid.datagrid({loadFilter:DocToolsHUI.lib.pagerFilter}).datagrid('loadData',GridData);
	});
};
function LoadItemData(q,obj1){
	var val = q //$('#Combo_Arcim').combogrid('getValue'); 
    var queryParams = new Object();
	queryParams.ClassName ='DHCDoc.DHCDocConfig.ArcItemConfig';
	queryParams.QueryName ='FindAllItem';
	queryParams.Arg1 =val;
	queryParams.ArgCnt =1;
	var opts = obj1.combogrid("grid").datagrid("options");
	opts.url = PUBLIC_CONSTANT.URL.QUERY_GRID_URL;
	obj1.combogrid("grid").datagrid('load', queryParams);
};	

function LoadArcimWardList(){
	var SelInfo=GetTabsSelect();
	var SelName=SelInfo.split("^")[0];
	var SelID=SelInfo.split("^")[1];
	var queryParams = new Object();
	queryParams.ClassName ='DHCDoc.DHCDocConfig.InstrArcim';
	queryParams.QueryName ='FindArcimWardLink';
	queryParams.Arg1 =session['LOGON.CTLOCID'];
	queryParams.Arg2 =SelName;
	queryParams.Arg3 =SelID;
	queryParams.ArgCnt =3;
	var opts = instrArcimWardListDataGrid.datagrid("options");
	opts.url = "./dhcdoc.config.query.grid.easyui.csp";
	instrArcimWardListDataGrid.datagrid('load', queryParams);
	editRow1 = undefined;
	
	/*var SelInfo=GetTabsSelect();
	var SelName=SelInfo.split("^")[0];
	var SelID=SelInfo.split("^")[1];
	$.cm({
	    ClassName : "DHCDoc.DHCDocConfig.InstrArcim",
	    QueryName : "FindArcimWardLink",
	    LocId:session['LOGON.CTLOCID'], queryName:SelName, QueryID:SelID,
	    Pagerows:instrArcimWardListDataGrid.datagrid("options").pageSize,
	    rows:99999
	},function(GridData){
		instrArcimWardListDataGrid.datagrid({loadFilter:DocToolsHUI.lib.pagerFilter}).datagrid('loadData',GridData);
		editRow1 = undefined;
	});*/
}
function LoadOtherInfo(){
	var SelInfo=GetTabsSelect();
	var SelName=SelInfo.split("^")[0];
	var SelID=SelInfo.split("^")[1];
	$.cm({
	    ClassName:"DHCDoc.DHCDocConfig.InstrArcim",
	    MethodName:"GetArcimWardLinkExpInfo",
	    LocId:session['LOGON.CTLOCID'],
		queryName:SelName,
		QueryID:SelID,
		dataType:"text"
	},function(Data){
		var Arr=Data.split("^");
		/*
		var SingleNotFee=Arr[0];
		if (SingleNotFee=="1"){
			$("#SingleNotFee").checkbox('check');
		}else{
			$("#SingleNotFee").checkbox('uncheck');
		}
		*/
	});
}
function GetTabsSelect(){
	var SelTab=$('#tabs').tabs('getSelected');
	var index = $('#tabs').tabs('getTabIndex',SelTab);
	var SelID="";
	var Sel=""
	if (index==0){
		Sel="Instr";
		var rows = instrDataGrid.datagrid("getSelections");
		if (rows && rows.length > 0){ 
			var ids = [];
			for (var i = 0; i < rows.length; i++) {
				ids.push(rows[i].InstrRowID);
			}
			SelID=ids.join(',');
		}
	}else if (index==1){
		Sel="Arcim";
		var rows = arcimDataGrid.datagrid("getSelections");
		if (rows && rows.length > 0){ 
			var ids = [];
			for (var i = 0; i < rows.length; i++) {
				ids.push(rows[i].ArcimRowID);
			}
			SelID=ids.join(',');
		}
	}
	return Sel+"^"+SelID
	
}

function ExcludePrior(){
	var rows2 = instrArcimWardListDataGrid.datagrid("getSelections");
	var SelInfo=GetTabsSelect();
	var SelName=SelInfo.split("^")[0];
	var SelID=SelInfo.split("^")[1];
	var ids = [];
    for (var i = 0; i < rows2.length; i++) {
        ids.push(rows2[i].Index);
    }
    var Index=ids.join(',');
    if (!Index) {
		return false;
	}
	if ((SelID=="")||(SelName=="")||(rows2.length==0)){
    	$.messager.alert("提示", "请选择需要编辑的行", "error");
		return false;	
    }
    $("#dialog-priorSelect").css("display", ""); 
	dialog1 = $("#dialog-priorSelect" ).dialog({
      autoOpen: false,
      iconCls:'icon-w-paper',
      height: 405,
      width: 270,
      modal: true
    });
	dialog1.dialog( "open" );
	$("#List_Prior").html(""); 
	$.cm({
		ClassName:"DHCDoc.DHCDocConfig.InstrArcim",
		QueryName:"FindInstrArcimBPrior",
		LocId:session['LOGON.CTLOCID'], Index:Index,
		rows:99999
	},function(objScope){
	   var vlist = ""; 
	   var selectlist="";
	   jQuery.each(objScope.rows, function(i, n) { 
			selectlist=selectlist+"^"+n.selected
			vlist += "<option value=" + n.OECPRRowId + ">" + n.OECPRDesc + "</option>"; 
	   });
	   $("#List_Prior").append(vlist); 
	   for (var j=1;j<=selectlist.split("^").length;j++){
			if(selectlist.split("^")[j]=="true"){
				$("#List_Prior").get(0).options[j-1].selected = true;
			}
		}
	});
}
/// 添加例外的医嘱项目(按用法维护)
function ExcludeItemByInstr(){
	var SelInfo=GetTabsSelect();
	var SelName=SelInfo.split("^")[0];
	var SelID=SelInfo.split("^")[1];
	if ((SelName!="Instr")||(SelID=="")){
		$.messager.alert("提示", "请选择需要维护的用法", "error");
		return false;	
	}
	var HospID=session['LOGON.HOSPID'];
	var ExcludeItemList=$.cm({
	    ClassName:"web.DHCDocConfig",
	    MethodName:"GetConfigNode3",
	    Node:"WardInstrArcim",
		SubNode1:"ExcludeItem_"+SelID,
		SubNode2:"WardId_"+session['LOGON.WARDID'],
		HospId:session['LOGON.HOSPID'],
		dataType:"text"
	},false);
	websys_showModal({
		url:"dhcdoc.util.tablelist.csp?TableName=ARC_ItmMast&IDList="+ExcludeItemList+"&HospDr="+HospID+"&DisplayType=Search",
		title:' 例外的医嘱项选择',
		width:400,height:610,
		closable:false,
		CallBackFunc:function(result){
			websys_showModal("close");
			if ((typeof result==="undefined")||(result===false)){
				return;
			}
			var rtn=$.cm({
				ClassName:"web.DHCDocConfig",
				MethodName:"SetConfigNode3",
				Node:"WardInstrArcim",
				SubNode1:"ExcludeItem_"+SelID,
				SubNode2:"WardId_"+session['LOGON.WARDID'],
				HospId:session['LOGON.HOSPID'],
				Value:result,
				dataType:"text"
			},false);
			$.messager.show({title:"提示",msg:"更新成功"});
		}
	})
}
function SingleNotFeeChange(e,value){
	setTimeout(function(){
		var SelInfo=GetTabsSelect();
		var SelName=SelInfo.split("^")[0];
		var SelID=SelInfo.split("^")[1];
		if ((SelID!="")&&(SelName!="")){
			var SingleNotFee=0
			if ($("#SingleNotFee").checkbox("getValue")) {
				SingleNotFee=1
			};
			var SaveInfo=SingleNotFee;
			$.m({
				ClassName:"DHCDoc.DHCDocConfig.InstrArcim",
				MethodName:"SaveArcimWardLinkExpInfo",
				LocId:session['LOGON.CTLOCID'],
				queryName:SelName,
				QueryID:SelID,
				SaveInfo:SaveInfo
			},function(Data){
				//if (Data==0) $.messager.alert('提示',"保存成功!");
			});
        }else{
            $.messager.alert("提示", "请选择一个左侧需要维护的数据", "error"); 
        }
	});
}
function SaveExcludePriorSelect(){
	var rows2 = instrArcimWardListDataGrid.datagrid("getSelections");
	var SelInfo=GetTabsSelect();
	var SelName=SelInfo.split("^")[0];
	var SelID=SelInfo.split("^")[1];
	var ids = [];
	for (var i = 0; i < rows2.length; i++) {
	    ids.push(rows2[i].Index);
	}
	var Index=ids.join(',')
	if ((SelID=="")||(SelName=="")||(rows2.length==0)){
		$.messager.alert("提示", "请选择需要编辑的行", "error");
		return false;	
	}
	var PriorIDStr="";
	var size = $("#List_Prior"+ " option").size();
	if(size>0){
		$.each($("#List_Prior"+" option:selected"), function(i,own){
	      var svalue = $(own).val();
		  if (PriorIDStr=="") PriorIDStr=svalue;
		  else PriorIDStr=PriorIDStr+"^"+svalue;
		})
	}
	$.cm({
		ClassName:"DHCDoc.DHCDocConfig.InstrArcim",
		MethodName:"SaveInstrArcimBPrior",
		Index:Index, PriorStr:PriorIDStr,
		LocId:session['LOGON.CTLOCID'],
		UserID:session['LOGON.USERID'],
		dataType:"text"
	},function(value){
		if(value=="0"){
			$.messager.show({title:"提示",msg:"保存成功"});	
	        dialog1.dialog( "close" );							
		}
	});	   
}

</script>	

</body>
</html>