<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
  i ##Class(websys.SessionEvents).SessionExpired() q 1
</csp:method>

<script language="cache" runat="server">
 //
 s codename="",action="",id=""
 s codename=$g(%request.Data("codename",1))
 s action=$g(%request.Data("action",1))
 s id=$g(%request.Data("id",1))

 s code=$g(%request.Data("code",1))
 s desc=$g(%request.Data("desc",1))


 i action="" d
 .//
 .i codename="sex" w ##class(CHSS.CTSex).GetJsonData()
 .//write data
 . i codename="nation" w ##class(CHSS.CTNation).GetJsonData()
 . //
 . i codename="occupation" w ##class(CHSS.CTOccupation).GetJsonData()
 . //
 . i codename="education" w ##class(CHSS.CTEducation).GetJsonData()
 . //
 . i codename="marital" w ##class(CHSS.CTMarital).GetJsonData()
 . //
 . i codename="relation" w ##class(CHSS.CTRelation).GetJsonData()
 . //
 . i codename="bloodtype" w ##class(CHSS.PACBloodType).GetJsonData()
 . //
 . i codename="DiagnosType" w ##class(CHSS.MRCDiagnosType).GetJsonData()
 . //
 . i codename="AdmReason" w ##class(CHSS.PACAdmReason).GetJsonData()
 . //
 . i codename="paymode" w ##class(CHSS.CTPayMode).GetJsonData()
 . //
 . i codename="country" w ##class(CHSS.CTCountry).GetJsonData()
 . //
 . i codename="cardtype" w ##class(CHSS.PACCardType).GetJsonData()
 . //
 . i codename="SocialStatus" w ##class(CHSS.CTSocialStatus).GetJsonData()
 . 
 . 
 e  d
 .i (action="Upd") d
 . . i id'="" d  //id'=""时,执行更新操作
 . . . 
 .. . i codename="gridsex" s ret=##class(CHSS.CTSex).Upd(id,code,desc)
 .. . //write data
 . . . i codename="gridnation" s ret=##class(CHSS.CTNation).Upd(id,code,desc)
 . . . //
 . . . i codename="gridoccupation" s ret=##class(CHSS.CTOccupation).Upd(id,code,desc)
 . . . //
 . . . i codename="grideducation" s ret=##class(CHSS.CTEducation).Upd(id,code,desc)
 . . . //
 . . . i codename="gridmarital" s ret=##class(CHSS.CTMarital).Upd(id,code,desc)
 . . . //
 . . . i codename="gridrelation" s ret=##class(CHSS.CTRelation).Upd(id,code,desc)
 . . . //
 . . . i codename="gridbloodtype" s ret=##class(CHSS.PACBloodType).Upd(id,code,desc)
 . . . //
 . . . i codename="gridDiagnosType" s ret=##class(CHSS.MRCDiagnosType).Upd(id,code,desc)
 . . . //
 . . . i codename="gridAdmReason" d
 . . . .s DateFrom=$g(%request.Data("datefrom",1))
 . . . .s DateTo=$g(%request.Data("dateto",1))
 . . . .s NationalCode=$g(%request.Data("nationalcode",1))
 . . . .s AgeFrom=$g(%request.Data("agefrom",1))
 . . . .s AgeTo=$g(%request.Data("ageto",1))
 . . . .s AgeType=$g(%request.Data("agetype",1))
 . . . .s datas=NationalCode_"^"_DateFrom_"^"_DateTo_"^"_AgeFrom_"^"_AgeTo_"^"_AgeType
 . . . .
 . . . .s ret=##class(CHSS.PACAdmReason).Upd(id,code,desc,datas)
 . . . .
 . . . //
 . . . i codename="gridpaymode" d
 . . . .s otherdata=$g(%request.Data("grpcode",1))
 . . . .s grpcode=$P(otherdata,"^",1)
 . . . .s ret=##class(CHSS.CTPayMode).Upd(id,code,desc,grpcode)
 . . . .
 . . . //
 . . . i codename="gridcountry" s ret=##class(CHSS.CTCountry).Upd(id,code,desc)
 . . . //
 . . . i codename="gridcardtype" s ret=##class(CHSS.PACCardType).Upd(id,code,desc)
 . . . //
 . . . i codename="gridSocialStatus" s ret=##class(CHSS.CTSocialStatus).Upd(id,code,desc)
 . . .
 . . . i ret=0 w "{success:'true',info:''}"
 . . . e  w "{success:'false',info:'"_ret_"'}"
 . . .
 . . e  d
 . . .
 . . . //id="",执行插入操作
 . . . //
 .. . i codename="gridsex" s ret=##class(CHSS.CTSex).Ins(code,desc)
 .. . //write data
 . . . i codename="gridnation" s ret=##class(CHSS.CTNation).Ins(code,desc)
 . . . //
 . . . i codename="gridoccupation" s ret=##class(CHSS.CTOccupation).Ins(code,desc)
 . . . //
 . . . i codename="grideducation" s ret=##class(CHSS.CTEducation).Ins(code,desc)
 . . . //
 . . . i codename="gridmarital" s ret=##class(CHSS.CTMarital).Ins(code,desc)
 . . . //
 . . . i codename="gridrelation" s ret=##class(CHSS.CTRelation).Ins(code,desc)
 . . . //
 . . . i codename="gridbloodtype" s ret=##class(CHSS.PACBloodType).Ins(code,desc)
 . . . //
 . . . i codename="gridDiagnosType" s ret=##class(CHSS.MRCDiagnosType).Ins(code,desc)
 . . . //
 . . . i codename="gridAdmReason" d
 . . . .
 . . . .s DateFrom=$g(%request.Data("datefrom",1))
 . . . .s DateTo=$g(%request.Data("dateto",1))
 . . . .s NationalCode=$g(%request.Data("nationalcode",1))
 . . . .s AgeFrom=$g(%request.Data("agefrom",1))
 . . . .s AgeTo=$g(%request.Data("ageto",1))
 . . . .s AgeType=$g(%request.Data("agetype",1))
 . . . .s datas=NationalCode_"^"_DateFrom_"^"_DateTo_"^"_AgeFrom_"^"_AgeTo_"^"_AgeType
 . . . .s ret=##class(CHSS.PACAdmReason).Ins(code,desc,datas)
 . . . //
 . . . i codename="gridpaymode" d
 . . . .s grpcode=$g(%request.Data("grpcode",1))
 . . . .s ret=##class(CHSS.CTPayMode).Ins(code,desc,grpcode)
 . . . .
 . . . //
 . . . i codename="gridcountry" s ret=##class(CHSS.CTCountry).Ins(code,desc)
 . . . //
 . . . i codename="gridcardtype" s ret=##class(CHSS.PACCardType).Ins(code,desc), ^TMP("zhwh")=$g(^TMP("zhwh"))+1
 . . . //
 . . . i codename="gridSocialStatus" s ret=##class(CHSS.CTSocialStatus).Ins(code,desc)
 . . . 
 . . . i ret=0 w "{success:'true',info:''}"
 . . . e  w "{success:'false',info:'"_ret_"'}"
 . . . 
 . i (action="Del") d
 .. s ret=0
 .. //s ^TMP("df")=action_"^"_codename_"^"_id
 .. i codename="gridsex" s ret=##class(CHSS.CTSex).Del(id)
 .. //write data
 . . i codename="gridnation" s ret=##class(CHSS.CTNation).Del(id)
 . . //
 . . i codename="gridoccupation" s ret=##class(CHSS.CTOccupation).Del(id)
 . . //
 . . i codename="grideducation" s ret=##class(CHSS.CTEducation).Del(id)
 . . //
 . . i codename="gridmarital" s ret=##class(CHSS.CTMarital).Del(id)
 . . //
 . . i codename="gridrelation" s ret=##class(CHSS.CTRelation).Del(id)
 . . //
 . . i codename="gridbloodtype" s ret=##class(CHSS.PACBloodType).Del(id)
 . . //
 . . i codename="gridDiagnosType" s ret=##class(CHSS.MRCDiagnosType).Del(id)
 . . //
 . . i codename="gridAdmReason" s ret=##class(CHSS.PACAdmReason).Del(id)
 . . //
 . . i codename="gridpaymode" s ret=##class(CHSS.CTPayMode).Del(id)
 . . //
 . . i codename="gridcountry" s ret=##class(CHSS.CTCountry).Del(id)
 . . //
 . . i codename="gridcardtype" s ret=##class(CHSS.PACCardType).Del(id)
 . . //
 . . i codename="gridSocialStatus" s ret=##class(CHSS.CTSocialStatus).Del(id)
 . . //
 . .
 . .
 . . i ret=0 w "{success:'true',info:''}"
 . . e  w "{success:'false',info:'"_ret_"'}"

</script>

