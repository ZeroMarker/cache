<csp:content charset="gb2312">
<csp:content charset="UTF-8">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	s action=$g(%request.Data("action",1))
	s start=$g(%request.Data("start",1))
	s pageSize = $g(%request.Data("limit",1))
	s onePage=$g(%request.Data("onePage",1))
	i +start=0 s start=1
	i +pageSize=0 s pageSize=20
	s:start>1 start=start+1
	s end=start+pageSize-1
	s deli="&"
	if "getRptLinkKpi"=action {
		s rptCode=$g(%request.Data("RptCode",1))
		w "{data:"
		d ##class(DHCWL.ComplexRptData.RptKpiPoolService).GetKpiByRptCode(rptCode)
		w ",success:true,tip:'ok'}"	
		q
	}elseif "getMkpiByRptId"=action {
		s rptId=$g(%request.Data("RptId",1))
		s para="{start:"_start_",end:"_end_",jsonProDeli:&,}"
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.ComplexRptData.RptLinkKpiService:GetRptLinkKpi",para,rptId)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif "SaveLinkRptKpi"=action {
		s kpiPoolDr=$g(%request.Data("KpiPoolDr",1))
		s rptId=$g(%request.Data("RptId",1))
		s rs=##class(DHCWL.ComplexRptData.RptLinkKpiService).SaveRptLinkKpi(rptId,kpiPoolDr)
		i rs=0{
			w "{success:true,tip:'ok'}"
		}elseif (rs=2){
			w "{success:true,tip:'关联指标个数与报表统计内容个数不相等，不允许修改！'}"
		}else{
			w "{success:true,tip:'修改失败！'}"
		}
	}
	
</script>