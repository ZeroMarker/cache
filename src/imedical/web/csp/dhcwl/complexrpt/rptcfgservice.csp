<csp:content charset="gb2312">
<csp:content charset="UTF-8">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	s action=$g(%request.Data("action",1))
	if "getStatWLCombo"=action {
		;s rs=##class(DHCWL.ComplexRptData.SaveData).GetWLDataInit()
		s wlFilter=$g(%request.Data("wlFilter",1))
		d ##class(DHCWL.ComplexRptData.SaveData).GetObjsByClassName("User","DHCWorkLoad",wlFilter)

	}elseif "getStatDimCombo"=action {
		s dimDesc=$g(%request.Data("dimDesc",1))
		i dimDesc="" {
			s sql="select ID,KDT_Code,KDT_Name from DHCWL_MKPI.DHCWLMKPIDimType"
		}else{
			s sql="select ID,KDT_Code,KDT_Name from DHCWL_MKPI.DHCWLMKPIDimType where KDT_Name like '%"_dimDesc_"%'"
		}
		s rs=##class(%Library.ResultSet).%New()
		d rs.Prepare(sql)
		d rs.Execute()
		s deli=",",str="['',''],"
		While(rs.Next()){
			s str=str_"['"_rs.Data("ID")_"'"_deli_"'"_rs.Data("KDT_Name")_"'],"
		}
		d rs.Close()
		w "["_$e(str,1,$l(str)-1)_"]"
	}elseif "AddRptCfg"=action {
		s dim("Mode")=$g(%request.Data("rptMode",1))
		s dim("Content")=$g(%request.Data("rptContext",1))
		s dim("Row")=$g(%request.Data("rptRow",1))
		s dim("Col")=$g(%request.Data("rptCol",1))
		s dim("Filter")=$g(%request.Data("rptFilter",1))
		s rptCode=$g(%request.Data("rptCode",1))
		s rptId=##class(DHCWL.ComplexRptData.SaveData).GetRptDefidByCode(rptCode)
		i (rptId=""){
			w "{success:true,tip:'报表保存失败！'}"
			q
		}
		s dim("RptId")=rptId
		s rs=##class(DHCWL.ComplexRptData.RptCfgService).CreateKpiByRptId(.dim)
		i rs=2{
			w "{success:true,tip:'报表维度个数不能查过5个！'}"
		}elseif rs=0{
			w "{success:true,tip:'ok'}"
		}else{
			w "{success:true,tip:'报表保存失败！'}"
		}
		
	}
</script>