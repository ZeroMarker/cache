<csp:content charset="gb2312">
<csp:content charset="UTF-8">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	s action=$g(%request.Data("action",1))
	if "getStatWLCombo"=action {
		k PV
		s rs=##class(DHCWL.ComplexRptData.SaveData).GetWLDataInit()
		w rs

	}elseif "getStatDimCombo"=action {
		s sql="select KDT_Code,KDT_Name from DHCWL_MKPI.DHCWLMKPIDimType"
		s rs=##class(%Library.ResultSet).%New()
		d rs.Prepare(sql)
		d rs.Execute()
		s deli=",",str="" ;str="['',''],"
		While(rs.Next()){
			s str=str_"['"_rs.Data("KDT_Code")_"'"_deli_"'"_rs.Data("KDT_Name")_"'],"
		}
		d rs.Close()
		w "["_$e(str,1,$l(str)-1)_"]"  
	}elseif "AddRptCfg"=action {	
		s dim("CondStr")=$g(%request.Data("CondStr",1)) 
		s dim("Text")=$g(%request.Data("Text",1)) 
		s rs=##class(DHCWL.ComplexRptWLDetData.RptCfgServiceDet).CreateKpiByRptId(.dim)
		//s rs=##class(DHCWL.ComplexRptWLDetData.SaveData).AddRptDef(.dim)
		if rs=0{
			w "{success:true,tip:'ok'}"
		}else{
			w "{success:true,tip:'报表保存失败！'}"
		}
	}elseif "SaveRptCfg"=action {	
		s dim("RptName")=$g(%request.Data("RptName",1)) 
		s dim("CondStr")=$g(%request.Data("CondStr",1)) 
		s dim("Text")=$g(%request.Data("Text",1)) 
		s rs=##class(DHCWL.ComplexRptWLDetData.SaveData).AddRptDef(.dim)
		if rs=0{
			w "{success:true,tip:'ok'}"
		}else{
			//w "{success:true,tip:'报表保存失败！'}"
			w "{success:true,tip:'"_rs_"'}"
		}	
	}elseif action="DeleteRpt" {
		s rptName=$g(%request.Data("RptName",1))
		s result=##class(DHCWL.ComplexRptWLDetData.SaveData).DeleteRptCfg(rptName)
		w "{success:true,tip:'"_result_"'}"
	}elseif action="CreatBackgndData" { //  
		s rptName=$g(%request.Data("RptName",1))
		s startDate=$g(%request.Data("StartDate",1))
		s endDate=$g(%request.Data("EndDate",1))
		s rptCond=$g(%request.Data("RptCond",1))
		s result=##class(DHCWL.ComplexRptWLDetData.SaveData).CreatKindsPidData(rptName,startDate,endDate,rptCond)
		w "{success:true,tip:'"_result_"'}"
	}elseif action="SavePid" { //  
		s rptName=$g(%request.Data("RptName",1))
		s result=##class(DHCWL.ComplexRptWLDetData.SaveData).SavePid(rptName)
		w "{success:true,tip:'"_result_"'}"
	}elseif action="CreatTaskData" { //  
		s rptName=$g(%request.Data("RptName",1))
		s startDate=$g(%request.Data("StartDate",1))
		s endDate=$g(%request.Data("EndDate",1))
		s result=##class(DHCWL.ComplexRptWLDetData.SaveData).CreatTaskData(rptName,startDate,endDate)
		w "{success:true,tip:'"_result_"'}"
	}	
</script>