<csp:content charset="gb2312">
<csp:content charset="UTF-8">
<script language="cache" runat="server"> 
	s action = $Get(%request.Data("action",1))
	s type = $Get(%request.Data("type",1))
	if ("getList"=action){
		if ("root"=type){
			s kpiRuleStr = $Get(%request.Data("kpiRuleStr",1))
			d ##class(DHCWL.SysService.SetFilterService).InitKpiNode(kpiRuleStr,.json)	
		}elseif("kpi"=type){
			s kpiRuleStr = $Get(%request.Data("kpiRuleStr",1))
			s kpiCode = $Get(%request.Data("kpiCode",1))
			d ##class(DHCWL.SysService.SetFilterService).InitDimNode(kpiRuleStr,kpiCode,.json)
		}elseif("kpiDim"=type){
			s kpiRuleStr = $Get(%request.Data("kpiRuleStr",1))
			s kpiCode = $Get(%request.Data("kpiCode",1))
			s kpiDimCode = $Get(%request.Data("kpiDimCode",1))
			d ##class(DHCWL.SysService.SetFilterService).InitDimProNode(kpiRuleStr,kpiCode,kpiDimCode,.json)
		}elseif("secDim"=type){
			s kpiRuleStr = $Get(%request.Data("kpiRuleStr",1))
			s kpiCode = $Get(%request.Data("kpiCode",1))
			s secDimCode = $Get(%request.Data("secDimCode",1))
			d ##class(DHCWL.SysService.SetFilterService).InitSecDimProNode(kpiRuleStr,kpiCode,secDimCode,.json)
		}
		if $d(json){
			s num=$o(json(""))
			write "["
			do{
				write json(num)
				s num=$o(json(num))
				i ""'=num write ","
			}while(""'=num)
			write "]"
		}
	}elseif ("getDimList"=action){
		if ("root"=type){
			s dimRuleStr = $Get(%request.Data("dimRuleStr",1))
			d ##class(DHCWL.SysService.SetFilterService).DimInitDimNode(dimRuleStr,.json)	
		}elseif("dim"=type){
			s dimRuleStr = $Get(%request.Data("dimRuleStr",1))
			s dimCode = $Get(%request.Data("dimCode",1))
			d ##class(DHCWL.SysService.SetFilterService).DimInitDimProNode(dimRuleStr,dimCode,.json)
		}
		if $d(json){
			s num=$o(json(""))
			write "["
			do{
				write json(num)
				s num=$o(json(num))
				i ""'=num write ","
			}while(""'=num)
			write "]"
		}
	}elseif("getLogicalOperators"=action){
		s json=##class(DHCWL.SysService.SetFilterService).InitLogicalOperators()
		set limit=""
		set start = $g(%request.Data("start",1))
		set maxRecordNum = $g(%request.Data("pageSize",1))
		set limit=$g(%request.Data("limit",1))
		if (""'=limit) set maxRecordNum=limit
		if (""'=json){
			write json.GetHead()
			set json.privor=start
			do{
				set obj=json.Next()
				if ((json.privor)=(start+maxRecordNum)){
					set obj=$p(obj,"}",1)
				 	set obj=obj_"}]}"
				}
				write obj
			}while((obj'="")&&(json.privor<(start+maxRecordNum))&&(json.privor<json.count))
		}
	}
</script>