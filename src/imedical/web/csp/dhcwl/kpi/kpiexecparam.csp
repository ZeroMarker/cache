<csp:content charset="gb2312">
<csp:content charset="UTF-8">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	s action=$g(%request.Data("action",1))
	s loginOperator=""
	i $d(%session.Data("LOGON.USERNAME")) s loginOperator=$g(%session.Data("LOGON.USERNAME"))		;added by JEFF@2013-11-15
	
	if "lookupObj"=action {
		b
		s className=$g(%request.Data("className",1))
		set start = $g(%request.Data("start",1))
		set pageSize = $g(%request.Data("limit",1)) ;$g(%request.Data("pageSize",1))
		s para="" f  s para=$o(%request.Data(para)) q:para=""  d
		.s PV(para)=$g(%request.Data(para,1))
		s end=start+pageSize
		s:+start>1 start=start+1
		s json=##class(web.DHCWL.KPI.MaintainKpi).GetObjsByClassName(className,start,end,.PV)
		;w json
		;q
		s retCnt=json.GetCount()
		if retCnt>0 {
			w json.GetHead()
			d{
				s obj=json.Next()
				w obj
			}while(obj'="")
		}else{
			w "{totalNums:0,totalNum:0,root:[13]}"
		}
	}elseif "SaveExecParam"=action {
		b
		s ID=$g(%request.Data("ID",1))
		s name=$g(%request.Data("Name",1))	
		s desc=$g(%request.Data("Desc",1))	
		s kpiCode=$g(%request.Data("KPICode",1))
		if $g(ID)="" {
			&sql(insert into DHCWL_MKPI.ExecParam (Param_KPICode,Param_Name,Param_Desc) values (:kpiCode,:name,:desc) )
			i +$g(SQLCODE)=0 w "{success:true,tip:'ok'}"
			e  w "{success:true,tip:'操作失败！',SQLCODE:"_SQLCODE_"}"		
		}else{
			&sql(update DHCWL_MKPI.ExecParam set Param_KPICode=:kpiCode,Param_Name=:name,Param_Desc=:desc where id=:ID)
			i +$g(SQLCODE)=0 w "{success:true,tip:'ok'}"
			e  w "{success:true,tip:'操作失败！',SQLCODE:"_SQLCODE_"}"		
		}	
	
	}elseif "DeleteExecParam"=action {
		s ID=$g(%request.Data("ID",1))
		&sql(delete from DHCWL_MKPI.ExecParam where ID=:ID)
		i +$g(SQLCODE)=0 w "{success:true,tip:'ok'}"
		e  w "{success:true,tip:'操作失败！',SQLCODE:"_SQLCODE_"}"		
	}
</script>