<csp:content charset="gb2312">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	set action=$g(%request.Data("action",1))
	
	set sessionUserName=""
	if $d(%session.Data("LOGON.USERNAME")) set sessionUserName=$g(%session.Data("LOGON.USERNAME"))
	if ("" = sessionUserName){
		s action="error"
		w "{success:true,tip:'"_"会话已过期,请移步重新登录！"_"'}"
		q
	}
		
	if ("saveOrdInfoSet"=action){
		s ordSetCode=$g(%request.Data("OrdSetCode",1))
		s ordSetDesc=$g(%request.Data("OrdSetDesc",1))
		s ordSetCreateUser=$g(%request.Data("OrdSetCreateUser",1))
		
		s dim("ordSetCode")=$g(ordSetCode)
		s dim("ordSetDesc")=$g(ordSetDesc)
		s dim("ordSetCreateUser")=$g(ordSetCreateUser)

		s tip=##class(DHCWL.MRIPDayTask.MRIPDayTaskServer).SaveOrdSetting(.dim)
		
		w "{success:true,tip:'"_tip_"'}"
		
	}elseif("getOrdInfoSet"=action){
		set json = ##class(DHCWL.MRIPDayTask.MRIPDayTaskServer).GetOrdSetting()
		set start = $g(%request.Data("start",1))
		set maxRecordNum = $g(%request.Data("pageSize",1))
		set limit=$g(%request.Data("limit",1))
		if (""'=limit) set maxRecordNum=limit
		if (""'=json){
			write json.GetHead()
			set json.privor=start
			do{
				set obj=json.Next()
				if ((json.privor)=(start+maxRecordNum)){
					set obj=$p(obj,"}",1)
				 	set obj=obj_"}]}"
				}
				write obj
			}while((obj'="")&&(json.privor<(start+maxRecordNum))&&(json.privor<json.count))
		}else {
			w "{result:0,totalNum:0,root:[]}"
		}	
	}elseif("updateOrdInfoSet"=action){
		s updateID=$g(%request.Data("updateID",1))
		s tip=##class(DHCWL.MRIPDayTask.MRIPDayTaskServer).SetDateOrdSetting(updateID)
		w "{success:true,tip:'"_tip_"'}"
	}elseif("selectARCItms"=action){
		s cond1=$g(%request.Data("cond1",1))
		s cond2=$g(%request.Data("cond2",1))
		
		set json = ##class(DHCWL.MRIPDayTask.MRIPDayTaskServer).GetARCItms(cond1,cond2)
		set start = $g(%request.Data("start",1))
		set maxRecordNum = $g(%request.Data("pageSize",1))
		set limit=$g(%request.Data("limit",1))
		if (""'=limit) set maxRecordNum=limit
		if (""'=json){
			write json.GetHead()
			set json.privor=start
			do{
				set obj=json.Next()
				if ((json.privor)=(start+maxRecordNum)){
					set obj=$p(obj,"}",1)
				 	set obj=obj_"}]}"
				}
				write obj
			}while((obj'="")&&(json.privor<(start+maxRecordNum))&&(json.privor<json.count))
		}else {
			w "{result:0,totalNum:0,root:[]}"
		}	
	}elseif("SaveOrdDetailSetting"=action){
		s str=$g(%request.Data("str",1))
		s tip=##class(DHCWL.MRIPDayTask.MRIPDayTaskServer).SaveOrdDetailSetting(str)
		w "{success:true,tip:'"_tip_"'}"
	}elseif("getOrdDetailSetting"=action){
		s mainID=$g(%request.Data("mainId",1))
		i ('$d(^DHCWL.MRIPDayTask.OrdItmDetI("OrdItmDetOrdItmtDRIndex",mainID))){
		 w "{result:0,totalNum:0,root:[]}"
		}else {
		set json = ##class(DHCWL.MRIPDayTask.MRIPDayTaskServer).GetOrdDetailSetting(mainID)
		set start = $g(%request.Data("start",1))
		set maxRecordNum = $g(%request.Data("pageSize",1))
		set limit=$g(%request.Data("limit",1))
		if (""'=limit) set maxRecordNum=limit
		if (""'=json){
			write json.GetHead()
			set json.privor=start
			do{
				set obj=json.Next()
				if ((json.privor)=(start+maxRecordNum)){
					set obj=$p(obj,"}",1)
				 	set obj=obj_"}]}"
				}
				write obj
			}while((obj'="")&&(json.privor<(start+maxRecordNum))&&(json.privor<json.count))
		}else {
			w "{result:0,totalNum:0,root:[]}"
		}	
	}	
	}elseif("DeleteOrdDetailSetting"=action){
		s idStr=$g(%request.Data("idStr",1))
		s tip=##class(DHCWL.MRIPDayTask.MRIPDayTaskServer).DeleteOrdDetailSetting(idStr)
		w "{success:true,tip:'"_tip_"'}"
	}
	</script>