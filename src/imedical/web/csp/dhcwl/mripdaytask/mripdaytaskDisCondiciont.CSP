<csp:content charset="gb2312">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	;w !,"aaa"
	set action=$g(%request.Data("action",1))
	
	set sessionUserName=""
	if $d(%session.Data("LOGON.USERNAME")) set sessionUserName=$g(%session.Data("LOGON.USERNAME"))
	if ("" = sessionUserName){
		s action="error"
		w "{success:true,tip:'"_"会话已过期,请移步重新登录！"_"'}"
		q
	}
		
	if ("GetDisCondicionts"=action){
		set json = ##class(DHCWL.MRIPDayTask.MRIPDayTaskServer).GetDisConditiont()
		set start = $g(%request.Data("start",1))
		set maxRecordNum = $g(%request.Data("pageSize",1))
		set limit=$g(%request.Data("limit",1))
		if (""'=limit) set maxRecordNum=limit
		if (""'=json){
			write json.GetHead()
			set json.privor=start
			do{
				set obj=json.Next()
				if ((json.privor)=(start+maxRecordNum)){
					set obj=$p(obj,"}",1)
				 	set obj=obj_"}]}"
				}
				write obj
			}while((obj'="")&&(json.privor<(start+maxRecordNum))&&(json.privor<json.count))
		}else {
			w "{result:0,totalNum:0,root:[]}"
		}	
	}elseif ("SaveDisCondicionts"=action){
		s str=$g(%request.Data("str",1))
		s creator=$g(%session.Data("LOGON.USERNAME"))
		//s ^cy("SaveDisCondicionts")=str_"*"_creator
		s dim("str")=$g(str)
		s dim("creator")=$g(creator)
		s tip=##class(DHCWL.MRIPDayTask.MRIPDayTaskServer).SaveDisCondicions(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}
	</script>