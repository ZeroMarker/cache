<csp:content charset="gb2312">
<csp:content charset="UTF-8">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	s action=$g(%request.Data("action",1))

	if "getSavedMgmt"=action {
		s MenuName=$g(%request.Data("MenuName",1))
		s RaqName=$g(%request.Data("RaqName",1))
		s CSPName=$g(%request.Data("CSPName",1))
		
		s start=$g(%request.Data("start",1))
		s limit=$g(%request.Data("limit",1))
		s end=start+limit
		s start=start+1	
		s qryName="%DynamicQuery:SQL"	
		s sql="SELECT ID, AdvUser, AuxiliaryMenuName, CSPName, CreateDate, "
		s sql=sql_"Demo, DepMaintainer, Filter, HisTableName, KPIName, "
		s sql=sql_"MenuName, ProMaintainer, ProgramLogic, QueryName, RaqName," 
		s sql=sql_"RowColShow, Spec, UPdateDate,UsedByDep FROM DHCWL_RptMgmt.RptCfg "
		s sqlConf=""
		if MenuName'="" {
			s sqlConf="MenuName like '%"_MenuName_"%'"
		}
		if RaqName'="" {
			if sqlConf'="" s sqlConf=sqlConf_" and "
			s sqlConf=sqlConf_"RaqName like '%"_RaqName_"%'"
		}		
		if CSPName'="" {
			if sqlConf'="" s sqlConf=sqlConf_" and "
			s sqlConf=sqlConf_"CSPName like '%"_CSPName_"%'"
		}	
			
		if sqlConf'="" s sql=sql_"WHERE "_sqlConf
		//w !,sql

		s jsonPro="ID, AdvUser, AuxiliaryMenuName, CSPName, CreateDate, "
		s jsonPro=jsonPro_"Demo, DepMaintainer, Filter, HisTableName, KPIName, "
		s jsonPro=jsonPro_"MenuName, ProMaintainer, ProgramLogic, QueryName, RaqName," 
		s jsonPro=jsonPro_"RowColShow, Spec, UPdateDate,UsedByDep"	
		
		//s json=##class(DHCWL.util.GetSetService).GetJsonBySQL(sql,start,end,jsonPro)
		s json=##class(DHCWL.RptMgmt.Util).GetJsonByQry(qryName,"",sql,start,end,jsonPro)
		w json.GetHead()
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"	
		
		q			
	}elseif "getSavedMgmt2"=action {
		s searchValue=$g(%request.Data("searchValue",1))

		
		s start=$g(%request.Data("start",1))
		s limit=$g(%request.Data("limit",1))
		s end=start+limit
		s start=start+1			

		s qryName="DHCWL.RptMgmt.Serv:QryRptMgmtDataUsedLike"
		s arguments=searchValue
		s jsonPro="ID, AdvUser, AuxiliaryMenuName, CSPName, CreateDate, "
		s jsonPro=jsonPro_"Demo, DepMaintainer, Filter, HisTableName, KPIName, "
		s jsonPro=jsonPro_"MenuName, ProMaintainer, ProgramLogic, QueryName, RaqName," 
		s jsonPro=jsonPro_"RowColShow, Spec, UPdateDate,UsedByDep"	
		
		s json=##class(DHCWL.RptMgmt.Util).GetJsonByQry(qryName,arguments,"",start,end,jsonPro)
		w json.GetHead()
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"	
		
		q			
	}elseif "GetRptCfg"=action {
		s RaqName=$g(%request.Data("RaqName",1))
		s CSPName=$g(%request.Data("CSPName",1))
		s AuxiliaryMenuName=$g(%request.Data("AuxiliaryMenuName",1))
		s inParam("RaqName")=RaqName
		s inParam("CSPName")=CSPName
		s inParam("AuxiliaryMenuName")=AuxiliaryMenuName
		//zw inParam
		s ret=##class(DHCWL.RptMgmt.Interface).GetRptCfg(.inParam,.outParam)
		
	}
	
</script>
