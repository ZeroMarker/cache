<csp:content charset="gb2312">
<csp:content charset="UTF-8">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	s action=$g(%request.Data("action",1))

	if "getMenuCfg"=action {
		s MenuName=$g(%request.Data("MenuName",1))
		s RaqName=$g(%request.Data("RaqName",1))
		s CSPName=$g(%request.Data("CSPName",1))
		
		s start=$g(%request.Data("start",1))
		s limit=$g(%request.Data("limit",1))
		s end=start+limit
		s start=start+1			
		//s sql="SELECT Caption As MenuName, ValueExpression  As RaqName, LinkUrl As CSPName "
		s sql="SELECT Caption As MenuName, $PIECE($PIECE(ValueExpression,'&reportName=',2),'.raq')||'.raq'  As RaqName, LinkUrl As CSPName "
		s sql=sql_"from websys.Menu WHERE ($FIND(%SQLUPPER(ValueExpression),'RAQ')>0 or ValueExpression IS NULL ) "
		s sql=sql_"AND ($FIND(%SQLUPPER(LinkUrl),'CSP')>0 or LinkUrl IS NULL ) "
		s sql=sql_"AND Type='SideMenu' "
		s sqlConf=""
		if MenuName'="" {
			s sqlConf="Caption like '%"_MenuName_"%'"
		}
		if RaqName'="" {
			if sqlConf'="" s sqlConf=sqlConf_" and "
			s sqlConf=sqlConf_"%SQLUPPER(ValueExpression) like %SQLUPPER('%"_RaqName_"%')"
		}		
		if CSPName'="" {
			if sqlConf'="" s sqlConf=sqlConf_" and "
			s sqlConf=sqlConf_"LinkUrl like '%"_CSPName_"%'"
		}	
			
		if sqlConf'="" s sql=sql_"and "_sqlConf
		//w !,sql

		s jsonPro="MenuName, RaqName, CSPName"
		
		s json=##class(DHCWL.util.GetSetService).GetJsonBySQL(sql,start,end,jsonPro)
		w json.GetHead()
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"	
		
		q			
	}
	
</script>
