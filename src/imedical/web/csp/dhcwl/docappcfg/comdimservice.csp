<csp:content charset="gb2312">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	s deli = "&"
	set start = $g(%request.Data("start",1))
	set limit = $g(%request.Data("limit",1))
	set action=$g(%request.Data("action",1))
	set pageSize = $g(%request.Data("limit",1))
	set isArrayType=$g(%request.Data("isArrayType",1))
	set className=$g(%request.Data("className",1))
	set condSql=""
	s:start>1 start=start+1
	s end=start+pageSize
	if "getComKpiDimPro"=action {
		s syskpiCode = $g(%request.Data("syskpiCode",1))
		s treeData =##class(DHCWL.DocQueryData.GetSysKpiDimData).GetDimProCode(syskpiCode)
		w treeData
		}
	elseif "getComDimDimPro"=action {
	s proCode = $g(%request.Data("MDimProCode",1))  //LocDesc
	//s statCode = $g(%request.Data("mstatCode",1))  //1772
	s dimId = $g(%request.Data("MDimId",1))
	s filterValue=$g(%request.Data("filterValue",1))
	s ^TEMPDHCWL("DUH") = proCode_"^"_dimId_"^"_filterValue
		//if proCode="" {
			//s proCode=##class(DHCWL.ComplexRptData.SaveData).GetDimProCodeByStatCode(statCode) ;ƒ¨»œŒ¨∂» Ù–‘
		//}
		s para="{start:"_start_",end:"_end_",jsonProDeli:&,}"
		s json=##class(DHCWL.DocQueryData.GetSysKpiDimData).GetJsonFromQuery("DHCWL.DocQueryData.GetSysKpiDimData:GetDimProValue",para,dimId,proCode,filterValue)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
		}
	elseif "getFilterFunCombo"=action {
		s sql="SELECT FilterFunc_Prototype,FilterFunc_Code,FilterFunc_ExecCode FROM DHCWL_MKPI.SysFilterFunc"
		s rs=##class(%Library.ResultSet).%New()
		d rs.Prepare(sql)
		d rs.Execute()
		s deli=",",str=""
		While(rs.Next()){
			s funCode=rs.Data("FilterFunc_Code")
			s funPro=rs.Data("FilterFunc_Prototype")
			i funCode[$c(10) s funCode=$tr(funCode,$c(10),"")
			i funPro[$c(10) s funPro=$tr(funPro,$c(10),"")
			s str=str_"["_""""_funCode_""""_deli_""""_funPro_"""],"
		}
		d rs.Close()
		w "["_$e(str,1,$l(str)-1)_"]"
	}
</script>

