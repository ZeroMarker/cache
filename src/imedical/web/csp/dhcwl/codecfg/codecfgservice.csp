<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
 ;dhccpm.rqreport.csp
 //d ##class(web.DHCBL.BDP.BDPExecutables).BuildAutAry("DHCWL_CodeCfg.DHCWLCodeCfgType")  //调用数据平台接口
 i ##Class(websys.SessionEvents).SessionExpired() q 1
 q 1
</csp:method>
<csp:content charset="gb2312">
<csp:content charset="UTF-8">
	<script language="cache" runat="server">
	set start = $g(%request.Data("start",1))
	set pageSize = $g(%request.Data("limit",1))
	set action=$g(%request.Data("action",1))
	set isArrayType=$g(%request.Data("isArrayType",1))
	set className=$g(%request.Data("className",1))
	set condSql=""
	;s start=1,pageSize=9999999
	s:start>1 start=start+1
	s end=start+pageSize
	s deli="&"
	i action="mulSearchGrp" {
		//s ^testyx("className")=className
		s id=$Get(%request.Data("ID",1))     //$g(%session.Data("kpiId"))
		s GrpCode=$g(%request.Data("GrpCode",1))
		s GrpDesc=$g(%request.Data("GrpDesc",1))
		s GrpTypeDr=$g(%request.Data("GrpTypeDr",1))
		s GrpCreateUse=$g(%request.Data("GrpCreateUse",1))
		s GrpDimDr=$g(%request.Data("GrpDimDr",1))
		i GrpCode'="" d
		.if condSql="" s condSql=condSql_" where"
		.e  s condSql=condSql_" and "
		.s condSql=condSql_" Grp_Code like '%"_GrpCode_"%'"
		i GrpDesc'="" d
		.if condSql="" s condSql=condSql_" where"
		.e  s condSql=condSql_" and "
		.s condSql=condSql_" Grp_Desc like '%"_GrpDesc_"%'"
		i GrpTypeDr'=""  d
		.s searcheSql="select ID from DHCWL_CodeCfg.DHCWLCodeCfgType where Type_Desc like '%"_GrpTypeDr_"%'"
		.s condRs=##class(%Library.ResultSet).%New()
		.d condRs.Prepare(searcheSql)
		.d condRs.Execute()
		.While(condRs.Next()){
		.s ID(condRs.Data("ID"))=""
		.}
		.d condRs.Close()
		.s ids="",tempId="" f  s tempId=$o(ID(tempId)) q:tempId=""  d
		..s ids=ids_tempId_","
		.s ids=$e(ids,1,$l(ids)-1)
		.if $g(ids)'="" d
		..if condSql="" s condSql=condSql_" where "
		..e  s condSql=condSql_" and "
		..s condSql=condSql_" Grp_Type_Dr in ("_ids_")"
		..k ID
		i GrpCreateUse'="" d
		.if condSql="" s condSql=condSql_" where"
		.e  s condSql=condSql_" and "
		.s condSql=condSql_" Grp_CreateUse like '%"_GrpCreateUse_"%'"
		i GrpDimDr'=""  d
		.s searcheSql="select ID from DHCWL_MKPI.DHCWLMKPIDimType where KDT_Code like '%"_$p(GrpDimDr,":",1)_"%'"
		.s condRs=##class(%Library.ResultSet).%New()
		.d condRs.Prepare(searcheSql)
		.d condRs.Execute()
		.While(condRs.Next()){
		.s ID(condRs.Data("ID"))=""
		.}
		.d condRs.Close()
		.s ids="",tempId="" f  s tempId=$o(ID(tempId)) q:tempId=""  d
		..s ids=ids_tempId_","
		.s ids=$e(ids,1,$l(ids)-1)
		.if $g(ids)'="" d
		..if condSql="" s condSql=condSql_" where "
		..e  s condSql=condSql_" and "
		..s condSql=condSql_" Grp_Dim_Dr in ("_ids_")"
		..k ID
		i className="DHCWL.CodeCfg.Group" s jsonPros="ID,GrpCode,GrpDesc,GrpTypeDr,GrpCreateUse,GrpDimDr"
		i className="DHCWL.CodeCfg.ItemGroup" s jsonPros="ID,ItemGrpCode,ItemGrpDesc,ItemGrpTypeDr,ItemGrpCreateUse,ItemGrpDimDr"
		s sqlFields=##class(DHCWL.util.GetSetService).MapFildFromClassProByStr(className,jsonPros)  //"DHCWL.CodeCfg.Group"
		s tableName=##class(DHCWL.util.GetSetService).GetTableName(className)   //"DHCWL.CodeCfg.Group"
		s sql="select "_sqlFields_" from "_tableName_condSql_" order by ID" 
		//s ^yxtest("sql")=sql
		s rs=##class(%Library.ResultSet).%New()
	    d rs.Prepare(sql)
	    d rs.Execute()
	    i className="DHCWL.CodeCfg.Group" s json=##class(DHCWL.util.Json).Json("ID"_deli_"GrpCode"_deli_"GrpDesc"_deli_"GrpTypeDr"_deli_"GrpCreateUse"_deli_"GrpDimDr","result","root",deli)
	    i className="DHCWL.CodeCfg.ItemGroup" s json=##class(DHCWL.util.Json).Json("ID"_deli_"ItemGrpCode"_deli_"ItemGrpDesc"_deli_"ItemGrpTypeDr"_deli_"ItemGrpCreateUse"_deli_"ItemGrpDimDr","result","root",deli)
	    //s ^yxtest("json")=json
	    s num=0
		i className="DHCWL.CodeCfg.Group" d
		.While(rs.Next()){
		.	s num=num+1
		.	s typedr=rs.Data("Grp_Type_Dr")
		.	i (typedr="")!('$d(^DHCWL.CodeCfg.TypeD(+typedr))) s typedesc=""
		.   e  s typedesc=$list(^DHCWL.CodeCfg.TypeD(typedr),6)
		.   s dimdr=rs.Data("Grp_Dim_Dr")
		.	i (dimdr="")!('$d(^DHCWL.MKPI.MKPIDimTypeD(+dimdr))) s dimdesc=""
		.   e  s dimdesc=$list(^DHCWL.MKPI.MKPIDimTypeD(dimdr),2)_":"_$list(^DHCWL.MKPI.MKPIDimTypeD(dimdr),3)
		.	d json.Insert(rs.Data("ID")_""_deli_"'"_rs.Data("Grp_Code")_"'"_deli_"'"_rs.Data("Grp_Desc")_"'"_deli_"'"_typedesc_"'"_deli_"'"_rs.Data("Grp_CreateUse")_"'"_deli_"'"_dimdesc_"'")
		.}
		i className="DHCWL.CodeCfg.ItemGroup" d
		.While(rs.Next()){
		.	s num=num+1
		.	s typedr=rs.Data("ItemGrp_Type_Dr")
		.	i (typedr="")!('$d(^DHCWL.CodeCfg.TypeD(+typedr))) s typedesc=""
		.   e  s typedesc=$list(^DHCWL.CodeCfg.TypeD(typedr),6)
		.
		.	s dimdr=rs.Data("ItemGrp_Dim_Dr")
		.	i (dimdr="")!('$d(^DHCWL.MKPI.MKPIDimTypeD(+dimdr))) s dimdesc=""
		.   e  s dimdesc=$list(^DHCWL.MKPI.MKPIDimTypeD(dimdr),2)_":"_$list(^DHCWL.MKPI.MKPIDimTypeD(dimdr),3)   //,dimcode=$list(^DHCWL.MKPI.MKPIDimTypeD(dimdr),2)
		.	d json.Insert(rs.Data("ID")_""_deli_"'"_rs.Data("ItemGrp_Code")_"'"_deli_"'"_rs.Data("ItemGrp_Desc")_"'"_deli_"'"_typedesc_"'"_deli_"'"_rs.Data("ItemGrp_CreateUse")_"'"_deli_"'"_dimdesc_"'")
		.}
		d rs.Close()
		d json.SetTotalNum(num)
		i (+isArrayType=1) {
			w "["
			d {
				s obj=json.GetNextJsonArray()
				i obj'="" w obj,","
			}while(obj'="")
			w "]"
			q
		}
	
		s jsonHead=json.GetHead()
		//w json.GetJson()有一些代替此方法（因为数据量大时string会溢出）
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	    
	}elseif action="mulSearchItemGrp" {
		//s ^testyx("className")=className
		s id=$Get(%request.Data("ID",1))     //$g(%session.Data("kpiId"))
		s GrpCode=$g(%request.Data("ItemGrpCode",1))
		s GrpDesc=$g(%request.Data("ItemGrpDesc",1))
		s GrpTypeDr=$g(%request.Data("ItemGrpTypeDr",1))
		s GrpCreateUse=$g(%request.Data("ItemGrpCreateUse",1))
		s GrpDimDr=$g(%request.Data("ItemGrpDimDr",1))
		i GrpCode'="" d
		.if condSql="" s condSql=condSql_" where"
		.e  s condSql=condSql_" and "
		.s condSql=condSql_" ItemGrp_Code like '%"_GrpCode_"%'"
		i GrpDesc'="" d
		.if condSql="" s condSql=condSql_" where"
		.e  s condSql=condSql_" and "
		.s condSql=condSql_" ItemGrp_Desc like '%"_GrpDesc_"%'"
		i GrpTypeDr'=""  d
		.s searcheSql="select ID from DHCWL_CodeCfg.DHCWLCodeCfgType where Type_Desc like '%"_GrpTypeDr_"%'"
		.s condRs=##class(%Library.ResultSet).%New()
		.d condRs.Prepare(searcheSql)
		.d condRs.Execute()
		.While(condRs.Next()){
		.s ID(condRs.Data("ID"))=""
		.}
		.d condRs.Close()
		.s ids="",tempId="" f  s tempId=$o(ID(tempId)) q:tempId=""  d
		..s ids=ids_tempId_","
		.s ids=$e(ids,1,$l(ids)-1)
		.if $g(ids)'="" d
		..if condSql="" s condSql=condSql_" where "
		..e  s condSql=condSql_" and "
		..s condSql=condSql_" ItemGrp_Type_Dr in ("_ids_")"
		..k ID
		i GrpCreateUse'="" d
		.if condSql="" s condSql=condSql_" where"
		.e  s condSql=condSql_" and "
		.s condSql=condSql_" ItemGrp_CreateUse like '%"_GrpCreateUse_"%'"
		
		i GrpDimDr'=""  d
		.s searcheSql="select ID from DHCWL_MKPI.DHCWLMKPIDimType where KDT_Code like '%"_$p(GrpDimDr,":",1)_"%'"
		.s condRs=##class(%Library.ResultSet).%New()
		.d condRs.Prepare(searcheSql)
		.d condRs.Execute()
		.While(condRs.Next()){
		.s ID(condRs.Data("ID"))=""
		.}
		.d condRs.Close()
		.s ids="",tempId="" f  s tempId=$o(ID(tempId)) q:tempId=""  d
		..s ids=ids_tempId_","
		.s ids=$e(ids,1,$l(ids)-1)
		.if $g(ids)'="" d
		..if condSql="" s condSql=condSql_" where "
		..e  s condSql=condSql_" and "
		..s condSql=condSql_" ItemGrp_Dim_Dr in ("_ids_")"
		..k ID
		
		s jsonPros="ID,ItemGrpCode,ItemGrpDesc,ItemGrpTypeDr,ItemGrpCreateUse,ItemGrpDimDr"
		s sqlFields=##class(DHCWL.util.GetSetService).MapFildFromClassProByStr(className,jsonPros)  //"DHCWL.CodeCfg.Group"
		s tableName=##class(DHCWL.util.GetSetService).GetTableName(className)   //"DHCWL.CodeCfg.Group"
		s sql="select "_sqlFields_" from "_tableName_condSql_" order by ID"  
		//s ^yxtest("mulSearchGrpaa")=sql
		s rs=##class(%Library.ResultSet).%New()
	    d rs.Prepare(sql)
	    d rs.Execute()
	    s json=##class(DHCWL.util.Json).Json("ID"_deli_"ItemGrpCode"_deli_"ItemGrpDesc"_deli_"ItemGrpTypeDr"_deli_"ItemGrpCreateUse"_deli_"ItemGrpDimDr","result","root",deli)
	    //s ^yxtest("json")=json
	    s num=0
		While(rs.Next()){
			s num=num+1
			s typedr=rs.Data("ItemGrp_Type_Dr")
			i (typedr="")!('$d(^DHCWL.CodeCfg.TypeD(+typedr))) s typedesc=""
		    e  s typedesc=$list(^DHCWL.CodeCfg.TypeD(typedr),6)
		    s dimdr=rs.Data("ItemGrp_Dim_Dr")
		    i (dimdr="")!('$d(^DHCWL.MKPI.MKPIDimTypeD(+dimdr))) s dimdesc=""
		    e  s dimdesc=$list(^DHCWL.MKPI.MKPIDimTypeD(dimdr),2)_":"_$list(^DHCWL.MKPI.MKPIDimTypeD(dimdr),3)
		    d json.Insert(rs.Data("ID")_""_deli_"'"_rs.Data("ItemGrp_Code")_"'"_deli_"'"_rs.Data("ItemGrp_Desc")_"'"_deli_"'"_typedesc_"'"_deli_"'"_rs.Data("ItemGrp_CreateUse")_"'"_deli_"'"_dimdesc_"'")
		}
		d rs.Close()
		d json.SetTotalNum(num)
		i (+isArrayType=1) {
			w "["
			d {
				s obj=json.GetNextJsonArray()
				i obj'="" w obj,","
			}while(obj'="")
			w "]"
			q
		}
	
		s jsonHead=json.GetHead()
		//w json.GetJson()有一些代替此方法（因为数据量大时string会溢出）
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
		
	}elseif action="mulSearch" {
		s session=$g(%request.Data("session",1))
		s className=$g(%request.Data("className",1))
		s isArrayType=$g(%request.Data("isArrayType",1))
		s PV=""
		s para="" f  s para=$o(%request.Data(para)) q:para=""  d
		.s PV(para)=$g(%request.Data(para,1))
		.i className="DHCWL.CodeCfg.SubGroup" s %session.Data("SGRP",para)=$g(%request.Data(para,1))
		.else  if className="DHCWL.CodeCfg.Group" s %session.Data("GRP",para)=$g(%request.Data(para,1))
		.else  if className="DHCWL.CodeCfg.Type" s %session.Data("FL",para)=$g(%request.Data(para,1))
		i session'="" d
		.k PV
		.s para="" f  s para=$o(%session.Data(session,para)) q:para=""  d
		..s PV(para)=%session.Data(session,para)
		set start = $g(%request.Data("start",1))
		set pageSize = $g(%request.Data("limit",1)) ;$g(%request.Data("pageSize",1))
		s end=$g(start)+$g(pageSize)
		s:+start>1 start=start+1
		i isArrayType=1 {
			s start="",pageSize=""
		}
		s json=##class(web.DHCWL.KPI.MaintainKpi).GetObjsByClassName(className,$g(start),end,.PV) 
		;w json
		;q
		i isArrayType=1 {
			w "["
			d {
				s obj=json.GetNextJsonArray()
				i obj'="" w obj,","
			}while(obj'="")
			w "]"
			q
		}
		w json.GetHead()
		;有一些代替此方法（因为数据量大时string会溢出）
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
		
	}elseif action="addCodecfg" {
		s ^yxtest("session")=$Get(%session.Data("LOGON.USERID"))
		s dim("TypeCode")=$g(%request.Data("TypeCode",1))
		s dim("TypeDesc")=$g(%request.Data("TypeDesc",1))
		s dim("TypeExtCode")=$g(%request.Data("TypeExtCode",1))
		s dim("TypeValueDes")=$g(%request.Data("TypeValueDes",1))
		s dim("TypeFlag")=$g(%request.Data("TypeFlag",1))
		s dim("TypeCreateUse")=$g(%request.Data("TypeCreateUse",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).AddCodeType(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="deleteCodecfgtype" {
		s id=$g(%request.Data("ID",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).DeleteCodeType(id)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="updateCodecfgtype" {
		s dim("ID")=$g(%request.Data("ID",1))
		s dim("TypeCode")=$g(%request.Data("TypeCode",1))
		s dim("TypeDesc")=$g(%request.Data("TypeDesc",1))
		s dim("TypeExtCode")=$g(%request.Data("TypeExtCode",1))
		s dim("TypeValueDes")=$g(%request.Data("TypeValueDes",1))
		s dim("TypeFlag")=$g(%request.Data("TypeFlag",1))
		s dim("TypeCreateUse")=$g(%request.Data("TypeCreateUse",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).UpdateCodeType(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="getCodeCfgtypeCombo" {
		s sql="select ID,Type_Desc from DHCWL_CodeCfg.DHCWLCodeCfgType"   //Type_Code
		s rs=##class(%Library.ResultSet).%New()
		d rs.Prepare(sql)
		d rs.Execute()
		s deli=",",str="['',''],"
		While(rs.Next()){
			s str=str_"['"_rs.Data("ID")_"'"_deli_"'"_rs.Data("Type_Desc")_"'],"
		}
		d rs.Close()
		w "["_$e(str,1,$l(str)-1)_"]"
	}elseif action="getCodeCfgDimComboold" {
		s sql="select ID,KDT_Code,KDT_Desc from DHCWL_MKPI.DHCWLMKPIDimType"   //Type_Code
		s rs=##class(%Library.ResultSet).%New()
		d rs.Prepare(sql)
		d rs.Execute()
		s deli=",",str="['',''],"
		While(rs.Next()){
			s str=str_"['"_rs.Data("ID")_"'"_deli_"'"_rs.Data("KDT_Code")_":"_rs.Data("KDT_Desc")_"'],"
		}
		d rs.Close()
		w "["_$e(str,1,$l(str)-1)_"]"
	}elseif action="getCodeCfgDimCombo" {
		s queryJsonPros="{start:"_start_",end:"_end_",jsonProDeli:&}"
		s desc=$g(%request.Data("desc",1))
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.CodeCfgData.FunctionModule:getDimInforQuery",queryJsonPros,desc)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif action="addCodecfggrp" {
		s dim("GrpCode")=$g(%request.Data("GrpCode",1))
		s dim("GrpDesc")=$g(%request.Data("GrpDesc",1))
		s dim("GrpTypeDr")=$g(%request.Data("GrpTypeDr",1))
		s dim("GrpCreateUse")=$g(%request.Data("GrpCreateUse",1))
		s dim("GrpDimDr")=$g(%request.Data("GrpDimDr",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).AddCodeGrp(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="deleteCodecfggrp" {
		s id=$g(%request.Data("ID",1))
		if ($d(^DHCWL.CodeCfg.SubGroupI("GrpDr",id))||($d(^DHCWL.CodeCfg.SubGroupItemI("Grp",id)))){
			w "{success:true,tip:'子组下有条目和明细,请先删除之后再操作'}"
			q
		}
		s tip=##class(DHCWL.CodeCfgData.SaveData).DeleteCodeGrp(id)
		w "{success:true,tip:'"_tip_"'}"
		q
	}elseif action="updateCodecfggrp" {
		s dim("ID")=$g(%request.Data("ID",1))
		s dim("GrpCode")=$g(%request.Data("GrpCode",1))
		s dim("GrpDesc")=$g(%request.Data("GrpDesc",1))
		s dim("GrpTypeDr")=$g(%request.Data("GrpTypeDr",1))
		s dim("GrpCreateUse")=$g(%request.Data("GrpCreateUse",1))
		s dim("GrpDimDr")=$g(%request.Data("GrpDimDr",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).UpdateCodeGrp(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="list-subGrp" {
		s grpId=$g(%request.Data("grpId",1))
		s SGrpCode=$g(%request.Data("SGrpCode",1))
		s SGrpDesc=$g(%request.Data("SGrpDesc",1))
		//i $g(kpiId)="" d
		//.s kpiCode=$g(%request.Data("kpiCode",1))
		//.s kpiId=##class(DHCWL.MKPIIO.XMLIOConfige).GetIdByCode(kpiCode,"DHCWL.MKPI.MKPI")  ;##class(DHCWL.MKPIService.ConfigService).GetKPIByName(kpiCode)
		i grpId="" {
			w "{success:false,info:'不存在该组'}"
			q
		}
		s subGrpPara=##class(DHCWL.CodeCfgData.FunctionModule).GetSubGrpListByGrpId(grpId,SGrpCode,SGrpDesc)
		//s ^testyx("subGrpPara")=subGrpPara
		s count=$p(subGrpPara,"^",2)
		s subGrpList=$p(subGrpPara,"^",1)
		s subGrpList=$e(subGrpList,1,$l(subGrpList)-1)
		w "{totalNums:"_count_",root:["_subGrpList_"]}"
	}elseif action="searchSubGroup"{
		s grpId=$g(%request.Data("grpId1",1))
		s SGrpCode=$g(%request.Data("SGrpCode",1))
		s SGrpDesc=$g(%request.Data("SGrpDesc",1))
		i grpId="" {
			w "{success:false,info:'不存在该组'}"
			q
		}
		d ##class(DHCWL.CodeCfgData.FunctionModule).GetSearchSubGrpList(grpId,SGrpCode,SGrpDesc)
		q
	}elseif action="deleteCodecfgsubgrp" {
		s id=$g(%request.Data("ID",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).DeleteCodeSubGrp(id)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="deleteCodecfgsubtreegrp"{
		s id=$g(%request.Data("ID",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).DeleteCodeSubTreeGrp(id)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="addCodecfgsubgrp" {
		s dim("SGrpCode")=$g(%request.Data("SGrpCode",1))
		s dim("SGrpDesc")=$g(%request.Data("SGrpDesc",1))
		s dim("SGrpGrpDr")=$g(%request.Data("SGrpGrpDr",1))
		s dim("SGrpSort")=$g(%request.Data("SGrpSort",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).AddCodeSubGrp(.dim)
		//s ^testyx("addCodecfgsubgrp")=tip
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="addCodecfgTreesubgrp"{
		s dim("SGrpCode")=$g(%request.Data("SGrpCode",1))
		s dim("SGrpDesc")=$g(%request.Data("SGrpDesc",1))
		s dim("SGrpGrpDr")=$g(%request.Data("SGrpGrpDr",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).AddCodeTreeSubGrp(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="updateCodecfgsubgrp" {
		s dim("ID")=$g(%request.Data("ID",1))
		s dim("SGrpCode")=$g(%request.Data("SGrpCode",1))
		s dim("SGrpDesc")=$g(%request.Data("SGrpDesc",1))
		s dim("SGrpGrpDr")=$g(%request.Data("SGrpGrpDr",1))
		s dim("SGrpSort")=$g(%request.Data("SGrpSort",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).UpdateCodeSubGrp(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="list-subGrpItemold" {
		s subgrpId=$g(%request.Data("subgrpId",1))
		i subgrpId="" {
			w "{success:false,info:'请选择要查看的分类'}"
			q
		}
		s subGrpPara=##class(DHCWL.CodeCfgData.FunctionModule).GetSubGrpItemListBySubGrpId(subgrpId)
		s count=$p(subGrpPara,"^",2)
		s subGrpList=$p(subGrpPara,"^",1)
		s subGrpList=$e(subGrpList,1,$l(subGrpList)-1)
		w "{totalNums:"_count_",root:["_subGrpList_"]}"
	}elseif action="list-subGrpItem" {
		s subgrpId=$g(%request.Data("subgrpId",1))
		s filterValue=$g(%request.Data("searcheValue",1))
		s searcheCond = $g(%request.Data("searcheCond",1))
		set start = $g(%request.Data("start",1))
		set pageSize = $g(%request.Data("limit",1))
		set end=start+pageSize
		s:start>1 start=start+1
		i subgrpId="" {
			w "{success:false,info:'请选择要查看的分类'}"
			q
		}
		s queryJsonPros="{start:"_start_",end:"_end_",jsonProDeli:&}"
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.CodeCfgData.CodeTypeItemQuery:GetSubGrpItemQuery",queryJsonPros,subgrpId,filterValue,searcheCond)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
		
		//w "{totalNums:"_count_",root:["_subGrpList_"]}"
	}elseif action="list-AllItemold" {
		s grpId=$g(%request.Data("grpId",1))
		i grpId="" {
			w "{success:false,info:'请选择要查看的分类'}"
			q
		}
		s allTypeItemPara=##class(DHCWL.CodeCfgData.FunctionModule).GetTypeItemListByGrpId(grpId)
		s count=$p(allTypeItemPara,"^",2)
		s allTypeItemList=$p(allTypeItemPara,"^",1)
		s allTypeItemList=$e(allTypeItemList,1,$l(allTypeItemList)-1)
		w "{totalNums:"_count_",root:["_allTypeItemList_"]}"
	}elseif action="list-AllItemold" {      ///通过代码类型取
		s grpId=$g(%request.Data("grpId",1))
		s searcheCond = $g(%request.Data("searcheCond",1))
	    s searcheValue = $g(%request.Data("searcheValue",1))
	    s className=$g(%request.Data("className",1))
	    s queryJsonPros="{start:"_start_",end:"_end_",jsonProDeli:&}"
		i grpId="" {
			w "{success:false,info:'请选择要查看的分类'}"
			q
		}
		i className="DHCWL.CodeCfg.Group" s typeId=$list(^DHCWL.CodeCfg.GroupD(grpId),7)
		i className="DHCWL.CodeCfg.ItemGroup" s typeId=$list(^DHCWL.CodeCfg.ItemGroupD(grpId),4)
		///d ##class(%ResultSet).RunQuery("DHCWL.Interface.MkpiData","QryDimValuesByDimType","CTLOC:LocDesc^LocHospid")
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.CodeCfgData.CodeTypeItemQuery:CodeTypeItemQuery","",typeId,searcheCond,searcheValue)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif action="list-AllItem" {     //通过关联维度取值
		s grpId=$g(%request.Data("grpId",1))
		s searcheCond = $g(%request.Data("searcheCond",1))
	    s searcheValue = $g(%request.Data("searcheValue",1))
	    s className=$g(%request.Data("className",1))
	    set start = $g(%request.Data("start",1))
		set pageSize = $g(%request.Data("limit",1))
		set end=start+pageSize
		s:start>1 start=start+1
	    s queryJsonPros="{start:"_start_",end:"_end_",jsonProDeli:&}"
		i grpId="" {
			w "{success:false,info:'请选择要查看的分类'}"
			q
		}
		i className="DHCWL.CodeCfg.Group" s typeId=$list(^DHCWL.CodeCfg.GroupD(grpId),11)    //维度ID
		i className="DHCWL.CodeCfg.ItemGroup" s typeId=$list(^DHCWL.CodeCfg.ItemGroupD(grpId),8)   //维度ID
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.CodeCfgData.CodeTypeItemQuery:CodeTypeItemQuery",queryJsonPros,typeId,searcheCond,searcheValue)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif action="deleteSubGrpDetail" {
		s id=$g(%request.Data("ID",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).DeleteSubGrpDetail(id)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="deleteAllSubGrpDetail" {
		s subgrpId=$g(%request.Data("subgrpId",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).DeleteSubGrpAllDetail(subgrpId)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="addsubgrpitem" {
		s dim("GrpId")=$g(%request.Data("GrpId",1))
		s dim("SubGrpId")=$g(%request.Data("SubGrpId",1))
		s dim("selectItemPara")=$g(%request.Data("selectItemPara",1))
		s dim("selectItemCode")=$g(%request.Data("selectItemCode",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).AddSubGrpItem(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="CheckGrpItem" {
		s grpId=$g(%request.Data("grpId",1))
		//add by  wk~2016-11-8
		s searcheCond = $g(%request.Data("searcheCond",1))
	    s searcheValue = $g(%request.Data("searcheValue",1))
		set start = $g(%request.Data("start",1))
		set pageSize = $g(%request.Data("limit",1))
		set end=start+pageSize
		s:start>1 start=start+1
	    s queryJsonPros="{start:"_start_",end:"_end_",jsonProDeli:&}"
	    //
		i grpId="" {
			w "{success:false,info:'请选择要查看的分类'}"
			q
		}
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.CodeCfgData.CheckGrpItemQuery:CheckGrpItemQuery",queryJsonPros,grpId,searcheCond,searcheValue)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif action="CheckGroupItem" {     //add by  wk~2016-11-8
		s grpId=$g(%request.Data("grpId",1))
		s searcheCond = $g(%request.Data("searcheCond",1))
	    s searcheValue = $g(%request.Data("searcheValue",1))
		i grpId="" {
			w "{success:false,info:'请选择要查看的分类'}"
			q
		}
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.CodeCfgData.CheckGrpItemQuery:CheckGroupItemQuery","",grpId,searcheCond,searcheValue)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif action="updateSgrpSort" {
		s strPara=$g(%request.Data("strPara",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).UpdateSgrpSort(strPara)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="addItemgrp" {
		s dim("GrpCode")=$g(%request.Data("GrpCode",1))
		s dim("GrpDesc")=$g(%request.Data("GrpDesc",1))
		s dim("GrpTypeDr")=$g(%request.Data("GrpTypeDr",1))
		s dim("GrpCreateUse")=$g(%request.Data("GrpCreateUse",1))
		s dim("GrpDimDr")=$g(%request.Data("GrpDimDr",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).AddCodeItemGrp(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="updateItemgrp" {
		s dim("ID")=$g(%request.Data("ID",1))
		s dim("GrpCode")=$g(%request.Data("GrpCode",1))
		s dim("GrpDesc")=$g(%request.Data("GrpDesc",1))
		s dim("GrpTypeDr")=$g(%request.Data("GrpTypeDr",1))
		s dim("GrpCreateUse")=$g(%request.Data("GrpCreateUse",1))
		s dim("GrpDimDr")=$g(%request.Data("GrpDimDr",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).UpdateCodeItemGrp(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="deleteItemgrp" {
		s id=$g(%request.Data("ID",1))
		if ($d(^DHCWL.CodeCfg.ItemGroupDetailsI("GrpIM",id))){
			w "{success:true,tip:'请先删除明细之后再删除统计大组'}"
			q
		}
		s tip=##class(DHCWL.CodeCfgData.SaveData).DeleteCodeItemGrp(id)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="list-GrpItem" {
		s grpId=$g(%request.Data("grpId",1))
		s searcheCond = $g(%request.Data("searcheCond",1))
	    s searcheValue = $g(%request.Data("searcheValue",1))
	    s queryJsonPros="{start:"_start_",end:"_end_",jsonProDeli:&}"
		i grpId="" {
			w "{success:false,info:'请选择要查看的分类'}"
			q
		}
		//s typeId=$list(^DHCWL.CodeCfg.GroupD(grpId),7)
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.CodeCfgData.CodeTypeGrpItemQuery:CodeTypeItemQuery","",grpId)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif action="delitem" {
		s dim("GrpId")=$g(%request.Data("GrpId",1))
		s dim("selectItemPara")=$g(%request.Data("selectItemPara",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).DelItem(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="updategrpitemSort" {
		s grpId=$g(%request.Data("grpId",1))
		s strPara=$g(%request.Data("strPara",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).updategrpitemSort(grpId,strPara)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="updategrpDeleteitemSort" {
		s grpId=$g(%request.Data("grpId",1))
		s strPara=$g(%request.Data("strPara",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).updategrpitemSort(grpId,strPara)
		if (tip'="更新失败！") s tip="ok"
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="addgrpitem" {
		s dim("GrpId")=$g(%request.Data("GrpId",1))
		s dim("selectItemPara")=$g(%request.Data("selectItemPara",1))
		//s ^testyx("addgrpitem")=$g(%request.Data("GrpId",1))_"^"_$g(%request.Data("selectItemPara",1))
		s tip=##class(DHCWL.CodeCfgData.SaveData).AddGrpItem(.dim)
		w "{success:true,tip:'"_tip_"'}"
	}elseif action="groupTreeInfor"{
		s grpId=$g(%request.Data("grpId",1))
		w "{data:["
		s subgrpId=""
		s mlevel=""
		s num=0
		for{
			s mlevel=$o(^DHCWL.CodeCfg.SubGroupI("GrpLevelSort",grpId,mlevel))
			q:mlevel=""
			s mSort=""
			for{
				//s subgrpId=$o(^DHCWL.CodeCfg.SubGroupI("GrpDr",grpId,subgrpId))
				s mSort=$o(^DHCWL.CodeCfg.SubGroupI("GrpLevelSort",grpId,mlevel,mSort))
				q:mSort=""
				s subgrpId=""
				for{
					s subgrpId=$o(^DHCWL.CodeCfg.SubGroupI("GrpLevelSort",grpId,mlevel,mSort,subgrpId))
					q:subgrpId=""
					s subgrpCode=$lg(^DHCWL.CodeCfg.SubGroupD(subgrpId),2)
					s subgrpDesc=$lg(^DHCWL.CodeCfg.SubGroupD(subgrpId),3)
					s subgrpSort=$lg(^DHCWL.CodeCfg.SubGroupD(subgrpId),5)
					s subgrpTreeCode=$lg(^DHCWL.CodeCfg.SubGroupD(subgrpId),6)
					s subgrpPTreeCode=$lg(^DHCWL.CodeCfg.SubGroupD(subgrpId),7)
					s num=num+1
					if (num>1){
						w ","
					}
					w "{""className"":""DHCWL.CodeCfg.SubGroup"",""CodeCfgGroupCode"":"_""""_subgrpCode_""""_",""CodeCfgGroupDesc"":"_""""_subgrpDesc_""""_",""ID"":"_""""_subgrpId_""""_",""CodeCfgGroupPTreeCode"":"_""""_subgrpPTreeCode_""""_",""CodeCfgGroupTreeCode"":"_""""_subgrpTreeCode_""""_",""code"":"_""""_subgrpSort_""""_",""level"":"_""""_mlevel_""""_"}"
				}
			}
		}
		w "]}"
		q
	}elseif action="saveSubGroup"{
		s Code=$g(%request.Data("Code",1))
		s Desc=$g(%request.Data("Desc",1))
		s groupCode=$g(%request.Data("groupCode",1))
		s grpId=$g(%request.Data("grpId",1))
		s result=##class(DHCWL.CodeCfgData.FunctionModule).SaveSubGroup(grpId,Code,Desc,groupCode)
		if (result=1){
			w "{success:true,tip:'ok'}"
		}elseif(result=-1){
			w "{success:true,tip:'error'}"
		}elseif(result=-2){
			w "{success:true,tip:'doubCode'}"
		}else{
			w "{success:true,tip:'false'}"
		}
	}elseif action="checkSubGrpTree"{
		s grpId=$g(%request.Data("grpId",1))
		d ##class(DHCWL.CodeCfgData.FunctionModule).GetCheckGroupTree(grpId)
		q
	}elseif action="getChildInfor"{
		s ID=$g(%request.Data("ID",1))
		s infor=##class(DHCWL.CodeCfgData.FunctionModule).GetTreeNodeChildFlag(ID)
		w "{success:true,tip:'"_infor_"'}"
	}elseif "exportSubGrp"=action {
		d ##class(DHCWL.CodeCfgData.FunctionModule).GetGrpInfor()
		s str="",deli=",",num=1
		w "["
		s grpID=""
		for{
			s grpID=$o(^||TEMPDHCWL($j,"Grp","Export",grpID))
			q:grpID=""
			s treeCode=""
			for{
				s treeCode=$o(^||TEMPDHCWL($j,"Grp","Export",grpID,treeCode))
				q:treeCode=""
				if ($g(^||TEMPDHCWL($j,"Grp","Export",grpID,treeCode))'=""){
					s infor=^||TEMPDHCWL($j,"Grp","Export",grpID,treeCode)
					w:num'=1 ","
					s num=num+1
					s newTreeCode=$p(treeCode,".",2,$l(treeCode,"."))
					s str="['"_$p(infor,"&",1)_"'"_deli_"'"_$p(infor,"&",2)_"'"_deli_"'"_$p(infor,"&",3)_"'"_deli_"'"_$p(infor,"&",4)_"'"_deli_"'"_$p(infor,"&",5)_"'"_deli_"'"_newTreeCode_"'"_deli_"'"_$p(infor,"&",6)_"'"_deli_"'"_$p(infor,"&",7)_"'"_deli_"'"_$p(infor,"&",8)_"'"_deli_"'"_$p(infor,"&",9)_"']"
					w str
				}else{
					s item=""
					for{
						s item=$o(^||TEMPDHCWL($j,"Grp","Export",grpID,treeCode,item))
						q:item=""
						w:num'=1 ","
						s infor=^||TEMPDHCWL($j,"Grp","Export",grpID,treeCode,item)
						s newTreeCode=$p(treeCode,".",2,$l(treeCode,"."))
						s str="['"_$p(infor,"&",1)_"'"_deli_"'"_$p(infor,"&",2)_"'"_deli_"'"_$p(infor,"&",3)_"'"_deli_"'"_$p(infor,"&",4)_"'"_deli_"'"_$p(infor,"&",5)_"'"_deli_"'"_newTreeCode_"'"_deli_"'"_$p(infor,"&",6)_"'"_deli_"'"_$p(infor,"&",7)_"'"_deli_"'"_$p(infor,"&",8)_"'"_deli_"'"_$p(infor,"&",9)_"'"_deli_"'"_$p(infor,"&",10)_"'"_deli_"'"_$p(infor,"&",11)_"']"
						s num=num+1
						w str
					}
				}
				
			}
		}
		w "]"
		q
	}elseif "exportGrp"=action {
		d ##class(DHCWL.CodeCfgData.FunctionModule).GetItemGrpInfor()
		s str="",deli=",",num=1
		w "["
		s itemGrpID=""
		for {
			s itemGrpID=$o(^||TEMPDHCWL($j,"Grp","Export",itemGrpID))
			q:itemGrpID=""
			if ($g(^||TEMPDHCWL($j,"Grp","Export",itemGrpID))'=""){
				s infor=^||TEMPDHCWL($j,"Grp","Export",itemGrpID)
				w:num'=1 ","
				s num=num+1
				s str="['"_$p(infor,"&",1)_"'"_deli_"'"_$p(infor,"&",2)_"'"_deli_"'"_$p(infor,"&",3)_"'"_deli_"'"_$p(infor,"&",4)_"'"_deli_"'"_$p(infor,"&",5)_"']"
				w str
			}else{
				s itemID=""
				for{
					s itemID=$o(^||TEMPDHCWL($j,"Grp","Export",itemGrpID,itemID))
					q:itemID=""
					w:num'=1 ","
					s num=num+1
					s infor=^||TEMPDHCWL($j,"Grp","Export",itemGrpID,itemID)
					s str="['"_$p(infor,"&",1)_"'"_deli_"'"_$p(infor,"&",2)_"'"_deli_"'"_$p(infor,"&",3)_"'"_deli_"'"_$p(infor,"&",4)_"'"_deli_"'"_$p(infor,"&",5)_"'"_deli_"'"_$p(infor,"&",6)_"'"_deli_"'"_$p(infor,"&",7)_"'"_deli_"'"_$p(infor,"&",8)_"']"
					w str
				}
			}	
		}
		w "]"
		q
	}elseif "GetLogInfor"=action{
		s onePage=$g(%request.Data("onePage",1))
		s queryJsonPros="{start:"_start_",end:"_end_",jsonProDeli:&}"
		s grpFlag=$g(%request.Data("grpFlag",1)) //检测是统计大组还是统计子组，统计子组为1，统计大组为2
		if (onePage=1){
			s name=$g(%request.Data("searchName",1))
			s modeType=$g(%request.Data("modType",1))
			s operType=$g(%request.Data("operType",1))
			s date=$g(%request.Data("date",1))
			s grpCode=$g(%request.Data("grpCode",1))
			s %session.Data("name")=name
			s %session.Data("modeType")=modeType
			s %session.Data("operType")=operType
			s %session.Data("date")=date
			s %session.Data("grpCode")=grpCode
			s %session.Data("grpFlag")=grpFlag
		}else{
			s name=$g(%session.Data("name"))
			s modeType=$g(%session.Data("modeType"))
			s operType=$g(%session.Data("operType"))
			s date=$g(%session.Data("date"))
			s grpCode=$g(%session.Data("grpCode"))
			s grpFlag=%session.Data("grpFlag")
		}
		//s ^TEMPDHCWL("BSCodeCfg","wk")=name_"^"_modeType_"^"_operType_"^"_date_"^"_grpCode_"^"_grpFlag
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.CodeCfgData.FunctionModule:GetLogInforQuery",queryJsonPros,name,modeType,operType,date,grpCode,grpFlag)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif "GetSubLogInfor"=action{
		s onePage=$g(%request.Data("onePage",1))
		s queryJsonPros="{start:"_start_",end:"_end_",jsonProDeli:&}"
		s grpFlag=$g(%request.Data("grpFlag",1)) //检测是统计大组还是统计子组，统计子组为1，统计大组为2
		if (onePage=1){
			s name=$g(%request.Data("searchName",1))
			s modeType=$g(%request.Data("modType",1))
			s operType=$g(%request.Data("operType",1))
			s date=$g(%request.Data("date",1))
			s grpCode=$g(%request.Data("grpCode",1))
			s %session.Data("nameSub")=name
			s %session.Data("modeTypeSub")=modeType
			s %session.Data("operTypeSub")=operType
			s %session.Data("dateSub")=date
			s %session.Data("grpCodeSub")=grpCode
			s %session.Data("grpFlagSub")=grpFlag
		}else{
			s name=$g(%session.Data("nameSub"))
			s modeType=$g(%session.Data("modeTypeSub"))
			s operType=$g(%session.Data("operTypeSub"))
			s date=$g(%session.Data("dateSub"))
			s grpCode=$g(%session.Data("grpCodeSub"))
			s grpFlag=%session.Data("grpFlagSub")
		}
		//s ^TEMPDHCWL("BSCodeCfg","wk")=name_"^"_modeType_"^"_operType_"^"_date_"^"_grpCode_"^"_grpFlag
		s json=##class(DHCWL.util.UniteQueryData).GetJsonFromQuery("DHCWL.CodeCfgData.FunctionModule:GetLogInforQuery",queryJsonPros,name,modeType,operType,date,grpCode,grpFlag)
		i json="" {
			w "{result:0,totalNum:0,root:[]}"
			q
		}
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif "GetLogDetailInfor"=action {
		s logID=$g(%request.Data("logID",1))
		s sql="select Grp_LogHeader,Grp_LogInfor,Grp_OperType from DHCWL_CodeCfg.DHCWLCodeCfgLogDetailInfo where Grp_LogDr="_logID
		s rs=##class(%Library.ResultSet).%New()
		d rs.Prepare(sql)
		d rs.Execute()
		s json=##class(DHCWL.util.Json).Json("name"_deli_"value"_deli_"type","result","root",deli)
		s num=0
		While(rs.Next()){
			//i (num<(start)) continue
			//i ((end)<num) continue
			//s len=$l(rs.Data("Grp_LogHeader"),"&")
			s logHeader=rs.Data("Grp_LogHeader")
			s logInfor=rs.Data("Grp_LogInfor")
			s type=rs.Data("Grp_OperType")
			s:type="Add" type="新增"
			s:type="Del" type="删除"
			s:type="DelAll" type="删除所有"
			s:type="itemNext" type="下移一位"
			s:type="moveup" type="上移一位"
			s:type="MoveToLocal" type="明细跳转"
			s:type="resetSort" type="排序重置"
			d json.Insert("'"_logHeader_"'"_deli_"'"_logInfor_"'"_deli_"'"_type_"'")
		}
		d rs.Close()
		d json.SetTotalNum(num)
		s jsonHead=json.GetHead()
		w jsonHead
		d{
			s obj=json.Next()
			w obj
		}while(obj'="")
		i json.GetCount()=0 w "]}"
	}elseif "initGrpLogGlobal"=action {
		k ^TEMPDHCWL("olnyForGrpLog","TJZZ")
		w "{success:true,tip:'ok'}"
		q
	}elseif "endGrpLogGlobal"=action {
		if ($d(^TEMPDHCWL("olnyForGrpLog","TJZZ"))){
			k dimLogList
			s dimLogList("operType")="更新"
			s dimLogList("modType")="子组明细"
			s dimLogList("depMod")=$g(^TEMPDHCWL("olnyForGrpLog","TJZZ","depMod"))
			s logID=##class(DHCWL.CodeCfgData.FunctionModule).SaveGrpLogInfor(.dimLogList,1)
			s dimLogList("LogHeader")="ID:描述"
			s dimLogList("logDr")=logID
			s num=""
			for{
				s num=$o(^TEMPDHCWL("olnyForGrpLog","TJZZ","Data",num),-1)
				q:num=""
				s type=$o(^TEMPDHCWL("olnyForGrpLog","TJZZ","Data",num,""),-1)
				continue:type=""
				s logInfor=$g(^TEMPDHCWL("olnyForGrpLog","TJZZ","Data",num,type))
				s dimLogList("LogInfor")=logInfor
				s dimLogList("Type")=type
				d ##class(DHCWL.CodeCfgData.FunctionModule).SaveGrpLogInfor(.dimLogList,2)
			}
		
			k ^TEMPDHCWL("olnyForGrpLog","TJZZ")
		}
		w "{success:true,tip:'ok'}"
		q
	}elseif "initItemGrpLogGlobal"=action {
		k ^TEMPDHCWL("olnyForGrpLog","TJDZ")
		w "{success:true,tip:'ok'}"
		q
	}elseif "endItemGrpLogGlobal"=action {
		if ($d(^TEMPDHCWL("olnyForGrpLog","TJDZ"))){
			k dimLogList
			s dimLogList("operType")="新增"
			s dimLogList("modType")="大组明细"
			s dimLogList("depMod")=$g(^TEMPDHCWL("olnyForGrpLog","TJDZ","depMod"))
			s logID=##class(DHCWL.CodeCfgData.FunctionModule).SaveGrpLogInfor(.dimLogList,1)
			s dimLogList("LogHeader")="ID:描述"
			s dimLogList("logDr")=logID
			s num=""
			for{
				s num=$o(^TEMPDHCWL("olnyForGrpLog","TJDZ","Data",num),-1)
				q:num=""
				s type=$o(^TEMPDHCWL("olnyForGrpLog","TJDZ","Data",num,""),-1)
				continue:type=""
				s logInfor=$g(^TEMPDHCWL("olnyForGrpLog","TJDZ","Data",num,type))
				s dimLogList("LogInfor")=logInfor
				s dimLogList("Type")=type
				d ##class(DHCWL.CodeCfgData.FunctionModule).SaveGrpLogInfor(.dimLogList,2)
			}
		
			k ^TEMPDHCWL("olnyForGrpLog","TJDZ")
		}
		w "{success:true,tip:'ok'}"
		q
	}elseif "getGrpCombo"=action{
		s sql="select ID,Grp_Code,Grp_Desc from DHCWL_CodeCfg.DHCWLCodeCfgGroup"   
		s rs=##class(%Library.ResultSet).%New()
		d rs.Prepare(sql)
		d rs.Execute()
		s deli=",",str="['',''],"
		While(rs.Next()){
			s str=str_"['"_rs.Data("ID")_"'"_deli_"'"_rs.Data("Grp_Code")_":"_rs.Data("Grp_Desc")_"'],"
		}
		d rs.Close()
		w "["_$e(str,1,$l(str)-1)_"]"
	}elseif "getSubGrpCombo"=action{
		s sql="select ID,ItemGrp_Code,ItemGrp_Desc from DHCWL_CodeCfg.DHCWLCodeCfgItemGroup"   
		s rs=##class(%Library.ResultSet).%New()
		d rs.Prepare(sql)
		d rs.Execute()
		s deli=",",str="['',''],"
		While(rs.Next()){
			s str=str_"['"_rs.Data("ID")_"'"_deli_"'"_rs.Data("ItemGrp_Code")_":"_rs.Data("ItemGrp_Desc")_"'],"
		}
		d rs.Close()
		w "["_$e(str,1,$l(str)-1)_"]"
	}elseif "updateGrpItemSort"=action{
		s subGrpID=$g(%request.Data("subGrpID",1))
		s sc=##class(DHCWL.CodeCfgData.FunctionModule).UpdateGrpItemSort(subGrpID)
		w "{success:true,tip:'"_sc_"'}"
	}elseif "moveup"=action{
		s subGrpID=$g(%request.Data("subGrpID",1))
		s itemID=$g(%request.Data("itemID",1))
		s sc=##class(DHCWL.CodeCfgData.FunctionModule).Moveup(subGrpID,itemID)
		w "{success:true,tip:'"_sc_"'}"
	}elseif "itemNext"=action{
		s subGrpID=$g(%request.Data("subGrpID",1))
		s itemID=$g(%request.Data("itemID",1))
		s sc=##class(DHCWL.CodeCfgData.FunctionModule).ItemNext(subGrpID,itemID)
		w "{success:true,tip:'"_sc_"'}"
	}elseif "MoveToLocal"=action{
		s subGrpID=$g(%request.Data("subGrpID",1))
		s itemID=$g(%request.Data("itemID",1))
		s aimsValue=$g(%request.Data("aimsValue",1))
		s sc=##class(DHCWL.CodeCfgData.FunctionModule).MoveToLocal(subGrpID,itemID,aimsValue)
		w "{success:true,tip:'"_sc_"'}"
	}
		
	
</script>
