<HTML>
<HEAD>
	<HISUI/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script type="text/javascript" src="../scripts/emr/lib/JQuery/datagrid-detailview.js"></script>
	<script type="text/javascript" src="../scripts/emr/js/tools.js"></script>
	<script language="cache" runat="server">
  		s appointUserID = %session.Get("LOGON.USERID")
		s appointUserLoc = %session.Get("LOGON.CTLOCID")
		s ssgroupID = %session.Get("LOGON.GROUPID")	
		s ssgroupIDItem = "@"_ssgroupID_"@"
		s authorizationSSGroupID = ##Class(EMRservice.BL.BLSysOption).GetOptionValueByName("AuthorizationSSGroupID")
        //onlyCurrentDept值为0，对应住院医生，只能给本人患者授权；
        //onlyCurrentDept值为1，对应住院医生主任，只能给本科室患者授权；
        //onlyCurrentDept值为2，对应医务科、病案室，能给全员患者授权；
		s onlyCurrentDept = "0"
        s KZRGroupIDs = $p(authorizationSSGroupID,"#",3)
        if (KZRGroupIDs '= "")&&("@"_KZRGroupIDs_"@" [ ssgroupIDItem)
        {
            s onlyCurrentDept = "1"
        }
        
        s YWKGroupIDs = $p(authorizationSSGroupID,"#",4)
        if (YWKGroupIDs '= "")&&("@"_YWKGroupIDs_"@" [ ssgroupIDItem)
        {
            s onlyCurrentDept = "2"
        }
        
        s BASGroupIDs = $p(authorizationSSGroupID,"#",5)
        if (BASGroupIDs '= "")&&("@"_BASGroupIDs_"@" [ ssgroupIDItem)
        {
            s onlyCurrentDept = "2"
        }
   </script>
	<script type="text/javascript">
		var ssgroupID = '#(ssgroupID)#';
		var appointUserID = '#(appointUserID)#';
		var appointUserLoc = '#(appointUserLoc)#';
		var onlyCurrentDept = '#(onlyCurrentDept)#';
        var titltObjName = "患者查询（医务科、病案室可对全院患者授权，需通过条件查询出患者再进行授权）";
        if (onlyCurrentDept == "0")
        {
            titltObjName = "患者查询（只能对本人患者进行授权）";
        }
        else if(onlyCurrentDept == "1")
        {
            titltObjName = "患者查询（只能对本科室患者进行授权）";
        }
   </script>
    <style type="text/css">
		.panel-body .panel-body-noheader 
		{ 
			border-color: #cccccc;;
		}
   </style>	
	<title>直接授权</title>
</HEAD>
<body class="hisui-layout">
	<div data-options="region:'center',headerCls:'panel-header-gray',border:false" style="padding:3px;">
		<div class="hisui-layout" data-options="fit:true">
			<div data-options="region:'center',headerCls:'panel-header-gray',border:false">
				<div id="patientListTableTBar" style="padding:5px;height:30px;">	
					<div style="margin-bottom:5px;">
						&nbsp;#(..Get("患者姓名"))# <input id="inputPatientName" class="textbox" style="width:80px;" />
						&nbsp;#(..Get("登记号"))# <input id="inputPatientRegNo" class="textbox" style="width:80px;" />
						&nbsp;#(..Get("就诊号"))# <input id="inputPatientEpisodeID" class="textbox" style="width:70px;" />
						&nbsp;#(..Get("病人号"))# <input id="inputPatientID" class="textbox" style="width:80px;" />
						&nbsp;#(..Get("病案号"))# <input id="inputMedicareNo" class="textbox" style="width:80px;" />
						<a href="#" id="patientSearchBtn" class="hisui-linkbutton" iconCls="icon-w-find">#(..Get("查询"))#</a>
						<a href="#" id="patientResetBtn" class="hisui-linkbutton" iconCls="icon-w-clean">#(..Get("清屏"))#</a>
					</div>		
				</div>
				<table id="patientListTable" class="hisui-datagrid" data-options="headerCls:'panel-header-gray',iconCls:'icon-paper',fit:true"></table>
			</div>
			<div data-options="region:'south',headerCls:'panel-header-gray',border:false" style="height:300px;padding-top:3px;">
				<div id="docListTableTBar" style="padding:5px;height:30px;">	
					<div style="margin-bottom:5px;">
						&nbsp;#(..Get("科室"))#&nbsp; <select id="inputDocLoc" name="inputDocLoc" class="hisui-combobox" style="width:130px;"></select>
						<!--&nbsp;&nbsp;#(..Get("安全组"))#&nbsp; <select id="inputDocSSGroup" name="inputDocSSGroup" class="hisui-combobox" style="width:126px;"></select> -->
						&nbsp;&nbsp;#(..Get("姓名"))#&nbsp; <input id="inputDocName" class="textbox" style="width:111px;" />
						&nbsp;&nbsp;#(..Get("用户名"))#&nbsp; <input id="inputDocUserCode" class="textbox" style="width:111px;" />
						<a href="#" id="docSearchBtn" class="hisui-linkbutton" iconCls="icon-w-find">#(..Get("查询"))#</a>
						<a href="#" id="docResetBtn" class="hisui-linkbutton" iconCls="icon-w-clean">#(..Get("清屏"))#</a>
					</div>		
				</div>
				<table id="docListTable" class="hisui-datagrid" data-options="headerCls:'panel-header-gray',iconCls:'icon-doctor',fit:true"></table>
			</div>
		</div>
	</div>
	<div id="eastPanel" data-options="region:'east',headerCls:'panel-header-gray',border:false" style="width:440px;padding:3px 3px 3px 0;">
		<div class="hisui-panel" title="授权信息" data-options="region:'south',headerCls:'panel-header-gray',split:false,fit:true,iconCls:'icon-paper',tools:'#episodehistory'" style="height:200px;">
			<div id="emrTreeDiv" class="hisui-layout" data-options="fit:true,border:false" style="border-color:#cccccc;">
				<div data-options="region:'north',border:false" style="overflow:hidden;">
					<div id="treeTBar" style="padding:5px;overflow-y:hidden;">
						#(..Get("授权时间(小时)"))#<input type="text" id="inputGivePowerSpan" style="width:30px;height:30px;margin:0 5px 0 5px;"></input>  
						#(..Get("授权操作类型"))# <select id="inputGivePowerType" class="hisui-combobox" name="inputGivePowerType" style="width:100px;height:30px;margin:0 5px 0 5px;"></select>
						<a href="#" id="treeHistoryBtn" class="hisui-linkbutton">#(..Get("授权历史"))#</a>	
					</div>
				</div>
				<div data-options="region:'center',border:false" style="border-top:1px solid #cccccc;border-bottom:1px solid #cccccc;">
					<ul id="emrTree" class="hisui-tree" data-options="lines:true"></ul>
				</div>
				<div data-options="region:'south',border:false" style="overflow:hidden;text-align:center;">
					<a href="#" id="treeGivePowerBtn" class="hisui-linkbutton" style="margin:5px 0 7px 0;background-color:#21BA45;">#(..Get("给予权限"))#</a>
				</div>
			</div>
		</div>
	</div>
	<div id="treeHistoryWin" style="border:0;padding:5px;">
		<div id="historyTableTBar" style="padding:5px;height:30;border:0;">	
			<div style="margin-bottom:5px;">
				#(..Get("生效类型"))# <select id="isCurrentValidSelect" class="hisui-combobox" name="isCurrentValidSelect" style="width:100px;"></select>
				<a href="#" id="withdrawBtn" class="hisui-linkbutton" iconCls="icon-w-close">#(..Get("撤销生效中授权"))#</a>
			</div>	
		</div>
		<table id="historyTable" class="hisui-datagrid" data-options="headerCls:'panel-header-gray',iconCls:'icon-doctor',fit:true"></table>
	</div>
	<div id="MessageWin" style="padding:5px">
		<div class="hisui-layout" data-options="fit:true">
			<div data-options="region:'north',headerCls:'panel-header-gray',border:false" style="height:90px;">
				<div style="height:20px;padding:8px 0px 3px 10px;">
					<span style="font-weight:bold;">#(..Get("给予医生："))#</span>
					<span> <a id="MsgDocName">#(..Get("给予医生"))#</a></span>
				</div>
				<div style="height:20px;padding:3px 0px 3px 10px;">
					<span style="font-weight:bold;">#(..Get("患者姓名："))#</span>
					<span> <a id="MsgPatName">#(..Get("患者姓名"))#</a></span>
				</div>
				<div style="height:20px;padding:3px 0px 8px 10px;">
					<span style="font-weight:bold;">#(..Get("操作类型："))#</span>
					<span> <a id="actionsName">#(..Get("操作类型"))#</a></span>
				</div>
			</div>
			<div data-options="region:'center',headerCls:'panel-header-gray',border:false">
				<div style="padding:0 3px 0 3px;">
					<table id="MsgWinTable" class="hisui-datagrid" data-options="headerCls:'panel-header-gray'" style="height:380px;border:1px solid #cccccc;"></table>
				</div>
				<div>
					<span style="height:50px;line-height:50px;overflow:hidden;padding-left:210px;">
						<a href="#" id="MsgBtnOK" class="hisui-linkbutton">#(..Get("确定"))#</a>
					</span>
					<span style="height:50px;line-height:50px;overflow:hidden;padding-left:15px;">
						<a href="#" id="MsgBtnCancel" class="hisui-linkbutton">#(..Get("取消"))#</a>
					</span>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../scripts/emr/js/auth.directauthorization.js"></script>
</body>
</HTML>
