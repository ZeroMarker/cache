<!-- Copyright (c) 2010 DHC Software Co.,Ltd. ALL RIGHTS RESERVED. -->
<!-- W650 -->
<html XMLNS=TRAK>
<head>
<!-- <TRAK:HEAD></TRAK:HEAD> -->
<EXTHEALTH:HEAD></EXTHEALTH:HEAD>
<STYLE>
</STYLE>
<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
 s returnval=##Class(websys.SessionLogon).Logon()
 ; ab 18.04.07 63052 - override timeout to 60 secs to free license
 s %session.AppTimeout=60
 q returnval
</csp:method>
<csp:method name=OnPostHTTP arguments="">
	k STATUS,username,password,department,ValidUser,welcometitle,medtrakver,copyright,copyrighttitle,traktooltip1,traktooltip2
</csp:method>
<title><TRAK:TRANSLATE></TRAK:TRANSLATE></title>
<link rel="stylesheet" href="../styles.css" type="text/css">
<SCRIPT language='javascript'>

function ChangePassword(obj) {
	var doc="websys.default.csp?WEBSYS.TCOMPONENT=SSUser.EditPassword&ID="+session['LOGON.USERID'];
	window.open(doc,'new','scrollbars=no,toolbar=no,width=300,height=200');
}
function resetSize()  {
  var posX=screen.availWidth;
  var posY=screen.availHeight;
  
  
//  ---DHC----------------------------  
  var winWidth=600;
  var winHeight=420;
//  ---DHC END -----------------------


  posX=posX-winWidth; if(posX<0) posX=0; else posX=posX/2;
  posY=posY-winHeight; if (posY<0) posY=0; else posY=posY/2;
  window.moveTo(posX,posY);
  window.resizeTo(winWidth,winHeight);
}
function unlockonunload() {
	websys_onunload();
	if (window.event) {
		if ((!islogon)&&(window.event.clientY < 0)) {
		   window.location.href="websys.closesession.csp";
		}
	}
	return true;
}
window.onunload=unlockonunload;
var islogon=0;
</SCRIPT>
</head>

<body text="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" oncontextmenu="return false;" >



<!-----------DHC --------------------------------------------
<TRAK:LOGOHEADER></TRAK:LOGOHEADER>
----------------------------------------------------->



<br>
<TABLE border=0 cellPadding=1 cellSpacing=1 width="100%">
  <TR>
    <TD align="middle">
	  <P align=center>
	  
	  
        <!-----------DHC -------------------------------------------
        </br>#($g(welcometitle))#<STRONG> #($g(%session.Data("TITLE")))#</STRONG>
        ---------C --------------------------------------------->
        
        
        </br><STRONG><FONT Color=red>#(STATUS)#</FONT></STRONG>
      </P>
    </TD>
  </TR>
</TABLE>

<CSP:IF condition="$g(lic)=1">
<TRAK:COMPONENT id="SSUserLogon" hidemenus=1></TRAK:COMPONENT>


<!-----DHC-------------------------------------------------------
<P align=center>#(LICENSE)# <STRONG>#($g(%session.Data("LICSITE")))#</STRONG></P>
--------------------------------------------------------->


<SCRIPT Language="JavaScript">
if (#(forcePasswordChange)#) ChangePassword();

var frm=document.forms['fSSUserLogon'];
frm.action="logon.csp";
var objUser=document.getElementById('USERNAME'); //frm.elements['USERNAME'];
//if (objUser) objUser.focus(); //set focus first to start
var objPswd=document.getElementById('PASSWORD'); //frm.elements['PASSWORD'];
var objDept=document.getElementById('DEPARTMENT'); //frm.elements['DEPARTMENT'];
var objRound=document.getElementById('ROUND'); //frm.elements['ROUND'];
var objListFlag=document.getElementById('LocationListFlag'); //frm.elements['LocationListFlag'];
var btnLogon=document.getElementById('Logon');
if (btnLogon) btnLogon.onclick=SetLogonClick;
if (tsc['Logon']) websys_sckeys[tsc['Logon']]=SetLogonClick;
function SetLogonClick(evt) {
	islogon=1;
	return Logon_click();
}

// SA 25.11.02 - log 30759: Changed from onblur, as this was automatically triggered incorrectly.
// Keydown will capture only the TAB event - assume moving away using mouse isn't used.
function EnterPassword(evt) {
  // keycode 9 is "TAB"
  if (websys_isIE) {var tabkeypressed=(window.event.keyCode==9)}
  else {var tabkeypressed=(evt.which==9)}
  if ((tabkeypressed)&&(objUser)&&(objUser.value!="")&&(objPswd)&&(objPswd.value!="")) {
	//may want to change department field
	if ((objDept)&&((objDept.disabled)||(objDept.readOnly))) btnLogon.onclick(); //Logon_click();
  }
}
if (objPswd) objPswd.onkeydown=EnterPassword;

if ('#(readonly)#'=='READONLY') {
	if (objUser) {
		objUser.readOnly=true;
		objUser.className='disabledField';
	}
	if (objPswd) {
		objPswd.readOnly=true;
		objPswd.className='disabledField';
	}
}

if ((objListFlag)&&(objListFlag.value!=1)) {
	if (objDept) {
		objDept.readOnly=true;
		objDept.className='disabledField';
	}
	var obj=document.getElementById('ld1473iDEPARTMENT');
	if (obj) obj.style.visibility='hidden';
} else {
	var obj=document.getElementById('ld1473iDEPARTMENT');
	if (obj) obj.style.visibility='';
}


if (#(locIsDisabled)#) {
	if (objDept) {
		objDept.readOnly=true;
		objDept.className='disabledField';
	}
	var obj=document.getElementById('ld1473iDEPARTMENT');
	if (obj) obj.style.visibility='hidden';
} else {
	if (objDept) {
		objDept.readOnly=false;
		objDept.disabled=false;
		objDept.className='';
		var obj=document.getElementById('ld1473iDEPARTMENT');
		if (obj.style.visibility=='hidden') objDept.onkeydown='';
		//if (objDept.value=="") objDept.onkeydown='';
	}
}
if (!#(ValidUser)#) {
	//disable department and changepassword link
	if (objDept) {
		objDept.disabled=true;
		objDept.className='disabledField';
	}
	var obj=document.getElementById('ld1473iDEPARTMENT');
	if (obj) obj.style.visibility='hidden';
	var obj=document.getElementById('CHANGEPASSWORD');
	if (obj) {
		obj.disabled=true;
		obj.className='disabledField';
		obj.onclick='';
	}
	if (objPswd) objPswd.value='';
}

if (!#(logonround)#) {
	if (objRound) {
		objRound.readOnly=true;
		objRound.className='disabledField';
		var roundobj=document.getElementById('ld1473iROUND');
		if (roundobj) { roundobj.style.visibility='hidden' }
	}
}


//SA: note that the following code is duplicated (slightly modified) in the standard SSUserLogon.js file
if ((objUser)&&(objUser.value=='')) {
	objUser.focus();
} else if ((objPswd)&&(objPswd.value=='')) {
	objPswd.focus();
} else if ((objDept)&&(objDept.value=='')&&(#(ValidUser)#)&&(!#(locIsDisabled)#)) {
	objDept.focus();
} else if ((objRound)&&(objRound.value=='')&&(#(ValidUser)#)&&(#(logonround)#)) {
	objRound.focus();
} else if (btnLogon) {
	btnLogon.focus();
}

</SCRIPT>
</CSP:IF> <!-- license check -->
<script language=javascript>
resetSize();
window.status='#(LICENSE)# #($g(%session.Data("LICSITE")))#'
</script>

<br><br>

<!--------------DHC-----------------------------------

<STYLE>
.footerBar {
	background-color: #D9D9FF; 
	background-image: url(../images/TRAK/horizgradient.gif);
	background-repeat: repeat-y;
	border-top-width: 5px;
	border-top-style: solid;
	border-top-color: #669999;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 11px;
	text-align: center;
	color:#669999;
	font-weight:bold;
	width:100%;
}
</STYLE>


<div class="footerBar" id="tkFooterBar" style="position:absolute;">
	<SCRIPT LANGUAGE=CACHE RUNAT=SERVER>
	w ##Class(websys.Configuration).VersionString()
	</SCRIPT>
	<br>&copy; 2005 TrakHealth. All rights reserved.
	</br>&nbsp;
</div>




<SCRIPT language='javascript'>
	var tkfooter=document.getElementById('tkFooterBar');
	var pgheight=document.body.offsetHeight;
	if (document.getElementById('PageContent')) {
		if (document.getElementById('PageContent').offsetHeight>pgheight) pgheight=document.getElementById('PageContent').offsetHeight;
	}
	tkfooter.style.top=eval(pgheight-tkfooter.offsetHeight-30)+"px";

</SCRIPT>

---------------------------------------------------------------------->

<CSP:COMMENT>
Install layout editor (if the user has access)
Not anymore, this will be called with SSUser.Logon component.show
</CSP:COMMENT>

</body>
</html>
