<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
 // d %response.SetCookie("sessionid",%session.SessionId,"","/","",1,0,"None")
 if ##class(websys.Conversions).IsValidClassName("websys.Filter") d ##class(websys.Filter).InjectionFilter()
 if ##Class(websys.SessionEvents).SessionExpired() q 1
 quit 1
</csp:method>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<TITLE><EXTHEALTH:TRANSLATE id=title>##(%session.Get("TITLE"))##</EXTHEALTH:TRANSLATE></TITLE>
	<SCRIPT SRC="../scripts/SysSound.js" type='text/javascript' charset='utf8'></SCRIPT>
	<EXTHEALTH:HEAD SoundScenes="HeaderMenu"></EXTHEALTH:HEAD>
	<link rel="shortcut icon" type="image/png" href="../logo.png">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="../scripts_lib/bootstrap/css/bootstrap.min.css"/>
	<HISUI css="epr.frames.css"></HISUI>
	<ADDINS/>
	<script type="text/javascript" src="../scripts_lib/bootstrap-3.0.3/dist/js/bootstrap.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="../scripts_lib/bootstrap-3.0.3/dist/js/jquery.backgroundcover.js"></script>
	<script type="text/javascript">/*会冲突hisui-tooltip*/	$.fn.popover.noConflict();	$.fn.tooltip.noConflict();	</script>
	<server>
	 Set IEVersion = ##class(ext.util.String).GetIEVersion()
	 if IEVersion="IE11" {
	 	 Set IEVersion = "IE11"
	 }ELSE{
	 	Set IEVersion = "IE8"
	 }
	 Set ActiveSkinRowId = $o(^websys.SkinI("ActiveIndex","Y",""))
	 Set lbgColor = "#47A8FF",rbgColor="#0979DE"
	 If ActiveSkinRowId>0{	
		Set skinObj = ##class(websys.Skin).%OpenId(ActiveSkinRowId)
		Set MenuBGColor = skinObj.MenuBGColor ;017BCE
		If $zcvt(MenuBGColor,"L")="#ff0000"{
			Set lbgColor="#EF4444",rbgColor="#7F1D1D"
		}
		If $zcvt(MenuBGColor,"L")="#00ff00"{
			Set lbgColor="#10b981",rbgColor="#064e3b" // green
			//Set lbgColor="#F59E0B",rbgColor="#78350F" yellow
		}
		If $zcvt(MenuBGColor,"L")="#0000ff"{
			Set lbgColor="#3B82F6",rbgColor="#1E3A8A"
		}
		Set LeftMenuBGColor = "#026cb4" //"#"_lbgColorG_lbgColorR_lbgColorB	;366abf
		Set MenuSelectedBGColor = skinObj.MenuSelectedBGColor
		Set skinObj=""
	 }
	 Set iconVolumeOnText = ..Get("开启消息提示音") 
	 Set iconVolumeOffText = ..Get("关闭消息提示音")
	 Set OtherMenuTan = ##class(websys.Translation).Get("DIC","其它")
	 Set NormalTan = ##class(websys.Translation).Get("DIC","正常")
	 Set MediWayLan = ##class(websys.Translation).Get("DIC","医为医疗")
	 Set ExitTipLan = ..Get("您确定退出系统")
	 Set CurYear = $p($zd(+$h,3),"-")
	 Set MenuHeight = 36
	 Set IsWideScreen = 0
	 if $d(%session.Data("LOGON.IsWideScreen"))#2 Set IsWideScreen=%session.Data("LOGON.IsWideScreen")
	 If IsWideScreen {
		 Set MenuHeight = 46
	 }
	 Set AccessToken = %session.Get("LOGON.AUTH2TOCKEN")
	 Set CASTypeCode = %session.Get("LOGON.CASTypeCode")
	 Set MWHOSAuth2Logon = 0
	 If CASTypeCode="MWHOSAuth2",AccessToken'=""{
		Set MWHOSAuth2Logon = 1
	 }
	 Set CTLodId = %session.Data("LOGON.CTLOCID")
	Set GroupId = %session.Data("LOGON.GROUPID")
	Set GroupDesc = $p(^SSU("SSGRP",GroupId),"^",1)
	Set PostId = 0
	If $d(%session.Data("LOGON.ACCPOSTID"))#2 Set PostId = %session.Data("LOGON.ACCPOSTID")
	Set PostDesc = "",PostDictCode="",PostDictDesc=""
	if PostId>0,$d(^CT.BDP.CT.HOSPostD(PostId))#2 {
		Set PostDesc = $Lg(^CT.BDP.CT.HOSPostD(PostId),3)
		Set PostDictId = $Lg(^CT.BDP.CT.HOSPostD(PostId),5)
		If PostDictId>0{
			Set PostDictCode = $lg(^CT.BDP.CT.HOSPostDictD(PostDictId),2)
			Set PostDictDesc = $lg(^CT.BDP.CT.HOSPostDictD(PostDictId),3)
		}
	}
	Set GroupSetId = ##class(epr.GroupSettings).GetIdFromGroupId(GroupId)
	Set GroupMutilTabMenu = $lg(^ooGroupSettingsD(GroupSetId),116)
	Set GroupShowPanelMenu = $lg(^ooGroupSettingsD(GroupSetId),117)
	Set MenuCode=$G(%request.Data("MenuCode",1),"")
	Set MenuIdByCode = ##class(websys.Menu).GetIdFromCodeOrDescription(MenuCode)
	// MenuCode=DHC.IP.Doctor.OrdExec
	// DHC.Consult.Manager.IPDoc  dhcem.consultmain.csp
	// CIS.AN.OPM cis.an.operapplication.csp
	Set ViewCode = $g(%request.Data("ViewCode",1))
	If (ViewCode=""){
		Set menuJson = ##class(websys.Menu).Json(MenuIdByCode,GroupId)
	}else{
		Set menuJson = "[]"
		Set MenuHeight = 0 /*视图方式时不显示头菜单*/
	}
	</server>
<style>
/*#0063A7*/
body {
  overflow: hidden;
  font-family: "Microsoft YaHei";
  font-size: 16px;
  line-height: 1.7;
  color: #333;
  background-color: transparent; /*#017BCE;*/
  padding:0; /*2018-7-6*/
}
.layout-panel-center{
	background-color: transparent; /*#017BCE;*/
}
.navbarhead a {
  color: #ffffff;
}
.centerPanel {
  overflow: hidden;
  /*background-color: #ffffff;*/
  background-color: transparent;
  position: absolute;
  width:100%;
  height:600px;
}
.eastPanel-wanghc-layout{
    position: absolute;
    background-color:#ffffff;
    height:100%;
    top: 0px;
    right: 0px;
}
.navbar-fixed-top {
  border-width: 0px;
}
.navbarhead .navbar {
  min-height: #(MenuHeight)#px;
  margin-bottom: 0px;
}
.navbarhead .navbar-default {
  /*color: #fff;
  background-color: #(MenuBGColor)#; 
  */
  color: #fff;
  background: linear-gradient(270deg, #(lbgColor)# 0%, #(rbgColor)# 100%);
  opacity: 1;
  border-radius: 0px;
  z-index:8999; /*9003; hisui-window从9000开始,9003会覆盖hisui-window*/ 
}
.navbarhead .navbar-default a.navbar-brand {
  color: #ffffff;
}
.navbarhead .navbar-default a:hover.navbar-brand {
  color: #ffffff;
}
.navbarhead .navbar-default .navbar-brand {
  height: 35px;
  padding-top: 5px;
}
.navbarhead .navbar-default .navbar-nav {

}
.navbarhead .navbar-default .navbar-nav > .active > a {
  background-color: #ffffff;
  border-color: #ffffff;
  color: #000000;
}
.navbarhead .navbar-default .navbar-nav > li > a {
  color: #ffffff;
  padding: 10px;
  line-height: #(MenuHeight-20)#px;
  font-size: 14px;
}

.navbarhead .navbar-default .navbar-inner .navbar-nav > .clickactive > a {
  color: #fff;
  background-color: #(MenuSelectedBGColor)# ; /*#ffffff; 选中color*/ 
  /*margin-top: 2px;
  padding-top: 8px;*/
}
/*.navbarhead .navbar-default .navbar-container .navbar-buttons .navbar-nav {
  margin-right: 5px;
}*/
.navbarhead .navbar-default .navbar-container .navbar-buttons .navbar-nav li:first > a {
  padding-left: 15px;
  padding-right: 15px;
}
.badge{
	z-index:90;
}
.navbarhead .navbar-default .navbar-container .navbar-buttons .nullMessage {
  padding-bottom: 15px;
}
.navbarhead .navbar-default .navbar-container .navbar-buttons .nullMessage .badge {
  display: none;
  position: relative;
  top: 5px; /*-6px*/
  left: -10px;
  line-height: 0.9;
  padding: 3px;
  color: #ffffff;
  background-color: red;
}
/*.navbarhead .navbar-default .navbar-container .navbar-buttons .hasMessage {
  padding-right: 4px;
}*/
.navbarhead .navbar-default .navbar-container .navbar-buttons .hasMessage .badge {
  display: inline-block;
  /*position: relative;
  top: -6px;
  left: -10px;
  */
  line-height: 0.9;
  padding: 3px;
  color: #ffffff;
  background-color: red;
  position: absolute;
  top: 5px; /*-6*/
  left: 22px;
}
.fontsettings {
  margin-left: 20px;
}
.fontsettings span {
  cursor: pointer;
  margin-left: 2px;
  margin-right: 2px;
}
.userlocinfo {
  display: inline-block;
  zoom: 1;
  font-size: 13px;
  line-height: 15px;
  max-width: 200px;
  overflow: hidden;
  vertical-align: top;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin-left:26px;
}
.userinfo {
  display: block;
}
.locinfo {
  float:left; /*right---ie11兼容下对不齐*/
}
.navbar-toggle {
  margin-top: 4px;
  margin-bottom: 4px;
}
/*三级菜单*/
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu:hover > .dropdown-menu {
  display: block;
}
.dropdown-submenu > .dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  -webkit-border-radius: 0 6px 6px 6px;
  -moz-border-radius: 0 6px 6px;
  border-radius: 0 6px 6px 6px;
}
.pull-right .dropdown-submenu > .dropdown-menu {
  left: auto;
  right:98%;
}
.pull-right .navbar-nav > li.dhc-menu > .dropdown-menu {
  right:0;
  left: auto;
}
.dropdown-submenu:hover > a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu > a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #ccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left > .dropdown-menu {
  left: -100%;
  margin-left: 10px;
  -webkit-border-radius: 6px 0 6px 6px;
  -moz-border-radius: 6px 0 6px 6px;
  border-radius: 6px 0 6px 6px;
}
/*下拉菜单背景色 #FEFEFE*/
.navbar-nav>li>.dropdown-menu, li.dropdown-submenu>ul.dropdown-menu{
	background-color:#FEFEFE;
	min-width:140px;
}
.dropdown-menu>li>a{
	/*color:#ffffff;*/
	position:relative;
	padding-left:25px;
}
.aboutMiddle{
	width: 480px;
	height: 374px;
	border: 0px;
	border-style: solid;
	border-color: #ffffff;
	border-top: 1px;
	margin: 0 auto;
}
.aboutMiddle-left-mid{
	float: left;
	width: 162px;
	height: 374px;
	padding: 110px 40px 179px 40px;
	background-image: url("../skin/default/images/websys/aboutlogo.png");
	background-repeat:no-repeat;
	background-position: 40px 110px;
}
.aboutbody ul>li{
	margin-top:5px;
}
.aboutbody{
	float: left;
	width: 295px;
	height: 374px;
	background-image: url("../skin/default/images/websys/logo.png");
	background-repeat:no-repeat;
	background-position: 0px 29px;
}
.aboutul{
	margin-top: 105px;
	font-size:8px
	font-family: 'MicrosoftYaHei';
}
.aboutul span{
	word-break: break-all;
}
.aboutfooter{
	background-color:#f7f7f7;
	width:493px;
	height:35px;
	left: 0px;
	font-size:12px;
	margin-top:7px;
	color:#999999; /*#B5B5B5;*/
	position: absolute;
	padding:8px 0px 0px 150px;
	border-bottom-left-radius: 5px;
	border-bottom-right-radius: 5px;
	bottom: 0px;
	border-top:1px solid #cccccc;
}
.ca-aboutbody li{
	padding-top:6px;
}
.panel-body{
	padding:0px;
}
.panel-body.messager-body {
    padding: 10px;
}
.modal-header{
	padding:8px;
	background-color:#556983;
	color:#ffffff;
}
.close,.close:hover{
	color:#ffffff;
	opacity:0.8;
}
.navbarhead .navbar-default .navbar-nav > LI {
	height:#(MenuHeight)#px;
}
.navbarhead .navbar-default .navbar-nav > LI > A.rightMainMenu{
	/*box-sizing:border-box;*/
	padding-top:12px;
	height:#(MenuHeight)#px;
}
.navbar-container a:focus{
	outline:none;
}

/*.navbarhead .dropdown-menu > li > a:focus,*/ 
.navbarhead .dropdown-menu > li > a:hover
{
  /*color: #ffffff;*/
  background-color: #21BA45;
}

/*.navbarhead .navbar-default .navbar-nav > .active > a:focus,*/
.navbarhead .navbar-default .navbar-nav > .active > a:hover {
  background-color: #ffffff;
  border-color: #ffffff;
  color: #000000;
}
/**/
/*.navbarhead .navbar-default .navbar-nav > li > a:focus,  点击不要变色效果*/
.navbarhead .navbar-default .navbar-inner> .navbar-nav > li > a:hover {
  background-color: #(MenuSelectedBGColor)#;
  border-color: #(MenuSelectedBGColor)#;
  color: #fff;
}
.navbarhead li.hover{
	background-color:  #(MenuSelectedBGColor)#;
    border-color:  #(MenuSelectedBGColor)#;
    color: #fff;
}
.navbarhead .navbar-default .navbar-nav > .open > a,
/*.navbarhead .navbar-default .navbar-nav > .open > a:focus,*/
.navbarhead .navbar-default .navbar-nav > .open > a:hover {
  color: #ffffff;
  background-color:  #(MenuSelectedBGColor)#;
}
/*下拉菜单选中色*/
 /*.navbarhead .dropdown-menu > li > a:focus*/
.navbarhead .dropdown-menu > li > a:hover,.navbarhead .dropdown-menu > li.selected a{
	color: #ffffff; /*#000000;*/
    background-color: #20BB44 ; /*#ffffff;*/
}
/**----*/
.navbarhead .navbar-default .navbar-nav > li > a.dhc-icon-th{
    padding: 6px;
    display: inline-block;
    width: 30px;
    height: 30px;
    border: 1px #7BC2F2 solid;
    margin-top: 10px;
    background: #3FA2DF;
}
.navbarhead .navbar-default .navbar-nav > li > a.dhc-icon-user{
    border-radius: 15px;
}
.navbarhead .navbar-default .navbar-nav > .open > a.dhc-icon-th,
/*.navbarhead .navbar-default .navbar-nav > .open > a:focus,*/
.navbarhead .navbar-default .navbar-nav > .open > a.dhc-icon-th:hover {
  border: 1px #40a2de solid;
  color:#ffffff;
  background-color: #0063a7;
}
.dhc-fa-icon-large{
	background-repeat:no-repeat;
	display:inline-block;
	width:16px;
	height:16px;
	/*position: absolute;*/
}
.dhc-fa-icon-small{
	background-repeat:no-repeat;
	display:inline-block;
	width:14px;
	height:14px;
    position: absolute;
    left: 10px;
    top: 5px;
}
.icon-user-md{
	position: absolute;
}
a.dhc-submenu{
	position: relative;
}
.dhc-menucount{
    top: 0px;
    left: 0px;
    position: absolute;
    background-color: red;
    padding: 2px 3px;
    border-radius: 10px;
    line-height: 0.8;
    min-width: 10px;
    font-size: 10px;
    font-weight: 700;
    color: #fff;
    text-align: center;
    white-space: nowrap;
    vertical-align: middle;
    border-radius: 10px;
}
span.dhc-menustar {
    height: 8px;
    background: red;
    vertical-align: top;
    width: 8px;
    display: inline-block;
    border-radius: 4px;
}
#SystemHeaderMenuHelp .dhc-menu{
	position: relative;
}
/*.dropdown-submenu:hover > a:after {
    border-left-color: #20BB44;
}*/
#SystemHeaderMenuHelp .dhc-menu:hover .dropdown-menu{
	display:block;
	left:auto;
	right:98%;
	top:-8px;
	
}
</style>
<csp:if condition=IsWideScreen>
	<style type="text/css">
	.navbarhead .navbar-default .navbar-nav > LI > A.rightMainMenu-user{
		padding-top:16px;
	}
	</style>
</csp:if>
<csp:if condition=IsWideScreen>
	<style type="text/css">
	.lockScreen .in_img.img1{
		background:url(../images/websys/lockScreen_bg_wide.png)  no-repeat!important;
		width: 100%;
	    	height: 100%;
	}
	.lockScreen .in_img.img2{
		background:url(../images/websys/lockScreen_bg2_wide.png)  no-repeat!important;
		width: 100%;
	    height: 100%;
	}
	.lockScreen .in_img.img3{
		background:url(../images/websys/lockScreen_bg3_wide.png)  no-repeat!important;
		width: 100%;
	    height: 100%;
	}
	</style>
<csp:else>
	<style type="text/css">
	.lockScreen .in_img.img1{
		background:url(../images/websys/lockScreen_bg.png)  no-repeat!important;
		width: 100%;
	    	height: 100%;
	}
	.lockScreen .in_img.img2{
		background:url(../images/websys/lockScreen_bg2.png)  no-repeat!important;
		width: 100%;
	    height: 100%;
	}
	.lockScreen .in_img.img3{
		background:url(../images/websys/lockScreen_bg3.png)  no-repeat!important;
		width: 100%;
	    height: 100%;
	}
	</style>
</csp:if>
<style type="text/css">
.lockScreen .carousel-inner ,.lockScreen .carousel-inner .item{
	width: 100%;
    height: 100%;
}
.lockScreen{
	z-index: 10000002!important;
    left: 0;
    line-height: 30px;
    padding: 9px 14px;
    position: fixed;
    right: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: none!important;
    padding: 0!important;
}
.lockScreen .iconLock{
    background: url(../images/websys/iconLock.png) no-repeat!important;
    background-size: contain;
    width: 205px;
    height: 205px;
    margin: 15px auto 90px;
    line-height: 500px;
    color: #fff;
    font-size: 26px;	
    text-align: center;
}
.lockScreen .iconLockOpen{
	background:url(../images/websys/iconLockOpen.png)!important;
	background-size:contain;	
	width: 20px;
    height: 24px;
	display: block;	
	margin: 7px 0 0 9px;
}

.lockScreen .bg{
	background-size: cover!important;
}
.lockScreen>div:first-child{
	opacity: 1!important;
}
.lockScreen .form-control{
	border-radius: 0;
    display: block;
    width: 100%;
    height: 40px;
    padding: 0px 12px;
    font-size: 14px;
    line-height: 1.42857143;
    color: #555;
    background-color: #fff;
    background-image: none;
    border: 1px solid #ccc;
    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,0.075);
    box-shadow: inset 0 1px 1px rgba(0,0,0,0.075);
    -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
    -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
    transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
}
.lockScreen>div:last-child{
	top: calc(50% - 185px)!important;
    left:calc(50% - 175px)!important;
    width: 350px;
    position: absolute;
}
.lockScreen>div:last-child>div:last-child{
	background: transparent!important;
	width: 100%;
	height: 100%;
	padding: 0;
}
.lockScreen .verifyPassword_zl{
    background: #ccc;
    width: 38px;
    height: 38px;
    display: block;
    /*margin: 0px -23px 0 0;*/
    margin-top: -39px;
    float: right;
}
.lockScreen .time{
	position: fixed;
	top: 50px;
	left: 50px;
	color: #fff;
}
.lockScreen .time >div{
	float:left;
}
.lockScreen .time>div.z-time{
	font-size: 82px;
	line-height: 82px;
	border-right: 1px solid;
	padding-right: 20px;
}
.lockScreen .time>div.z-dateweek{
	line-height: 42px;
	font-size: 26px;
	padding-left: 20px;
}
/*../skin/default/images/logon/ca_sound_mphone.png*/
.icon-syssound{
    background: url('../images/fa/fa-record-disable.png');
    background-size: 16px 16px;
 }
 .record-open>.icon-syssound { 
    background: url('../images/fa/fa-record-enable.gif');
    background-size: 16px 16px;
 }
</style>
<server>
	w "<style>"
	for cssname = "th-large","envelope","user-md","notice","secondscreen","singlescreen","findwebsysmenu","dts"{
		w ".dhc-menu.open .icon-"_cssname_"{background:url('../images/fa/fa-"_cssname_"-000.png') ;}",!
		w ".icon-"_cssname_"{background:url('../images/fa/fa-"_cssname_"-fff.png') ;background-size: 16px 16px;}",!
	}
	for cssname="question-sign","volume-off","volume-up","question-sign","cog","key","exchange","reply","off"{
		w "a.dhc-submenu:hover .icon-"_cssname_"{background:url('../images/fa/fa-"_cssname_"-fff.png') ;background-size: 16px 16px;}",!
		w ".icon-"_cssname_"{background:url('../images/fa/fa-"_cssname_"-000.png') ;background-size: 16px 16px;}",!
	}
	w "</style>"
	
</server>
<style type="text/css">
.box {
    position: absolute;
    left: -18%;
    top:-3px;
    width: 800px;
    border-radius: 3px;
    box-shadow: 1px 1px 10px #666;
    background-color: #FFFFFF;
    overflow: auto !important;
    max-height: 500px;
    filter: alpha(opacity=0);
    opacity: 1;
    border-bottom: 1px none #074c52;
    z-index: 99;
}
.box .cont {
    position: relative;
    padding: 15px 0 0px 20px;
}
.box ul.clearfix {
    display: block;
}
.box .sublist>li {
    float: left;
    width: 97.5%;
    padding-right: 2px;
    padding-bottom: 10px;
}
.ltitlebox{text-align:right;width:15%;position:relative;float:left;/*padding-top:4px;*/}
.sublist>li h3.ltitle {
    background-color: #FFFFFF;
    margin-right: 10px;
    margin-top: 10px;
    border-radius: 2px;
    font-weight: bold;
    font-family: '微软雅黑';
    font-size: 14px;
    color: #333;
    border-bottom: 1px none #666666;
    word-break: keep-all;
}
.sublist>li div.lbody {
    padding-left: 10px;
    margin-top: 0;
    width:85%;
    border-left:1px solid #CCCCCC;
    position:relative;
    float:left;
}
.lbody>ul>li{
	display: block;
    width: 24%;
    float: left;
}
.sublist>li div.lbody a:hover {
    background-color: #DCDCDC;
    color: #000000;
}
.sublist>li div.lbody a {
    width:100%;
    padding: 5px 10px 5px 10px;
    margin-left: 5px;
    font-size: 14px;
    color: #333;
    text-decoration: none;
    display: inline-block;
    /*white-space: nowrap;*/
    line-height:16px;
}
.pm-caret-in {
    display: block;
	float: right;
    width: 0;
    height: 0;
    border-color: transparent;
    border-style: solid;
    border-width: 5px 0 5px 5px;
    border-left-color: #000000;
    margin-top: 8px;
    margin-left: 10px;
}
.box .dropdown-submenu > a:after{
	margin-right: 0px;
}
a:focus{
	color:#FFFFFF;  /*hisui-alert提示按钮字体颜色被bootstrap覆盖了，重写回来*/
}
.panel-tool a:focus{  /*由于前面定义了a:focus颜色，导致了hisui panel工具按钮当按住拖拽一下后 按钮看不到了*/
  color: #7E7E7E;	
}

.sysMenuFindTxt{
	height: 35px;
    margin: 1px 0;
    background: #ffffff;
    border: 1px solid #0664ba;
    padding-left: 5px;
    color: #000000;
    float:left;
    width:140px;
}
.sysMenuFindTxt:hover,.sysMenuFindTxt:focus{
    background: #ffffff;
    color: #000000;
}
.sysMenuFindCont{
	width:176px;
}
</style>

<csp:if condition=IEVersion="IE8">
<style>
/*IE低版本布局乱，是li的float莫名其妙没了*/
.navbar-nav>li{
	float:left!important;
	display:list-item!important;
	/*display:inline-block!important;
	float:none!important;*/
}
/*IE低版本莫名其妙有了margin*/
/*IE8需要floatleft,IE7却不需要*/
.navbar-nav{
	margin:0!important;
	float:left!important;
}
/*IE低版本生成三角号*/
.caret-in {
    display: block;
	float: right;
    width: 0;
    height: 0;
    border-color: transparent;
    border-style: solid;
    border-width: 5px 0 5px 5px;
    border-left-color: #ccc;
    margin-top: -18px;
    margin-right: 10px;
}
/*分隔线显示不对，在js中增加一class*/
.dropdown-menu .divider-ie{
    margin:-9px 0 0 0;
    width:100%;
}
</style>	
</csp:if>
</head>
<body class='hisui-layout' style="background-color: transparent;">
<div data-options='region:"center",title:"",split:true' style="background-color: transparent;border-color:transparent; border-radius:0px;"> 
 <csp:method name=GetTrans arguments="CN,PN,Key">
 Quit ##class(websys.TranslationEPR).GetTrans(CN,PN,"",Key)
</csp:method>
<SERVER>
	
	Set HelpMenuId = ##class(websys.Menu).GetIdFromCodeOrDescription("System.HeaderMenu.Help")
	Set HeaderMenuDesc = ##class(websys.Translation).Get("DIC","帮助文档")
	Set HeaderMenuHelpJson = "[]"
	If (HelpMenuId>0){
		Set HeaderMenuDesc = ##class(websys.Menu).%OpenId(HelpMenuId,0).Caption
		Set HeaderMenuHelpJson = ##class(websys.Menu).Json(HelpMenuId,GroupId)
	}
	/*wanghc*/
	set CloseSessionMenuId = ##class(websys.Menu).GetIdFromCodeOrDescription("Main.Close")
	
	Set EnableExitAlert = 0
	if ##class(%Dictionary.CompiledProperty).%ExistsId("websys.Configuration||EnableExitAlert"){
		Set EnableExitAlert = ##class(websys.Configuration).GetFieldValue("EnableExitAlert")
		if EnableExitAlert="" Set EnableExitAlert=0
	}
	/*工作站 wanghc 2017-03-08*/
	Set WorkStationDesc = ##class(websys.DHCWorkstationLnkGrp).GetWorkstation(GroupId, CTLodId)
	If (WorkStationDesc=""){
		Set WorkStationDesc = MediWayLan
	}
	Set LicInfo = ##class(websys.License).GetInfo()
	
	Set LicExpDate = $P(LicInfo,"^",2)
	Set LicVerSummary = $P(LicInfo,"^",3)
	Set LicUserName = $P(LicInfo,"^",5)
	Set LicPrj = $TR($P(LicInfo,"^",6)_" HIS "_$p($P(LicInfo,"^",7),".",1,2),"R","")   //产品名称
	Set LicVer = $p($g(^CF("SM",1)),"^",5) //产品版本
	Set LicVer = $p(LicVer," ",$l(LicVer," "))
	Set LicUseType = $p(LicInfo,"^",9)
	Set ModelLicType = NormalTan
	if ##class(websys.Conversions).IsValidMethodName("BSP.Lic.SRV.Interface","GetModelType"){
		Set ModelLicType = ##class(BSP.Lic.SRV.Interface).GetModelType()
	}
	Set EncryptCmpCode = ##class(websys.License).EncryptCmpCode()
	; 消息配置
	Set messageShowFlag = 1,MsgSearchInterval=3,iconVolumeCls="",iconVolumeText="",EnableMsgAudio="false",MsgShowByCatgory=""
	//If (##class(websys.Conversions).IsValidMethodName("web.DHCBL.Authorize.CTLocAut","IsAutCTLoc")){
	//	if '##class(web.DHCBL.Authorize.CTLocAut).IsAutCTLoc(CTLodId) {
	If (##class(websys.Conversions).IsValidMethodName("websys.DHCMessageConfig","MsgBtnIsDisabled")){
		if (##class(websys.DHCMessageConfig).MsgBtnIsDisabled(CTLodId)){
			Set messageShowFlag = 0
		}
	}elseif(##class(websys.Conversions).IsValidMethodName("web.DHCBL.Authorize.CTLocAut","IsAutCTLoc")){
		if '##class(web.DHCBL.Authorize.CTLocAut).IsAutCTLoc(CTLodId) {
			Set messageShowFlag = 0
		}
	}
	If (messageShowFlag=1){
		Set MsgSearchInterval = +$lg($g(^websys.DHCMessageConfigD(1)),2)
		if MsgSearchInterval=0 Set MsgSearchInterval=3
		if ##class(websys.DHCMessageConfig).MsgAudioIsDisabled(%session.Get("LOGON.USERID")) {
			Set iconVolumeCls = "icon-volume-off", iconVolumeText=iconVolumeOnText, EnableMsgAudio="false"
		}else{
			Set iconVolumeCls = "icon-volume-up", iconVolumeText=iconVolumeOffText, EnableMsgAudio="true"
		}
		If (##class(websys.Conversions).IsValidMethodName("websys.DHCMessageConfig","GetShowByCatgory")){
			s MsgShowByCatgory=##class(websys.DHCMessageConfig).GetShowByCatgory()	
		}
	}
	n LogonFromVB
	s (LogonFromVB)=""
	i $p($g(%request.Data("LogonFromVB",1)),"^",1)=1 s LogonFromVB=$g(%request.Data("LogonFromVB",1)) ;s ^zTRAK("cjb","epr.frames.csp")=LogonFromVB
	
	;KK 18/jul/2002 Log 23459 To display the system security message	
	n securitymsg
	s securitymsg=""
	i $d(%request.Data("RELOGON",1))'="" d
	. s securitymsg=##Class(web.SSUser).GetSystemSecurityMessage(%session.Get("LOGON.USERID"))
	;i $p($g(%request.Data("LogonFromVB",1)),"^",1)=1 s ^zTRAK("cjb","epr.menu.csp")=$g(%request.Data("LogonFromVB",1))
	n str,LogonPatientID,LogonEpisodeID,LogonMradm,LogonAnaesthesiaID
	s (str,LogonPatientID,LogonEpisodeID,LogonMradm,LogonAnaesthesiaID)=""
	i $p($g(%request.Data("LogonFromVB",1)),"^",1)=1 s str=$p($g(%request.Data("LogonFromVB",1)),"^",2)
	i str'="" s LogonPatientID=$p(str,":",3),LogonEpisodeID=$p(str,":",4)
	/*处理参数,RegNo中取ID,如果传RegNo与AdmTimes时,循环算出EpisodeID*/
	Set PatientNo = $g(%request.Data("RegNo",1))
	if (PatientNo'="") Set LogonPatientID=$O(^PAPERi("PAPMI_PatNo",PatientNo,""))
	If $G(%request.Data("EpisodeID",1))'="" Set LogonPatientID = $G(%request.Data("EpisodeID",1))
	Set LogonAnaesthesiaID = $g(%request.Data("AnaesthesiaID",1))
	if (""'=$G(%request.Data("EpisodeID",1))) {
		Set LogonEpisodeID = $G(%request.Data("EpisodeID",1))
		Set LogonPatientID = $P($G(^PAADM(LogonEpisodeID)),"^",1)
		Set LogonMradm = $P($G(^PAADM(LogonEpisodeID)),"^",61)
	}
	If LogonEpisodeID="",LogonPatientID'=""{
		Set LogonEpisodeID=$O(^PAPERdr(LogonPatientID,"ADM","I",""),-1)
		If LogonEpisodeID="" Set LogonEpisodeID=$O(^PAPERdr(LogonPatientID,"ADM","O",""),-1)
		If LogonEpisodeID="" Set LogonEpisodeID=$O(^PAPERdr(LogonPatientID,"ADM","E",""),-1)
		if (PatientNo'=""){
			If LogonPatientID'="",$g(%request.Data("AdmTimes",1))'=""{
				Set PAAdm="",AdmTimes = $g(%request.Data("AdmTimes",1))
				Set ind=0
				For  Set PAAdm=$O(^PAPERdr(LogonPatientID,"ADM","I",PAAdm)) Quit:(PAAdm="")&&(ind=AdmTimes)  Do
				.Set ind=ind+1
				.Quit:ind=AdmTimes
				Set LogonEpisodeID = PAAdm
			}
		}
	}
	If LogonEpisodeID'="" Set %request.Data("EpisodeID",1)=LogonEpisodeID
	If LogonPatientID'="" Set %request.Data("PatientID",1)=LogonPatientID
	If LogonMradm'="" Set %request.Data("mradm",1) = LogonMradm
	// 不再从登录时传req过来, 超时后logonrefesh.csp时没办法传req。 20211208 wanghc
	S IsSideMenu = "false"  
	if ##Class(epr.GroupSettings).GetStartPage($g(%session.Data("LOGON.GROUPID")))=""{
		S IsSideMenu = "true"
	}
	S %request.Data("IsSideMenu",1)=IsSideMenu
	/*处理参数*/	
	Set Url = $g(%request.Data("TDIRECTPAGE",1))
	If (Url=""){Set Url = "epr.default.csp"}
	if (Url'=""){
		if Url'["?" Set Url = Url_"?a=a"
		Set key = "" For {
			Set key = $O(%request.Data(key))
			Quit:key=""
			Continue:key="TDIRECTPAGE"
			Continue:key="CacheNoRedirect"
			Continue:key="CachePassword"
			Continue:key="CacheUserName"
			Continue:key="LayoutManager"
			Continue:key="PASSWORD"
			Continue:key="CSPRQN" //Q"1m_$c(m3,01m)_m"
			Continue:"^DEPARTMENT^Hospital^SSUSERGROUPDESC^"[("^"_key_"^")
			Continue:"^TPSID^ViewCode^"[("^"_key_"^")
			Set Url = Url_"&"_key_"="_$G(%request.Data(key,1))
		}
	}
	If (ViewCode=""),(MenuIdByCode>0){Set Url="" /*直接到某菜单组时,不走工作流Url,让js点击第一个头菜单*/}
	Set HosAssemblyType = $g(%request.Data("assemblyType",1))
	
	Set ReqDisabledMutilScreen = $g(%request.Data("DisabledMutilScreen",1))
	If HosAssemblyType="embedded" Set ReqDisabledMutilScreen=1 /*嵌入组件禁用多屏*/
	//	Set Url = "epr.default.csp?EpisodeID="_LogonEpisodeID_"&PatientID="_LogonPatientID_"&MWToken="_($G(%request.Data("MWToken",1)))_"&mradm="_LogonMradm_"&IsSideMenu="_$g(%request.Data("IsSideMenu",1),"false")
	n comp
	s comp=##Class(websys.Component).OpenName("epr.Menu.Messages")
	i comp d comp.LoadTrans(),comp.%Close()
	w "<SCRIPT>",$c(13,10)
	; Dump out all the translated captions
	s code=""  f  s code=$o(t(code))  q:code=""  d
	. w "t['"_code_"']="_..QuoteJS($p($g(t(code),code),"^",1))_";",$c(13,10)
	if ##class(websys.Conversions).IsValidMethodName("CF.BSP.SYS.BL.OpenEvent","GetOpenEvent"){
	 	Write "var OpenEventJson = "
	 	d ##class(CF.BSP.SYS.BL.OpenEvent).GetOpenEvent()
 	}
 	Set CreateChatForMultiDevice = ##class(websys.StandardTypeItem).GetIdFromCodeOrDescription("websys","CreateChatForMultiDevice")
 	w !,"var EnableMultiScreenDisplay="""_##class(websys.StandardTypeItem).GetIdFromCodeOrDescription("websys","EnableMultiScreenDisplay")_""";"
 	w !,"var CreateChatForMultiDevice="""_CreateChatForMultiDevice_""";"
 	w "</SCRIPT>",$c(13,10),!
</server>


<server>
 s CfgLayoutNameSpace = ##class(websys.Configuration).GetLayoutManager() 	;##Class(web.DHCTHREEEX).GetServerNameSpace()
 s ServerNameSpace = "cn_iptcp:"_##class(ext.util.String).ServerIP()_"["_##class(ext.util.String).GetConnPort()_"]:DHC-APP"
 
 S CacheDetails = "{}"
 if ##class(websys.Conversions).IsValidMethodName("websys.DHCCache","CacheDetails"){
 	S CacheDetails = ##class(websys.DHCCache).CacheDetails(%session.Data("LOGON.GROUPID"),%session.Data("LOGON.CTLOCID"),%session.Get("LOGON.USERID"))
 }
 s Loc=%session.Data("LOGON.CTLOCID")
 s LocCode =$P($G(^CTLOC(Loc)),"^",1)
 s LocDesc=$P($G(^CTLOC(Loc)),"^",2)
 Set SplitDepDescDash = ##class(websys.StandardTypeItem).GetIdFromCodeOrDescription("websys","SplitDepDescDash") 
 If (SplitDepDescDash="")||(SplitDepDescDash=1){
	i $P(LocDesc,"-",2)'="" s LocDesc= $P(LocDesc,"-",2)
 }
 s UserId=%session.Data("LOGON.USERID")
 s HospId=%session.Data("LOGON.HOSPID")
 s HospCode = $P(^CT("HOSP",HospId),"^",1)
 s WardId=$O(^PAWARD(0,"WARD_LocationDR",Loc,""),-1) //$P(WardStr,"^",2)

 Set LockSrcTimeout=0 // 不启用锁屏
 if ##class(%Dictionary.PropertyDefinition).%ExistsId("websys.Configuration||LockScrTimeOut"){
	 Set LockSrcTimeout = +##class(websys.Configuration).GetFieldValue("LockScrTimeOut")
	 if ##class(%Dictionary.PropertyDefinition).%ExistsId("epr.GroupSettings||LockScrTimeOut"){
	 	set eprGrpId = ##class(epr.GroupSettings).GetIdFromGroupId(%session.Data("LOGON.GROUPID"))
	 	Set eprGrpObj  = ##class(epr.GroupSettings).%OpenId(eprGrpId,0)
	 	if eprGrpObj.LockScrTimeOut>0 Set LockSrcTimeout = eprGrpObj.LockScrTimeOut
	 }
 }
 Set MenuHoverHiddenEPREditorNum = ##class(websys.StandardTypeItem).GetIdFromCodeOrDescription("websys","MenuHoverHiddenEPREditorNum")
 Set CALogonTypeList = ##class(websys.CAInterface).GetLogonTypeList(Loc,"")
 Set CALogonDefaultType = $p($P(CALogonTypeList,"^",$p(CALogonTypeList,"$",2)),"|")
 Set LogonType=""
 if $d(%session.Data("CALogonType"),LogonType){
	// 20221028 使用ca登录了非CA科室后,再切换到CA科室时,需要资源校验证书是否正常
	if (LogonType'="") d ##class(websys.CAInterface).IsAndLoadJs(LogonType,Loc,"","","",%session.Data("LOGON.HOSPID"))
 }
 set cdssType=""
 s ctpcprowid=$P(^SSU("SSUSR",UserId),"^",14),CTCPTName="",CTCPTInternalType=""
 if (ctpcprowid'=""),$d(^CTPCP(ctpcprowid,1)) {
	 s CTPCPCarPrvTpDR = $p(^CTPCP(ctpcprowid,1),"^",4)
	 if CTPCPCarPrvTpDR'="" {
		 s CTCPTInternalType = $p(^CT("CPT",CTPCPCarPrvTpDR),"^",4)
		 S CTCPTName = $p(^CT("CPT",CTPCPCarPrvTpDR),"^",1)
	 }
 }
Set EnablePostLogon = ##class(websys.StandardTypeItem).GetIdFromCodeOrDescription("websys","EnablePostLogon")
Set rightMainMenuTitle = ..GetTrans("User.SSGroup","SSGRPDesc",GroupDesc)_"/"_..GetTrans("User.CTLoc","CTLOCDesc",LocDesc)
if EnablePostLogon { 
	Set rightMainMenuTitle = ..GetTrans("CT.BDP.CT.HOSPost","POSTDesc",$G(PostDesc))_"（"_rightMainMenuTitle_"）"
}

 Set hideBrand = $g(%request.Data("hideBrand",1))
 Set showHosTitle=$g(%request.Data("showTitle",1))
</server>
<SCRIPT Language="Javascript">
 /*
 VB,C#,C++连接Cache连接串 
 ServerNameSpace是web对应后台的Cache库的连接串,
 CfgLayoutNameSpace是[配置管理界面]配置的Cache连接串
 */
 ;var ServerNameSpace = "#(ServerNameSpace)#";
 var CfgLayoutNameSpace = "#(CfgLayoutNameSpace)#";
 /*缓存明细*/;
 var gCacheDetails = #(CacheDetails)#;  
 var WardId="#(WardId)#";
 var LocDesc="#(LocDesc)#";
 var LocCode = "#(LocCode)#";
 var LicVer="#(LicVer)#"
 var LicExpDate="#(LicExpDate)#"
 var LicVerSummary="#(LicVerSummary)#"
 var LicUserName="#(LicUserName)#"
 var LicUseType="#(LicUseType)#";
 var LicPrj="#(LicPrj)#"
 var ModelLicType="#(ModelLicType)#"
 var CurYear="#(CurYear)#";
 var EncryptCmpCode="#(EncryptCmpCode)#";
 var IsSideMenu = #(IsSideMenu)#;
 var popsw = "#(##class(dhc.dao.SSUser).Encode())#";
 var isValidUserEncypt = "#(##class(websys.Page).Encrypt($lb("web.SSUser.IsValidUserMd5Password")))#";
 var lockScreenOpt = {"encodeKey":"#(%session.SessionId)#","popsw":popsw,"timeout":#(LockSrcTimeout*60)#,"username":"#(%session.Data("LOGON.USERNAME"))#"};
 var groupMutilTabMenu = "#(GroupMutilTabMenu)#";
 var menuJson = {records:#(menuJson)#};
 var HeaderMenuHelpJson = {records:#(HeaderMenuHelpJson)#};
 var HeaderMenuDesc = "#(HeaderMenuDesc)#";
 var OtherMenuTan = "#(OtherMenuTan)#";
 var iconVolumeOnText = "#(iconVolumeOnText)#";
 var iconVolumeOffText = "#(iconVolumeOffText)#";
 var GroupShowPanelMenu = '#(GroupShowPanelMenu)#';
 var MenuHoverHiddenEPREditorNum = "#(MenuHoverHiddenEPREditorNum)#";
 var CALogonDefaultType = "#(CALogonDefaultType)#"
 var LastCALogonType = "#(LogonType)#";
 session["LOGON.CTLOCCODE"] = "#(LocCode)#";
 session["LOGON.CTLOCDESC"] = "#(LocDesc)#";
 session["LOGON.CTCPTINType"] = "#(CTCPTInternalType)#";
 var showHosTitle = "#(showHosTitle)#";
 var ViewCode = "#(ViewCode)#";
 var menuHeight = "#(MenuHeight)#";
 var LogonEpisodeID = "#(LogonEpisodeID)#";
 var LogonPatientID  = "#(LogonPatientID)#";
 var LogonMradm = "#(LogonMradm)#";
 var LogonAnaesthesiaID = "#(LogonAnaesthesiaID)#";
 var HosAssemblyType = "#(HosAssemblyType)#";
 var ReqDisabledMutilScreen = "#(ReqDisabledMutilScreen)#";
 var HomePageUrl = "#($zcvt(Url,"O","JS"))#";
 var PostDictCode = "#(PostDictCode)#";
</SCRIPT>
<SCRIPT SRC="../scripts/epr.menu.js"></SCRIPT>

<SCRIPT language="Javascript">
var securitymsg="#(securitymsg)#";
if (securitymsg!="") alert(securitymsg);

self.moveTo(0,0);
self.resizeTo(screen.availWidth,screen.availHeight);
var keepopen=false;
if (#(EnableExitAlert)#){
	window.onbeforeunload = unlockbeforeunload ;
}
function unlockbeforeunload(){
	if (#(EnableExitAlert)#){
		var DoingSthDesc = $("#DoingSth").val();
		if (DoingSthDesc!=""){
			if(window.event) window.event.returnValue = DoingSthDesc;
			return DoingSthDesc + "#(ExitTipLan)#";
		}
		if(!keepopen){
			return "#(ExitTipLan)#";
		}
	}
}
window.onunload=unlockonunload;                        //add by wuqk 2011-12-31
 
 // ab 19.12.07 65893 - check 'keepopen' flag rather than mouse cursor position
// keepopen flag is set on click of a 'home' menu
function unlockonunload() {
	if (navigator.sendBeacon) {
		navigator.sendBeacon("websys.closesession.csp?MWToken=#($G(%request.Data("MWToken",1)))#");
    }
	websys_onunload(); //关闭界面时,打开的界面也关闭
	if ('undefined'!=typeof CreateChatForMultiDevice && CreateChatForMultiDevice==1){
		if (HosAssemblyType!="embedded") websys_leaveChatClient();
	}
	if (!keepopen) {
		   try {unloadHandler();} catch(e) {}
		   window.logoutWebsysCDSS&&logoutWebsysCDSS();
		   //确定退出后,把before事件置空,IE11兼容到IE5后,加载新界面会再次触发before事件
		   window.onbeforeunload=function(){}
		   if(window.SysSoundInstc){
				window.SysSoundInstc.stopRecording();
			}
		   if (websys_isIE){
			   window.location.href="websys.closesession.csp";
		   }else{
				// window.open("websys.closesession.csp","TRAK_hidden"); //单步调试时可以关闭锁,但直接运行时有时不行
		   		// 处理chrome系统浏览器上不运行closese...csp问题
		   		//window.open("websys.closesession.csp","_blank","top=1200,left=0,width=20,height=20");
		   }
		   
	}
	return true;
}
 
//This is a workaround to try and distinguish between reloading the frame and closing the window
/*
function unlockonunload() {
	if (window.event) {
		if (window.event.clientY < 0) {
		   	try {unloadHandler();} catch(e) {}
			//alert("The browser is closing...");
			window.location.href="websys.closesession.csp";
		} else {
			//alert("The user is refreshing or navigating away...");
		}
	}
}
*/
function unloadHandler() {
	// SA 13.8.02 - log 26697: Function written in order to close Medicode 
	// when Medtrak is closed. While this code is only relevant to RIE, because 
	// there is no single component associated with this code, SP and I have agreed
	// that this code needs to be here rather than in a custom javascript.
	// This code also appears in websys.frames.csp

	// DDE object
	var objDDE;
	try {
		objDDE = new ActiveXObject("tkDDEInterface.clsConnect");
		objDDE.DDELinkTopic = "OINSIGHT|MW_MAINFORM.TXT_HOST_ID";
		objDDE.DDELinkMode = 2;
		objDDE.DDELinkItem = "TEXT";
		objDDE.DDEText = "MEDICODE_EXIT"
		objDDE.DDEPoke();
	} catch(e) {}
	
	// cjb 04/04/2006 58809 - unload SimpleCode when unloading web session
	var obj;
	try {
		obj = new ActiveXObject("tkPSimpleCode.clstkPSimpleCode");
		obj.ItemPath = "";
		obj.ClosePSimpleCodeWindow();
		obj="";
	} catch(e) {}

}

var DivBedSelected = "";
var isMenuLoaded = 0;
var isMainLoaded = 0;
var elementID="";
var elementValue="";

//TN: added multipleIDs parameter to pass to MultipleIDs fields for multiple selection. This is to store the main id of those items selected
//ie. off the episode list... multipleIDs will be "EpisodeID^episID1^episID2^episID3".... etc
//ie. off the orders workbench... multipleIDs will be "OEOrdItemID^oeoriID1^oeoriID2^oeoriID3".... etc
////////////////////////////////////////////////////////////////////
//IMPORTANT!!! TN: when adding new fields to be passed to this function, please remember to add to the Clear function below as well
////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////
////modify by wuqk 2010-05-20    begin
////////////////////////////////////////////////////////////////////
function SetEpisodeDetails(patID,episID,mradm,titleName,apptID,waitinglistID,OEOrdItemIDs,SinglePatientFlag,WardID,PAAdmCodingID,multipleIDs,OEORIItemStatus,BillRowIds,BillTypes,wlstatus,ARCIMDesc,FollowUpApptID,ItemApptStatus,Decease,ReqIDs,ReqVolIDs,canGiveBirth,MultiEpisodeID,OperRoomID,AnaesthesiaID,NokID,attendID) {
	//var win=top.frames['eprmenu'];
	//if (win) {
		//if (titleName=="") titleName='##--(%session.Get("TITLE"))--##';
		//websys_setTitleBar(titleName);
		//var frm = win.document.forms['fEPRMENU'];
		var frm = document.forms['fEPRMENU'];
		if (frm) {
			//HORRIBLE BUT SAFE SO CAN'T GET MIXED IDs... clear then set values
			for (var i=0; i<frm.elements.length; i++) {
				frm.elements[i].value="";
			}
			//
			frm.PatientID.value = patID;
			frm.EpisodeID.value = episID;
			frm.mradm.value = mradm;
			//alert("SetEpisodeDetails"+OperRoomID);
			if (apptID) frm.apptID.value=apptID;
			if (OperRoomID) frm.OperRoomID.value=OperRoomID;
			if (waitinglistID) frm.WaitingListID.value=waitinglistID;
			if (OEOrdItemIDs) frm.OEOrdItemID.value=OEOrdItemIDs;
			if (SinglePatientFlag) frm.SinglePatientFlag.value=SinglePatientFlag;
			if (WardID) frm.WardID.value=WardID;
			if (PAAdmCodingID) frm.PAAdmCodingID.value=PAAdmCodingID;
			if (multipleIDs) frm.MultipleIDs.value=multipleIDs;
			if (OEORIItemStatus) frm.OEORIItemStatus.value=OEORIItemStatus;
			if (BillRowIds) frm.BillRowIds.value=BillRowIds;
			if (BillTypes) frm.BillTypes.value=BillTypes;
			if (wlstatus) frm.WLWaitListStatusDR.value=wlstatus;
			if (ARCIMDesc) frm.ARCIMDesc.value=ARCIMDesc;
			if (FollowUpApptID) frm.FollowUpAppt.value=FollowUpApptID;
			if (ItemApptStatus) frm.ItemApptStatus.value=ItemApptStatus;
			if (Decease) frm.Decease.value=Decease;
			if (ReqIDs) frm.ReqIDs.value=ReqIDs;
			if (ReqVolIDs) frm.ReqVolIDs.value=ReqVolIDs;
			if (canGiveBirth) frm.canGiveBirth.value=canGiveBirth;
			if (MultiEpisodeID) frm.MultiEpisodeID.value=MultiEpisodeID;
			/*for (i in HEADERBUFFER) {
				if (frm.elements[i]) frm.elements[i].value=HEADERBUFFER[i];
			}*/
			if (NokID) frm.NokID.value=NokID;	// cjb 22/02/2006 56793
			if (AnaesthesiaID) frm.AnaesthesiaID.value=AnaesthesiaID;
			if (attendID) frm.attendID.value=attendID;  //log 61395 TedT
		}
	//}
}

function SetSingleField(fldname,val) {
	//var win=top.frames['eprmenu'];
	//if (win) {
		var frm = document.forms['fEPRMENU'];
		if (frm) {
			var fld=frm.elements[fldname];
			if (fld) fld.value=val;
		}
	//}

}
//created one clear function so will need to update just the one function instead of everywhere.
function MainClearEpisodeDetails() {
	//don't need this anymore, does a form loop
	//SetEpisodeDetails("","","","","","","","","","","","","","","","","","","","","","","","");
	//
	
		var frm = document.forms['fEPRMENU'];
		for (var i=0; i<frm.elements.length; i++) {
			frm.elements[i].value="";
		}
		//window.frames["eprmenu"].MENU_TRELOADPAGE='';
		//window.frames["eprmenu"].MENU_TRELOADID='';
	
}

//SA 4.1.01 - log 22468: Added mPiece function.
function mPiece(s1,sep,n) {
	//Getting wanted piece, passing (string,separator,piece number)
	//First piece starts from 0
	//Split the array with the passed delimeter
	delimArray = s1.split(sep);
	//If out of range, return a blank string
	if ((n <= delimArray.length-1) && (n >= 0)) return delimArray[n];
}
function SetKeepOpen(url,newwin) {
	keepopen = true;
	parent.keepopen = true;
	parent.location.href = url;
}
</SCRIPT>
<FORM name="fEPRMENU">
	<!--TN:23-Apr-2002:added field MultipleIDs for multiple selected IDs for generic looping workflows-->
	<INPUT TYPE="hidden" name="PatientID" id="PatientID" value="#($g(%request.Data("PatientID",1)))#">
	<INPUT TYPE="hidden" name="EpisodeID" id="EpisodeID" value="#($g(%request.Data("EpisodeID",1)))#">
	<INPUT TYPE="hidden" name="mradm" id="mradm" value="#($g(%request.Data("mradm",1)))#">
	<INPUT TYPE="hidden" name="Decease" value="">
	<INPUT TYPE="hidden" name="MultipleIDs" value="">
	<!-- WAITINGLIST -->
	<INPUT TYPE="hidden" name="WaitingListID" value="">
	<INPUT TYPE="hidden" name="WLWaitListStatusDR" value="">
	<!-- ORDERITEM -->
	<INPUT TYPE="hidden" name="OEOrdItemID" value="">
	<INPUT TYPE="hidden" name="OEORIItemStatus" value="">
	<INPUT TYPE="hidden" name="ARCIMDesc" value="">
	<INPUT TYPE="hidden" name="ItemApptStatus" value="">
	<!-- CODING -->
	<INPUT TYPE="hidden" name="PAAdmCodingID" value="">
	<!-- BILLING -->
	<INPUT TYPE="hidden" name="BillRowIds" value="">
	<INPUT TYPE="hidden" name="BillTypes" value="">
	<!-- BOOKING -->
	<INPUT TYPE="hidden" name="FollowUpAppt" value="">
	<INPUT TYPE="hidden" name="apptID" value="">
	<INPUT TYPE="hidden" name="OperRoomID" value="">
	<INPUT TYPE="hidden" id="AnaesthesiaID" name="AnaesthesiaID"  value="#($g(%request.Data("AnaesthesiaID",1)))#"> <!--OR_Anaesthesia用于在医嘱表加上麻醉表指针//-->
	<!-- 现在需要再加一个手术表OR_Anaest_Operation（麻醉表的子表）的ID，也在医嘱表中存,需要通过顶部菜单传手术表ID //-->
	<INPUT TYPE="hidden" name="AnaestOperationID" value=""> 
	
	<!-- MEDRECORD -->
	<INPUT TYPE="hidden" name="ReqIDs" value="">
	<INPUT TYPE="hidden" name="ReqVolIDs" value="">
	<!-- EPISODE -->
	<INPUT TYPE="hidden" name="MultiEpisodeID" value="">
	<INPUT TYPE="hidden" name="WardID" value="">
	<!-- MATERNITY -->
	<INPUT TYPE="hidden" name="canGiveBirth" value="">
	<!-- NEXT OF KIN - cjb 22/02/2006 56793 -->
	<INPUT TYPE="hidden" name="NokID" value="">
	<!-- Attendance - 61395 Tedt 01/07 -->
	<INPUT TYPE="hidden" name="attendID" value="">
	<INPUT TYPE="hidden" name="SpecificID" value="">
	<INPUT TYPE="hidden" name="SinglePatientFlag" value="">
	<!-- 药理实验项目指针 -->
	<INPUT TYPE="hidden" name="PPRowId" value="">
	<!--会计核算成品-帐套-->
	<INPUT TYPE="hidden" name="AcctBookID" id="AcctBookID" value="">
	<INPUT TYPE="hidden" name="AcctBookName" id="AcctBookName" value="">
	<INPUT TYPE="hidden" id="checkNewMessage" value='<%=##class(websys.Page).Encrypt($lb("web.SSMessageRecipient.countNewMessages"))%>'>
	<!-- 业务上正在做某事,菜单不能切换   DoingSthName为提示信息,为空表示可以切换-->
	<input Type="hidden" id="DoingSth" name="DoingSth" value="">
	<!-- 医技申请单号 PACSApplyNo -->
	<INPUT TYPE="hidden" name="PACSApplyNo" id="PACSApplyNo" value="">
</FORM>
<div class="navbarhead">
	<!---navbar-fixed-top wanghclayout-->
	<nav class="navbar navbar-default" id="menuPanel" style="height:#(MenuHeight)#px;border:0px;">
		<csp:if condition=(ViewCode="")> <!--隐藏菜单导航条-->
		<div class="navbar-container">
			<csp:if condition=hideBrand'=1>
			<div class="navbar-header pull-left" style="height:#(MenuHeight)#px;">
				<a href="#" class="navbar-brand" style="font-size:16px;color:#e8fffe;display: inline-block;width:140px;height:#(MenuHeight)#px;line-height:#(MenuHeight)#px;padding-top:0px;">
					<div><img src="../skin/default/images/websys/HO.svg"/></div>
				</a>
				<div style="display: inline-block;height: #(MenuHeight)#px;line-height: #(MenuHeight)#px;font-weight: bold;padding-right:30px;">#(WorkStationDesc)#</div>
				<!--<span style="font-size:10px;" class="glyphicon glyphicon-registration-mark"></span>-->
			</div>

			</csp:if>
			<!--header menu start//-->
			<div class="navbar-inner">
				<ul class="nav navbar-nav" id="left-menu">
				</ul>
			</div>
			<!--header menu end//-->
			<div class="navbar-header navbar-buttons pull-right" role="navigation">
				<ul class="nav navbar-nav">
				<!--style="padding:6px;display: inline-block;width: 30px; height: 30px; border: 1px #7BC2F2 solid; margin-top: 10px;background: #3FA2DF;"-->
					<li class='dhc-menu'>						
						<input class="sysMenuFindTxt" autocomplete=off placeholder="查询菜单" style="display: none;"/>
						<a id="sysMenuFindBtn" href="#" data-imodal='true' data-ilink="javascript:sysMenuFindHandler();" class="rightMainMenu dhc-submenu" style="display:inline-block;">
							<span class="dhc-fa-icon-large icon-findwebsysmenu" style="font-size:23px;"></span>
						</a>
					</li>
					<!--<li class="dhc-menu">
						<a id="dts" href="#" data-imodal='true' data-ilink="javascript:dtsBtnClickHandler();" class="rightMainMenu dhc-submenu" >
							<span class="dhc-fa-icon-large icon-dts" style="font-size:23px;"></span>
						</a>
					</li>-->
					<li class='dhc-menu'>
						<a id="sysSountBtn" href="#" data-imodal='true' data-ilink="javascript:sysSoundBtnClickHandler();" class="rightMainMenu dhc-submenu" >
							<span class="dhc-fa-icon-large icon-syssound" style="font-size:23px;"></span>
						</a>
					</li>
					<li class="dhc-menu">
						<!-- class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown"-->
						<a href="#" class="rightMainMenu">
							<span class="dhc-fa-icon-large icon-th-large" style="font-size:23px;" aria-hidden="true"></span>
						</a>
						<ul class="dropdown-menu">
							<li id="SystemHeaderMenuHelp">
								<a href="#" data-imodal='true' data-ilink="javascript:showHelp();" class="dhc-submenu">
									<i class="dhc-fa-icon-small icon-question-sign"></i>
									#(##class(websys.Translation).Get("DIC","帮助文档"))#
									</a>
							</li>
							<li>
								<a href="#" data-imodal='true' data-ilink="javascript:showConfig();" class="dhc-submenu">
									<i class="dhc-fa-icon-small icon-cog"></i>
									#(##class(websys.Translation).Get("DIC","页面设置"))#
								</a>
							</li>
							<csp:if condition=messageShowFlag=1>
								<li>
									<a href="#" data-imodal='true' data-ilink="javascript:toggleMsgAudio();" id="toggleMsgAudioA" class="dhc-submenu">
										<i class="dhc-fa-icon-small #(iconVolumeCls)#"></i><span>#(iconVolumeText)#</span></a>
								</li>
							</csp:if>
							<li>
								<a href="#" data-imodal='true' data-ilink="javascript:showAbout();" class="dhc-submenu">
									<i class="dhc-fa-icon-small icon-question-sign"></i> #(##class(websys.Translation).Get("DIC","关于"))#</a>
							</li>
							<!--
							<li>
								<a href="#" data-ilink="#" class="dhc-submenu">
									<i class="icon-font"></i>
									字体大小转换
								</a>
							</li>
							<li role="separator" class="divider"></li>
							<li>
								<div class="fontsettings">
									<span class="label label-danger" style="font-size:14px;" data-val="16">大</span>
									<span class="label label-primary" data-val="14">中</span>
									<span class="label label-warning" style="font-size:10px;" data-val="12">小</span>
								</div>
							</li>
							-->
						</ul>
					</li>
					<csp:if condition=messageShowFlag=1>
						<li class="dhc-menu">
							<!--data-ilink="dhc.message.csp" data-itarget="#WinModal" data-iblankOpt="title:'消息列表',width:900,height:500,showbefore:ShowDHCMessageCount" data-imodal='true'-->
							<a id="DHCMessageBtn" href="#" data-imodal='true' data-ilink="javascript:msgBtnClickHandler();" class="rightMainMenu dhc-submenu nullMessage" >
								<span class="dhc-fa-icon-large icon-envelope" style="font-size:23px;"></span>
								<span class="badge messagecount" > </span>
							</a>
						</li>
						
						<csp:if condition=MsgShowByCatgory="Y">
							<li class="dhc-menu">
								<a id="DHCMessageBtnNotice" href="#" data-imodal='true' data-ilink="javascript:msgBtnClickHandler('','N');" class="rightMainMenu dhc-submenu nullMessage" >
									<span class="dhc-fa-icon-large icon-notice" style="font-size:23px;"></span>
									<span class="badge messagecount" > </span>
								</a>
							</li>
						</csp:if>
					</csp:if>
					<csp:if condition=hideBrand'=1>
					<li class="dhc-menu">
						<!--class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" -->
						<a href="#" class="rightMainMenu hisui-tooltip rightMainMenu-user" data-options='position:"left"' title="#(rightMainMenuTitle)#">
							<span class="dhc-fa-icon-large icon-user-md" style="font-size:23px;"></span>
							<span class="userlocinfo">
								<span class="userinfo">#(%session.Data("LOGON.USERNAME"))#</span>
							</span>
						</a>
						<ul class="dropdown-menu">
							<li>
								<a href="#" data-ilink="websys.user.settings.csp" 
								data-itarget="#WinModalEasyUI" data-iblankOpt="width:750,height:450,isTopZindex:true" data-imodal='true' class="dhc-submenu">
									<i class="dhc-fa-icon-small icon-cog"></i> #(##class(websys.Translation).Get("DIC","个人中心"))#</a>
							</li>
							<li>
								<a href="#" data-ilink="websys.default.hisui.csp?WEBSYS.TCOMPONENT=websys.localnetinfo" 
								data-itarget="#WinModalEasyUI" data-iblankOpt="width:750,height:400,isTopZindex:true" data-imodal='true' class="dhc-submenu">
									<i class="dhc-fa-icon-small icon-cog"></i> #(##class(websys.Translation).Get("DIC","网络信息"))#</a>
							</li>
							<csp:if Condition=0=MWHOSAuth2Logon>
							<li>
								<a href="#" data-ilink="dhc.logon.otherloc.csp" data-itarget="#WinModalEasyUI" data-iblankOpt="width:800,height:500" data-imodal='true' class="dhc-submenu">
									<i class="dhc-fa-icon-small icon-exchange"></i>#(..Get("切换科室"))#</a>
							</li>
							</csp:if>
							<li>
								<a href="#" data-ilink="javascript:lockScreenOpt.lockScrn();" 
								data-itarget="#WinModalEasyUI" data-imodal='true' class="dhc-submenu">
									<i class="dhc-fa-icon-small icon-off"></i> #(##class(websys.Translation).Get("DIC","立即锁屏"))#</a>
							</li>
							<csp:if Condition=0=MWHOSAuth2Logon>
							<li role="separator" class="divider"></li>		
							<li>
								<a href="#" data-ilink="javascript:SetKeepOpen('websys.csp?TMENU=#(CloseSessionMenuId)#&relogon=1','')" data-itarget="TRAK_main" data-iblankOpt="" class="dhc-submenu">
									<i class="dhc-fa-icon-small icon-reply"></i>#(##class(websys.Translation).Get("DIC","重新登录"))#</a>
							</li>
							<li>
								<a href="#" data-ilink="javascript:SetKeepOpen('websys.csp?TMENU=#(CloseSessionMenuId)#','')" data-itarget="TRAK_main" data-iblankOpt="" class="dhc-submenu">
									<!--icon-signout-->
									<i class="dhc-fa-icon-small icon-off"></i>#(##class(websys.Translation).Get("DIC","退出系统"))#</a>
							</li>
							</csp:if>
						</ul>
					</li>
					</csp:if>
				</ul>
			</div>
		</div>
		</csp:if> <!--隐藏菜单导航条end-->
	</nav>
	</div>
	<div id="centerPanel" class="centerPanel" stylepp="border-right: 6px solid #509de1;" >
		<iframe name="TRAK_main" src="#(Url)#" width="100%" height="100%" scrolling="auto" marginwidth=0 marginheight=0 frameborder="no" framespacing=0 allowtransparency='true'>
		</iframe>
	</div>
	<div style="height:0px"  id="southPanel">
		<iframe name="TRAK_hidden" src="" width="100%" scrolling="auto" marginwidth=0 marginheight=0 frameborder="no" framespacing=0>
		</iframe>
	</div>
	<div id="WinModalEasyUI" style="padding:0px;overflow:hidden;" data-options="isTopZindex:true"></div>
	</div><!--中部区结束-->

	<script type="text/javascript" src="../scripts_lib/jQuery/jquery.tmpl.min.js"></script>
	<script type="text/javascript" src="../scripts/epr.frames.js"></script>
	<script type="text/javascript" src='../scripts/websys.jquery.js'></script>

	<script type="text/javascript" src='../scripts/websys.encrypt.js'></script>
	<script type="text/javascript" src='../scripts/websys.lockscreen.js'></script>

 	<SCRIPT type="text/javascript">
 		/*$("body").on("click",".dhc-submenu",function(){
	 		if (websys_emit){
				websys_emit("onHISLogonSuccess",{usercode:"YS01"});
				
			}		
	 	})*/
 	</SCRIPT>
	<SCRIPT type="text/javascript">
		var IEVersion = "#(IEVersion)#";
		var navbar,preSelectedMenu;
		var g_showMessage=("#($g(messageShowFlag))#"=="1");  //定义一个是否显示消息按钮js变量
		var LevelTypeFlag = "D,V,I,G"; 
		var msgBtnClickHandler = function(){} 
		function HideExecMsgWin (){};
		var ShowExecMsgWin = function(DetailsId,OtherJson){}
		// 第一次登录与消息有变化时调用。  
		// 请求query,刷新消息数量
		var ForceShowDHCMessageCount = function(isNewMsg,forceQuery){}
		//显示消息数量
		var ShowDHCMessageCount = function(){}

		/*$.parser.onComplete = function(context){
			// 当点消息按钮时,是用easyui的window打开的,所以parser再次调用,再次进入方法
			// context是$("#MessageWin")
			// 第一次context为undefined,不为空跳出.
			//console.log("parser.onComplete--all---"+context);
			if (!!context) return ;
			$("#Loading").fadeOut("fast");
			//ShowDHCMessageCount();
		}*/
		function tkMakeServerCall(tkclass,tkmethod) {
			if ((tkclass=='')||(tkmethod=='')) return '';
			var reqdata = {ClassName:tkclass,MethodName:tkmethod};
			for (var i=2; i<tkMakeServerCall.arguments.length; i++) {
				reqdata["P_"+(i-1)] = tkMakeServerCall.arguments[i];
			}
			var retval=$m(reqdata,false);
			return retval;
		}
		Object.defineProperty(document.getElementById('EpisodeID'), 'value',{
			set:function(v){
				
				this._value = v;
				if ((v!="") && menuJson.records){
					$cm({ClassName:"websys.Menu",MethodName:"Json",MenuId:"#(MenuIdByCode)#", GroupId:"#(GroupId)#",EpisodeID:v},function(menus){
						menuJson.records = menus;
						renderMenu($(document).width()-(eastPanelWidth||0));
					})
				}
				/*信息同步HOS*/
				var obj = {type: 'postFromProd',messageList:[{key: 'EpisodeID',value: v}]};
				if(window.parent && 'function'==typeof window.parent.postMessage) window.parent.postMessage(obj, "*")
			},
			get:function(){
				return this._value;
			}
		});
		Object.defineProperty(document.getElementById('AnaesthesiaID'), 'value',{
			set:function(v){
				this._value = v;
				/*信息同步HOS*/
				var obj = {type: 'postFromProd',messageList:[{key: 'AnaesthesiaID',value: v}]};
				if(window.parent && 'function'==typeof window.parent.postMessage) window.parent.postMessage(obj, "*")
			},
			get:function(){
				return this._value;
			}
		});
		Object.defineProperty(document.getElementById('PatientID'), 'value',{
			set:function(v){
				this._value = v;
				/*信息同步HOS*/
				var obj = {type: 'postFromProd',messageList:[{key: 'PatientID',value: v}]};
				if(window.parent && 'function'==typeof window.parent.postMessage) window.parent.postMessage(obj, "*")
			},
			get:function(){
				return this._value;
			}
		});
		/*html中为EpisodeID赋值不会触发Object.defineProperty的set方法*/
		SetEpisodeDetails(LogonPatientID,LogonEpisodeID,LogonMradm,"","","","","","","","","","","","","","","","","","","","","",LogonAnaesthesiaID,"","");
	</SCRIPT>
	<csp:if condition=(ViewCode="")>
	<script type="text/javascript" src='../scripts/DHCMessageEngine.js'></script>
	</csp:if>
	<server>
	if ##class(websys.Conversions).IsValidMethodName("BSP.GlobalPhrases.COM.PhrasesRules","GetPhrasesRulesBYID") {
	  if ##class(BSP.GlobalPhrases.COM.PhrasesRules).GetPhrasesRulesBYID(%session.Data("LOGON.USERID"),%session.Data("LOGON.CTLOCID"),%session.Data("LOGON.GROUPID")){
	    w "<script type=""text/javascript"" src='../scripts/emr/js/phrase.contextmanager.js'></script>"
	  }
	}
	/*if ##class(websys.Conversions).IsValidMethodName("web.DHCBL.BDP.BDPCDSSDeptUserAut","GetCDSSUserAutFlag") {
	  if ##class(web.DHCBL.BDP.BDPCDSSDeptUserAut).GetCDSSUserAutFlag(%session.Data("LOGON.CTLOCID"),%session.Data("LOGON.USERID")){
	    ;;w "<script type=""text/javascript"" src=""../scripts/dhcdoc/CDSSInterface.js""></script>"
	    w "<script type=""text/javascript"" src=""../scripts/bdp/CDSSVue/Public/DHCBDP_CDSS.js""></script>"
	  }
	}*/
	</server>
	<server>
	 if ((CreateChatForMultiDevice=1)&&(HosAssemblyType'="embedded")) {
		W "<script type=""text/javascript"" src='../scripts_lib/chat-client-1.9.1.js' charset='utf-8'></script>"
	 }
	</server>
	<server>
	if HosAssemblyType'="embedded", ##class(websys.Conversions).IsValidMethodName("CF.BSP.SYS.SRV.CDSSService","InitCDSSJS"){
		d ##class(CF.BSP.SYS.SRV.CDSSService).InitCDSSJS(%session.Data("LOGON.CTLOCID"),%session.Data("LOGON.USERID"))
	}
	</server>
	<Server>
	if ##class(websys.Conversions).IsValidMethodName("CF.BSP.MSG.SRV.AlertAction","hasAlertAction"),##class(CF.BSP.MSG.SRV.AlertAction).hasAlertAction(GroupId){
		S RollTime = +(##class(websys.StandardTypeItem).GetIdFromCodeOrDescription("websys","AlertRollTimes"))
		S DefaultPosition = ##class(websys.StandardTypeItem).GetIdFromCodeOrDescription("websys","AlertDefaultPosition")
		W "<script type=""text/javascript"">var websysAlertCfg = {rollTime:"_RollTime_",DefaultPosition:"""_DefaultPosition_"""}"_"</script>"
		W "<link rel=""stylesheet"" type=""text/css"" href=""../skin/default/css/websys.alert.css""/>",!
		W "<script type=""text/javascript"" src=""../scripts/websys.alert.js""></script>"
	}
	</Server>
</body>
</html>	
