<!-- Copyright (c) 2010 DHC Software Co.,Ltd. ALL RIGHTS RESERVED. --> 
<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
 //i ##Class(websys.SessionEvents).SessionExpired()
 i ##Class(ext.websys.SessionEvents).SessionExpired() q 1
</csp:method>
<HTML XMLNS=TRAK>
<HEAD>
<TITLE><TRAK:TRANSLATE id=title>##(%session.Get("TITLE"))##</TRAK:TRANSLATE></TITLE>
<!-- <TRAK:HEAD></TRAK:HEAD> -->
<EXTHEALTH:HEAD></EXTHEALTH:HEAD>
<!--DHC Add for lookup   -->
<LINK REL="stylesheet" TYPE="text/css" HREF="../scripts/lookup.css"></LINK>
<!--DHC End   -->
<SCRIPT LANGUAGE=Cache RUNAT=SERVER>
	//a very nasty hack for a very strange error !
	i $g(%request.Data("WEBSYS.TCOMPONENT",1))["Profile",$g(%request.Data("ID",1))="" {
		k %request.Data("WEBSYS.TCOMPONENT",1)
		w "<SCR","IPT language=javascript>",!
		w "	window.location.reload(true);",!
		w "</SCR","IPT>",!
	}
</SCRIPT>
<SCRIPT language=javascript>
var FindComponent='#(%request.Get("WEBSYS.TCOMPONENT"))#';
//TR_OnMouseDown
function TR_OMD(row) {
	if (selectedrow>-1) {
		RowUnHi(selectedrow);
	}
	RowHi(row);
	//selectedrow=row;
}

function OnKeyDownHandler(e) {
	if (maxrows>-1) {
		var eKey=websys_getKey(e);
		switch (eKey) {
		case 9: //Don't allow to tab off lookup table - therefore select
			var eSrc=websys_getSrcElement(e);
			if (FindComponent=="") RowSel(selectedrow);
			break;
		case 13: //Enter select
			var eSrc=websys_getSrcElement(e);
			if (eSrc.tagName!="A") RowSel(selectedrow);
			break;
		case 27: //Esc - jump out
			isSelected=0;
			window.close();
			break;
		case 33: //Page Up
			PrevPage();
			//window.event.cancelBubble;  //eat the key
			websys_cancel();
			return false;
			break;
		case 34: //Page Down
			NextPage();
			//window.event.cancelBubble;  //eat the key
			websys_cancel();
			return false;
			break;
		case 35: //End
			RowUnHi(selectedrow);
			selectedrow=maxrows;
			RowHi(selectedrow);
			break;
		case 36: //Home
			RowUnHi(selectedrow);
			selectedrow=minrows;
			RowHi(selectedrow);
			break;
		case 38: //Cursor up
			if (selectedrow>minrows) {
				RowUnHi(selectedrow);
				selectedrow-=1;
				RowHi(selectedrow);
				//window.event.cancelBubble;  //eat the key
				websys_cancel();
				return false;
			}
			break;
		case 40: //Cursor down
			if (selectedrow<maxrows) {
				RowUnHi(selectedrow);
				selectedrow+=1;
				RowHi(selectedrow);
				//window.event.cancelBubble;  //eat the key
				websys_cancel();
				return false;
			}
			break;
		} //switch
		//event.cancelBubble;
	} //maxrow>0
}

function RowHi(row) {
	var eTR=document.getElementById('tblLookup').tBodies[0].rows[row];
	eTR.className='clsLookUpSelected';
	selectedrow=row;
}
function RowUnHi(row) {
	var eTR=document.getElementById('tblLookup').tBodies[0].rows[row];
	eTR.className='';
}
function docHandler() {
	//websys_resizeT();
	var w=0;var h=0;
	//var f=this.document.body.all;
	var f=websys_getChildElements(this.document.body);
	for (var i=0;i<f.length;i++) {
		if (f[i].tagName=="TABLE") {
		//if (f[i].id=="tblLookup") {
			if (f[i].offsetWidth>w) w=f[i].offsetWidth;
			if (f[i].offsetHeight>h) h=f[i].offsetHeight;
		}
	}
	this.resizeTo(w+27,h+30);
	this.focus();
}

//function RowSel is generated by lookup method of cache object
</SCRIPT>
</HEAD>
<BODY bottomMargin=0 leftMargin=0 rightMargin=0 topMargin=0  CLASS="clsLookUp" onload="docHandler();">
<TABLE WIDTH="100%" style="left: 0px; top: 0px" border=0 cellspacing=0><TR><TD>
<SCRIPT LANGUAGE=CACHE RUNAT=SERVER>
 ;dhccpmreport.csp
 n comp

;KM 21-Nov-2001: For addition additional find components to a LookUp.
i $g(%request.Data("WEBSYS.TCOMPONENT",1))'="" { 
	s comp=##Class(websys.Component).OpenName($g(%request.Data("WEBSYS.TCOMPONENT",1)))
	i comp  {
		;w "<TABLE ><TR><TD>"
		;d comp.Show()
		;d comp.%Close()
		;w "</TD></TR></TABLE>"
	}
}
 ;d ##class(DHCCPMWeb.CPMBL.DHCBLRepCSP).GetComponentItemsList()
 ;d ##class(DHCCPMWeb.CPMBL.DHCBLRepCSP).ChooseTemplate()
 d ##class(DHCCPMWeb.CPMBL.DHCBLRepCSP).CPMReportEdit()
 ;s comp=##Class(websys.Component).OpenName("websys.Lookup.List")
 ;d comp.Show()
 ;d comp.%Close()
 /* 
 s id=%request.Get("ID")
 i id="",%request.Get("TFORM")'="" d
 . s id=%request.Get("TFORM") k %request.Data("TFORM")
 . s name=$p(id,"^",2,99)
 . s id=$p(id,"^",1),id=##Class(websys.Component).GetIdFromCodeOrDescription(id)
 . s id="d"_id_"i"_name d %request.Set("ID",id)
 ;
 i id'="" d
 . s compid=$e($p(id,"i",1),2,999)
 . s name=$p(id,"i",2,99)
 . ;s comp=##Class(websys.Component).%OpenId(compid)
 . ;i comp d  //find the item which matches (optimise...)
 . ;. f j=1:1:comp.Items.Count() i comp.Items.GetAt(j).Name=name d comp.Items.GetAt(j).Lookup(%request.Get("TPAGCNT")) q
 . ;. d comp.%Close()
 . i compid d
 . . s itmid=$o(^websys.ComponentItemsI("Name",compid," "_$zcvt(name,"U"),""))
 . . i itmid d
 . . . s itm=##Class(websys.ComponentItems).%OpenId(compid_"||"_itmid,0)
 . . . i itm d
 . . . . d itm.Lookup($g(%request.Data("TPAGCNT",1)))
 */
 ;
</SCRIPT>
</TD></TR></TABLE>
</BODY>
</HTML>
