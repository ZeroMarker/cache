
<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>

 q 1
</csp:method>


<script language="cache" runat="server">
	
	s action = $Get(%request.Data("action",1))
	s sortField = $Get(%request.Data("sort",1))
	s sortDir = $Get(%request.Data("dir",1))
	s start = $Get(%request.Data("start",1))
	s limit = $Get(%request.Data("limit",1))
	s searchField = $Get(%request.Data("searchField",1))
	s searchValue = $Get(%request.Data("searchValue",1))

	s active= $Get(%request.Data("active",1))
	s userCode = $Get(%request.Data("userCode",1))
	s rowid = $Get(%request.Data("rowid",1))
	s data = $Get(%request.Data("data",1))
	s periodType = $Get(%request.Data("periodType",1))
	s unitDr = $Get(%request.Data("unitDr",1))
	s period = $Get(%request.Data("period",1))
	s userDr = $Get(%request.Data("userDr",1))
    s schemDr = $Get(%request.Data("schemDr",1))
	s patDr = $Get(%request.Data("patDr",1))

	i action="list"  d
	.w ##class(dhc.pa.udata.uTest).ListRec(schemDr,period)
	
	i action="patList" d
	.w ##class(dhc.pa.udata.uTest).surveyPat(data)
	
	i action="detail"  d
	.w ##class(dhc.pa.udata.uSurveyScore).ListRec(schemDr,period,periodType,userDr,patDr,unitDr) 
	
	i action="schem"  d
	.w ##class(dhc.pa.udata.uTest).schem()
	
	i action="period1"  d
	.w ##class(dhc.pa.udata.uTest).period(schemDr)
	
	i action="cycle"  d
	.w ##class(dhc.pa.udata.uTest).cycle()
	
	i action="num"  d
	.w ##class(dhc.pa.udata.uTest).surveyNum(data)
	
	i action="jxunit"  d
	.;s userCode=$Get(%session.Data("userCode"))
	.w ##class(dhc.pa.udata.uTest).jxUnit(schemDr,userCode)

	i action="submit"  d
	.s result= ##class(dhc.pa.udata.uSurveyScore).insert(data)
	.i result=0 d
	..s str="{""success"":""true"",""info"":""提交成功""}" 
	.e  i result=1 d
	..s str="{""success"":""flase"",""info"":""数据重复""}" 
	. e  s str= "{""success"":""flase"",""info"":""提交失败""}"
	.w str
	
	
</script>