<!-- Copyright (c) 2010 DHC Software Co.,Ltd. ALL RIGHTS RESERVED. -->
<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
	i ##Class(DHCMRQ.Base.Util.Verification).SessionVerifi() q 1
	q 1
</csp:method>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title></title>
		<link rel="stylesheet" href="../scripts/dhcmrq/bootstrap-3.3.5-dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="../scripts/dhcmrq/font-awesome-4.6.3/css/font-awesome.min.css">
		<link rel="stylesheet" href="../scripts/dhcmrq/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css">
		<link rel="stylesheet" href="../scripts/dhcmrq/datatable-1.10.12/datatables.min.css">
		<link rel="stylesheet" href="../scripts/dhcmrq/css/main.css">
		<!--[if lte IE 6]>
	  	<link rel="stylesheet" type="text/css" href="../scripts/dhcmrq/bootstrap-3.3.5-dist/css/bootstrap-ie6.css">
	  <![endif]-->
	  <!--[if lte IE 8]>
	  	<link rel="stylesheet" type="text/css" href="../scripts/dhcmrq/bootstrap-3.3.5-dist/css/ie.css">
			<style media="screen">
				.col-md-1, .col-md-10, .col-md-11, .col-md-12, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9{
					padding-left: 0;
					padding-right: 0;
				}
			</style>
	  <![endif]-->
	  <style>
	  #startDate,#endDate{
		display:inline-block;
		width:100px;  
	  }
	  .top-card .col-sm-12 {
		margin:5px 0;  
	  }
	  .btn-group .btn{
		tansition:all 0.4s;
	  }
	  .btn-default.active, .btn-default:active, .open>.dropdown-toggle.btn-default {
    	color: #333;
    	background-color: #e5ffe5;
    	border-color: #16c79e;
      }
      .btn-default.active:hover{
	   	background-color: #e5ffe5;
    	border-color: #16c79e;
    	box-shadow: 0 0 4px #16c79e;
	  }
	  .btn-default.active:after {
		content: "\f00c";
    	font-family: FontAwesome;
		color: #16c79e;
	  }
	 </style>
	</head>
	<body>
		<div class="navbar navbar-static-top" style="background-color:#fff;">
			<div class="container-fluid">
				<div class="navbar-header">
					<button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a href="#" class="navbar-brand">病案首页数据质量督导系统</a>
				</div>
				<nav id="bs-navbar" class="collapse navbar-collapse">
					<ul class="nav navbar-nav">
						<!--
						<li class="active">
							<a href="../getting-started/">Getting started</a>
						</li>
						 -->
					</ul>
					<ul class="nav navbar-nav navbar-right">
						
					</ul>

				</nav>
			</div>
		</div>
		<div class="container-fluid">
			<div class="row top-card">
				<div class="col-sm-12">
					<span class="item-name">
						<i class="fa fa-calendar fa-lg"></i>
						查询时间
					</span>
					<input id="startDate" class="form-control input-sm" readonly>
					~
					<input id="endDate" class="form-control input-sm" readonly>
				</div>
				<div class="col-sm-12">
					<span class="item-name">
						<i class="fa fa-wpforms fa-lg"></i>
						病案状态
					</span> 
					<div class="btn-group btn-mr" data-toggle="buttons"> 
  						<label class="btn btn-default active">
    						<input type="checkbox" name="mrVersion" value="CLINIC" autocomplete="off" checked> 临床
  						</label>
  						<label class="btn btn-default active">
    						<input type="checkbox" name="mrVersion" value="CODING" autocomplete="off" checked>编目
  						</label>
  						<label class="btn btn-default">
    						<input type="checkbox" name="mrVersion" value="HQMS" autocomplete="off">HQMS
  						</label>
  						<label class="btn btn-default">
    						<input type="checkbox" name="mrVersion" value="WT4" autocomplete="off">卫统4
  						</label>
					</div>
				</div>
				<div class="col-sm-12">
					<span class="item-name">
						<i class="fa fa-list-alt fa-lg"></i>
						首页信息
					</span>
					<div class="btn-group" data-toggle="buttons">
  						<label class="btn btn-default active">
    						<input type="checkbox" name="itemClass" value="DEFIR-I" title="基本信息" autocomplete="off" checked>基本信息
  						</label>
  						<label class="btn btn-default active">
    						<input type="checkbox" name="itemClass" value="DEFIR-P" title="过程信息" autocomplete="off" checked>过程信息
  						</label>
  						<label class="btn btn-default">
    						<input type="checkbox" name="itemClass" value="DEFIR-D" title="诊疗信息" autocomplete="off">诊疗信息
  						</label>
  						<label class="btn btn-default">
    						<input type="checkbox" name="itemClass" value="DEFIR-B" title="费用信息" autocomplete="off">费用信息
  						</label>
					</div>
					<button type="button" onclick="searchByCondition()" data-loading-text="Loading..." class="btn btn-success pull-right" autocomplete="off">
  					确定
					</button>
				</div>
			</div>

			<!-- 中部表格图表 -->
			
			<div class="row">
				<div class="boxcq" id="one">
					<div class="ti">
						<i class="fa fa-balance-scale fa-lg"></i>总体对比
					</div>
					<ul class="nav nav-tabs boxnavcq" role="tablist">
						<li></li>
					</ul>
					<div class="tab-content">
						<div role="tabpanel" class="tab-pane active">
							<div class="row">
								<div class="col-sm-12">
									<table id="mrCompareTable" class="table table-striped table-bordered" width="100%">
										<thead>
											<tr><th rowspan="2">病案状态</th><th rowspan="2">病例数</th><th rowspan="2">首页完整率</th><th colspan="2" class="itemClass">信息</th><th rowspan="2">差异病历</th></tr>
											<tr><th>项目完整率</th><th style="border-right-width:1px;">平均得分</th></tr>
										</thead>
										<tbody></tbody>
									</table>
								</div>
							</div>
						</div>
						
					</div>
				</div>
			</div>
			
			<div class="row">
				<div class="boxcq">
					<div class="ti">
						<i class="fa fa-wpforms fa-lg"></i><span class="docName"></span>病历缺失项列表
					</div>
					<ul class="nav nav-tabs boxnavcq" role="tablist">
						<li></li>
					</ul>
					<div class="tab-content">
						<div role="tabpanel" class="tab-pane active">
							<div class="row" id="compareDiv"></div>
						</div>
						
					</div>
				</div>
			</div>
			
			
		</div>
		<!--
		<footer id="footer">
			<div class="container">
        <p class="text-muted">copyright <i class="fa fa-heartbeat fa-lg"></i> DHCC</p>
      </div>
		</footer>
		 -->
		 <div id="loading">
		 	<img src="../scripts/dhcmrq/images/loading.gif"/>
		 	<h3 class="info">正在加载<br>...</h3>
		 </div>
		 
		<DHCMRQ:HEAD></DHCMRQ:HEAD>
		<script type="text/javascript">
    	
    	init();//初始化
	
		searchByCondition();
    	
    	function loadData(){
	    	var mrVersionCode = [];
	    	var itemClass = [];
	    	var itemName = [];
	    	
	    	$("input[name='mrVersion']:checked").each(function () {
                   mrVersionCode.push(this.value);
            });
            $("input[name='itemClass']:checked").each(function () {
                itemClass.push(this.value);
                itemName.push(this.title);
            });
            $('.itemClass').html(itemName.join('+'));
            //console.log(mrVersionCode.join('^'))
            //console.log(itemClass.join('^'))
            //console.log(itemName.join('^'))
	    		
	    	$.post('dhcmrq.service.csp',
				{ClassName:'DHCMRQ.Compute.FpCompare',
			 	MethodName:'GetOverAllInfo',
			 	Params:startDate+','+endDate+','+mrVersionCode.join('^')+','+itemClass.join('^')
				},
				function(data){
					try{
						//console.log(depInfo)
						//console.log(JSON.parse(data));
						loadTable(JSON.parse(data),startDate,endDate,mrVersionCode,itemClass)
					}catch(err){
						console.log(err);
					}
			});
	    }

function loadTable(data,startDate,endDate,mrVersionCode,itemClass){
	
	var mrCompareTable = $('#mrCompareTable').DataTable( {
			dom: 'rt',
      		data: data,
			columns: [
            	{ "data": "fpDesc" 
            			//,
						//"render": function ( data, type, full, meta ) {
				      	//	return '<a title="查看问题详情" role="button" onclick="loadMissDetail(\''+full.fpDesc+'\')">'+full.fpDesc+'</a>';
					    //}
				},
            	{ "data": "fpCnt" },
				{ "data": "fpCplRatio" },
				{ "data": "cplRqItemRatio" },
				{ "data": "avgScore" },
				{ "data": "transScore" ,
						  "render": function ( data, type, full, meta ) {
				      		return '<a title="查看差异病例" role="button" onclick="addTab(\'差异病历列表\',\'dhcmrq.diffList.csp?startDate='+startDate+'&endDate='+endDate+'&mrType1='+mrVersionCode[0]+'&mrType2='+mrVersionCode[1]+'&itemClass='+itemClass.join('^')+'\',\'diffList\')">查看列表</a>';
					    }
				}
        	],
			order: [[1, 'desc']],
			drawCallback: function( settings ) {
	        		var thisPageData = this.api().rows( {page:'current'} ).data();
	        		//console.log(thisPageData)
	        		$('#compareDiv').html('');
					for (var i = 0; i < thisPageData.length; i++) {
						$('#compareDiv').append('<div class="col-sm-'+(12/thisPageData.length)+'">'
								+'	<table id="detailTable'+i+'" class="table table-striped" width="100%">'
								+'		<thead>'
								+'			<tr><th colspan="2"><strong>'+thisPageData[i]['fpDesc']+'</strong></th></tr>'
								+'			<tr><th>项目名称</th><th>触犯频次</th></tr>'
								+'		</thead>'
								+'		<tbody></tbody>'
								+'	</table>'
								+'</div>');
						$('#detailTable'+i).DataTable({
      						data: thisPageData[i]['mRqItemDtl'],
							columns:[
            						{ "data": "desc" },
									{ "data": "count" 
										//,
						  			  	//"render": function ( data, type, full, meta ) {
				      					//	return '<a title="查看病例详情" role="button" onclick="addTab(\''+full.desc+'缺失病例列表\',\'dhcmrq.caseList.csp?itemId='+full.ItemID+'&startDate='+startDate+'&endDate='+endDate+'&mrVersionCode='+mrVersionCode+'&depCode='+depCode+'&docName='+docName+'\',\'mrList'+full.ItemID+'\')">'+full.count+'</a>';
					    				//}
									}
        							],
        					order: [[1, 'desc']],
  						});
					}
	    	}
  	});
  	
}
	   </script>
	</body>
</html>
