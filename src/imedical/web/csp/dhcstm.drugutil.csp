<csp:content charset="UTF-8">
<SERVER>
s Action=$Get(%request.Data("actiontype",1))
s Start=$Get(%request.Data("start",1))
s Limit=$Get(%request.Data("limit",1))
s Sort=$Get(%request.Data("sort",1))
s Dir=$Get(%request.Data("dir",1))
s Desc = $Get(%request.Data("Desc",1))
s HospId=$Get(%session.Data("LOGON.HOSPID"))
i Action = "Hosp" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetHosp(Start,Limit)

i Action = "CTUom" d
    .s CTUomDesc = $Get(%request.Data("CTUomDesc",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetCTUom(CTUomDesc, Start,Limit)
i Action = "CONUom" d
    .s UomId = $Get(%request.Data("UomId",1))
    .s PUCTUomDesc = $Get(%request.Data("PUCTUomDesc",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetConUom(UomId, Start,Limit,PUCTUomDesc)
i Action = "INCIUom" d
    .s ItmRowid = $Get(%request.Data("ItmRowid",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetItmUom(ItmRowid)
 i Action = "GetSpec" d
    .s SpecItmRowId=$Get(%request.Data("SpecItmRowId",1))
    .s desc=$Get(%request.Data("desc",1))
    .s StrParam=$G(%session.Data("LOGON.GROUPID"))_"^"_$G(%session.Data("LOGON.CTLOCID"))_"^"_$G(%session.Data("LOGON.USERID"))
	.w ##class(web.DHCSTM.Util.DrugUtil).GetSpec(SpecItmRowId,desc,Start,Limit,StrParam)
i Action = "INCSCStkGrp" d
    .s StkType = $Get(%request.Data("StkType",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetINCSCStkGrp(StkType, Start,Limit,"")
i Action = "OperateType" d
    .s Type = $Get(%request.Data("Type",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetOperateType(Type)
i Action = "StkCat" d
    .s StkGrpId = $Get(%request.Data("StkGrpId",1))
    .s StkCatName=$Get(%request.Data("StkCatName",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetStkCat(StkGrpId, Start, Limit,StkCatName)
i Action = "PhcCat" d
    .S PhccDesc = $Get(%request.Data("PhccDesc",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPhcCat(PhccDesc, Start, Limit)
i Action = "PhcSubCat" d
    .s PhcCatId = $Get(%request.Data("PhcCatId",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPhcSubCat(PhcCatId, Start, Limit)
i Action = "PhcMinCat" d
    .s PhcSubCatId = $Get(%request.Data("PhcSubCatId",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPhcMinCat(PhcSubCatId, Start, Limit)
i Action = "PhcGeneric" d
    .s PhcGeName = $Get(%request.Data("PhcGeName",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPhcGeneric(PhcGeName, Start, Limit)
i Action = "PhcForm" d
    .s PHCFDesc = $Get(%request.Data("PHCFDesc",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPhcForm(PHCFDesc, Start, Limit)
i Action = "PHCInstruc" d
    .s PHCInDesc = $Get(%request.Data("PHCInDesc",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPHCInstruc(PHCInDesc, Start, Limit)
i Action = "PHCFreq" d
    .s PhcFrDesc = $Get(%request.Data("PhcFrDesc",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPHCFreq(PhcFrDesc, Start, Limit)
i Action = "PhcDuration" d
    .s PhcDuDesc = $Get(%request.Data("PhcDuDesc",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPhcDuration(PhcDuDesc, Start, Limit)
i Action = "OfficeCode" d
        .s Type = $Get(%request.Data("Type",1)) 
    .w ##class(web.DHCSTM.Util.DrugUtil).GetOfficeCode(Type,Start, Limit)
i Action = "PhcPoison" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPhcPoison(Start, Limit)
i Action = "ArcBillGrp" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetArcBillGrp(Start,Limit,Desc)
i Action = "ArcBillSub" d
    .s ARCBGRowId = $Get(%request.Data("ARCBGRowId",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetArcBillSub(ARCBGRowId,Start,Limit,Desc)
i Action = "OrderCategory" d
    .s StkType=$Get(%request.Data("StkType",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetOrderCategory(StkType,Start, Limit)
i Action = "ArcItemCat" d
    .s Desc = $Get(%request.Data("Desc",1))
    .s OrderCat= $Get(%request.Data("OrderCat",1))
    .s StkType=$Get(%request.Data("StkType",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetArcItemCat(OrderCat,Desc,Start,Limit,StkType)
i Action = "OECPriority" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetOECPriority(Start, Limit)
i Action = "MarkType" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetMarkType()
i Action = "PublicBiddingList" d
	.s PBLevel=$Get(%request.Data("PBLevel",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPublicBiddingList(PBLevel,Desc)
i Action = "BookCat" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetBookCat()
i Action = "GetItmInfo" d
    .s ItmRowid = $Get(%request.Data("ItmRowid",1))
    .s HospId = $Get(%request.Data("HospId",1))
    .s result=##class(web.DHCSTM.Util.DrugUtil).GetItmInfo(ItmRowid,HospId)
    .s result=##class(web.DHCSTM.Common.UtilCommon).hJsonChar(result)
    .w "{success:'true',info:'"_result_"'}"
;读取药品信息
i Action = "GetPhaOrderItemForDialog" d
    .s Input=$Get(%request.Data("Input",1))
    .s StkGrpRowId=$Get(%request.Data("StkGrpRowId",1))
    .s StkGrpType=$Get(%request.Data("StkGrpType",1))
    .s Locdr=$Get(%request.Data("Locdr",1))
    .s NotUseFlag=$Get(%request.Data("NotUseFlag",1))
    .s QtyFlag=$Get(%request.Data("QtyFlag",1))
    .s HospID=$Get(%request.Data("HospID",1))
    .s User=$G(%session.Data("LOGON.USERID")) //zhwh 2013-07-12 add
    .s StkCat=$Get(%request.Data("StkCat",1))
    .s toLoc=$Get(%request.Data("toLoc",1))
    .s ReqModeLimited=$Get(%request.Data("ReqModeLimited",1))
    .s NoLocReq=$Get(%request.Data("NoLocReq",1))
    .s Spec=$Get(%request.Data("Spec",1))
    .s Rp=$Get(%request.Data("Rp",1))
    .s Brand=$Get(%request.Data("Brand",1))
    .s sLoc=$G(%session.Data("CurrentStkLoc"))
    .s:sLoc="" sLoc=$G(%session.Data("LOGON.CTLOCID"))
    .s Vendor=$Get(%request.Data("Vendor",1))
    .s HV=$Get(%request.Data("HV",1))
    .s RequestNoStock=$Get(%request.Data("RequestNoStock",1))
    .s StrParam=Input_"^"_StkGrpRowId_"^"_StkGrpType_"^"_Locdr_"^"_NotUseFlag_"^"_QtyFlag_"^"_HospID_"^"_User_"^"_StkCat_"^"_toLoc_"^"_ReqModeLimited_"^"_NoLocReq_"^"_Spec_"^"_Rp_"^"_Brand_"^"_sLoc_"^"_Vendor_"^"_HV_"^"_RequestNoStock
    .d ##class(web.DHCSTM.Util.DrugUtil).GetPhaOrderItemInfo(Start,Limit,Sort,Dir,StrParam)
    .
;根据库存项条码读取药品信息
i Action = "GetPhaOrderItemByBarcode" d
    .s Input=$Get(%request.Data("Input",1))
    .s StkGrpRowId=$Get(%request.Data("StkGrpRowId",1))
    .s StkGrpType=$Get(%request.Data("StkGrpType",1))
    .s Locdr=$Get(%request.Data("Locdr",1))
    .s NotUseFlag=$Get(%request.Data("NotUseFlag",1))
    .s QtyFlag=$Get(%request.Data("QtyFlag",1))
    .s HospID=$Get(%request.Data("HospID",1))
    .s User=$G(%session.Data("LOGON.USERID")) //zhwh 2013-07-12 add
    .s sLoc=$G(%session.Data("LOGON.CTLOCID"))  //xuchao 2014-10-29 add
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPhaOrderItemByBarcode(Input, StkGrpRowId, StkGrpType, Locdr, NotUseFlag, QtyFlag, HospID, Start, Limit,User,sLoc)    
i Action = "GetDrugBatInfo" d
    .S InciDr=$Get(%request.Data("IncId",1))
    .S ProLocId=$Get(%request.Data("ProLocId",1))
    .S ReqLocId=$Get(%request.Data("ReqLocId",1))
    .s QtyFlag=$Get(%request.Data("QtyFlag",1))
    .s StkType=$Get(%request.Data("StkType",1))
    .s Inclb=$Get(%request.Data("Inclb",1))     ;此参数目前仅根据高值条码查询时用到, 查询特定批次
    .w ##class(web.DHCSTM.Util.DrugUtil).GetDrugBatInfo(InciDr, ProLocId, ReqLocId,QtyFlag,Start,Limit,StkType,Inclb)
    
i Action = "GetDrugBatInfoAll" d
    .S InciDr=$Get(%request.Data("IncId",1))
    .S ProLocId=$Get(%request.Data("ProLocId",1))
    .S ReqLocId=$Get(%request.Data("ReqLocId",1))
    .s QtyFlag=$Get(%request.Data("QtyFlag",1))
    .s StkType=$Get(%request.Data("StkType",1))
    .s Inclb=$Get(%request.Data("Inclb",1))     ;此参数目前仅根据高值条码查询时用到, 查询特定批次
    .d ##class(web.DHCSTM.Util.DrugUtil).GetDrugBatInfoAll(InciDr, ProLocId,Start,Limit,StkType)
   
i Action = "GetQualityLevel" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetQualityLevel()
i Action = "GetInsuCat" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetInsuCat()
i Action = "GetPBLevel" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetPBLevel()
i Action = "GetItmNotUseReason" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetItmNotUseReason()
i Action = "StkDecimal" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetStkDecimal()
i Action = "GetStkBin" d
    .s Desc = $Get(%request.Data("Desc",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetAllStkBin(Desc, Start, Limit)
i Action = "GetLocStkBin" d
    .s Desc = $Get(%request.Data("Desc",1))
    .s Loc=$g(%request.Data("LocId",1))
    .w ##class(web.DHCSTM.Util.DrugUtil).GetLocStkBin(Loc,Desc, Start, Limit)
i Action = "GetTarSubCate" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetTarSubCate(Desc, Start, Limit)
i Action = "GetTarAcctCate" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetTarAcctCate(Desc, Start, Limit)
i Action = "GetTarInpatCate" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetTarInpatCate(Desc, Start, Limit)
i Action = "GetTarMRCate" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetTarMRCate(Desc, Start, Limit)
i Action = "GetTarEMCCate" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetTarEMCCate(Desc, Start, Limit)
i Action = "GetTarOutpatCate" d
    .w ##class(web.DHCSTM.Util.DrugUtil).GetTarOutpatCate(Desc, Start, Limit)

i Action = "GetItmInfoByCode" d
    .s ItmCode = $Get(%request.Data("ItmCode",1))
    .s HospId = $Get(%request.Data("HospId",1))
    .s result=##class(web.DHCSTM.Util.DrugUtil).GetItmInfoByCode(ItmCode,HospId)
    .s result=##class(web.DHCSTM.Common.UtilCommon).hJsonChar(result)
    .w "{success:'true',info:'"_result_"'}"

i Action = "ChargeType" d
  .w ##class(web.DHCSTM.Util.DrugUtil).GetChargeType()
//获取新病案首页分类
i Action = "GetTarNewMRCate" d
	.w ##class(web.DHCSTM.Util.DrugUtil).GetTarNewMRCate(Desc, Start, Limit)
 
 i Action = "GetMedEqptCat" d
	.d ##class(web.DHCSTM.Util.DrugUtil).GetMedEqptCat(Desc, Start, Limit)

 i Action = "GetLocalLocInciAll" d
    .s LocId = $Get(%request.Data("ReqLocId",1))
    .s user=$Get(%request.Data("ReqUser",1))
    .s toLoc=$Get(%request.Data("toLoc",1))
    .d ##class(web.DHCSTM.Util.DrugUtil).GetLocalLocInciAll(LocId,user,toLoc)
    
 i Action = "MoveUp" d
    .s Rowid = $Get(%request.Data("ReRowid",1))
    .s result = ##class(web.DHCSTM.Util.DrugUtil).MoveUp(Rowid)
    .i result = 0 d
    ..w "{success:'true',info:'"_result_"'}"
    .e  d
    ..w "{success:'false',info:'"_result_"'}"
 i Action = "MoveDown" d
    .s Rowid = $Get(%request.Data("ReRowid",1))
    .s result = ##class(web.DHCSTM.Util.DrugUtil).MoveDown(Rowid)
    .i result = 0 d
    ..w "{success:'true',info:'"_result_"'}"
    .e  d
    ..w "{success:'false',info:'"_result_"'}"

i Action = "GetOrigin" d
 . s alias=$Get(%request.Data("Alias",1))
 . d ##class(web.DHCSTM.Util.DrugUtil).GetOrigin(alias,Start,Limit,HospId)
 
i Action = "Catequery" d
    .w ##class(web.DHCSTM.ItmCate).SelectAll()
///显示所有医嘱子类
i Action = "AllArcItemCat" d
	.s Desc = $Get(%request.Data("Desc",1))
	.w ##class(web.DHCSTM.Util.DrugUtil).GetAllArcItemCat(Desc,Start,Limit)
</SERVER>