<!-- Copyright (c) 2010 DHC Software Co.,Ltd. ALL RIGHTS RESERVED. --> 
<csp:method name=OnPreHTTP arguments="" returntype=%Boolean>
 i ##Class(websys.SessionEvents).SessionExpired() q 1
 quit 1
</csp:method>
<HTML XMLNS=TRAK>
<HEAD>
<TITLE><EXTHEALTH:TRANSLATE id=title>##(%session.Get("TITLE"))##</EXTHEALTH:TRANSLATE></TITLE>
<EXTHEALTH:EXT321></EXTHEALTH:EXT321>
<EXTHEALTH:HEAD></EXTHEALTH:HEAD>

<SCRIPT language=javascript>

function OnKeyDownHandler(e) {
	if (maxrows>-1) {
		var eKey=websys_getKey(e);
		switch (eKey) {
			/*
		case 9: //Don't allow to tab off lookup table - therefore select
			var eSrc=websys_getSrcElement(e);
			if (FindComponent=="") RowSel(selectedrow);
			break;*/
		case 13: //Enter select
			//var eSrc=websys_getSrcElement(e);
			//if (eSrc.tagName!="A") RowSel(selectedrow);
			selectRow();
			break;
		case 27: //Esc - jump out
			isSelected=0;
			window.close();
			break;
			
		case 33: //Page Up
			//PrevPage();
			//window.event.cancelBubble;  //eat the key
			if (pagingBar.getPageData().activePage>1){
				pagingBar.movePrevious();
			}
			websys_cancel();
			return false;
			break;
		case 34: //Page Down
			//NextPage();
			if (pagingBar.getPageData().activePage< pagingBar.getPageData().pages){
				pagingBar.moveNext();
			}
			//window.event.cancelBubble;  //eat the key
			websys_cancel();
			return false;
			break;
		
		case 35: //End
			//RowUnHi(selectedrow);
			//selectedrow=maxrows;
			//RowHi(selectedrow);
			if (pagingBar.getPageData().activePage!=pagingBar.getPageData().pages){
				pagingBar.moveLast();
			}
			break;
		case 36: //Home
			//RowUnHi(selectedrow);
			//selectedrow=minrows;
			//RowHi(selectedrow);
			if (pagingBar.getPageData().activePage>1){
				pagingBar.moveFirst();
			}
			break;
		/*case 38: //Cursor up
			if (selectedrow>minrows) {
				RowUnHi(selectedrow);
				selectedrow-=1;
				RowHi(selectedrow);
				//window.event.cancelBubble;  //eat the key
				websys_cancel();
				return false;
			}
			break;
		case 40: //Cursor down
			if (selectedrow<maxrows) {
				RowUnHi(selectedrow);
				selectedrow+=1;
				RowHi(selectedrow);
				//window.event.cancelBubble;  //eat the key
				websys_cancel();
				return false;
			}
			break;*/
		} //switch
		//event.cancelBubble;
	} //maxrow>0
}

function RowHi(row) {
	var eTR=document.getElementById('tblLookup').tBodies[0].rows[row];
	eTR.className='clsLookUpSelected';
	selectedrow=row;
}
function RowUnHi(row) {
	var eTR=document.getElementById('tblLookup').tBodies[0].rows[row];
	eTR.className='';
}
function docHandler() {
	//websys_resizeT();
	if (m_PageSize>0){
		m_PageHeight=150+(25*15);
	}else{
		
	}
	window.resizeTo(m_PageWidth,m_PageHeight);
}

//function RowSel is generated by lookup method of cache object
// 

</SCRIPT>

<style type="text/css">
	.x-grid3-row-alt{
		background-color:#b6d8fb; /*#3885d4/*005dc5/*0a246a/*eeea88*/;
		/*#fff0d0;*/
	}
	.x-grid3-row-selected{
		background-color: #b6d8fb;
	}
</style>

<script language='javascript' src='../scripts/framework/ext.websys.Lookup.List.js'></script>

<script language="Cache" runat="server">
	///¶¯Ì¬Ð´JSº¯Êý
	s myID=$g(%request.Data("ID",1))
	s myItemName=$p(myID,"i",2,199)
	s myCONTEXT=%request.Data("CONTEXT",1)
	s myjsf=$g(%request.Data("TLUJSF",1))
	w "<SCRIPT language=javascript>",!
	w "var minrows=0;",!
	w "var maxrows=1;",!
	w "var selectedrow=minrows;",!
	w "var isSelected=0;",!
	w "function GridRowSelect(firstCol,allCol) {",!
	w "	var par_win=window.opener;",!
	w " if(window.opener.dialogWindow){par_win = window.opener.dialogWindow}",!
	w "	try {par_win."_myItemName_"_lookupsel(unescape(firstCol));} catch (err) {}",!
	i myjsf'=""{
		w "	try {par_win."_myjsf_"(unescape(allCol));} catch (err) {}",!
		;;w "	par_win."_myjsf_"(unescape(allCol));",!
	}
	w " isSelected=1;",!
	w "	window.close();",!
	w "}",!
	w "",!
	w "",!
	w "",!
	w "function RegainFocus() {",!
	w " if (!isSelected) {",!
	w "  try {",!
	w "   var par_win=window.opener;",!
	w "   if(window.opener.dialogWindow){par_win = window.opener.dialogWindow}",!
	w "   par_win.websys_setfocus('"_myItemName_"');",!
	w "  } catch(e) {};",!
	w " }",!
	w "}",!
	
	w "</"_"script"_">",!

</script>


</HEAD>
<BODY bottomMargin=0 leftMargin=0 rightMargin=0 topMargin=0  CLASS="clsLookUp" onload="docHandler();">
<TABLE WIDTH="100%" style="left: 0px; top: 0px" border=0 cellspacing=0><TR><TD>
</TD></TR></TABLE>
<div id="grid3" style="width: 100%;height: 100%">
</div>

<SCRIPT language=javascript>

document.onkeydown=OnKeyDownHandler;

window.onunload=RegainFocus;

</SCRIPT>
</BODY>
</HTML>
